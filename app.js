var __webpack_modules__={42:function(t,e,i){t.exports=function(){function t(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self&&self;var e=t((function(t,e){t.exports=function(){function t(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function e(t){return Array.isArray(t)?[]:{}}function i(i,s){return s&&!0===s.clone&&t(i)?l(e(i),i,s):i}function s(e,s,n){var a=e.slice();return s.forEach((function(s,r){void 0===a[r]?a[r]=i(s,n):t(s)?a[r]=l(e[r],s,n):-1===e.indexOf(s)&&a.push(i(s,n))})),a}function n(e,s,n){var a={};return t(e)&&Object.keys(e).forEach((function(t){a[t]=i(e[t],n)})),Object.keys(s).forEach((function(r){t(s[r])&&e[r]?a[r]=l(e[r],s[r],n):a[r]=i(s[r],n)})),a}function l(t,e,l){var a=Array.isArray(e),r=(l||{arrayMerge:s}).arrayMerge||s;return a?Array.isArray(t)?r(t,e,l):i(e,l):n(t,e,l)}return l.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce((function(t,i){return l(t,i,e)}))},l}()}));var s=t((function(t,e){e.default={svg:{name:"xmlns",uri:"http://www.w3.org/2000/svg"},xlink:{name:"xmlns:xlink",uri:"http://www.w3.org/1999/xlink"}},t.exports=e.default})),n=s.svg,l=s.xlink,a={};a[n.name]=n.uri,a[l.name]=l.uri;var r,o=function(t,i){return void 0===t&&(t=""),"<svg "+function(t){return Object.keys(t).map((function(e){return e+'="'+t[e].toString().replace(/"/g,"&quot;")+'"'})).join(" ")}(e(a,i||{}))+">"+t+"</svg>"},h=s.svg,p=s.xlink,d={attrs:(r={style:["position: absolute","width: 0","height: 0"].join("; "),"aria-hidden":"true"},r[h.name]=h.uri,r[p.name]=p.uri,r)},c=function(t){this.config=e(d,t||{}),this.symbols=[]};c.prototype.add=function(t){var e=this.symbols,i=this.find(t.id);return i?(e[e.indexOf(i)]=t,!1):(e.push(t),!0)},c.prototype.remove=function(t){var e=this.symbols,i=this.find(t);return!!i&&(e.splice(e.indexOf(i),1),i.destroy(),!0)},c.prototype.find=function(t){return this.symbols.filter((function(e){return e.id===t}))[0]||null},c.prototype.has=function(t){return null!==this.find(t)},c.prototype.stringify=function(){var t=this.config.attrs,e=this.symbols.map((function(t){return t.stringify()})).join("");return o(e,t)},c.prototype.toString=function(){return this.stringify()},c.prototype.destroy=function(){this.symbols.forEach((function(t){return t.destroy()}))};var u=function(t){var e=t.id,i=t.viewBox,s=t.content;this.id=e,this.viewBox=i,this.content=s};u.prototype.stringify=function(){return this.content},u.prototype.toString=function(){return this.stringify()},u.prototype.destroy=function(){var t=this;["id","viewBox","content"].forEach((function(e){return delete t[e]}))};var g=function(t){var e=!!document.importNode,i=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return e?document.importNode(i,!0):i},_=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={isMounted:{}};return i.isMounted.get=function(){return!!this.node},e.createFromExistingNode=function(t){return new e({id:t.getAttribute("id"),viewBox:t.getAttribute("viewBox"),content:t.outerHTML})},e.prototype.destroy=function(){this.isMounted&&this.unmount(),t.prototype.destroy.call(this)},e.prototype.mount=function(t){if(this.isMounted)return this.node;var e="string"==typeof t?document.querySelector(t):t,i=this.render();return this.node=i,e.appendChild(i),i},e.prototype.render=function(){var t=this.stringify();return g(o(t)).childNodes[0]},e.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},Object.defineProperties(e.prototype,i),e}(u),f={autoConfigure:!0,mountTo:"body",syncUrlsWithBaseTag:!1,listenLocationChangeEvent:!0,locationChangeEvent:"locationChange",locationChangeAngularEmitter:!1,usagesToUpdate:"use[*|href]",moveGradientsOutsideSymbol:!1},C=function(t){return Array.prototype.slice.call(t,0)},y=function(){return/firefox/i.test(navigator.userAgent)},E=function(){return/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)},v=function(){return/edge/i.test(navigator.userAgent)},m=function(t){return(t||window.location.href).split("#")[0]},w=function(t){angular.module("ng").run(["$rootScope",function(e){e.$on("$locationChangeSuccess",(function(e,i,s){var n,l,a;n=t,l={oldUrl:s,newUrl:i},(a=document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,l),window.dispatchEvent(a)}))}])},x=function(t,e){return void 0===e&&(e="linearGradient, radialGradient, pattern, mask, clipPath"),C(t.querySelectorAll("symbol")).forEach((function(t){C(t.querySelectorAll(e)).forEach((function(e){t.parentNode.insertBefore(e,t)}))})),t};var S=s.xlink.uri,b="xlink:href",A=/[{}|\\\^\[\]`"<>]/g;function M(t){return t.replace(A,(function(t){return"%"+t[0].charCodeAt(0).toString(16).toUpperCase()}))}var T,P=["clipPath","colorProfile","src","cursor","fill","filter","marker","markerStart","markerMid","markerEnd","mask","stroke","style"],I=P.map((function(t){return"["+t+"]"})).join(","),O=function(t,e,i,s){var n,l,a=M(i),r=M(s);(n=t.querySelectorAll(I),l=function(t){var e=t.localName,i=t.value;return-1!==P.indexOf(e)&&-1!==i.indexOf("url("+a)},C(n).reduce((function(t,e){if(!e.attributes)return t;var i=C(e.attributes),s=l?i.filter(l):i;return t.concat(s)}),[])).forEach((function(t){return t.value=t.value.replace(new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r)})),function(t,e,i){C(t).forEach((function(t){var s=t.getAttribute(b);if(s&&0===s.indexOf(e)){var n=s.replace(e,i);t.setAttributeNS(S,b,n)}}))}(e,a,r)},L="mount",H="symbol_mount",D=function(t){function i(i){var s=this;void 0===i&&(i={}),t.call(this,e(f,i));var n,l=(n=n||Object.create(null),{on:function(t,e){(n[t]||(n[t]=[])).push(e)},off:function(t,e){n[t]&&n[t].splice(n[t].indexOf(e)>>>0,1)},emit:function(t,e){(n[t]||[]).map((function(t){t(e)})),(n["*"]||[]).map((function(i){i(t,e)}))}});this._emitter=l,this.node=null;var a=this.config;if(a.autoConfigure&&this._autoConfigure(i),a.syncUrlsWithBaseTag){var r=document.getElementsByTagName("base")[0].getAttribute("href");l.on(L,(function(){return s.updateUrls("#",r)}))}var o=this._handleLocationChange.bind(this);this._handleLocationChange=o,a.listenLocationChangeEvent&&window.addEventListener(a.locationChangeEvent,o),a.locationChangeAngularEmitter&&w(a.locationChangeEvent),l.on(L,(function(t){a.moveGradientsOutsideSymbol&&x(t)})),l.on(H,(function(t){var e;a.moveGradientsOutsideSymbol&&x(t.parentNode),(E()||v())&&(e=[],C(t.querySelectorAll("style")).forEach((function(t){t.textContent+="",e.push(t)})))}))}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var s={isMounted:{}};return s.isMounted.get=function(){return!!this.node},i.prototype._autoConfigure=function(t){var e=this.config;void 0===t.syncUrlsWithBaseTag&&(e.syncUrlsWithBaseTag=void 0!==document.getElementsByTagName("base")[0]),void 0===t.locationChangeAngularEmitter&&(e.locationChangeAngularEmitter=void 0!==window.angular),void 0===t.moveGradientsOutsideSymbol&&(e.moveGradientsOutsideSymbol=y())},i.prototype._handleLocationChange=function(t){var e=t.detail,i=e.oldUrl,s=e.newUrl;this.updateUrls(i,s)},i.prototype.add=function(e){var i=t.prototype.add.call(this,e);return this.isMounted&&i&&(e.mount(this.node),this._emitter.emit(H,e.node)),i},i.prototype.attach=function(t){var e=this,i=this;if(i.isMounted)return i.node;var s="string"==typeof t?document.querySelector(t):t;return i.node=s,this.symbols.forEach((function(t){t.mount(i.node),e._emitter.emit(H,t.node)})),C(s.querySelectorAll("symbol")).forEach((function(t){var e=_.createFromExistingNode(t);e.node=t,i.add(e)})),this._emitter.emit(L,s),s},i.prototype.destroy=function(){var t=this,e=t.config,i=t.symbols,s=t._emitter;i.forEach((function(t){return t.destroy()})),s.off("*"),window.removeEventListener(e.locationChangeEvent,this._handleLocationChange),this.isMounted&&this.unmount()},i.prototype.mount=function(t,e){void 0===t&&(t=this.config.mountTo),void 0===e&&(e=!1);var i=this;if(i.isMounted)return i.node;var s="string"==typeof t?document.querySelector(t):t,n=i.render();return this.node=n,e&&s.childNodes[0]?s.insertBefore(n,s.childNodes[0]):s.appendChild(n),this._emitter.emit(L,n),n},i.prototype.render=function(){return g(this.stringify())},i.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},i.prototype.updateUrls=function(t,e){if(!this.isMounted)return!1;var i=document.querySelectorAll(this.config.usagesToUpdate);return O(this.node,i,m(t)+"#",m(e)+"#"),!0},Object.defineProperties(i.prototype,s),i}(c),R=t((function(t){var e;e=function(){var t,e=[],i=document,s=i.documentElement.doScroll,n="DOMContentLoaded",l=(s?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return l||i.addEventListener(n,t=function(){for(i.removeEventListener(n,t),l=1;t=e.shift();)t()}),function(t){l?setTimeout(t,0):e.push(t)}},t.exports=e()})),k="__SVG_SPRITE_NODE__",B="__SVG_SPRITE__";window[B]?T=window[B]:(T=new D({attrs:{id:k,"aria-hidden":"true"}}),window[B]=T);var V=function(){var t=document.getElementById(k);t?T.attach(t):T.mount(document.body,!0)};return document.body?V():R(V),T}()},79:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(315),n=i(83);class l extends s.A{constructor(t,e,i="#FFFFFF",s="#000000",n=1){super(t,i,s,n),this.imageSrc=e,this.shadow=!1,this.preserveImageAspect=!0}getSvgScreenOffset(){return 0}apply(t){super.apply(t),this.fill=n.x3,this.stroke=n.x3,this.gradient=n.x3,this.style&&null!=this.style.imageAspect&&(this.preserveImageAspect=this.style.imageAspect)}isHtmlAllowed(){return!this.preserveImageAspect}isRoundable(t,e,i,s,n){return!1}paintVertexShape(t,e,i,s,l){if(this.imageSrc){const a=this.style?.imageBackground??n.x3,r=this.style?.imageBorder??n.x3;a!==n.x3&&(t.setFillColor(a),t.setStrokeColor(r),t.rect(e,i,s,l),t.fillAndStroke()),t.image(e,i,s,l,this.imageSrc,this.preserveImageAspect,!1,!1),r!==n.x3&&(t.setShadow(!1),t.setStrokeColor(r),t.rect(e,i,s,l),t.stroke())}else this.paintBackground(t,e,i,s,l)}}const a=l},83:(t,e,i)=>{i.d(e,{$g:()=>X,$o:()=>b,$p:()=>r,CT:()=>W,Cx:()=>q,DK:()=>l,Ec:()=>pt,FK:()=>u,FV:()=>$,Fb:()=>j,G2:()=>ct,G7:()=>y,IW:()=>Ct,J8:()=>F,JP:()=>R,Jk:()=>O,Js:()=>_,Lm:()=>S,M8:()=>dt,MO:()=>L,MQ:()=>H,Mm:()=>c,Mn:()=>k,Q5:()=>tt,QG:()=>o,QX:()=>Q,RH:()=>g,SR:()=>I,SU:()=>T,Sr:()=>Y,TE:()=>ut,V8:()=>x,Vj:()=>C,Vm:()=>M,XA:()=>N,XW:()=>G,XZ:()=>v,Xy:()=>D,_v:()=>ht,aQ:()=>V,aY:()=>ft,ag:()=>A,aq:()=>gt,bF:()=>w,bR:()=>_t,dZ:()=>z,eX:()=>E,es:()=>m,fQ:()=>et,fm:()=>K,gK:()=>lt,ir:()=>s,jo:()=>f,mE:()=>ot,nh:()=>P,pC:()=>nt,pK:()=>p,pr:()=>h,qG:()=>st,r5:()=>B,s4:()=>at,tK:()=>Z,vd:()=>n,wh:()=>J,x3:()=>rt,xU:()=>it,y2:()=>d,yS:()=>U});const s=.3,n=8,l=0;var a,r;!function(t){t.EXACT="exact",t.FASTER="faster",t.FASTEST="fastest"}(a||(a={})),function(t){t.SVG="svg",t.MIXEDHTML="mixedHtml",t.PREFERHTML="preferHtml",t.STRICTHTML="strictHtml"}(r||(r={}));const o="mxObjectId",h="http://www.w3.org/2000/svg",p="http://www.w3.org/1999/xlink",d="gray",c=2,u=3,g=1;var _;!function(t){t[t.ELEMENT=1]="ELEMENT",t[t.ATTRIBUTE=2]="ATTRIBUTE",t[t.TEXT=3]="TEXT",t[t.CDATA=4]="CDATA",t[t.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",t[t.ENTITY=6]="ENTITY",t[t.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",t[t.COMMENT=8]="COMMENT",t[t.DOCUMENT=9]="DOCUMENT",t[t.DOCUMENTTYPE=10]="DOCUMENTTYPE",t[t.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",t[t.NOTATION=12]="NOTATION"}(_||(_={}));const f=16,C="#00FF00",y="#FF0000",E="#00FF00",v=5,m=3,w=2,x=100;var S;!function(t){t.MOVABLE_VERTEX="move",t.MOVABLE_EDGE="move",t.LABEL_HANDLE="default",t.TERMINAL_HANDLE="pointer",t.BEND_HANDLE="crosshair",t.VIRTUAL_BEND_HANDLE="crosshair",t.CONNECT="pointer"}(S||(S={}));const b="#FF0000",A="#0000FF",M="#00FF00",T="#FF0000",P="#00FF00",I="#00FF00",O=1,L=1,H=!0,D=!0,R="#FF0000",k=1,B=6,V=4,U="#00FF00",N="black",z="yellow",G="#0000FF",F="#FF0000",W="Arial,Helvetica",$=11,Y="",X=1.2,q="normal",j=!1,K=0,Q=40,J=6,Z=24,tt=30,et=.15,it=20,st=0,nt=30,lt=30,at=[0,0,827,1169],rt="none";var ot,ht,pt,dt,ct;!function(t){t[t.BOLD=1]="BOLD",t[t.ITALIC=2]="ITALIC",t[t.UNDERLINE=4]="UNDERLINE",t[t.STRIKETHROUGH=8]="STRIKETHROUGH"}(ot||(ot={})),function(t){t.CLASSIC="classic",t.CLASSIC_THIN="classicThin",t.BLOCK="block",t.BLOCK_THIN="blockThin",t.OPEN="open",t.OPEN_THIN="openThin",t.OVAL="oval",t.DIAMOND="diamond",t.DIAMOND_THIN="diamondThin"}(ht||(ht={})),function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(pt||(pt={})),function(t){t.NORTH="north",t.SOUTH="south",t.EAST="east",t.WEST="west"}(dt||(dt={})),function(t){t.DEFAULT="",t.AUTO="auto",t.LTR="ltr",t.RTL="rtl"}(ct||(ct={}));const ut={NONE:0,WEST:1,NORTH:2,SOUTH:4,EAST:8,ALL:15};var gt,_t,ft,Ct;!function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"}(gt||(gt={})),function(t){t.ELBOW="elbowEdgeStyle",t.ENTITY_RELATION="entityRelationEdgeStyle",t.LOOP="loopEdgeStyle",t.SIDETOSIDE="sideToSideEdgeStyle",t.TOPTOBOTTOM="topToBottomEdgeStyle",t.ORTHOGONAL="orthogonalEdgeStyle",t.SEGMENT="segmentEdgeStyle",t.MANHATTAN="manhattanEdgeStyle"}(_t||(_t={})),function(t){t.ELLIPSE="ellipsePerimeter",t.RECTANGLE="rectanglePerimeter",t.RHOMBUS="rhombusPerimeter",t.HEXAGON="hexagonPerimeter",t.TRIANGLE="trianglePerimeter"}(ft||(ft={})),function(t){t.RECTANGLE="rectangle",t.ELLIPSE="ellipse",t.DOUBLE_ELLIPSE="doubleEllipse",t.RHOMBUS="rhombus",t.LINE="line",t.IMAGE="image",t.ARROW="arrow",t.ARROW_CONNECTOR="arrowConnector",t.LABEL="label",t.CYLINDER="cylinder",t.SWIMLANE="swimlane",t.CONNECTOR="connector",t.ACTOR="actor",t.CLOUD="cloud",t.TRIANGLE="triangle",t.HEXAGON="hexagon"}(Ct||(Ct={}))},127:(t,e,i)=>{i.d(e,{A:()=>n});class s{static putValue(t,e){s.values[t]=e}static getValue(t){return s.values[t]}static getName(t){for(const e in s.values)if(s.values[e]===t)return e;return null}}s.values={};const n=s},272:(t,e,i)=>{i.d(e,{eo:()=>n,m5:()=>l});var s=i(83);const n={logger:new class{debug(t){}enter(t){}error(t,...e){}info(t){}leave(t,e){}show(){}trace(t){}warn(t){}}},l={shadowColor:s.y2,shadowOffsetX:s.Mm,shadowOffsetY:s.FK,shadowOpacity:s.RH}},306:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(83);class n{}n.basePath=".",n.setBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.basePath=t):n.basePath="."},n.imageBasePath=".",n.setImageBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.imageBasePath=t):n.imageBasePath=`${n.basePath}/images`},n.IS_EDGE="undefined"!=typeof window&&null!=navigator.userAgent&&!!navigator.userAgent.match(/Edge\//),n.IS_NS="undefined"!=typeof window&&null!=navigator.userAgent&&navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0,n.IS_SF="undefined"!=typeof window&&/Apple Computer, Inc/.test(navigator.vendor),n.IS_ANDROID="undefined"!=typeof window&&navigator.appVersion.indexOf("Android")>=0,n.IS_IOS="undefined"!=typeof window&&/iP(hone|od|ad)/.test(navigator.platform),n.IS_GC="undefined"!=typeof window&&/Google Inc/.test(navigator.vendor),n.IS_CHROMEAPP="undefined"!=typeof window&&null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,n.IS_FF=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,n.IS_MT="undefined"!=typeof window&&(navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0),n.IS_SVG="undefined"!=typeof window&&"MICROSOFT INTERNET EXPLORER"!==navigator.appName.toUpperCase(),n.NO_FO="undefined"!=typeof window&&(!document.createElementNS||"[object SVGForeignObjectElement]"!==document.createElementNS(s.pr,"foreignObject").toString()||navigator.userAgent.indexOf("Opera/")>=0),n.IS_WIN="undefined"!=typeof window&&navigator.appVersion.indexOf("Win")>0,n.IS_MAC="undefined"!=typeof window&&navigator.appVersion.indexOf("Mac")>0,n.IS_CHROMEOS="undefined"!=typeof window&&/\bCrOS\b/.test(navigator.appVersion),n.IS_TOUCH="undefined"!=typeof window&&"ontouchstart"in document.documentElement,n.IS_POINTER="undefined"!=typeof window&&null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),n.IS_LOCAL="undefined"!=typeof window&&document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0;const l=n},315:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(83),n=i(341);class l extends n.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isHtmlAllowed(){let t=!0;return this.style&&null!=this.style.pointerEvents&&(t=this.style.pointerEvents),!this.isRounded&&!this.glass&&0===this.rotation&&(t||this.fill!==s.x3)}paintBackground(t,e,i,n,l){let a=!0;if(this.style&&null!=this.style.pointerEvents&&(a=this.style.pointerEvents),a||this.fill!==s.x3||this.stroke!==s.x3){if(a||this.fill!==s.x3||(t.pointerEvents=!1),this.isRounded){let a=0;if(this.style?.absoluteArcSize)a=Math.min(n/2,Math.min(l/2,(this.style?.arcSize??s.xU)/2));else{const t=(this.style?.arcSize??100*s.fQ)/100;a=Math.min(n*t,l*t)}t.roundrect(e,i,n,l,a,a)}else t.rect(e,i,n,l);t.fillAndStroke()}}isRoundable(t,e,i,s,n){return!0}paintForeground(t,e,i,n,l){this.glass&&!this.outline&&this.fill!==s.x3&&this.paintGlassEffect(t,e,i,n,l,this.getArcSize(n+this.strokeWidth,l+this.strokeWidth))}}const a=l},341:(t,e,i)=>{i.d(e,{A:()=>c});var s=i(989),n=i(675),l=i(633),a=i(83),r=i(534),o=i(504),h=i(603),p=i(306),d=i(272);const c=class{constructor(t=null){this.preserveImageAspect=!1,this.overlay=null,this.indicator=null,this.indicatorShape=null,this.opacity=100,this.isDashed=!1,this.fill=a.x3,this.gradient=a.x3,this.gradientDirection=a.M8.EAST,this.fillOpacity=100,this.strokeOpacity=100,this.stroke=a.x3,this.strokeWidth=1,this.spacing=0,this.startSize=1,this.endSize=1,this.startArrow=a.x3,this.endArrow=a.x3,this.direction=a.M8.EAST,this.flipH=!1,this.flipV=!1,this.isShadow=!1,this.isRounded=!1,this.rotation=0,this.cursor="",this.verticalTextRotation=0,this.oldGradients={},this.glass=!1,this.dialect=null,this.scale=1,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.bounds=null,this.points=[],this.state=null,this.style=null,this.boundingBox=null,this.stencil=null,this.svgStrokeTolerance=8,this.pointerEvents=!0,this.originalPointerEvents=null,this.svgPointerEvents="all",this.shapePointerEvents=!1,this.stencilPointerEvents=!1,this.outline=!1,this.visible=!0,this.useSvgBoundingBox=!0,this.image=null,this.imageSrc=null,this.indicatorColor=a.x3,this.indicatorStrokeColor=a.x3,this.indicatorGradientColor=a.x3,this.indicatorDirection=a.M8.EAST,this.indicatorImageSrc=null,t&&(this.stencil=t),this.node=this.create()}init(t){this.node.parentNode||t.appendChild(this.node)}initStyles(){this.strokeWidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isHtmlAllowed(){return!1}getSvgScreenOffset(){const t=this.stencil&&"inherit"!==this.stencil.strokeWidthValue?Number(this.stencil.strokeWidthValue):this.strokeWidth??0;return 1===(0,l.zi)(Math.max(1,Math.round(t*this.scale)),2)?.5:0}create(){return document.createElementNS(a.pr,"g")}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){for(;this.node.lastChild;)this.node.removeChild(this.node.lastChild)}updateBoundsFromPoints(){const t=this.points;if(t.length>0&&t[0]){this.bounds=new s.A(Math.round(t[0].x),Math.round(t[0].y),1,1);for(const e of t)e&&this.bounds.add(new s.A(Math.round(e.x),Math.round(e.y),1,1))}}getLabelBounds(t){const e=this.style?.direction??a.M8.EAST;let i=t.clone();e!==a.M8.SOUTH&&e!==a.M8.NORTH&&this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()&&(i=i.clone(),[i.width,i.height]=[i.height,i.width]);let s=this.getLabelMargins(i);if(s){s=s.clone();let e=this.style?.flipH??!1,i=this.style?.flipV??!1;if(this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()){const t=s.x;s.x=s.height,s.height=s.width,s.width=s.y,s.y=t,[e,i]=[i,e]}return(0,l.Aw)(t,s,this.style,e,i)}return t}getLabelMargins(t){return null}checkBounds(){return!Number.isNaN(this.scale)&&Number.isFinite(this.scale)&&this.scale>0&&this.bounds&&!Number.isNaN(this.bounds.x)&&!Number.isNaN(this.bounds.y)&&!Number.isNaN(this.bounds.width)&&!Number.isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}redrawShape(){const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.beforePaint(t),this.paint(t),this.afterPaint(t),this.node!==t.root&&t.root&&this.node.insertAdjacentHTML("beforeend",t.root.outerHTML),this.destroyCanvas(t))}createCanvas(){const t=this.createSvgCanvas();return t&&this.outline&&(t.setStrokeWidth(this.strokeWidth),t.setStrokeColor(this.stroke),this.isDashed&&t.setDashed(this.isDashed),t.setStrokeWidth=()=>{},t.setStrokeColor=()=>{},t.setFillColor=()=>{},t.setGradient=()=>{},t.setDashed=()=>{},t.text=()=>{}),t}createSvgCanvas(){if(!this.node)return null;const t=new o.A(this.node,!1);t.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,t.pointerEventsValue=this.svgPointerEvents;const e=this.getSvgScreenOffset();return 0!==e?this.node.setAttribute("transform",`translate(${e},${e})`):this.node.removeAttribute("transform"),t.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(t.format=t=>Math.round(t)),t}destroyCanvas(t){if(t instanceof o.A){for(const e in t.gradients){const i=t.gradients[e];i&&(i.mxRefCount=(i.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=t.gradients}}beforePaint(t){}afterPaint(t){}paint(t){let e=!1;if(t&&this.outline){const{stroke:i}=t;t.stroke=(...s)=>{e=!0,i.apply(t,s)};const{fillAndStroke:s}=t;t.fillAndStroke=(...i)=>{e=!0,s.apply(t,i)}}const i=this.scale,s=this.bounds;if(s){let l=s.x/i,a=s.y/i,o=s.width/i,h=s.height/i;if(this.isPaintBoundsInverted()){const t=(o-h)/2;l+=t,a-=t;const e=o;o=h,h=e}this.updateTransform(t,l,a,o,h),this.configureCanvas(t,l,a,o,h);let p=null;if(!this.stencil&&0===this.points.length&&this.shapePointerEvents||this.stencil&&this.stencilPointerEvents){const t=this.createBoundingBox();t&&this.node&&(p=this.createTransparentSvgRectangle(t.x,t.y,t.width,t.height),this.node.appendChild(p))}if(this.stencil)this.stencil.drawShape(t,this,l,a,o,h);else if(t.setStrokeWidth(this.strokeWidth),this.points.length>0){const e=[];for(let t=0;t<this.points.length;t+=1){const s=this.points[t];s&&e.push(new r.A(s.x/i,s.y/i))}this.paintEdgeShape(t,e)}else this.paintVertexShape(t,l,a,o,h);p&&t.state&&(0,n.Vq)(t.state.transform)&&p.setAttribute("transform",t.state.transform),t&&this.outline&&!e&&(t.rect(l,a,o,h),t.stroke())}}configureCanvas(t,e,i,s,n){let l=null;if(this.style&&null!=this.style.dashPattern&&(l=this.style.dashPattern),t.setAlpha(this.opacity/100),t.setFillAlpha(this.fillOpacity/100),t.setStrokeAlpha(this.strokeOpacity/100),this.isShadow&&t.setShadow(this.isShadow),this.isDashed&&t.setDashed(this.isDashed,this.style?.fixDash??!1),l&&t.setDashPattern(l),this.fill!==a.x3&&this.gradient!==a.x3){const l=this.getGradientBounds(t,e,i,s,n);t.setGradient(this.fill,this.gradient,l.x,l.y,l.width,l.height,this.gradientDirection)}else t.setFillColor(this.fill);t.setStrokeColor(this.stroke)}getGradientBounds(t,e,i,n,l){return new s.A(e,i,n,l)}updateTransform(t,e,i,s,n){t.scale(this.scale),t.rotate(this.getShapeRotation(),this.flipH,this.flipV,e+s/2,i+n/2)}paintVertexShape(t,e,i,s,n){this.paintBackground(t,e,i,s,n),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),this.paintForeground(t,e,i,s,n))}paintBackground(t,e,i,s,n){}paintForeground(t,e,i,s,n){}paintEdgeShape(t,e){}getArcSize(t,e){let i=0;if(this.style?.absoluteArcSize)i=Math.min(t/2,Math.min(e/2,(this.style?.arcSize??a.xU)/2));else{const s=(this.style?.arcSize??100*a.fQ)/100;i=Math.min(t*s,e*s)}return i}paintGlassEffect(t,e,i,s,n,l){const a=Math.ceil((this.strokeWidth??0)/2),r=.4;t.setGradient("#ffffff","#ffffff",e,i,s,.6*n,"south",.9,.1),t.begin(),l+=2*a,this.isRounded?(t.moveTo(e-a+l,i-a),t.quadTo(e-a,i-a,e-a,i-a+l),t.lineTo(e-a,i+n*r),t.quadTo(e+.5*s,i+.7*n,e+s+a,i+n*r),t.lineTo(e+s+a,i-a+l),t.quadTo(e+s+a,i-a,e+s+a-l,i-a)):(t.moveTo(e-a,i-a),t.lineTo(e-a,i+n*r),t.quadTo(e+.5*s,i+.7*n,e+s+a,i+n*r),t.lineTo(e+s+a,i-a)),t.close(),t.fill()}addPoints(t,e,i=!1,s,n=!1,a=[],o=!0){if(e.length>0){const h=e[e.length-1];if(n&&i){const t=(e=e.slice())[0],i=new r.A(h.x+(t.x-h.x)/2,h.y+(t.y-h.y)/2);e.splice(0,0,i)}let p=e[0],d=1;for(o?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y);d<(n?e.length:e.length-1);){let n=e[(0,l.zi)(d,e.length)],o=p.x-n.x,h=p.y-n.y;if(i&&(0!==o||0!==h)&&a.indexOf(d-1)<0){let i=Math.sqrt(o*o+h*h);const a=o*Math.min(s,i/2)/i,p=h*Math.min(s,i/2)/i,c=n.x+a,u=n.y+p;t.lineTo(c,u);let g=e[(0,l.zi)(d+1,e.length)];for(;d<e.length-2&&0===Math.round(g.x-n.x)&&0===Math.round(g.y-n.y);)g=e[(0,l.zi)(d+2,e.length)],d++;o=g.x-n.x,h=g.y-n.y,i=Math.max(1,Math.sqrt(o*o+h*h));const _=o*Math.min(s,i/2)/i,f=h*Math.min(s,i/2)/i,C=n.x+_,y=n.y+f;t.quadTo(n.x,n.y,C,y),n=new r.A(C,y)}else t.lineTo(n.x,n.y);p=n,d+=1}n?t.close():t.lineTo(h.x,h.y)}}resetStyles(){this.initStyles(),this.spacing=0,this.fill=a.x3,this.gradient=a.x3,this.gradientDirection=a.M8.EAST,this.stroke=a.x3,this.startSize=1,this.endSize=1,this.startArrow=a.x3,this.endArrow=a.x3,this.direction=a.M8.EAST,this.isShadow=!1,this.isDashed=!1,this.isRounded=!1,this.glass=!1}apply(t){if(this.state=t,this.style=t.style,this.style){if(this.fill=this.style.fillColor??this.fill,this.gradient=this.style.gradientColor??this.gradient,this.gradientDirection=this.style.gradientDirection??this.gradientDirection,this.opacity=this.style.opacity??this.opacity,this.fillOpacity=this.style.fillOpacity??this.fillOpacity,this.strokeOpacity=this.style.strokeOpacity??this.strokeOpacity,this.stroke=this.style.strokeColor??this.stroke,this.strokeWidth=this.style.strokeWidth??this.strokeWidth,this.spacing=this.style.spacing??this.spacing,this.startSize=this.style.startSize??this.startSize,this.endSize=this.style.endSize??this.endSize,this.startArrow=this.style.startArrow??this.startArrow,this.endArrow=this.style.endArrow??this.endArrow,this.rotation=this.style.rotation??this.rotation,this.direction=this.style.direction??this.direction,this.flipH=!!this.style.flipH,this.flipV=!!this.style.flipV,this.direction===a.M8.NORTH||this.direction===a.M8.SOUTH){const t=this.flipH;this.flipH=this.flipV,this.flipV=t}this.isShadow=this.style.shadow??this.isShadow,this.isDashed=this.style.dashed??this.isDashed,this.isRounded=this.style.rounded??this.isRounded,this.glass=this.style.glass??this.glass}}setCursor(t){this.cursor=t,this.node.style.cursor=t}getCursor(){return this.cursor}isRoundable(t,e,i,s,n){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node.ownerSVGElement)try{const t=this.node.getBBox();if(t.width>0&&t.height>0)return this.boundingBox=new s.A(t.x,t.y,t.width,t.height),void this.boundingBox.grow((this.strokeWidth??0)*this.scale/2)}catch(t){}if(this.bounds){let t=this.createBoundingBox();if(t){this.augmentBoundingBox(t);const e=this.getShapeRotation();0!==e&&(t=(0,l.UX)(t,e))}this.boundingBox=t}}createBoundingBox(){if(!this.bounds)return null;const t=this.bounds.clone();return(this.stencil&&(this.direction===a.M8.NORTH||this.direction===a.M8.SOUTH)||this.isPaintBoundsInverted())&&t.rotate90(),t}augmentBoundingBox(t){this.isShadow&&(t.width+=Math.ceil(d.m5.shadowOffsetX*this.scale),t.height+=Math.ceil(d.m5.shadowOffsetX*this.scale)),t.grow((this.strokeWidth??0)*this.scale/2)}isPaintBoundsInverted(){return!this.stencil&&(this.direction===a.M8.NORTH||this.direction===a.M8.SOUTH)}getRotation(){return this.rotation??0}getTextRotation(){let t=this.getRotation();return(this.style?.horizontal??1)||(t+=this.verticalTextRotation||-90),t}getShapeRotation(){let t=this.getRotation();return this.direction===a.M8.NORTH?t+=270:this.direction===a.M8.WEST?t+=180:this.direction===a.M8.SOUTH&&(t+=90),t}createTransparentSvgRectangle(t,e,i,s){const n=document.createElementNS(a.pr,"rect");return n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n.setAttribute("width",String(i)),n.setAttribute("height",String(s)),n.setAttribute("fill",a.x3),n.setAttribute("stroke",a.x3),n.setAttribute("pointer-events","all"),n}redrawHtmlShape(){}setTransparentBackgroundImage(t){t.style.backgroundImage=`url('${p.A.imageBasePath}/transparent.gif')`}releaseSvgGradients(t){for(const e in t){const i=t[e];i&&(i.mxRefCount=(i.mxRefCount||0)-1,0===i.mxRefCount&&i.parentNode&&i.parentNode.removeChild(i))}}destroy(){h.A.release(this.node),this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.innerHTML="",this.releaseSvgGradients(this.oldGradients),this.oldGradients={}}}},437:(t,e,i)=>{i.d(e,{$Y:()=>g,CA:()=>f,DO:()=>d,El:()=>l,Er:()=>c,Lg:()=>u,M4:()=>n,RT:()=>_,UT:()=>y,el:()=>r,ew:()=>p,fm:()=>o,kH:()=>h,qt:()=>C,xJ:()=>a});var s=i(306);const n=t=>{let e=t;return("touchstart"===e.type||"touchmove"===e.type)&&e.touches&&e.touches[0]?e=e.touches[0]:"touchend"===e.type&&e.changedTouches&&e.changedTouches[0]&&(e=e.changedTouches[0]),e},l=t=>n(t).clientX,a=t=>n(t).clientY,r=t=>t.target,o=t=>{const e=t;return void 0!==e.isConsumed&&e.isConsumed},h=t=>{const e=t;return e.pointerType?"touch"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH:void 0!==e.mozInputSource?5===e.mozInputSource:0===e.type.indexOf("touch")},p=t=>{const e=t;return e.pointerType?"pen"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_PEN:void 0!==e.mozInputSource?2===e.mozInputSource:0===e.type.indexOf("pen")},d=t=>{const e=t;return e.type&&0==e.type.indexOf("touch")&&void 0!==e.touches&&e.touches.length>1},c=t=>{const e=t;return e.pointerType?"mouse"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE:void 0!==e.mozInputSource?1===e.mozInputSource:0===e.type.indexOf("mouse")},u=t=>!("buttons"in t)||"mousedown"!==t.type&&"mousemove"!==t.type?void 0!==t.which?1===t.which:1===t.button:1===t.buttons,g=t=>(t=>2===t.button)(t)||s.A.IS_MAC&&C(t)&&!_(t)&&!y(t)&&!f(t),_=t=>t.shiftKey,f=t=>t.altKey,C=t=>t.ctrlKey,y=t=>t.metaKey},504:(t,e,i)=>{i.d(e,{A:()=>y});var s=i(675),n=i(633),l=i(906),a=i(306),r=i(83),o=i(989);const h=class{constructor(){this.enabled=!0,this.baseUrl=null,this.baseDomain=null}updateBaseUrl(){this.baseDomain=`${location.protocol}//${location.host}`,this.baseUrl=this.baseDomain+location.pathname;const t=this.baseUrl.lastIndexOf("/");t>0&&(this.baseUrl=this.baseUrl.substring(0,t+1))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getBaseUrl(){return this.baseUrl}setBaseUrl(t){this.baseUrl=t}getBaseDomain(){return this.baseDomain}setBaseDomain(t){this.baseDomain=t}isRelativeUrl(t){return t&&"//"!==t.substring(0,2)&&"http://"!==t.substring(0,7)&&"https://"!==t.substring(0,8)&&"data:image"!==t.substring(0,10)&&"file://"!==t.substring(0,7)}convert(t){return this.isEnabled()&&this.isRelativeUrl(t)&&(this.getBaseUrl()||this.updateBaseUrl(),t="/"===t.charAt(0)?this.getBaseDomain()+t:this.getBaseUrl()+t),t}};var p=i(534),d=i(766),c=i(272);const u=class{constructor(){this.state=this.createState(),this.states=[],this.path=[],this.rotateHtml=!0,this.lastX=0,this.lastY=0,this.moveOp="M",this.lineOp="L",this.quadOp="Q",this.curveOp="C",this.closeOp="Z",this.pointerEvents=!1,this.pointerEventsValue=null,this.addOp=(t,...e)=>{if(this.path.push(t),e.length>1){const t=this.state;for(let i=1;i<e.length;i+=2)this.lastX=e[i-1],this.lastY=e[i],this.path.push(this.format((this.lastX+t.dx)*t.scale)),this.path.push(this.format((this.lastY+t.dy)*t.scale))}},this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new h}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:r.x3,gradientFillAlpha:1,gradientColor:r.x3,gradientAlpha:1,gradientDirection:r.M8.EAST,strokeColor:r.x3,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:r.x3,fontBorderColor:r.x3,fontSize:r.FV,fontFamily:r.CT,fontStyle:0,shadow:!1,shadowColor:c.m5.shadowColor,shadowAlpha:c.m5.shadowOpacity,shadowDx:c.m5.shadowOffsetX,shadowDy:c.m5.shadowOffsetY,rotation:0,rotationCx:0,rotationCy:0}}format(t){return Math.round(t)}rotatePoint(t,e,i,s,l){const a=i*(Math.PI/180);return(0,n.Iq)(new p.A(t,e),Math.cos(a),Math.sin(a),new p.A(s,l))}save(){this.states.push(this.state),this.state=(0,d.o)(this.state)}restore(){const t=this.states.pop();t&&(this.state=t)}setLink(t){}scale(t){this.state.scale*=t,null!==this.state.strokeWidth&&(this.state.strokeWidth*=t)}translate(t,e){this.state.dx+=t,this.state.dy+=e}rotate(t,e,i,s,n){}setAlpha(t){this.state.alpha=t}setFillAlpha(t){this.state.fillAlpha=t}setStrokeAlpha(t){this.state.strokeAlpha=t}setFillColor(t){this.state.fillColor=t??r.x3,this.state.gradientColor=r.x3}setGradient(t,e,i,s,n,l,a,r=1,o=1){const h=this.state;h.fillColor=t,h.gradientFillAlpha=r,h.gradientColor=e,h.gradientAlpha=o,h.gradientDirection=a}setStrokeColor(t){this.state.strokeColor=t??r.x3}setStrokeWidth(t){this.state.strokeWidth=t}setDashed(t,e=!1){this.state.dashed=t,this.state.fixDash=e}setDashPattern(t){this.state.dashPattern=t}setLineCap(t){this.state.lineCap=t}setLineJoin(t){this.state.lineJoin=t}setMiterLimit(t){this.state.miterLimit=t}setFontColor(t){this.state.fontColor=t??r.x3}setFontBackgroundColor(t){this.state.fontBackgroundColor=t??r.x3}setFontBorderColor(t){this.state.fontBorderColor=t??r.x3}setFontSize(t){this.state.fontSize=t}setFontFamily(t){this.state.fontFamily=t}setFontStyle(t){this.state.fontStyle=t}setShadow(t){this.state.shadow=t}setShadowColor(t){this.state.shadowColor=t??r.x3}setShadowAlpha(t){this.state.shadowAlpha=t}setShadowOffset(t,e){this.state.shadowDx=t,this.state.shadowDy=e}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(t,e){this.addOp(this.moveOp,t,e)}lineTo(t,e){this.addOp(this.lineOp,t,e)}quadTo(t,e,i,s){this.addOp(this.quadOp,t,e,i,s)}curveTo(t,e,i,s,n,l){this.addOp(this.curveOp,t,e,i,s,n,l)}arcTo(t,e,i,s,l,a,r){const o=(0,n.UA)(this.lastX,this.lastY,t,e,i,s,l,a,r);if(null!=o)for(let t=0;t<o.length;t+=6)this.curveTo(o[t],o[t+1],o[t+2],o[t+3],o[t+4],o[t+5])}close(t,e,i,s,n,l){this.addOp(this.closeOp)}};var g=i(733),_=i(568);const f="function"==typeof DOMParser&&!a.A.IS_CHROMEAPP&&!a.A.IS_EDGE&&document.getElementsByTagName("base").length>0;class C extends u{constructor(t,e){super(),this.defs=null,this.styleEnabled=!0,this.node=null,this.matchHtmlAlignment=!0,this.textEnabled=!0,this.foEnabled=!0,this.foAltText="[Object]",this.foOffset=0,this.textOffset=0,this.imageOffset=0,this.strokeTolerance=0,this.minStrokeWidth=1,this.refCount=0,this.lineHeightCorrection=1,this.pointerEventsValue="all",this.fontMetricsPadding=10,this.cacheOffsetSize=!0,this.originalRoot=null,this.root=t,this.gradients={},this.defs=null,this.styleEnabled=null!=e&&e;let i=null;if(t.ownerDocument!==document){let e=t;for(;e&&"svg"!==e.nodeName;)e=e.parentElement;i=e}i&&(i.getElementsByTagName("defs").length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs||(this.defs=this.createElement("defs"),null!=i.firstChild?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}format(t){return parseFloat(t.toFixed(2))}getBaseUrl(){let{href:t}=window.location;const e=t.lastIndexOf("#");return e>0&&(t=t.substring(0,e)),t}reset(){super.reset(),this.gradients={}}end(){}createStyle(){const t=this.createElement("style");return t.setAttribute("type","text/css"),(0,g.M9)(t,`svg{font-family:${r.CT};font-size:${r.FV};fill:none;stroke-miterlimit:10}`),t}createElement(t,e){return this.root?.ownerDocument.createElementNS(e||r.pr,t)}getAlternateText(t,e,i,n,l,a,r,o,h,p,d,c,u){return(0,s.Vq)(a)?this.foAltText:null}createAlternateContent(t,e,i,n,a,o,h,p,d,c,u,_,f){const C=this.getAlternateText(t,e,i,n,a,o,h,p,d,c,u,_,f),y=this.state;if((0,s.Vq)(C)&&y.fontSize>0){const t=p===r.Ec.TOP?1:p===r.Ec.BOTTOM?0:.3,s=h===r.Ec.RIGHT?"end":h===r.Ec.LEFT?"start":"middle",n=this.createElement("text");n.setAttribute("x",String(Math.round(e+y.dx))),n.setAttribute("y",String(Math.round(i+y.dy+t*y.fontSize))),n.setAttribute("fill",y.fontColor||"black"),n.setAttribute("font-family",y.fontFamily),n.setAttribute("font-size",`${Math.round(y.fontSize)}px`),"start"!==s&&n.setAttribute("text-anchor",s);const a=y.fontStyle;(0,l.bW)(a,r.mE.BOLD)&&n.setAttribute("font-weight","bold"),(0,l.bW)(a,r.mE.ITALIC)&&n.setAttribute("font-style","italic");const o=[];return(0,l.bW)(a,r.mE.UNDERLINE)&&o.push("underline"),(0,l.bW)(a,r.mE.STRIKETHROUGH)&&o.push("line-through"),o.length>0&&n.setAttribute("text-decoration",o.join(" ")),(0,g.M9)(n,C),n}return null}createGradientId(t,e,i,s,n){"#"===t.charAt(0)&&(t=t.substring(1)),"#"===e.charAt(0)&&(e=e.substring(1)),t=`${t.toLowerCase()}-${i}`,e=`${e.toLowerCase()}-${s}`;let l=null;if(null==n||n===r.M8.SOUTH)l="s";else if(n===r.M8.EAST)l="e";else{const i=t;t=e,e=i,n===r.M8.NORTH?l="s":n===r.M8.WEST&&(l="e")}return`mx-gradient-${t}-${e}-${l}`}getSvgGradient(t,e,i,s,n){const l=this.createGradientId(t,e,i,s,n);let a=this.gradients[l];if(!a){const r=this.root.ownerSVGElement;let o=0,h=`${l}-${o}`;if(r)for(a=r.ownerDocument.getElementById(h);a&&a.ownerSVGElement!==r;)h=`${l}-${o++}`,a=r.ownerDocument.getElementById(h);else h="id"+ ++this.refCount;a||(a=this.createSvgGradient(t,e,i,s,n),a.setAttribute("id",h),this.defs?this.defs.appendChild(a):r&&r.appendChild(a)),this.gradients[l]=a}return a.getAttribute("id")}createSvgGradient(t,e,i,s,n){const l=this.createElement("linearGradient");l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","0%"),l.setAttribute("y2","0%"),null==n||n===r.M8.SOUTH?l.setAttribute("y2","100%"):n===r.M8.EAST?l.setAttribute("x2","100%"):n===r.M8.NORTH?l.setAttribute("y1","100%"):n===r.M8.WEST&&l.setAttribute("x1","100%");let a=i<1?`;stop-opacity:${i}`:"",o=this.createElement("stop");return o.setAttribute("offset","0%"),o.setAttribute("style",`stop-color:${t}${a}`),l.appendChild(o),a=s<1?`;stop-opacity:${s}`:"",o=this.createElement("stop"),o.setAttribute("offset","100%"),o.setAttribute("style",`stop-color:${e}${a}`),l.appendChild(o),l}addNode(t,e){const{node:i}=this,s=this.state;if(i){if("path"===i.nodeName){if(!(this.path&&this.path.length>0))return;i.setAttribute("d",this.path.join(" "))}t&&s.fillColor!==r.x3?this.updateFill():this.styleEnabled||("ellipse"===i.nodeName&&a.A.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill",r.x3),t=!1),e&&s.strokeColor!==r.x3?this.updateStroke():this.styleEnabled||i.setAttribute("stroke",r.x3),s.transform&&s.transform.length>0&&i.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(i)),this.strokeTolerance>0&&!t&&this.root.appendChild(this.createTolerance(i)),this.pointerEvents?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot||i.setAttribute("pointer-events",r.x3),("rect"!==i.nodeName&&"path"!==i.nodeName&&"ellipse"!==i.nodeName||i.getAttribute("fill")!==r.x3&&"transparent"!==i.getAttribute("fill")||i.getAttribute("stroke")!==r.x3||i.getAttribute("pointer-events")!==r.x3)&&this.root.appendChild(i),this.node=null}}updateFill(){const t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",String(t.alpha*t.fillAlpha)),t.fillColor!==r.x3)if(t.gradientColor!==r.x3){const e=this.getSvgGradient(t.fillColor,t.gradientColor,t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if(this.root?.ownerDocument===document&&f){const t=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill",`url(${t}#${e})`)}else this.node.setAttribute("fill",`url(#${e})`)}else this.node.setAttribute("fill",t.fillColor.toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){const t=this.state;t.strokeColor&&t.strokeColor!==r.x3&&this.node.setAttribute("stroke",t.strokeColor.toLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",String(t.alpha*t.strokeAlpha));const e=this.getCurrentStrokeWidth();1!==e&&this.node.setAttribute("stroke-width",String(e)),"path"===this.node.nodeName&&this.updateStrokeAttributes(),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))}updateStrokeAttributes(){const t=this.state;if(t.lineJoin&&"miter"!==t.lineJoin&&this.node.setAttribute("stroke-linejoin",t.lineJoin),t.lineCap){let e=t.lineCap;"flat"===e&&(e="butt"),"butt"!==e&&this.node.setAttribute("stroke-linecap",e)}null==t.miterLimit||this.styleEnabled&&10===t.miterLimit||this.node.setAttribute("stroke-miterlimit",String(t.miterLimit))}createDashPattern(t){const e=[];if("string"==typeof this.state.dashPattern){const i=this.state.dashPattern.split(" ");if(i.length>0)for(let s=0;s<i.length;s+=1)e[s]=Number(i[s])*t}return e.join(" ")}createTolerance(t){const e=t.cloneNode(!0),i=parseFloat(e.getAttribute("stroke-width")||"1")+this.strokeTolerance;return e.setAttribute("pointer-events","stroke"),e.setAttribute("visibility","hidden"),e.removeAttribute("stroke-dasharray"),e.setAttribute("stroke-width",String(i)),e.setAttribute("fill","none"),e.setAttribute("stroke","white"),e}createShadow(t){const e=t.cloneNode(!0),i=this.state;return"none"===e.getAttribute("fill")||a.A.IS_FF&&"transparent"===e.getAttribute("fill")||e.setAttribute("fill",i.shadowColor),"none"!==e.getAttribute("stroke")&&i.shadowColor&&i.shadowColor!==r.x3&&e.setAttribute("stroke",i.shadowColor),e.setAttribute("transform",`translate(${this.format(i.shadowDx*i.scale)},${this.format(i.shadowDy*i.scale)})${i.transform||""}`),e.setAttribute("opacity",String(i.shadowAlpha)),e}setLink(t){if(t){this.originalRoot=this.root;const e=this.createElement("a");null==e.setAttributeNS||this.root.ownerDocument!==document?e.setAttribute("xlink:href",t):e.setAttributeNS(r.pK,"xlink:href",t),this.root.appendChild(e),this.root=e}else this.root=this.originalRoot}rotate(t,e,i,s,n){if(0!==t||e||i){const l=this.state;if(s+=l.dx,n+=l.dy,s*=l.scale,n*=l.scale,l.transform=l.transform||"",e&&i)t+=180;else if(e!==i){const t=e?s:0,a=e?-1:1,r=i?n:0,o=i?-1:1;l.transform+=`translate(${this.format(t)},${this.format(r)})scale(${this.format(a)},${this.format(o)})translate(${this.format(-t)},${this.format(-r)})`}(e?!i:i)&&(t*=-1),0!==t&&(l.transform+=`rotate(${this.format(t)},${this.format(s)},${this.format(n)})`),l.rotation+=t,l.rotationCx=s,l.rotationCy=n}}begin(){super.begin(),this.node=this.createElement("path")}rect(t,e,i,s){const n=this.state,l=this.createElement("rect");l.setAttribute("x",String(this.format((t+n.dx)*n.scale))),l.setAttribute("y",String(this.format((e+n.dy)*n.scale))),l.setAttribute("width",String(this.format(i*n.scale))),l.setAttribute("height",String(this.format(s*n.scale))),this.node=l}roundrect(t,e,i,s,n,l){this.rect(t,e,i,s),n>0&&this.node.setAttribute("rx",String(this.format(n*this.state.scale))),l>0&&this.node.setAttribute("ry",String(this.format(l*this.state.scale)))}ellipse(t,e,i,s){const n=this.state,l=this.createElement("ellipse");l.setAttribute("cx",String(this.format((t+i/2+n.dx)*n.scale))),l.setAttribute("cy",String(this.format((e+s/2+n.dy)*n.scale))),l.setAttribute("rx",String(i/2*n.scale)),l.setAttribute("ry",String(s/2*n.scale)),this.node=l}image(t,e,i,s,n,l=!0,a=!1,o=!1){n=this.converter.convert(n);const h=this.state;t+=h.dx,e+=h.dy;const p=this.createElement("image");p.setAttribute("x",String(this.format(t*h.scale)+this.imageOffset)),p.setAttribute("y",String(this.format(e*h.scale)+this.imageOffset)),p.setAttribute("width",String(this.format(i*h.scale))),p.setAttribute("height",String(this.format(s*h.scale))),p.setAttributeNS?p.setAttributeNS(r.pK,"xlink:href",n):p.setAttribute("xlink:href",n),l||p.setAttribute("preserveAspectRatio","none"),(h.alpha<1||h.fillAlpha<1)&&p.setAttribute("opacity",String(h.alpha*h.fillAlpha));let d=this.state.transform||"";if(a||o){let n=1,l=1,r=0,p=0;a&&(n=-1,r=-i-2*t),o&&(l=-1,p=-s-2*e),d+=`scale(${n},${l})translate(${r*h.scale},${p*h.scale})`}d.length>0&&p.setAttribute("transform",d),this.pointerEvents||p.setAttribute("pointer-events","none"),this.root.appendChild(p)}convertHtml(t){const e=(new DOMParser).parseFromString(t,"text/html");return null!=e&&("<body"===(t=(new XMLSerializer).serializeToString(e.body)).substring(0,5)&&(t=t.substring(t.indexOf(">",5)+1)),"</body>"===t.substring(t.length-7,t.length)&&(t=t.substring(0,t.length-7))),t}createDiv(t){let e=t;if((0,g.Ll)(e)||(e=`<div><div>${this.convertHtml(e)}</div></div>`),document.createElementNS){const t=document.createElementNS("http://www.w3.org/1999/xhtml","div");if((0,g.Ll)(e)){const i=e,s=document.createElement("div"),n=s.cloneNode(!1);this.root.ownerDocument!==document?s.appendChild(i.cloneNode(!0)):s.appendChild(i),n.appendChild(s),t.appendChild(n)}else t.innerHTML=e;return t}return(0,g.Ll)(e)&&(e=`<div><div>${((t,e="&#xa;")=>{let i=(new XMLSerializer).serializeToString(t);return i=i.replace(/\n/g,e),i})(e)}</div></div>`),e=`<div xmlns="http://www.w3.org/1999/xhtml">${e}</div>`,(new DOMParser).parseFromString(e,"text/xml").documentElement}updateText(t,e,i,s,n,l,a,r,o,h,p){p&&p.firstChild&&p.firstChild.firstChild&&this.updateTextNodes(t,e,i,s,n,l,a,r,o,h,p.firstChild)}addForeignObject(t,e,i,s,n,l,a,r,o,h,p,d,c,u,g){const _=this.createElement("g"),f=this.createElement("foreignObject");if(f.setAttribute("style","overflow: visible; text-align: left;"),f.setAttribute("pointer-events","none"),f.appendChild(u),_.appendChild(f),this.updateTextNodes(t,e,i,s,l,a,r,h,p,d,_),this.root?.ownerDocument!==document){const c=this.createAlternateContent(f,t,e,i,s,n,l,a,r,o,h,p,d);if(null!=c){f.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");const t=this.createElement("switch");t.appendChild(f),t.appendChild(c),_.appendChild(t)}}g.appendChild(_)}updateTextNodes(t,e,i,s,n,l,a,o,h,p,d){const c=this.state.scale;C.createCss(i+2,s,n,l,a,o,h,null!=this.state.fontBackgroundColor?this.state.fontBackgroundColor:null,null!=this.state.fontBorderColor?this.state.fontBorderColor:null,`display: flex; align-items: unsafe ${l===r.Ec.TOP?"flex-start":l===r.Ec.BOTTOM?"flex-end":"center"}; justify-content: unsafe ${n===r.Ec.LEFT?"flex-start":n===r.Ec.RIGHT?"flex-end":"center"}; `,this.getTextCss(),c,((i,s,n,l,a)=>{t+=this.state.dx,e+=this.state.dy;const r=d.firstChild,o=r.firstChild,h=o.firstChild,u=h.firstChild,g=(this.rotateHtml?this.state.rotation:0)+(null!=p?p:0);let _=(0!==this.foOffset?`translate(${this.foOffset} ${this.foOffset})`:"")+(1!==c?`scale(${c})`:"");u.setAttribute("style",a),h.setAttribute("style",l),r.setAttribute("width",`${Math.ceil(1/Math.min(1,c)*100)}%`),r.setAttribute("height",`${Math.ceil(1/Math.min(1,c)*100)}%`);const f=Math.round(e+s);f<0?r.setAttribute("y",String(f)):(r.removeAttribute("y"),n+=`padding-top: ${f}px; `),o.setAttribute("style",`${n}margin-left: ${Math.round(t+i)}px;`),_+=0!==g?`rotate(${g} ${t} ${e})`:"",""!==_?d.setAttribute("transform",_):d.removeAttribute("transform"),1!==this.state.alpha?d.setAttribute("opacity",String(this.state.alpha)):d.removeAttribute("opacity")}))}getTextCss(){const t=this.state,e=r.Fb?t.fontSize*r.$g+"px":r.$g*this.lineHeightCorrection;let i=`display: inline-block; font-size: ${t.fontSize}px; font-family: ${t.fontFamily}; color: ${t.fontColor}; line-height: ${e}; pointer-events: ${this.pointerEvents?this.pointerEventsValue:"none"}; `;const s=t.fontStyle;(0,l.bW)(s,r.mE.BOLD)&&(i+="font-weight: bold; "),(0,l.bW)(s,r.mE.ITALIC)&&(i+="font-style: italic; ");const n=[];return(0,l.bW)(s,r.mE.UNDERLINE)&&n.push("underline"),(0,l.bW)(s,r.mE.STRIKETHROUGH)&&n.push("line-through"),n.length>0&&(i+=`text-decoration: ${n.join(" ")}; `),i}text(t,e,i,s,n,l,a,r,o,h,p,d=0,c){if(this.textEnabled&&null!=n)if(d=null!=d?d:0,this.foEnabled&&"html"===o){const u=this.createDiv(n);null!=u&&(null!=c&&u.setAttribute("dir",c),this.addForeignObject(t,e,i,s,n,l,a,r,o,h,p,d,c,u,this.root))}else this.plainText(t+this.state.dx,e+this.state.dy,i,s,n,l,a,r,h,p,d,c)}createClip(t,e,i,s){const n=`mx-clip-${t=Math.round(t)}-${e=Math.round(e)}-${i=Math.round(i)}-${s=Math.round(s)}`;let l=0,a=`${n}-${l}`;for(;null!=document.getElementById(a);)a=`${n}-${++l}`;const r=this.createElement("clipPath");r.setAttribute("id",a);const o=this.createElement("rect");return o.setAttribute("x",String(t)),o.setAttribute("y",String(e)),o.setAttribute("width",String(i)),o.setAttribute("height",String(s)),r.appendChild(o),r}plainText(t,e,i,s,n,l,o,h,p,d,c=0,u){const f=this.state,C=f.fontSize,y=this.createElement("g");let E=f.transform||"";if(this.updateFont(y),this.pointerEvents||null!=this.originalRoot||y.setAttribute("pointer-events","none"),0!==c&&(E+=`rotate(${c},${this.format(t*f.scale)},${this.format(e*f.scale)})`),null!=u&&y.setAttribute("direction",u),d&&i>0&&s>0){let n=t,h=e;l===r.Ec.CENTER?n-=i/2:l===r.Ec.RIGHT&&(n-=i),"fill"!==p&&(o===r.Ec.MIDDLE?h-=s/2:o===r.Ec.BOTTOM&&(h-=s));const d=this.createClip(n*f.scale-2,h*f.scale-2,i*f.scale+4,s*f.scale+4);if(null!=this.defs?this.defs.appendChild(d):this.root.appendChild(d),a.A.IS_CHROMEAPP||a.A.IS_EDGE||this.root.ownerDocument!==document)y.setAttribute("clip-path",`url(#${d.getAttribute("id")})`);else{const t=this.getBaseUrl().replace(/([()])/g,"\\$1");y.setAttribute("clip-path",`url(${t}#${d.getAttribute("id")})`)}}const v=l===r.Ec.RIGHT?"end":l===r.Ec.CENTER?"middle":"start";"start"!==v&&y.setAttribute("text-anchor",v),this.styleEnabled&&C===r.FV||y.setAttribute("font-size",C*f.scale+"px"),E.length>0&&y.setAttribute("transform",E),f.alpha<1&&y.setAttribute("opacity",String(f.alpha));const m=n.split("\n"),w=Math.round(C*r.$g),x=C+(m.length-1)*w;let S=e+C-1;o===r.Ec.MIDDLE?S-="fill"===p?s/2:(this.matchHtmlAlignment&&d&&s>0?Math.min(x,s):x)/2:o===r.Ec.BOTTOM&&(S-="fill"===p?s:(this.matchHtmlAlignment&&d&&s>0?Math.min(x,s):x)+1);for(let e=0;e<m.length;e+=1){const i=(0,_.Bq)(m[e]);if(i){const e=this.createElement("text");e.setAttribute("x",String(this.format(t*f.scale)+this.textOffset)),e.setAttribute("y",String(this.format(S*f.scale)+this.textOffset)),(0,g.M9)(e,i),y.appendChild(e)}S+=w}this.root.appendChild(y),this.addTextBackground(y,n,t,e,i,"fill"===p?s:x,l,o,p)}updateFont(t){const e=this.state;e.fontColor&&e.fontColor!==r.x3&&t.setAttribute("fill",e.fontColor),this.styleEnabled&&e.fontFamily===r.CT||t.setAttribute("font-family",e.fontFamily);const i=e.fontStyle;(0,l.bW)(i,r.mE.BOLD)&&t.setAttribute("font-weight","bold"),(0,l.bW)(i,r.mE.ITALIC)&&t.setAttribute("font-style","italic");const s=[];(0,l.bW)(i,r.mE.UNDERLINE)&&s.push("underline"),(0,l.bW)(i,r.mE.STRIKETHROUGH)&&s.push("line-through"),s.length>0&&t.setAttribute("text-decoration",s.join(" "))}addTextBackground(t,e,i,s,a,h,p,d,c){const u=this.state;if(null!=u.fontBackgroundColor||null!=u.fontBorderColor){let g=null;if("fill"===c||"width"===c)p===r.Ec.CENTER?i-=a/2:p===r.Ec.RIGHT&&(i-=a),d===r.Ec.MIDDLE?s-=h/2:d===r.Ec.BOTTOM&&(s-=h),g=new o.A((i+1)*u.scale,s*u.scale,(a-2)*u.scale,(h+2)*u.scale);else if(null!=t.getBBox&&this.root.ownerDocument===document)try{g=t.getBBox(),g=new o.A(g.x,g.y+1,g.width,g.height+0)}catch(t){}if(null==g||0===g.width||0===g.height){const t=document.createElement("div");t.style.lineHeight=r.Fb?u.fontSize*r.$g+"px":String(r.$g),t.style.fontSize=`${u.fontSize}px`,t.style.fontFamily=u.fontFamily,t.style.whiteSpace="nowrap",t.style.position="absolute",t.style.visibility="hidden",t.style.display="inline-block",(0,l.bW)(u.fontStyle,r.mE.BOLD)&&(t.style.fontWeight="bold"),(0,l.bW)(u.fontStyle,r.mE.ITALIC)&&(t.style.fontStyle="italic"),e=(0,_.bG)(e,!1),t.innerHTML=e.replace(/\n/g,"<br/>"),document.body.appendChild(t);const n=t.offsetWidth,a=t.offsetHeight;document.body.removeChild(t),p===r.Ec.CENTER?i-=n/2:p===r.Ec.RIGHT&&(i-=n),d===r.Ec.MIDDLE?s-=a/2:d===r.Ec.BOTTOM&&(s-=a),g=new o.A((i+1)*u.scale,(s+2)*u.scale,n*u.scale,(a+1)*u.scale)}if(null!=g){const e=this.createElement("rect");e.setAttribute("fill",u.fontBackgroundColor||"none"),e.setAttribute("stroke",u.fontBorderColor||"none"),e.setAttribute("x",String(Math.floor(g.x-1))),e.setAttribute("y",String(Math.floor(g.y-1))),e.setAttribute("width",String(Math.ceil(g.width+2))),e.setAttribute("height",String(Math.ceil(g.height)));const i=u.fontBorderColor?Math.max(1,this.format(u.scale)):0;e.setAttribute("stroke-width",String(i)),this.root?.ownerDocument===document&&1===(0,n.zi)(i,2)&&e.setAttribute("transform","translate(0.5, 0.5)"),t.insertBefore(e,t.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}C.createCss=(t,e,i,s,n,a,o,h,p,d,c,u,g)=>{let _=`box-sizing: border-box; font-size: 0; text-align: ${i===r.Ec.LEFT?"left":i===r.Ec.RIGHT?"right":"center"}; `;const f=(0,l.oM)(i,s);let C="overflow: hidden; ",y="width: 1px; ",E="height: 1px; ",v=f.x*t,m=f.y*e;o?(y=`width: ${Math.round(t)}px; `,_+=`max-height: ${Math.round(e)}px; `,m=0):"fill"===a?(y=`width: ${Math.round(t)}px; `,E=`height: ${Math.round(e)}px; `,c+="width: 100%; height: 100%; ",_+=y+E):"width"===a?(y=`width: ${Math.round(t)}px; `,c+="width: 100%; ",_+=y,m=0,e>0&&(_+=`max-height: ${Math.round(e)}px; `)):(C="",m=0);let w="";h&&(w+=`background-color: ${h}; `),p&&(w+=`border: 1px solid ${p}; `),""==C||o?c+=w:_+=w,n&&t>0?(c+=`white-space: normal; word-wrap: ${r.Cx}; `,y=`width: ${Math.round(t)}px; `,""!==C&&"fill"!==a&&(m=0)):(c+="white-space: nowrap; ",""===C&&(v=0)),g(v,m,d+y+E,_+C,c,C)};const y=C},534:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(t=0,e=0){this._x=0,this._y=0,this.x=t,this.y=e}get x(){return this._x}set x(t){if(Number.isNaN(t))throw new Error("Invalid x supplied.");this._x=t}get y(){return this._y}set y(t){if(Number.isNaN(t))throw new Error("Invalid y supplied.");this._y=t}equals(t){return!!t&&t.x===this.x&&t.y===this.y}clone(){return new s(this.x,this.y)}}const n=s},568:(t,e,i)=>{i.d(e,{Bq:()=>n,K7:()=>a,bG:()=>r,qQ:()=>l});const s=(t,e="\\s")=>null!=t?t.replace(new RegExp(`^[${e}]+`,"g"),""):null,n=(t,e)=>s(((t,e="\\s")=>null!=t?t.replace(new RegExp(`[${e}]+$`,"g"),""):null)(t,e),e),l=t=>{let e=null;if(null!=t)if(null!=t.name)e=t.name;else if(e=n(t.toString()),null!==e&&/^function\s/.test(e)&&(e=s(e.substring(9)),null!==e)){const t=e.indexOf("(");t>0&&(e=e.substring(0,t))}return e},a=(t,e)=>{let i="";for(;t.length>0&&"\n"==t.charAt(t.length-1);)t=t.substring(0,t.length-1),i+=e;return t+i},r=(t,e=!0)=>(t=(t=(t=(t=(t=(t=String(t||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e&&(t=t.replace(/\n/g,"&#xa;")),t)},577:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(){throw new Error("Static class can't be instantiated!")}static create(t){let e="",i=t.getParent();for(;i;)e=i.getIndex(t)+s.PATH_SEPARATOR+e,i=(t=i).getParent();const n=e.length;return n>1&&(e=e.substring(0,n-1)),e}static getParentPath(t){const e=t.lastIndexOf(s.PATH_SEPARATOR);return e>=0?t.substring(0,e):t.length>0?"":null}static resolve(t,e){let i=t;const n=e.split(s.PATH_SEPARATOR);for(let t=0;t<n.length;t+=1)i=i.getChildAt(parseInt(n[t]));return i}static compare(t,e){const i=Math.min(t.length,e.length);let s=0;for(let n=0;n<i;n+=1)if(t[n]!==e[n]){if(0===t[n].length||0===e[n].length)s=t[n]===e[n]?0:t[n]>e[n]?1:-1;else{const i=parseInt(t[n]),l=parseInt(e[n]);s=i===l?0:i>l?1:-1}break}if(0===s){const i=t.length,n=e.length;i!==n&&(s=i>n?1:-1)}return s}}s.PATH_SEPARATOR=".";const n=s},592:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(603),n=i(823);const l=class{constructor(t,e=!0){this.changes=[],this.significant=!0,this.undone=!1,this.redone=!1,this.source=t,this.changes=[],this.significant=e}isEmpty(){return 0===this.changes.length}isSignificant(){return this.significant}add(t){this.changes.push(t)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new n.A(s.A.START_EDIT));for(let t=this.changes.length-1;t>=0;t--){const e=this.changes[t];e.execute?e.execute():e.undo&&e.undo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:e}))}this.undone=!0,this.redone=!1,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new n.A(s.A.START_EDIT));const t=this.changes.length;for(let e=0;e<t;e+=1){const t=this.changes[e];null!=t.execute?t.execute():null!=t.redo&&t.redo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:t}))}this.undone=!1,this.redone=!0,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}}},603:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(966),n=i(306),l=i(437);let a=!1;try{document.addEventListener("test",(()=>{}),Object.defineProperty&&Object.defineProperty({},"passive",{get:()=>{a=!0}}))}catch(t){}class r{static addListener(t,e,i){t.addEventListener(e,i,!!a&&{passive:!1}),t.mxListenerList||(t.mxListenerList=[]);const s={name:e,f:i};t.mxListenerList.push(s)}static removeListener(t,e,i){if(t.removeEventListener(e,i,!1),t.mxListenerList){const e=t.mxListenerList.length;for(let s=0;s<e;s+=1)if(t.mxListenerList[s].f===i){t.mxListenerList.splice(s,1);break}}}static removeAllListeners(t){const e=t.mxListenerList;if(e)for(;e.length>0;){const i=e[0];r.removeListener(t,i.name,i.f)}}static addGestureListeners(t,e=null,i=null,s=null){e&&r.addListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&r.addListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&r.addListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&r.addListener(t,"touchstart",e),i&&r.addListener(t,"touchmove",i),s&&r.addListener(t,"touchend",s))}static removeGestureListeners(t,e,i,s){e&&r.removeListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&r.removeListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&r.removeListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&r.removeListener(t,"touchstart",e),i&&r.removeListener(t,"touchmove",i),s&&r.removeListener(t,"touchend",s))}static redirectMouseEvents(t,e,i=null,n=null,a=null,o=null,h=null){const p=t=>"function"==typeof i?i(t):i;r.addGestureListeners(t,(t=>{n?n(t):(0,l.fm)(t)||e.fireMouseEvent(r.MOUSE_DOWN,new s.A(t,p(t)))}),(t=>{a?a(t):(0,l.fm)(t)||e.fireMouseEvent(r.MOUSE_MOVE,new s.A(t,p(t)))}),(t=>{o?o(t):(0,l.fm)(t)||e.fireMouseEvent(r.MOUSE_UP,new s.A(t,p(t)))})),r.addListener(t,"dblclick",(t=>{if(h)h(t);else if(!(0,l.fm)(t)){const i=p(t);e.dblClick(t,i?.cell)}}))}static release(t){try{r.removeAllListeners(t);const e=t.childNodes;if(void 0!==e){const t=e.length;for(let i=0;i<t;i+=1)r.release(e[i])}}catch(t){}}static addMouseWheelListener(t,e){if(null!=t){const i=e=>{e.ctrlKey&&e.preventDefault(),(Math.abs(e.deltaX)>.5||Math.abs(e.deltaY)>.5)&&t(e,0==e.deltaY?-e.deltaX>0:-e.deltaY>0)};if(e=null!=e?e:window,n.A.IS_SF&&!n.A.IS_TOUCH){let i=1;r.addListener(e,"gesturestart",(t=>{r.consume(t),i=1})),r.addListener(e,"gesturechange",(e=>{if(r.consume(e),"number"==typeof e.scale){const s=i-e.scale;Math.abs(s)>.2&&(t(e,s<0,!0),i=e.scale)}})),r.addListener(e,"gestureend",(t=>{r.consume(t)}))}else{let i=[],s=0,n=0;r.addGestureListeners(e,(t=>{(0,l.Er)(t)||null==t.pointerId||i.push(t)}),(e=>{if(!(0,l.Er)(e)&&2==i.length){for(let t=0;t<i.length;t+=1)if(e.pointerId==i[t].pointerId){i[t]=e;break}const l=Math.abs(i[0].clientX-i[1].clientX),a=Math.abs(i[0].clientY-i[1].clientY),o=Math.abs(l-s),h=Math.abs(a-n);if(o>r.PINCH_THRESHOLD||h>r.PINCH_THRESHOLD){const e=i[0].clientX+(i[1].clientX-i[0].clientX)/2,r=i[0].clientY+(i[1].clientY-i[0].clientY)/2;t(i[0],o>h?l>s:a>n,!0,e,r),s=l,n=a}}}),(t=>{i=[],s=0,n=0}))}r.addListener(e,"wheel",i)}}static disableContextMenu(t){r.addListener(t,"contextmenu",(t=>(t.preventDefault&&t.preventDefault(),!1)))}static consume(t,e=!0,i=!0){e&&(t.preventDefault?(i&&t.stopPropagation(),t.preventDefault()):i&&(t.cancelBubble=!0)),t.isConsumed=!0,t.preventDefault||(t.returnValue=!1)}}r.LABEL_HANDLE=-1,r.ROTATION_HANDLE=-2,r.CUSTOM_HANDLE=-100,r.VIRTUAL_HANDLE=-1e5,r.MOUSE_DOWN="mouseDown",r.MOUSE_MOVE="mouseMove",r.MOUSE_UP="mouseUp",r.ACTIVATE="activate",r.RESIZE_START="resizeStart",r.RESIZE="resize",r.RESIZE_END="resizeEnd",r.MOVE_START="moveStart",r.MOVE="move",r.MOVE_END="moveEnd",r.PAN_START="panStart",r.PAN="pan",r.PAN_END="panEnd",r.MINIMIZE="minimize",r.NORMALIZE="normalize",r.MAXIMIZE="maximize",r.HIDE="hide",r.SHOW="show",r.CLOSE="close",r.DESTROY="destroy",r.REFRESH="refresh",r.SIZE="size",r.SELECT="select",r.FIRED="fired",r.FIRE_MOUSE_EVENT="fireMouseEvent",r.GESTURE="gesture",r.TAP_AND_HOLD="tapAndHold",r.GET="get",r.RECEIVE="receive",r.CONNECT="connect",r.DISCONNECT="disconnect",r.SUSPEND="suspend",r.RESUME="resume",r.MARK="mark",r.ROOT="root",r.POST="post",r.OPEN="open",r.SAVE="save",r.BEFORE_ADD_VERTEX="beforeAddVertex",r.ADD_VERTEX="addVertex",r.AFTER_ADD_VERTEX="afterAddVertex",r.DONE="done",r.EXECUTE="execute",r.EXECUTED="executed",r.BEGIN_UPDATE="beginUpdate",r.START_EDIT="startEdit",r.END_UPDATE="endUpdate",r.END_EDIT="endEdit",r.BEFORE_UNDO="beforeUndo",r.UNDO="undo",r.REDO="redo",r.CHANGE="change",r.NOTIFY="notify",r.LAYOUT_CELLS="layoutCells",r.CLICK="click",r.SCALE="scale",r.TRANSLATE="translate",r.SCALE_AND_TRANSLATE="scaleAndTranslate",r.UP="up",r.DOWN="down",r.ADD="add",r.REMOVE="remove",r.CLEAR="clear",r.ADD_CELLS="addCells",r.CELLS_ADDED="cellsAdded",r.MOVE_CELLS="moveCells",r.CELLS_MOVED="cellsMoved",r.RESIZE_CELLS="resizeCells",r.CELLS_RESIZED="cellsResized",r.TOGGLE_CELLS="toggleCells",r.CELLS_TOGGLED="cellsToggled",r.ORDER_CELLS="orderCells",r.CELLS_ORDERED="cellsOrdered",r.REMOVE_CELLS="removeCells",r.CELLS_REMOVED="cellsRemoved",r.GROUP_CELLS="groupCells",r.UNGROUP_CELLS="ungroupCells",r.REMOVE_CELLS_FROM_PARENT="removeCellsFromParent",r.FOLD_CELLS="foldCells",r.CELLS_FOLDED="cellsFolded",r.ALIGN_CELLS="alignCells",r.LABEL_CHANGED="labelChanged",r.CONNECT_CELL="connectCell",r.CELL_CONNECTED="cellConnected",r.SPLIT_EDGE="splitEdge",r.FLIP_EDGE="flipEdge",r.START_EDITING="startEditing",r.EDITING_STARTED="editingStarted",r.EDITING_STOPPED="editingStopped",r.ADD_OVERLAY="addOverlay",r.REMOVE_OVERLAY="removeOverlay",r.UPDATE_CELL_SIZE="updateCellSize",r.ESCAPE="escape",r.DOUBLE_CLICK="doubleClick",r.START="start",r.RESET="reset",r.PINCH_THRESHOLD=10;const o=r},633:(t,e,i)=>{i.d(e,{Aw:()=>g,E$:()=>v,E8:()=>m,HY:()=>f,Iq:()=>p,JQ:()=>u,KP:()=>C,Qg:()=>c,UA:()=>o,UX:()=>h,_C:()=>w,ct:()=>d,eh:()=>r,gR:()=>_,kf:()=>y,zi:()=>E});var s=i(83),n=i(534),l=i(989),a=i(675);const r=t=>Math.PI*t/180,o=(t,e,i,s,n,l,a,r,o)=>{if(r-=t,o-=e,0===i||0===s)return[];const h=a,p=n;i=Math.abs(i),s=Math.abs(s);const d=-r/2,c=-o/2,u=Math.cos(p*Math.PI/180),g=Math.sin(p*Math.PI/180),_=u*d+g*c,f=-1*g*d+u*c,C=_*_,y=f*f,E=i*i,v=s*s,m=C/E+y/v;let w;if(m>1)i=Math.sqrt(m)*i,s=Math.sqrt(m)*s,w=0;else{let t=1;l===h&&(t=-1),w=t*Math.sqrt((E*v-E*y-v*C)/(E*y+v*C))}const x=w*i*f/s,S=-1*w*s*_/i,b=u*x-g*S+r/2,A=g*x+u*S+o/2;let M=Math.atan2((f-S)/s,(_-x)/i)-Math.atan2(0,1),T=M>=0?M:2*Math.PI+M;M=Math.atan2((-f-S)/s,(-_-x)/i)-Math.atan2((f-S)/s,(_-x)/i);let P=M>=0?M:2*Math.PI+M;!h&&P>0?P-=2*Math.PI:h&&P<0&&(P+=2*Math.PI);const I=2*P/Math.PI,O=Math.ceil(I<0?-1*I:I),L=P/O,H=8/3*Math.sin(L/4)*Math.sin(L/4)/Math.sin(L/2),D=u*i,R=u*s,k=g*i,B=g*s;let V=Math.cos(T),U=Math.sin(T),N=-H*(D*U+B*V),z=-H*(k*U-R*V),G=0,F=0;const W=[];for(let i=0;i<O;++i){T+=L,V=Math.cos(T),U=Math.sin(T),G=D*V-B*U+b,F=k*V+R*U+A;const s=-H*(D*U+B*V),n=-H*(k*U-R*V),l=6*i;W[l]=Number(N+t),W[l+1]=Number(z+e),W[l+2]=Number(G-s+t),W[l+3]=Number(F-n+e),W[l+4]=Number(G+t),W[l+5]=Number(F+e),N=G+s,z=F+n}return W},h=(t,e,i=null)=>{let s=null;if(t&&0!==e){const a=r(e),o=Math.cos(a),h=Math.sin(a);i=null!=i?i:new n.A(t.x+t.width/2,t.y+t.height/2);let d=new n.A(t.x,t.y),c=new n.A(t.x+t.width,t.y),u=new n.A(c.x,t.y+t.height),g=new n.A(t.x,u.y);d=p(d,o,h,i),c=p(c,o,h,i),u=p(u,o,h,i),g=p(g,o,h,i),s=new l.A(d.x,d.y,0,0),s.add(new l.A(c.x,c.y,0,0)),s.add(new l.A(u.x,u.y,0,0)),s.add(new l.A(g.x,g.y,0,0))}return s},p=(t,e,i,s=new n.A)=>{const l=t.x-s.x,a=t.y-s.y,r=l*e-a*i,o=a*e+l*i;return new n.A(r+s.x,o+s.y)},d=(t,e,i,n)=>{const l=t.style.portConstraint??(i?e.style.sourcePortConstraint:e.style.targetPortConstraint)??null;if((0,a.uy)(l))return n;const r=l.toString();let o=s.TE.NONE,h=0;t.style.portConstraintRotation&&(h=t.style.rotation??0);let p=0;if(h>45?(p=1,h>=135&&(p=2)):h<-45&&(p=3,h<=-135&&(p=2)),r.indexOf(s.M8.NORTH)>=0)switch(p){case 0:o|=s.TE.NORTH;break;case 1:o|=s.TE.EAST;break;case 2:o|=s.TE.SOUTH;break;case 3:o|=s.TE.WEST}if(r.indexOf(s.M8.WEST)>=0)switch(p){case 0:o|=s.TE.WEST;break;case 1:o|=s.TE.NORTH;break;case 2:o|=s.TE.EAST;break;case 3:o|=s.TE.SOUTH}if(r.indexOf(s.M8.SOUTH)>=0)switch(p){case 0:o|=s.TE.SOUTH;break;case 1:o|=s.TE.WEST;break;case 2:o|=s.TE.NORTH;break;case 3:o|=s.TE.EAST}if(r.indexOf(s.M8.EAST)>=0)switch(p){case 0:o|=s.TE.EAST;break;case 1:o|=s.TE.SOUTH;break;case 2:o|=s.TE.WEST;break;case 3:o|=s.TE.NORTH}return o},c=t=>{let e=0;return e=(t&s.TE.WEST)<<3,e|=(t&s.TE.NORTH)<<1,e|=(t&s.TE.SOUTH)>>1,e|=(t&s.TE.EAST)>>3,e},u=(t,e,i)=>{let s=-1;if(t.absolutePoints.length>0){let n=t.absolutePoints[0],l=null;for(let a=1;a<t.absolutePoints.length;a+=1){const r=t.absolutePoints[a];if(!n||!r)continue;const o=m(n.x,n.y,r.x,r.y,e,i);(null==l||o<l)&&(l=o,s=a-1),n=r}}return s},g=(t,e,i,n,a)=>{const r=i?.direction??"east";if(n??(n=i?.flipH??!1),a??(a=i?.flipV??!1),e.x=Math.round(Math.max(0,Math.min(t.width,e.x))),e.y=Math.round(Math.max(0,Math.min(t.height,e.y))),e.width=Math.round(Math.max(0,Math.min(t.width,e.width))),e.height=Math.round(Math.max(0,Math.min(t.height,e.height))),a&&(r===s.M8.SOUTH||r===s.M8.NORTH)||n&&(r===s.M8.EAST||r===s.M8.WEST)){const t=e.x;e.x=e.width,e.width=t}if(n&&(r===s.M8.SOUTH||r===s.M8.NORTH)||a&&(r===s.M8.EAST||r===s.M8.WEST)){const t=e.y;e.y=e.height,e.height=t}const o=l.A.fromRectangle(e);return r===s.M8.SOUTH?(o.y=e.x,o.x=e.height,o.width=e.y,o.height=e.width):r===s.M8.WEST?(o.y=e.height,o.x=e.width,o.width=e.x,o.height=e.y):r===s.M8.NORTH&&(o.y=e.width,o.x=e.y,o.width=e.height,o.height=e.x),new l.A(t.x+o.x,t.y+o.y,t.width-o.width-o.x,t.height-o.height-o.y)},_=(t,e,i)=>t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i,f=(t,e)=>{let i=t.width,s=t.height,n=e.width,l=e.height;if(n<=0||l<=0||i<=0||s<=0)return!1;const a=t.x,r=t.y,o=e.x,h=e.y;return n+=o,l+=h,i+=a,s+=r,(n<o||n>a)&&(l<h||l>r)&&(i<a||i>o)&&(s<r||s>h)},C=(t,e,i,s,a,o)=>{if(a=null!=a?a:0,o=null!=o?o:0,(s=null!=s?s:1)>0){let h=t.getCenterX(),d=t.getCenterY(),c=t.width,u=t.height;const g=t.style,f=(g?.startSize??0)*t.view.scale;f>0&&(g?.horizontal??1?(d=t.y+f/2,u=f):(h=t.x+f/2,c=f)),c=Math.max(a,c*s),u=Math.max(a,u*s),o>0&&(c=Math.min(c,o),u=Math.min(u,o));const C=new l.A(h-c/2,d-u/2,c,u),y=r(g?.rotation??0);if(0!=y){const s=Math.cos(-y),l=Math.sin(-y),a=new n.A(t.getCenterX(),t.getCenterY()),r=p(new n.A(e,i),s,l,a);e=r.x,i=r.y}return _(C,e,i)}return!0},y=t=>!Number.isNaN(parseFloat(t))&&isFinite(+t)&&("string"!=typeof t||t.toLowerCase().indexOf("0x")<0),E=(t,e)=>(t%e+e)%e,v=(t,e,i,s,l,a,r,o)=>{const h=(o-a)*(i-t)-(r-l)*(s-e),p=((r-l)*(e-a)-(o-a)*(t-l))/h,d=((i-t)*(e-a)-(s-e)*(t-l))/h;if(p>=0&&p<=1&&d>=0&&d<=1){const l=t+p*(i-t),a=e+p*(s-e);return new n.A(l,a)}return null},m=(t,e,i,s,n,l)=>{let a,r=(n-=t)*(i-=t)+(l-=e)*(s-=e);r<=0?a=0:(r=(n=i-n)*i+(l=s-l)*s,a=r<=0?0:r*r/(i*i+s*s));let o=n*n+l*l-a;return o<0&&(o=0),o},w=(t,e,i,s,n,l)=>{let a=(n-=t)*(s-=e)-(l-=e)*(i-=t);return 0==a&&(a=n*i+l*s,a>0&&(a=(n-=i)*i+(l-=s)*s,a<0&&(a=0))),a<0?-1:a>0?1:0}},675:(t,e,i)=>{i.d(e,{Vq:()=>a,rU:()=>r,uy:()=>l});var s=i(306),n=i(272);s.A.imageBasePath;const l=t=>null==t,a=t=>!l(t),r=t=>e=>{const i=Reflect.ownKeys(e);try{for(const s of i)Object.defineProperty(t.prototype,s,{value:e[s],writable:!0})}catch(t){n.eo.logger.error("Error while mixing",t)}}},733:(t,e,i)=>{i.d(e,{Ll:()=>l,M9:()=>n,oH:()=>a,uq:()=>s,wr:()=>r});const s=t=>{const e=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],i=[];return function t(s){if(1!=s.length||"BR"!=s[0].nodeName&&"\n"!=s[0].innerHTML)for(let n=0;n<s.length;n+=1){const l=s[n];"BR"==l.nodeName||"\n"==l.innerHTML||(1==s.length||0==n)&&"DIV"==l.nodeName&&"<br>"==l.innerHTML.toLowerCase()?i.push("\n"):(3===l.nodeType||4===l.nodeType?l.nodeValue&&l.nodeValue.length>0&&i.push(l.nodeValue):8!==l.nodeType&&l.childNodes.length>0&&t(Array.from(l.childNodes)),n<s.length-1&&e.indexOf(s[n+1].nodeName)>=0&&i.push("\n"))}}(t),i.join("")},n=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&t.appendChild(i),i},l=(t,e=null,i,s)=>!(null==t||isNaN(t.nodeType)||null!=e&&t.nodeName.toLowerCase()!=e.toLowerCase()||null!=i&&t.getAttribute(i)!=s),a=(t,e)=>{let i=e;for(;null!=i;){if(i===t)return!0;i=i.parentNode}return!1},r=()=>{const t=window.getSelection?window.getSelection():document.selection;t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())}},737:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(823);const n=class{constructor(t=null){this.eventListeners=[],this.eventsEnabled=!0,this.eventSource=null,this.eventSource=t}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(t){this.eventsEnabled=t}getEventSource(){return this.eventSource}setEventSource(t){this.eventSource=t}addListener(t,e){this.eventListeners.push({name:t,funct:e})}removeListener(t){let e=0;for(;e<this.eventListeners.length;)this.eventListeners[e].funct===t?this.eventListeners.splice(e,1):e+=1}fireEvent(t,e=null){if(this.isEventsEnabled()){t||(t=new s.A("")),e||(e=this.getEventSource()),e||(e=this);for(const i of this.eventListeners)null!==i.name&&i.name!==t.getName()||i.funct.apply(this,[e,t])}}}},766:(t,e,i)=>{i.d(e,{I:()=>l,o:()=>n});var s=i(909);const n=function t(e,i=null,n=!1){n=null!=n&&n;let l=null;if(null!=e&&"function"==typeof e.constructor){l=new e.constructor;for(const a in e)a!=s.A.FIELD_NAME&&(null==i||i.indexOf(a)<0)&&(n||"object"!=typeof e[a]?l[a]=e[a]:l[a]=t(e[a]))}return l},l=(t,e)=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];Array.isArray(s)?e[i]=[...s]:e[i]=s}}},823:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t="",...e){if(this.consumed=!1,this.name=t,this.properties={},e[0]&&e[0].constructor===Object)for(const[t,i]of Object.entries(e[0]))this.properties[t]=i;else for(let t=0;t<e.length;t+=2)null!==e[t+1]&&(this.properties[e[t]]=e[t+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(t){return this.properties[t]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}},897:function(t,e,i){t.exports=function(){var t=function(t){var e=t.id,i=t.viewBox,s=t.content;this.id=e,this.viewBox=i,this.content=s};t.prototype.stringify=function(){return this.content},t.prototype.toString=function(){return this.stringify()},t.prototype.destroy=function(){var t=this;["id","viewBox","content"].forEach((function(e){return delete t[e]}))};function e(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self&&self;var s=e((function(t,e){t.exports=function(){function t(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function e(t){return Array.isArray(t)?[]:{}}function i(i,s){return s&&!0===s.clone&&t(i)?l(e(i),i,s):i}function s(e,s,n){var a=e.slice();return s.forEach((function(s,r){void 0===a[r]?a[r]=i(s,n):t(s)?a[r]=l(e[r],s,n):-1===e.indexOf(s)&&a.push(i(s,n))})),a}function n(e,s,n){var a={};return t(e)&&Object.keys(e).forEach((function(t){a[t]=i(e[t],n)})),Object.keys(s).forEach((function(r){t(s[r])&&e[r]?a[r]=l(e[r],s[r],n):a[r]=i(s[r],n)})),a}function l(t,e,l){var a=Array.isArray(e),r=(l||{arrayMerge:s}).arrayMerge||s;return a?Array.isArray(t)?r(t,e,l):i(e,l):n(t,e,l)}return l.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce((function(t,i){return l(t,i,e)}))},l}()})),n=e((function(t,e){e.default={svg:{name:"xmlns",uri:"http://www.w3.org/2000/svg"},xlink:{name:"xmlns:xlink",uri:"http://www.w3.org/1999/xlink"}},t.exports=e.default})),l=n.svg,a=n.xlink,r={};r[l.name]=l.uri,r[a.name]=a.uri;var o=function(t,e){return void 0===t&&(t=""),"<svg "+function(t){return Object.keys(t).map((function(e){return e+'="'+t[e].toString().replace(/"/g,"&quot;")+'"'})).join(" ")}(s(r,e||{}))+">"+t+"</svg>"},h=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={isMounted:{}};return i.isMounted.get=function(){return!!this.node},e.createFromExistingNode=function(t){return new e({id:t.getAttribute("id"),viewBox:t.getAttribute("viewBox"),content:t.outerHTML})},e.prototype.destroy=function(){this.isMounted&&this.unmount(),t.prototype.destroy.call(this)},e.prototype.mount=function(t){if(this.isMounted)return this.node;var e="string"==typeof t?document.querySelector(t):t,i=this.render();return this.node=i,e.appendChild(i),i},e.prototype.render=function(){var t=this.stringify();return function(t){var e=!!document.importNode,i=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return e?document.importNode(i,!0):i}(o(t)).childNodes[0]},e.prototype.unmount=function(){this.node.parentNode.removeChild(this.node)},Object.defineProperties(e.prototype,i),e}(t);return h}()},902:(t,e,i)=>{i.d(e,{F:()=>r});var s=i(675),n=i(766);function l(){return"undefined"!=typeof window?navigator.language:"en"}const a={defaultLanguage:"en",language:l(),languages:[]};(0,n.I)(a,{});const r={isEnabled(){return"none"!==this.getLanguage()},getLanguage:()=>a.language,setLanguage(t){a.language=(0,s.uy)(t)?l():t},getLanguages:()=>a.languages,setLanguages(t){(0,s.uy)(t)||(a.languages=t)},getDefaultLanguage:()=>a.defaultLanguage,setDefaultLanguage(t){a.defaultLanguage=(0,s.uy)(t)?"en":t}}},906:(t,e,i)=>{i.d(e,{A3:()=>g,FR:()=>d,ID:()=>f,Ko:()=>m,Uj:()=>u,bW:()=>w,ce:()=>C,fE:()=>E,gU:()=>S,i4:()=>x,jb:()=>_,lY:()=>h,nf:()=>y,oM:()=>b,sc:()=>p,uM:()=>c});var s=i(306),n=i(83),l=i(534),a=i(944),r=i(577),o=i(989);const h=t=>t&&"[object ShadowRoot]"!==t.toString()?window.getComputedStyle(t,""):null,p=t=>{"thin"===t?t="2":"medium"===t?t="4":"thick"===t&&(t="6");let e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},d=(t,e,i)=>{let n=null;s.A.IS_SF||s.A.IS_GC?n="Webkit":s.A.IS_MT&&(n="Moz"),t.setProperty(e,i),null!==n&&e.length>0&&(e=n+e.substring(0,1).toUpperCase()+e.substring(1),t.setProperty(e,i))},c=t=>{const e=h(t);return!!e&&("scroll"===e.overflow||"auto"===e.overflow)},u=t=>{const e=(()=>{const t=document.body,e=document.documentElement;try{return new o.A(0,0,t.clientWidth??e.clientWidth,Math.max(t.clientHeight??0,e.clientHeight))}catch(t){return new o.A}})(),i=t.offsetLeft,s=t.offsetWidth,n=_(t.ownerDocument),l=n.x,a=n.y,r=l+e.width;i+s>r&&(t.style.left=`${Math.max(l,r-s)}px`);const h=t.offsetTop,p=t.offsetHeight,d=a+e.height;h+p>d&&(t.style.top=`${Math.max(a,d-p)}px`)},g=(t,e=!1)=>{let i=0,s=0,n=!1,a=t;const r=document.body,o=document.documentElement;for(;null!=a&&a!=r&&a!=o&&!n;){const t=h(a);null!=t&&(n=n||"fixed"==t.position),a=a.parentNode}if(!e&&!n){const e=_(t.ownerDocument);i+=e.x,s+=e.y}const p=t.getBoundingClientRect();return null!=p&&(i+=p.left,s+=p.top),new l.A(i,s)},_=t=>{const e=t.defaultView||t.parentWindow,i=null!=e&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,s=null!=e&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new l.A(i,s)},f=(t=null,e=!1,i=!0)=>{const s=null!=t?t.ownerDocument:document,n=s.body,a=s.documentElement,r=new l.A;let o=!1;for(;null!=t&&t!=n&&t!=a;){Number.isNaN(t.scrollLeft)||Number.isNaN(t.scrollTop)||(r.x+=t.scrollLeft,r.y+=t.scrollTop);const i=h(t);null!=i&&(o=o||"fixed"==i.position),t=e?t.parentNode:null}if(!o&&i){const t=_(s);r.x+=t.x,r.y+=t.y}return r},C=(t,e,i)=>{const s=f(t,!1),n=g(t);return n.x-=s.x,n.y-=s.y,new l.A(e-n.x,i-n.y)},y=(t,e,i,s)=>{e.length>0&&t.batchUpdate((()=>{for(let n=0;n<e.length;n+=1){const l=e[n];if(l){const e=l.getClonedStyle();e[i]=s,t.setStyle(l,e)}}}))},E=(t,e,i,s,n)=>{e.length>0&&t.batchUpdate((()=>{for(let l=0;l<e.length;l+=1){const a=e[l];if(a){const e=v(a.getClonedStyle(),i,s,n);t.setStyle(a,e)}}}))},v=(t,e,i,s)=>{const n=t[e];return t[e]=void 0===n?void 0===s||s?i:0:void 0===s?n^i:s?n|i:n&~i,t},m=(t,e)=>{t.style.opacity=String(e/100)},w=(t,e)=>(t&e)===e,x=(t,e=n.FV,i=n.CT,s=null,l=null)=>{const a=document.createElement("div");if(a.style.fontFamily=i,a.style.fontSize=`${Math.round(e)}px`,a.style.lineHeight=`${Math.round(e*n.$g)}px`,null!==l){w(l,n.mE.BOLD)&&(a.style.fontWeight="bold"),w(l,n.mE.ITALIC)&&(a.style.fontWeight="italic");const t=[];w(l,n.mE.UNDERLINE)&&t.push("underline"),w(l,n.mE.STRIKETHROUGH)&&t.push("line-through"),t.length>0&&(a.style.textDecoration=t.join(" "))}a.style.position="absolute",a.style.visibility="hidden",a.style.display="inline-block",null!==s?(a.style.width=`${s}px`,a.style.whiteSpace="normal"):a.style.whiteSpace="nowrap",a.innerHTML=t,document.body.appendChild(a);const r=new o.A(0,0,a.offsetWidth,a.offsetHeight);return document.body.removeChild(a),r},S=(t,e=!0)=>{const i=new a.A;return t.sort(((t,s)=>{let n=i.get(t);null==n&&(n=r.A.create(t).split(r.A.PATH_SEPARATOR),i.put(t,n));let l=i.get(s);null==l&&(l=r.A.create(s).split(r.A.PATH_SEPARATOR),i.put(s,l));const a=r.A.compare(n,l);return 0==a?0:a>0==e?1:-1})),t},b=(t,e)=>{let i=-.5,s=-.5;return t===n.Ec.LEFT?i=0:t===n.Ec.RIGHT&&(i=-1),e===n.Ec.TOP?s=0:e===n.Ec.BOTTOM&&(s=-1),new l.A(i,s)}},909:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(83),n=i(568);class l{static get(t){if(t){if(null===t[s.QG]||void 0===t[s.QG])if("object"==typeof t){const e=(0,n.qQ)(t.constructor);t[s.QG]=`${e}#${l.counter++}`}else"function"==typeof t&&(t[s.QG]="Function#"+l.counter++);return t[s.QG]}return null}static clear(t){delete t[s.QG]}}l.FIELD_NAME=s.QG,l.counter=0;const a=l},937:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(823),n=i(534),l=i(603);const a=class{constructor(t,e){if(this.view=t,this.root=e,this.previous=e,this.isUp=null===e,!this.isUp){let t=this.view.currentRoot;for(;t;){if(t===e){this.isUp=!0;break}t=t.getParent()}}}execute(){const t=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=t;const e=this.view.graph.getTranslateForRoot(this.view.currentRoot);e&&(this.view.translate=new n.A(-e.x,-e.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0,!0),this.view.validate(null)):this.view.refresh();const i=this.isUp?l.A.UP:l.A.DOWN;this.view.fireEvent(new s.A(i,{root:this.view.currentRoot,previous:this.previous})),this.isUp=!this.isUp}}},944:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(909);const n=class{constructor(){this.map={},this.clear()}clear(){this.map={}}get(t){const e=s.A.get(t);return this.map[e]??null}put(t,e){const i=s.A.get(t),n=this.map[i];return this.map[i]=e,n??null}remove(t){const e=s.A.get(t),i=this.map[e];return delete this.map[e],i??null}getKeys(){const t=[];for(const e in this.map)t.push(e);return t}getValues(){const t=[];for(const e in this.map)t.push(this.map[e]);return t}visit(t){for(const e in this.map)t(e,this.map[e])}}},953:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(534),n=i(989),l=i(944),a=i(83);class r extends n.A{constructor(t=null,e=null,i=null){super(),this.node=null,this.cellBounds=null,this.paintBounds=null,this.boundingBox=null,this.control=null,this.overlays=new l.A,this.invalidStyle=!1,this.invalid=!0,this.absolutePoints=[],this.visibleSourceState=null,this.visibleTargetState=null,this.terminalDistance=0,this.length=0,this.segments=[],this.shape=null,this.text=null,this.unscaledWidth=0,this.unscaledHeight=0,this.parentHighlight=null,this.point=null,t&&(this.view=t),e&&(this.cell=e),this.style=i??{},this.origin=new s.A,this.absoluteOffset=new s.A}getPerimeterBounds(t=0,e=new n.A(this.x,this.y,this.width,this.height)){if("fixed"===this.shape?.stencil?.aspect){const t=this.shape.stencil.computeAspect(this.shape,e.x,e.y,e.width,e.height);e.x=t.x,e.y=t.y,e.width=this.shape.stencil.w0*t.width,e.height=this.shape.stencil.h0*t.height}return 0!==t&&e.grow(t),e}setAbsoluteTerminalPoint(t,e=!1){e?0===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[0]=t:0===this.absolutePoints.length?(this.absolutePoints.push(null),this.absolutePoints.push(t)):1===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[this.absolutePoints.length-1]=t}setCursor(t){this.shape&&this.shape.setCursor(t),this.text&&this.text.setCursor(t)}getVisibleTerminal(t=!1){return this.getVisibleTerminalState(t)?.cell??null}getVisibleTerminalState(t=!1){return t?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(t,e=!1){e?this.visibleSourceState=t:this.visibleTargetState=t}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){const t=this.view,e=t.translate,i=t.scale;this.cellBounds=new n.A(this.x/i-e.x,this.y/i-e.y,this.width/i,this.height/i),this.paintBounds=n.A.fromRectangle(this.cellBounds),this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(t){this.view=t.view,this.cell=t.cell,this.style=t.style,this.absolutePoints=t.absolutePoints,this.origin=t.origin,this.absoluteOffset=t.absoluteOffset,this.boundingBox=t.boundingBox,this.terminalDistance=t.terminalDistance,this.segments=t.segments,this.length=t.length,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.unscaledWidth=t.unscaledWidth,this.unscaledHeight=t.unscaledHeight}clone(){const t=new r(this.view,this.cell,this.style);for(let e=0;e<this.absolutePoints.length;e+=1){const i=this.absolutePoints[e];t.absolutePoints[e]=i?i.clone():null}return this.origin&&(t.origin=this.origin.clone()),this.absoluteOffset&&(t.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox&&(t.boundingBox=this.boundingBox.clone()),t.terminalDistance=this.terminalDistance,t.segments=this.segments,t.length=this.length,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.unscaledWidth=this.unscaledWidth,t.unscaledHeight=this.unscaledHeight,t}destroy(){this.view.graph.cellRenderer.destroy(this)}isLoop(t){const e=this.getVisibleTerminalState(!0);return e&&e===this.getVisibleTerminalState(!1)}getVerticalAlign(){return this.style.verticalAlign??a.Ec.MIDDLE}isTransparentState(){return(this.style.strokeColor??a.x3)===a.x3&&(this.style.fillColor??a.x3)===a.x3&&!this.getImageSrc()}getImageSrc(){return this.style.image||null}getIndicatorColor(){return this.style.indicatorColor||null}getIndicatorGradientColor(){return this.style.gradientColor||null}getIndicatorShape(){return this.style.indicatorShape||null}getIndicatorImageSrc(){return this.style.indicatorImage||null}}const o=r},954:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _geometry_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(534),_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(989),_util_Dictionary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(944),_event_EventSource__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(737),_event_EventObject__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(823),_geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(315),_util_Constants__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(83),_Client__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(306),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(603),_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(906),_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(633),_util_config__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(272),_cell_CellState__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(953),_undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(592),_geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(79),_event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(966),_undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(937),_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(437),_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(766),_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(127),_i18n_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(902);class GraphView extends _event_EventSource__WEBPACK_IMPORTED_MODULE_0__.A{constructor(t){super(),this.backgroundImage=null,this.backgroundPageShape=null,this.EMPTY_POINT=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A,this.doneResource=_i18n_config__WEBPACK_IMPORTED_MODULE_2__.F.isEnabled()?"done":"",this.updatingDocumentResource=_i18n_config__WEBPACK_IMPORTED_MODULE_2__.F.isEnabled()?"updatingDocument":"",this.allowEval=!1,this.captureDocumentGesture=!0,this.rendering=!0,this.currentRoot=null,this.graphBounds=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A,this.scale=1,this.translate=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A,this.states=new _util_Dictionary__WEBPACK_IMPORTED_MODULE_4__.A,this.updateStyle=!1,this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null,this.endHandler=null,this.moveHandler=null,this.graph=t}getGraphBounds(){return this.graphBounds}setGraphBounds(t){this.graphBounds=t}getScale(){return this.scale}setScale(t){const e=this.scale;e!==t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.SCALE,{scale:t,previousScale:e}))}getTranslate(){return this.translate}isRendering(){return this.rendering}setRendering(t){this.rendering=t}setTranslate(t,e){const i=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(this.translate.x,this.translate.y);this.translate.x===t&&this.translate.y===e||(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.TRANSLATE,{translate:this.translate,previousTranslate:i}))}isAllowEval(){return this.allowEval}setAllowEval(t){this.allowEval=t}getStates(){return this.states}setStates(t){this.states=t}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}getBounds(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.getState(t[i]);s&&(e?e.add(s):e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A.fromRectangle(s))}return e}setCurrentRoot(t){if(this.currentRoot!==t){const e=new _undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__.A(this,t);e.execute();const i=new _undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__.A(this,!0);i.add(e),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.UNDO,{edit:i})),this.graph.sizeDidChange(),this.currentRoot=t}return t}scaleAndTranslate(t,e,i){const s=this.scale,n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(this.translate.x,this.translate.y);this.scale===t&&this.translate.x===e&&this.translate.y===i||(this.scale=t,this.translate.x=e,this.translate.y=i,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.SCALE_AND_TRANSLATE,{scale:t,previousScale:s,translate:this.translate,previousTranslate:n}))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(t,e=!1,i=!0){if(t||(t=this.graph.getDataModel().getRoot()),t)if(this.removeState(t),i&&(e||t!==this.currentRoot)){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.clear(t.getChildAt(s),e)}else this.invalidate(t)}invalidate(t=null,e=!0,i=!0){const s=this.graph.getDataModel();if(t=t??s.getRoot()){const s=this.getState(t);if(s&&(s.invalid=!0),!t.invalidating){if(t.invalidating=!0,e){const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);this.invalidate(s,e,i)}}if(i){const s=t.getEdgeCount();for(let n=0;n<s;n+=1)this.invalidate(t.getEdgeAt(n),e,i)}t.invalidating=!1}}}validate(t=null){const e=_util_config__WEBPACK_IMPORTED_MODULE_9__.eo.logger.enter("GraphView.validate");this.resetValidationState();const i=t||(this.currentRoot??this.graph.getDataModel().getRoot());if(i){const t=this.getBoundingBox(this.validateCellState(i?this.validateCell(i):null));this.setGraphBounds(t??this.getEmptyBounds()),this.validateBackground(),this.resetValidationState()}_util_config__WEBPACK_IMPORTED_MODULE_9__.eo.logger.leave("GraphView.validate",e)}getEmptyBounds(){return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(t=null,e=!0){let i=null;if(t&&(t.shape&&t.shape.boundingBox&&(i=t.shape.boundingBox.clone()),t.text&&t.text.boundingBox&&(i?i.add(t.text.boundingBox):i=t.text.boundingBox.clone()),e)){const e=t.cell.getChildCount();for(let s=0;s<e;s+=1){const e=this.getBoundingBox(this.getState(t.cell.getChildAt(s)));e&&(i?i.add(e):i=e)}}return i}createBackgroundPageShape(t){return new _geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__.A(t,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){const t=this.graph.getBackgroundImage();if(t){if(!this.backgroundImage||this.backgroundImage.imageSrc!==t.src){this.backgroundImage&&this.backgroundImage.destroy();const e=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(0,0,1,1);this.backgroundImage=new _geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__.A(e,t.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,t)}else this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){const t=this.graph;if(t.pageVisible){const e=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(e),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.backgroundPageShape.node&&(t.isNativeDblClickEnabled()&&_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(this.backgroundPageShape.node,"dblclick",(e=>{t.dblClick(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(this.backgroundPageShape.node,(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{const i=t.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),t.isMouseDown&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.fm)(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))})))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=e,this.backgroundPageShape.redraw())}else this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){const t=this.graph.pageFormat,e=this.scale*this.graph.pageScale;return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(this.scale*this.translate.x,this.scale*this.translate.y,t.width*e,t.height*e)}redrawBackgroundImage(t,e){if(t.scale=this.scale,t.bounds){const i=t.bounds;i.x=this.scale*this.translate.x,i.y=this.scale*this.translate.y,i.width=this.scale*e.width,i.height=this.scale*e.height}t.redraw()}validateCell(t,e=!0){if(e=e&&t.isVisible(),this.getState(t,e)&&!e)this.removeState(t);else{const i=t.getChildCount();for(let s=0;s<i;s+=1)this.validateCell(t.getChildAt(s),e&&(!t.isCollapsed()||t===this.currentRoot))}return t}validateCellState(t,e=!0){let i=null;if(t&&(i=this.getState(t),i&&(i.invalid&&(i.invalid=!1,i.style&&!i.invalidStyle||(i.style=this.graph.getCellStyle(i.cell),i.invalidStyle=!1),t!==this.currentRoot&&this.validateCellState(t.getParent(),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(i),t===this.currentRoot||i.invalid||(this.graph.cellRenderer.redraw(i,!1,this.isRendering()),i.updateCachedBounds())),e&&!i.invalid))){i.shape&&this.stateValidated(i);const e=t.getChildCount();for(let i=0;i<e;i+=1)this.validateCellState(t.getChildAt(i))}return i}updateCellState(t){const e=t.absoluteOffset,i=t.origin;if(e.x=0,e.y=0,i.x=0,i.y=0,t.length=0,t.cell!==this.currentRoot){const s=t.cell.getParent(),n=s?this.getState(s):null;n&&n.cell!==this.currentRoot&&(i.x+=n.origin.x,i.y+=n.origin.y);let l=this.graph.getChildOffsetForCell(t.cell);l&&(i.x+=l.x,i.y+=l.y);const a=t.cell.getGeometry();if(a){if(!t.cell.isEdge())if(l=a.offset?a.offset:this.EMPTY_POINT,a.relative&&n)if(n.cell.isEdge()){const t=this.getPoint(n,a);t&&(i.x+=t.x/this.scale-n.origin.x-this.translate.x,i.y+=t.y/this.scale-n.origin.y-this.translate.y)}else i.x+=a.x*n.unscaledWidth+l.x,i.y+=a.y*n.unscaledHeight+l.y;else e.x=this.scale*l.x,e.y=this.scale*l.y,i.x+=a.x,i.y+=a.y;t.x=this.scale*(this.translate.x+i.x),t.y=this.scale*(this.translate.y+i.y),t.width=this.scale*a.width,t.unscaledWidth=a.width,t.height=this.scale*a.height,t.unscaledHeight=a.height,t.cell.isVertex()&&this.updateVertexState(t,a),t.cell.isEdge()&&this.updateEdgeState(t,a)}}t.updateCachedBounds()}updateVertexState(t,e){const i=t.cell.getParent(),s=i?this.getState(i):null;if(e.relative&&s&&!s.cell.isEdge()){const e=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.eh)(s.style.rotation??0);if(0!==e){const i=Math.cos(e),n=Math.sin(e),l=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(t.getCenterX(),t.getCenterY()),a=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(s.getCenterX(),s.getCenterY()),r=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.Iq)(l,i,n,a);t.x=r.x-t.width/2,t.y=r.y-t.height/2}}this.updateVertexLabelOffset(t)}updateEdgeState(t,e){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1);if(t.cell.getTerminal(!0)&&!i||!i&&!e.getTerminalPoint(!0)||t.cell.getTerminal(!1)&&!s||!s&&!e.getTerminalPoint(!1))this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,i,s),this.updatePoints(t,e.points,i,s),this.updateFloatingTerminalPoints(t,i,s);const n=t.absolutePoints;t.cell!==this.currentRoot&&(null==n||n.length<2||null==n[0]||null==n[n.length-1])?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}}updateVertexLabelOffset(t){const e=t.style.labelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.CENTER;if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.LEFT){let e=t.style.labelWidth??null;null!=e?e*=this.scale:e=t.width,t.absoluteOffset.x-=e}else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.RIGHT)t.absoluteOffset.x+=t.width;else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.CENTER){const e=t.style.labelWidth??null;if(null!=e){const i=t.style.align??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.CENTER;let s=0;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.CENTER?s=.5:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.RIGHT&&(s=1),0!==s&&(t.absoluteOffset.x-=(e*this.scale-t.width)*s)}}const i=t.style.verticalLabelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.MIDDLE;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.TOP?t.absoluteOffset.y-=t.height:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.Ec.BOTTOM&&(t.absoluteOffset.y+=t.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(t){const e=this.graph,i=t.cell.isEdge()&&e.keepEdgesInForeground||t.cell.isVertex()&&e.keepEdgesInBackground,s=i&&this.lastForegroundHtmlNode||this.lastHtmlNode,n=i&&this.lastForegroundNode||this.lastNode,l=e.cellRenderer.insertStateAfter(t,n,s);i?(this.lastForegroundHtmlNode=l[1],this.lastForegroundNode=l[0]):(this.lastHtmlNode=l[1],this.lastNode=l[0])}updateFixedTerminalPoints(t,e,i){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,i,!1,this.graph.getConnectionConstraint(t,i,!1))}updateFixedTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,i,s),i)}getFixedTerminalPoint(t,e,i,s){let n=null;if(s&&e&&(n=this.graph.getConnectionPoint(e,s,!1)),!n&&!e){const e=this.scale,s=this.translate,l=t.origin;n=t.cell.getGeometry().getTerminalPoint(i),n&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e*(s.x+n.x+l.x),e*(s.y+n.y+l.y)))}return n}updateBoundsFromStencil(t){let e=null;if(t&&t.shape&&t.shape.stencil&&"fixed"===t.shape.stencil.aspect){e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A.fromRectangle(t);const i=t.shape.stencil.computeAspect(null,t.x,t.y,t.width,t.height);t.setRect(i.x,i.y,t.shape.stencil.w0*i.width,t.shape.stencil.h0*i.height)}return e}updatePoints(t,e,i,s){const n=[];n.push(t.absolutePoints[0]);const l=this.getEdgeStyle(t,e,i,s);if(l&&i){const a=this.getTerminalPort(t,i,!0),r=s?this.getTerminalPort(t,s,!1):null,o=this.updateBoundsFromStencil(a),h=this.updateBoundsFromStencil(r);l(t,a,r,e,n),a&&o&&a.setRect(o.x,o.y,o.width,o.height),r&&h&&r.setRect(h.x,h.y,h.width,h.height)}else if(e)for(let i=0;i<e.length;i+=1)if(e[i]){const s=(0,_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__.o)(e[i]);n.push(this.transformControlPoint(t,s))}const a=t.absolutePoints;n.push(a[a.length-1]),t.absolutePoints=n}transformControlPoint(t,e,i=!1){if(t&&e){const s=t.origin,n=i?1:this.scale;return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(n*(e.x+this.translate.x+s.x),n*(e.y+this.translate.y+s.y))}return null}isLoopStyleEnabled(t,e=[],i=null,s=null){const n=this.graph.getConnectionConstraint(t,i,!0),l=this.graph.getConnectionConstraint(t,s,!1);return(null==e||e.length<2)&&!t.style.orthogonalLoop&&(null!=n&&null!=n.point||null!=l&&null!=l.point)&&null!=i&&i===s}getEdgeStyle(edge,points=[],source=null,target=null){let edgeStyle=this.isLoopStyleEnabled(edge,points,source,target)?edge.style.loopStyle??this.graph.defaultLoopStyle:edge.style.noEdgeStyle?null:edge.style.edgeStyle;if("string"==typeof edgeStyle){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.A.getValue(edgeStyle);!tmp&&this.isAllowEval()&&(tmp=eval(edgeStyle)),edgeStyle=tmp}return"function"==typeof edgeStyle?edgeStyle:null}updateFloatingTerminalPoints(t,e,i){const s=t.absolutePoints,n=s[0];!s[s.length-1]&&i&&this.updateFloatingTerminalPoint(t,i,e,!1),!n&&e&&this.updateFloatingTerminalPoint(t,e,i,!0)}updateFloatingTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,i,s),s)}getFloatingTerminalPoint(t,e,i,s){e=this.getTerminalPort(t,e,s);let n=this.getNextPoint(t,i,s);const l=this.graph.isOrthogonal(t),a=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.eh)(e.style.rotation??0),r=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.getCenterX(),e.getCenterY());if(0!==a){const t=Math.cos(-a),e=Math.sin(-a);n=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.Iq)(n,t,e,r)}let o=t.style.perimeterSpacing??0;o+=t.style[s?"sourcePerimeterSpacing":"targetPerimeterSpacing"]??0;let h=this.getPerimeterPoint(e,n,0===a&&l,o);if(h&&0!==a){const t=Math.cos(a),e=Math.sin(a);h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.Iq)(h,t,e,r)}return h}getTerminalPort(t,e,i=!1){const s=i?"sourcePort":"targetPort",n=t.style[s];if(n){const t=this.graph.getDataModel().getCell(n);if(t){const i=this.getState(t,!1);i&&(e=i)}}return e}getPerimeterPoint(t,e,i,s=0){let n=null;if(null!=t){const l=this.getPerimeterFunction(t);if(null!=l&&null!=e){const a=this.getPerimeterBounds(t,s);if(a.width>0||a.height>0){n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.x,e.y);let s=!1,r=!1;t.cell.isVertex()&&(s=!!t.style.flipH,r=!!t.style.flipV,s&&(n.x=2*a.getCenterX()-n.x),r&&(n.y=2*a.getCenterY()-n.y)),n=l(a,t,n,i),null!=n&&(s&&(n.x=2*a.getCenterX()-n.x),r&&(n.y=2*a.getCenterY()-n.y))}}null==n&&(n=this.getPoint(t))}return n}getRoutingCenterX(t){const e=t.style?t.style.routingCenterX??0:0;return t.getCenterX()+e*t.width}getRoutingCenterY(t){const e=t.style?t.style.routingCenterY??0:0;return t.getCenterY()+e*t.height}getPerimeterBounds(t,e=0){return e+=t.style.perimeterSpacing??0,t.getPerimeterBounds(e*this.scale)}getPerimeterFunction(state){let perimeter=state.style.perimeter;if("string"==typeof perimeter){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.A.getValue(perimeter);null==tmp&&this.isAllowEval()&&(tmp=eval(perimeter)),perimeter=tmp}return"function"==typeof perimeter?perimeter:null}getNextPoint(t,e,i=!1){const s=t.absolutePoints;let n=null;if(s.length>=2){const t=s.length;n=s[i?Math.min(1,t-1):Math.max(0,t-2)]}return!n&&e&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.getCenterX(),e.getCenterY())),n}getVisibleTerminal(t,e){const i=this.graph.getDataModel();let s=t.getTerminal(e),n=s;for(;s&&s!==this.currentRoot;)(n&&!n.isVisible()||s.isCollapsed())&&(n=s),s=s.getParent();return!n||i.contains(n)&&n.getParent()!==i.getRoot()&&n!==this.currentRoot||(n=null),n}updateEdgeBounds(t){const e=t.absolutePoints,i=e[0],s=e[e.length-1];if(i&&s&&(i.x!==s.x||i.y!==s.y)){const e=s.x-i.x,n=s.y-i.y;t.terminalDistance=Math.sqrt(e*e+n*n)}else t.terminalDistance=0;let n=0;const l=[];let a=i;if(a){let i=a.x,s=a.y,r=i,o=s;for(let t=1;t<e.length;t+=1){const h=e[t];if(h){const t=a.x-h.x,e=a.y-h.y,p=Math.sqrt(t*t+e*e);l.push(p),n+=p,a=h,i=Math.min(a.x,i),s=Math.min(a.y,s),r=Math.max(a.x,r),o=Math.max(a.y,o)}}t.length=n,t.segments=l;const h=1;t.x=i,t.y=s,t.width=Math.max(h,r-i),t.height=Math.max(h,o-s)}}getPoint(t,e=null){let i=t.getCenterX(),s=t.getCenterY();if(null==t.segments||null!=e&&!e.relative){if(null!=e){const{offset:t}=e;null!=t&&(i+=t.x,s+=t.y)}}else{const n=null!=e?e.x/2:0,l=t.absolutePoints.length,a=Math.round((n+.5)*t.length);let r=t.segments[0],o=0,h=1;for(;a>=Math.round(o+r)&&h<l-1;)o+=r,r=t.segments[h++];const p=0===r?0:(a-o)/r,d=t.absolutePoints[h-1],c=t.absolutePoints[h];if(null!=d&&null!=c){let t=0,n=0,l=0;if(null!=e){t=e.y;const{offset:i}=e;null!=i&&(n=i.x,l=i.y)}const a=c.x-d.x,o=c.y-d.y,h=0===r?0:o/r,u=0===r?0:a/r;i=d.x+a*p+(h*t+n)*this.scale,s=d.y+o*p-(u*t-l)*this.scale}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(i,s)}getRelativePoint(t,e,i){const s=t.cell.getGeometry();if(s){const n=t.absolutePoints,l=n.length;if(s.relative&&l>1){const s=t.length,{segments:a}=t;let r=n[0],o=n[1],h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.E8)(r.x,r.y,o.x,o.y,e,i),p=0,d=0,c=0;for(let t=2;t<l;t+=1){r=o,o=n[t];const s=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.E8)(r.x,r.y,o.x,o.y,e,i);c+=a[t-2],s<=h&&(h=s,d=t-1,p=c)}const u=a[d];r=n[d],o=n[d+1];const g=r.x,_=r.y,f=o.x,C=o.y;let y=e,E=i;const v=g-f,m=_-C;y-=f,E-=C;let w=0;y=v-y,E=m-E;const x=y*v+E*m;w=x<=0?0:x*x/(v*v+m*m);let S=Math.sqrt(w);S>u&&(S=u);let b=Math.sqrt((0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.E8)(r.x,r.y,o.x,o.y,e,i));return-1===(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__._C)(r.x,r.y,o.x,o.y,e,i)&&(b=-b),new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A((s/2-p-S)/s*-2,b/this.scale)}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A}updateEdgeLabelOffset(t){const e=t.absolutePoints,i=t.absoluteOffset;if(i.x=t.getCenterX(),i.y=t.getCenterY(),e.length>0&&t.segments){const s=t.cell.getGeometry();if(s)if(s.relative){const e=this.getPoint(t,s);t.absoluteOffset=e}else{const t=e[0],n=e[e.length-1];if(t&&n){const e=n.x-t.x,l=n.y-t.y;let a=0,r=0;const o=s.offset;o&&(a=o.x,r=o.y);const h=t.x+e/2+a*this.scale,p=t.y+l/2+r*this.scale;i.x=h,i.y=p}}}}getState(t,e=!1){let i=this.states.get(t);return e&&(!i||this.updateStyle)&&t.isVisible()&&(i?i.style=this.graph.getCellStyle(t):(i=this.createState(t),this.states.put(t,i))),i}getCellStates(t=null){if(!t)return this.states.getValues();const e=[];for(const i of t){const t=this.getState(i);t&&e.push(t)}return e}removeState(t){const e=this.states.remove(t);return e&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy()),e}createState(t){return new _cell_CellState__WEBPACK_IMPORTED_MODULE_18__.A(this,t,this.graph.getCellStyle(t))}isContainerEvent(t){const e=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.el)(t);return e&&(e===this.graph.container||e.parentNode===this.backgroundPane||e.parentNode&&e.parentNode.parentNode===this.backgroundPane||e===this.canvas.parentNode||e===this.canvas||e===this.backgroundPane||e===this.drawPane||e===this.overlayPane||e===this.decoratorPane)}isScrollEvent(t){const e=this.graph,i=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.A3)(e.container),s=t instanceof MouseEvent?[t.clientX,t.clientY]:[t.touches[0].clientX,t.touches[0].clientY],n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(s[0]-i.x,s[1]-i.y),l=e.container,a=l.offsetWidth,r=l.clientWidth;if(a>r&&n.x>r+2&&n.x<=a)return!0;const o=l.offsetHeight,h=l.clientHeight;return o>h&&n.y>h+2&&n.y<=o}init(){this.installListeners(),this.createSvg()}installListeners(){const t=this.graph,{container:e}=t;_Client__WEBPACK_IMPORTED_MODULE_20__.A.IS_TOUCH&&(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gesturestart",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gesturechange",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gestureend",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})));let i=null;_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(e,(e=>{!this.isContainerEvent(e)||(_Client__WEBPACK_IMPORTED_MODULE_20__.A.IS_GC||_Client__WEBPACK_IMPORTED_MODULE_20__.A.IS_SF)&&this.isScrollEvent(e)||(t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e)),i=e.pointerId)}),(e=>{!this.isContainerEvent(e)||null!==i&&e.pointerId!==i||t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{this.isContainerEvent(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e)),i=null})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"dblclick",(e=>{this.isContainerEvent(e)&&t.dblClick(e)})),t.addMouseListener({mouseDown:(e,i)=>{const s=t.getPlugin("PopupMenuHandler");s?.hideMenu()},mouseMove:()=>{},mouseUp:()=>{}}),this.moveHandler=i=>{const s=t.getPlugin("TooltipHandler");s&&s.isHideOnHover()&&s.hide(),this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(i)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.fm)(i)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(i,(i=>{let s=null;if(_Client__WEBPACK_IMPORTED_MODULE_20__.A.IS_TOUCH){const n=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.El)(i),l=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.xJ)(i),a=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.ce)(e,n,l),r=t.getCellAt(a.x,a.y);r&&(s=t.view.getState(r))}return s})(i)))},this.endHandler=e=>{this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))},_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(document,null,this.moveHandler,this.endHandler)}createSvg(){const{container:t}=this.graph,e=this.canvas=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"g");this.backgroundPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"g"),e.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"g"),e.appendChild(this.drawPane),this.overlayPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"g"),e.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"g"),e.appendChild(this.decoratorPane);const i=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.pr,"svg");i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.display="block",i.appendChild(this.canvas),null!=t&&(t.appendChild(i),this.updateContainerStyle(t))}createHtml(){const t=this.graph.container;null!=t&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t))}updateHtmlCanvasSize(t,e){if(null!=this.graph.container){const i=this.graph.container.offsetWidth,s=this.graph.container.offsetHeight;this.canvas.style.width=i<t?t+"px":"100%",this.canvas.style.height=s<e?e+"px":"100%"}}createHtmlPane(t,e){const i=document.createElement("DIV");return null!=t&&null!=e?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=t,i.style.height=e):i.style.position="relative",i}updateContainerStyle(t){const e=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.lY)(t);null!=e&&"static"==e.position&&(t.style.position="relative"),_Client__WEBPACK_IMPORTED_MODULE_20__.A.IS_POINTER&&(t.style.touchAction="none")}destroy(){let t=null;this.canvas&&this.canvas instanceof SVGElement&&(t=this.canvas.ownerSVGElement),t||(t=this.canvas),t&&t.parentNode&&(this.clear(this.currentRoot,!0),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.removeGestureListeners(document,null,this.moveHandler,this.endHandler),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}const __WEBPACK_DEFAULT_EXPORT__=GraphView},966:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(437),n=i(733);const l=class{constructor(t,e=null){this.consumed=!1,this.evt=t,this.state=e,this.sourceState=e,this.graphX=0,this.graphY=0}getEvent(){return this.evt}getSource(){return(0,s.el)(this.evt)}isSource(t){return!!t&&(0,n.oH)(t.node,this.getSource())}getX(){return(0,s.El)(this.getEvent())}getY(){return(0,s.xJ)(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){const t=this.getState();return t?t.cell:null}isPopupTrigger(){return(0,s.$Y)(this.getEvent())}isConsumed(){return this.consumed}consume(t){(t=t||window.TouchEvent&&this.evt instanceof TouchEvent||(0,s.Er)(this.evt))&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}},989:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(534);class n extends s.A{constructor(t=0,e=0,i=0,s=0){super(t,e),this._width=0,this._height=0,this.width=i,this.height=s}get width(){return this._width}set width(t){if(Number.isNaN(t))throw new Error("Invalid width supplied.");this._width=t}get height(){return this._height}set height(t){if(Number.isNaN(t))throw new Error("Invalid height supplied.");this._height=t}setRect(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),n=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=i,this.width=s-e,this.height=n-i}intersect(t){const e=this.x+this.width,i=t.x+t.width,s=this.y+this.height,n=t.y+t.height;this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.width=Math.min(e,i)-this.x,this.height=Math.min(s,n)-this.y}grow(t){this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t}getPoint(){return new s.A(this.x,this.y)}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;this.width=this.height,this.height=e}equals(t){return!!t&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new n(this.x,this.y,this.width,this.height)}}n.fromRectangle=t=>new n(t.x,t.y,t.width,t.height);const l=n}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{h:()=>app_AppModelVisualizer,A:()=>app_app});class app_ImageBox{constructor(t,e,i){this.src=t,this.width=e,this.height=i}}const app_image_ImageBox=app_ImageBox;var app_EventObject=__webpack_require__(823),app_EventSource=__webpack_require__(737),app_InternalEvent=__webpack_require__(603),app_Rectangle=__webpack_require__(989),app_Client=__webpack_require__(306),app_GraphView=__webpack_require__(954),app_RectangleShape=__webpack_require__(315),app_Constants=__webpack_require__(83),app_Shape=__webpack_require__(341);class app_PolylineShape extends app_Shape.A{constructor(t,e,i=1){super(),this.points=t,this.stroke=e,this.strokeWidth=i}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(t,e){const i=t.pointerEventsValue;t.pointerEventsValue="stroke",this.style&&this.style.curved?this.paintCurvedLine(t,e):this.paintLine(t,e,this.isRounded),t.pointerEventsValue=i}paintLine(t,e,i){const s=this.style?.arcSize??app_Constants.xU;t.begin(),this.addPoints(t,e,i,s,!1),t.stroke()}paintCurvedLine(t,e){t.begin();const i=e[0],s=e.length;t.moveTo(i.x,i.y);for(let i=1;i<s-2;i+=1){const s=e[i],n=e[i+1],l=(s.x+n.x)/2,a=(s.y+n.y)/2;t.quadTo(s.x,s.y,l,a)}const n=e[s-2],l=e[s-1];t.quadTo(n.x,n.y,l.x,l.y),t.stroke()}}const app_edge_PolylineShape=app_PolylineShape;class app_MarkerShape{static addMarker(t,e){app_MarkerShape.markers[t]=e}static createMarker(t,e,i,s,n,l,a,r,o,h){const p=app_MarkerShape.markers[i];return p?p(t,e,i,s,n,l,a,r,o,h):null}}app_MarkerShape.markers={};const app_edge_MarkerShape=app_MarkerShape;function app_createArrow(t){return(e,i,s,n,l,a,r,o,h,p)=>{const d=l*h*1.118,c=a*h*1.118;l*=r+h,a*=r+h;const u=n.clone();u.x-=d,u.y-=c;const g=s!==app_Constants._v.CLASSIC&&s!==app_Constants._v.CLASSIC_THIN?1:3/4;return n.x+=-l*g-d,n.y+=-a*g-c,()=>{e.begin(),e.moveTo(u.x,u.y),e.lineTo(u.x-l-a/t,u.y-a+l/t),s!==app_Constants._v.CLASSIC&&s!==app_Constants._v.CLASSIC_THIN||e.lineTo(u.x-3*l/4,u.y-3*a/4),e.lineTo(u.x+a/t-l,u.y-a-l/t),e.close(),p?e.fillAndStroke():e.stroke()}}}function app_createOpenArrow(t){return(e,i,s,n,l,a,r,o,h,p)=>{const d=l*h*1.118,c=a*h*1.118;l*=r+h,a*=r+h;const u=n.clone();return u.x-=d,u.y-=c,n.x+=2*-d,n.y+=2*-c,()=>{e.begin(),e.moveTo(u.x-l-a/t,u.y-a+l/t),e.lineTo(u.x,u.y),e.lineTo(u.x+a/t-l,u.y-a-l/t),e.stroke()}}}const app_oval=(t,e,i,s,n,l,a,r,o,h)=>{const p=a/2,d=s.clone();return s.x-=n*p,s.y-=l*p,()=>{t.ellipse(d.x-p,d.y-p,a,a),h?t.fillAndStroke():t.stroke()}};function app_diamond(t,e,i,s,n,l,a,r,o,h){const p=i===app_Constants._v.DIAMOND?.7071:.9862,d=n*o*p,c=l*o*p;n*=a+o,l*=a+o;const u=s.clone();u.x-=d,u.y-=c,s.x+=-n-d,s.y+=-l-c;const g=i===app_Constants._v.DIAMOND?2:3.4;return()=>{t.begin(),t.moveTo(u.x,u.y),t.lineTo(u.x-n/2-l/g,u.y+n/g-l/2),t.lineTo(u.x-n,u.y-l),t.lineTo(u.x-n/2+l/g,u.y-l/2-n/g),t.close(),h?t.fillAndStroke():t.stroke()}}let app_isDefaultMarkersRegistered=!1;const app_registerDefaultEdgeMarkers=()=>{app_isDefaultMarkersRegistered||(app_MarkerShape.addMarker("classic",app_createArrow(2)),app_MarkerShape.addMarker("classicThin",app_createArrow(3)),app_MarkerShape.addMarker("block",app_createArrow(2)),app_MarkerShape.addMarker("blockThin",app_createArrow(3)),app_MarkerShape.addMarker("open",app_createOpenArrow(2)),app_MarkerShape.addMarker("openThin",app_createOpenArrow(3)),app_MarkerShape.addMarker("oval",app_oval),app_MarkerShape.addMarker("diamond",app_diamond),app_MarkerShape.addMarker("diamondThin",app_diamond),app_isDefaultMarkersRegistered=!0)};class app_ConnectorShape extends app_edge_PolylineShape{constructor(t,e,i){super(t,e,i)}updateBoundingBox(){this.useSvgBoundingBox=!!this.style?.curved,super.updateBoundingBox()}paintEdgeShape(t,e){const i=this.createMarker(t,e,!0),s=this.createMarker(t,e,!1);if(super.paintEdgeShape(t,e),t.setShadow(!1),t.setDashed(!1),i){const e=this.style?.startStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.startFillColor??e),i()}if(s){const e=this.style?.endStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.endFillColor??e),s()}}createMarker(t,e,i){if(!this.style)return null;let s=null;const n=e.length,l=(i?this.style.startArrow:this.style.endArrow)||app_Constants.x3;let a=i?e[1]:e[n-2];const r=i?e[0]:e[n-1];if(l!==app_Constants.x3&&null!==a&&null!==r){let o=1;for(;o<n-1&&0===Math.round(a.x-r.x)&&0===Math.round(a.y-r.y);)a=i?e[1+o]:e[n-2-o],o++;const h=r.x-a.x,p=r.y-a.y,d=Math.max(1,Math.sqrt(h*h+p*p)),c=h/d,u=p/d,g=(i?this.style.startSize:this.style.endSize)??app_Constants.wh,_=(i?this.style.startFill:this.style.endFill)??!0;s=app_edge_MarkerShape.createMarker(t,this,l,r,c,u,g,i,this.strokeWidth,_)}return s}augmentBoundingBox(t){if(super.augmentBoundingBox(t),!this.style)return;let e=0;this.style.startArrow!==app_Constants.x3&&(e=(this.style.startSize??app_Constants.wh)+1),this.style.endArrow!==app_Constants.x3&&(e=Math.max(e,this.style.endSize??app_Constants.wh)+1),t.grow(e*this.scale)}}const app_edge_ConnectorShape=app_ConnectorShape;var app_ImageShape=__webpack_require__(79),app_mathUtils=__webpack_require__(633),app_styleUtils=__webpack_require__(906),app_Point=__webpack_require__(534),app_StringUtils=__webpack_require__(568),app_domUtils=__webpack_require__(733),app_SvgCanvas2D=__webpack_require__(504);class app_TextShape extends app_Shape.A{constructor(t,e,i=app_Constants.Ec.CENTER,s=app_Constants.Ec.MIDDLE,n="black",l=app_Constants.CT,a=app_Constants.FV,r=app_Constants.fm,o=2,h=0,p=0,d=0,c=0,u=!0,g=app_Constants.x3,_=app_Constants.x3,f=!1,C=!1,y="visible",E=0,v=app_Constants.Sr){super(),this.margin=null,this.unrotatedBoundingBox=null,this.flipH=!1,this.flipV=!1,this.baseSpacingTop=0,this.baseSpacingBottom=0,this.baseSpacingLeft=0,this.baseSpacingRight=0,this.replaceLinefeeds=!0,this.verticalTextRotation=-90,this.ignoreClippedStringSize=!0,this.ignoreStringSize=!1,this.lastValue=null,this.cacheEnabled=!0,this.value=t,this.bounds=e,this.color=n??"black",this.align=i??app_Constants.Ec.CENTER,this.valign=s??app_Constants.Ec.MIDDLE,this.family=l??app_Constants.CT,this.size=a??app_Constants.FV,this.fontStyle=r??app_Constants.fm,this.spacing=o??2,this.spacingTop=this.spacing+(h??0),this.spacingRight=this.spacing+(p??0),this.spacingBottom=this.spacing+(d??0),this.spacingLeft=this.spacing+(c??0),this.horizontal=u??!0,this.background=g,this.border=_,this.wrap=f??!1,this.clipped=C??!1,this.overflow=y??"visible",this.labelPadding=E??0,this.textDirection=v,this.rotation=0,this.updateMargin()}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(t,e=!1){const i=this.scale,s=this.bounds.x/i,n=this.bounds.y/i,l=this.bounds.width/i,a=this.bounds.height/i;if(this.updateTransform(t,s,n,l,a),this.configureCanvas(t,s,n,l,a),e)t.updateText(s,n,l,a,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{const e=(0,app_domUtils.Ll)(this.value)||this.dialect===app_Constants.$p.STRICTHTML,i=e?"html":"";let r=this.value;e||"html"!==i||(r=(0,app_StringUtils.bG)(r,!1)),"html"!==i||(0,app_domUtils.Ll)(this.value)||(r=(0,app_StringUtils.K7)(r,"<div><br></div>")),r=!(0,app_domUtils.Ll)(this.value)&&this.replaceLinefeeds&&"html"===i?r.replace(/\n/g,"<br/>"):r;let o=this.textDirection;o!==app_Constants.G2.AUTO||e||(o=this.getAutoDirection()),o!==app_Constants.G2.LTR&&o!==app_Constants.G2.RTL&&(o=app_Constants.G2.DEFAULT),t.text(s,n,l,a,r,this.align,this.valign,this.wrap,i,this.overflow,this.clipped,this.getTextRotation(),o)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue===this.value&&((0,app_domUtils.Ll)(this.value)||this.dialect===app_Constants.$p.STRICTHTML))if("DIV"===this.node.nodeName)this.redrawHtmlShape(),this.updateBoundingBox();else{const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox())}else super.redraw(),(0,app_domUtils.Ll)(this.value)||this.dialect===app_Constants.$p.STRICTHTML?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align=app_Constants.Ec.CENTER,this.valign=app_Constants.Ec.MIDDLE,this.family=app_Constants.CT,this.size=app_Constants.FV,this.fontStyle=app_Constants.fm,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,this.background=app_Constants.x3,this.border=app_Constants.x3,this.textDirection=app_Constants.Sr,this.margin=null}apply(t){const e=this.spacing;super.apply(t),this.style&&(this.fontStyle=this.style.fontStyle??this.fontStyle,this.family=this.style.fontFamily??this.family,this.size=this.style.fontSize??this.size,this.color=this.style.fontColor??this.color,this.align=this.style.align??this.align,this.valign=this.style.verticalAlign??this.valign,this.spacing=this.style.spacing??this.spacing,this.spacingTop=(this.style.spacingTop??this.spacingTop-e)+this.spacing,this.spacingRight=(this.style.spacingRight??this.spacingRight-e)+this.spacing,this.spacingBottom=(this.style.spacingBottom??this.spacingBottom-e)+this.spacing,this.spacingLeft=(this.style.spacingLeft??this.spacingLeft-e)+this.spacing,this.horizontal=this.style.horizontal??this.horizontal,this.background=this.style.labelBackgroundColor??this.background,this.border=this.style.labelBorderColor??this.border,this.textDirection=this.style.textDirection??app_Constants.Sr,this.opacity=this.style.textOpacity??100,this.updateMargin()),this.flipV=!1,this.flipH=!1}getAutoDirection(){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(String(this.value));return t&&t.length>0&&t[0]>"z"?app_Constants.G2.RTL:app_Constants.G2.LTR}getContentNode(){let t=this.node;return t&&(t=t.ownerSVGElement?t.firstChild.firstChild.firstChild.firstChild.firstChild:this.node.firstChild.firstChild),t}updateBoundingBox(){let{node:t}=this;this.boundingBox=this.bounds.clone();const e=this.getTextRotation(),i=this.style?.labelPosition??app_Constants.Ec.CENTER,s=this.style?.verticalLabelPosition??app_Constants.Ec.MIDDLE;if(!this.ignoreStringSize&&t&&"fill"!==this.overflow&&(!this.clipped||!this.ignoreClippedStringSize||i!==app_Constants.Ec.CENTER||s!==app_Constants.Ec.MIDDLE)){let e=null,i=null;if(t.firstChild&&t.firstChild.firstChild&&"foreignObject"===t.firstChild.firstChild.nodeName)t=t.firstChild.firstChild.firstChild.firstChild,i=t.offsetHeight*this.scale,e="width"===this.overflow?this.boundingBox.width:t.offsetWidth*this.scale;else try{const e=t.getBBox();return void("string"==typeof this.value&&0===(0,app_StringUtils.Bq)(this.value)?.length||0===e.width&&0===e.height?this.boundingBox=null:this.boundingBox=new app_Rectangle.A(e.x,e.y,e.width,e.height))}catch(t){}e&&i&&(this.boundingBox=new app_Rectangle.A(this.bounds.x,this.bounds.y,e,i))}if(this.boundingBox){const t=this.margin;if(0!==e){const i=(0,app_mathUtils.UX)(new app_Rectangle.A(t.x*this.boundingBox.width,t.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),e,new app_Point.A(0,0));this.unrotatedBoundingBox=app_Rectangle.A.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=t.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=t.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=i.x,this.boundingBox.y+=i.y,this.boundingBox.width=i.width,this.boundingBox.height=i.height}else this.boundingBox.x+=t.x*this.boundingBox.width,this.boundingBox.y+=t.y*this.boundingBox.height,this.unrotatedBoundingBox=null}}getShapeRotation(){return 0}getTextRotation(){return this.state&&this.state.shape?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&!!this.state&&this.state.cell.isVertex()}configureCanvas(t,e,i,s,n){super.configureCanvas(t,e,i,s,n),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)}getHtmlValue(){let t=this.value;return this.dialect!==app_Constants.$p.STRICTHTML&&(t=(0,app_StringUtils.bG)(t,!1)),t=(0,app_StringUtils.K7)(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,t}getTextCss(){const t=app_Constants.Fb?this.size*app_Constants.$g+"px":app_Constants.$g;let e=`display: inline-block; font-size: ${this.size}px; font-family: ${this.family}; color: ${this.color}; line-height: ${t}; pointer-events: ${this.pointerEvents?"all":"none"}; `;(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.BOLD)&&(e+="font-weight: bold; "),(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.ITALIC)&&(e+="font-style: italic; ");const i=[];return(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.UNDERLINE)&&i.push("underline"),(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e+=`text-decoration: ${i.join(" ")}; `),e}redrawHtmlShape(){const t=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),i=`position: absolute; left: ${Math.round(this.bounds.x)}px; top: ${Math.round(this.bounds.y)}px; pointer-events: none; `,s=this.getTextCss(),n=this.margin,l=this.node;app_SvgCanvas2D.A.createCss(t+2,e,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!==app_Constants.x3?(0,app_StringUtils.bG)(this.background,!0):null,this.border!==app_Constants.x3?(0,app_StringUtils.bG)(this.border,!0):null,i,s,this.scale,((t,e,i,s,a,r)=>{const o=this.getTextRotation();let h=(1!==this.scale?`scale(${this.scale}) `:"")+(0!==o?`rotate(${o}deg) `:"")+(0!==n.x||0!==n.y?`translate(${100*n.x}%,${100*n.y}%)`:"");""!==h&&(h=`transform-origin: 0 0; transform: ${h}; `),""===r?(i+=s,s=`display:inline-block; min-width: 100%; ${h}`):(s+=h,app_Client.A.IS_SF&&(s+="-webkit-clip-path: content-box;")),this.opacity<100&&(a+=`opacity: ${this.opacity/100}; `),l.setAttribute("style",i);const p=(0,app_domUtils.Ll)(this.value)?this.value.outerHTML:this.getHtmlValue();l.firstChild||(l.innerHTML=`<div><div>${p}</div></div>`),l.firstChild.firstChild.setAttribute("style",a),l.firstChild.setAttribute("style",s)}))}updateInnerHtml(t){if((0,app_domUtils.Ll)(this.value))t.innerHTML=this.value.outerHTML;else{let e=this.value;this.dialect!==app_Constants.$p.STRICTHTML&&(e=(0,app_StringUtils.bG)(e,!1)),e=(0,app_StringUtils.K7)(e,"<div>&nbsp;</div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e,e=`<div style="display:inline-block;_display:inline;">${e}</div>`,t.innerHTML=e}}updateValue(){const t=this.node;if((0,app_domUtils.Ll)(this.value))t.innerHTML="",t.appendChild(this.value);else{let e=this.value;this.dialect!==app_Constants.$p.STRICTHTML&&(e=(0,app_StringUtils.bG)(e,!1)),e=(0,app_StringUtils.K7)(e,"<div><br></div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e;const i=this.background!==app_Constants.x3?this.background:null,s=this.border!==app_Constants.x3?this.border:null;if("fill"===this.overflow||"width"===this.overflow)i&&(t.style.backgroundColor=i),s&&(t.style.border=`1px solid ${s}`);else{let t="";i&&(t+=`background-color:${(0,app_StringUtils.bG)(i,!0)};`),s&&(t+=`border:1px solid ${(0,app_StringUtils.bG)(s,!0)};`),e=`<div style="zoom:1;${t}display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:${app_Constants.Fb?this.size*app_Constants.$g+"px":app_Constants.$g}">${e}</div>`}t.innerHTML=e;const n=t.getElementsByTagName("div");if(n.length>0){let t=this.textDirection;t===app_Constants.G2.AUTO&&this.dialect!==app_Constants.$p.STRICTHTML&&(t=this.getAutoDirection()),t===app_Constants.G2.LTR||t===app_Constants.G2.RTL?n[n.length-1].setAttribute("dir",t):n[n.length-1].removeAttribute("dir")}}}updateFont(t){const{style:e}=t;e.lineHeight=app_Constants.Fb?this.size*app_Constants.$g+"px":app_Constants.$g,e.fontSize=`${this.size}px`,e.fontFamily=this.family,e.verticalAlign="top",e.color=this.color,(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.BOLD)?e.fontWeight="bold":e.fontWeight="",(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.ITALIC)?e.fontStyle="italic":e.fontStyle="";const i=[];(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.UNDERLINE)&&i.push("underline"),(0,app_styleUtils.bW)(this.fontStyle,app_Constants.mE.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e.textDecoration=i.join(" ")),this.align===app_Constants.Ec.CENTER?e.textAlign="center":this.align===app_Constants.Ec.RIGHT?e.textAlign="right":e.textAlign="left"}updateSize(t,e=!1){const i=Math.max(0,Math.round(this.bounds.width/this.scale)),s=Math.max(0,Math.round(this.bounds.height/this.scale)),{style:n}=t;if(this.clipped?(n.overflow="hidden",n.maxHeight=`${s}px`,n.maxWidth=`${i}px`):"fill"===this.overflow?(n.width=`${i+1}px`,n.height=`${s+1}px`,n.overflow="hidden"):"width"===this.overflow&&(n.width=`${i+1}px`,n.maxHeight=`${s+1}px`,n.overflow="hidden"),this.wrap&&i>0){if(n.wordWrap=app_Constants.Cx,n.whiteSpace="normal",n.width=`${i}px`,e&&"fill"!==this.overflow&&"width"!==this.overflow){let e=t;null!=e.firstChild&&"DIV"===e.firstChild.nodeName&&(e=e.firstChild,"break-word"===t.style.wordWrap&&(e.style.width="100%"));let s=e.offsetWidth;if(0===s){const i=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),s=e.offsetWidth,t.style.visibility="",i.appendChild(t)}s+=3,this.clipped&&(s=Math.min(s,i)),n.width=`${s}px`}}else n.whiteSpace="nowrap"}updateMargin(){this.margin=(0,app_styleUtils.oM)(this.align,this.valign)}getSpacing(){let t=0,e=0;return t=this.align===app_Constants.Ec.CENTER?(this.spacingLeft-this.spacingRight)/2:this.align===app_Constants.Ec.RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,e=this.valign===app_Constants.Ec.MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign===app_Constants.Ec.BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new app_Point.A(t,e)}}const app_node_TextShape=app_TextShape;var app_util_Dictionary=__webpack_require__(944);const app_remove=(t,e)=>{let i=null;if("object"==typeof e){let s=e.indexOf(t);for(;s>=0;)e.splice(s,1),i=t,s=e.indexOf(t)}for(const s in e)e[s]==t&&(delete e[s],i=t);return i},app_equalPoints=(t,e)=>{if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e)for(let i=0;i<t.length;i+=1){const s=t[i];if(!s||s&&!s.equals(e[i]))return!1}return!0},app_equalEntries=(t,e)=>{let i=0;if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e){for(const t in e)i++;for(const s in t)if(i--,!(Number.isNaN(t[s])&&Number.isNaN(e[s])||t[s]===e[s]))return!1}return 0===i},app_removeDuplicates=t=>{const e=new app_util_Dictionary.A,i=[];for(let s=0;s<t.length;s+=1)e.get(t[s])||(i.push(t[s]),e.put(t[s],!0));return i};class app_StencilShapeRegistry{static addStencil(t,e){app_StencilShapeRegistry.stencils[t]=e}static getStencil(t){return app_StencilShapeRegistry.stencils[t]}}app_StencilShapeRegistry.stencils={};const app_node_StencilShapeRegistry=app_StencilShapeRegistry;var app_InternalMouseEvent=__webpack_require__(966),app_EventUtils=__webpack_require__(437);const app_placeholderStyleValues=["inherit","swimlane","indicated"],app_placeholderStyleProperties=["fillColor","strokeColor","gradientColor","fontColor"];class app_CellRenderer{constructor(){this.defaultEdgeShape=app_edge_ConnectorShape,this.defaultVertexShape=app_RectangleShape.A,this.defaultTextShape=app_node_TextShape,this.legacyControlPosition=!0,this.legacySpacing=!0,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.forceControlClickHandler=!1}static registerShape(t,e){app_CellRenderer.defaultShapes[t]=e}initializeShape(t){t.shape&&(t.shape.dialect=t.view.graph.dialect,this.configureShape(t),t.shape.init(t.view.getDrawPane()))}createShape(t){const e=app_node_StencilShapeRegistry.getStencil(t.style.shape);return e?new app_Shape.A(e):new(this.getShapeConstructor(t))}createIndicatorShape(t){t.shape&&(t.shape.indicatorShape=this.getShape(t.getIndicatorShape()))}getShape(t){return t?app_CellRenderer.defaultShapes[t]:null}getShapeConstructor(t){let e=this.getShape(t.style.shape||null);return e||(e=t.cell.isEdge()?this.defaultEdgeShape:this.defaultVertexShape),e}configureShape(t){const e=t.shape;e&&(e.apply(t),e.imageSrc=t.getImageSrc()||null,e.indicatorColor=t.getIndicatorColor()||app_Constants.x3,e.indicatorStrokeColor=t.style.indicatorStrokeColor||app_Constants.x3,e.indicatorGradientColor=t.getIndicatorGradientColor()||app_Constants.x3,t.style.indicatorDirection&&(e.indicatorDirection=t.style.indicatorDirection),e.indicatorImageSrc=t.getIndicatorImageSrc()||null,this.postConfigureShape(t))}postConfigureShape(t){t.shape&&(this.resolveColor(t,"indicatorGradientColor","gradientColor"),this.resolveColor(t,"indicatorColor","fillColor"),this.resolveColor(t,"gradient","gradientColor"),this.resolveColor(t,"stroke","strokeColor"),this.resolveColor(t,"fill","fillColor"))}checkPlaceholderStyles(t){for(const e of app_placeholderStyleProperties)if(app_placeholderStyleValues.includes(t.style[e]))return!0;return!1}resolveColor(t,e,i){const s="fontColor"===i?t.text:t.shape;if(s){const n=t.view.graph,l=s[e];let a=null;if("inherit"===l?a=t.cell.getParent():"swimlane"===l?(s[e]="strokeColor"===i||"fontColor"===i?"#000000":"#ffffff",a=t.cell.getTerminal(!1)?t.cell.getTerminal(!1):t.cell,a=n.getSwimlane(a),i=n.swimlaneIndicatorColorAttribute):"indicated"===l&&t.shape?s[e]=t.shape.indicatorColor:"fillColor"!==i&&"fillColor"===l&&t.shape?s[e]=t.style.fillColor:"strokeColor"!==i&&"strokeColor"===l&&t.shape&&(s[e]=t.style.strokeColor),a){const t=n.getView().getState(a);if(s[e]=null,t){const n="fontColor"===i?t.text:t.shape;s[e]=n&&"indicatorColor"!==e?n[e]:t.style[i]}}}}getLabelValue(t){return t.view.graph.getLabel(t.cell)}createLabel(t,e){const i=t.view.graph;if((t.style.fontSize||0)>0||null==t.style.fontSize){const s=i.isHtmlLabel(t.cell)||(0,app_domUtils.Ll)(e);t.text=new this.defaultTextShape(e,new app_Rectangle.A,t.style.align??app_Constants.Ec.CENTER,t.getVerticalAlign(),t.style.fontColor,t.style.fontFamily,t.style.fontSize,t.style.fontStyle,t.style.spacing,t.style.spacingTop,t.style.spacingRight,t.style.spacingBottom,t.style.spacingLeft,t.style.horizontal,t.style.labelBackgroundColor,t.style.labelBorderColor,i.isWrapping(t.cell)&&i.isHtmlLabel(t.cell),i.isLabelClipped(t.cell),t.style.overflow,t.style.labelPadding,t.style.textDirection??app_Constants.Sr),t.text.opacity=t.style.textOpacity??100,t.text.dialect=s?app_Constants.$p.STRICTHTML:i.dialect,t.text.style=t.style,t.text.state=t,this.initializeLabel(t,t.text);let n=!1;const l=e=>{let s=t;if(app_Client.A.IS_TOUCH||n){const t=(0,app_EventUtils.El)(e),n=(0,app_EventUtils.xJ)(e),l=(0,app_styleUtils.ce)(i.container,t,n);s=i.view.getState(i.getCellAt(l.x,l.y))}return s};app_InternalEvent.A.addGestureListeners(t.text.node,(e=>{if(this.isLabelEvent(t,e)){i.fireMouseEvent(app_InternalEvent.A.MOUSE_DOWN,new app_InternalMouseEvent.A(e,t));const s=(0,app_EventUtils.el)(e);n=i.dialect!==app_Constants.$p.SVG&&"IMG"===s.nodeName}}),(e=>{this.isLabelEvent(t,e)&&i.fireMouseEvent(app_InternalEvent.A.MOUSE_MOVE,new app_InternalMouseEvent.A(e,l(e)))}),(e=>{this.isLabelEvent(t,e)&&(i.fireMouseEvent(app_InternalEvent.A.MOUSE_UP,new app_InternalMouseEvent.A(e,l(e))),n=!1)})),i.isNativeDblClickEnabled()&&app_InternalEvent.A.addListener(t.text.node,"dblclick",(e=>{this.isLabelEvent(t,e)&&(i.dblClick(e,t.cell),app_InternalEvent.A.consume(e))}))}}initializeLabel(t,e){if(app_Client.A.IS_SVG&&app_Client.A.NO_FO&&e.dialect!==app_Constants.$p.SVG){const i=t.view.graph;e.init(i.container)}else e.init(t.view.getDrawPane())}createCellOverlays(t){const e=t.view.graph,i=e.getCellOverlays(t.cell),s=new app_util_Dictionary.A;for(const n of i){const i=t.overlays.remove(n);if(i){s.put(n,i);continue}const l=this.createOverlayShape(t,n);l.dialect=e.dialect,l.overlay=n,this.initializeOverlay(t,l),this.installCellOverlayListeners(t,n,l),this.configureOverlayShape(t,n,l),s.put(n,l)}t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=s}createOverlayShape(t,e){const i=new app_ImageShape.A(new app_Rectangle.A,e.image.src);return i.preserveImageAspect=!1,i}initializeOverlay(t,e){e.init(t.view.getOverlayPane())}installCellOverlayListeners(t,e,i){const s=t.view.graph;app_InternalEvent.A.addListener(i.node,"click",(i=>{s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),e.fireEvent(new app_EventObject.A(app_InternalEvent.A.CLICK,{event:i,cell:t.cell}))})),app_InternalEvent.A.addGestureListeners(i.node,(t=>{app_InternalEvent.A.consume(t)}),(e=>{s.fireMouseEvent(app_InternalEvent.A.MOUSE_MOVE,new app_InternalMouseEvent.A(e,t))})),app_Client.A.IS_TOUCH&&app_InternalEvent.A.addListener(i.node,"touchend",(i=>{e.fireEvent(new app_EventObject.A(app_InternalEvent.A.CLICK,{event:i,cell:t.cell}))}))}configureOverlayShape(t,e,i){e.cursor&&(i.node.style.cursor=e.cursor)}createControl(t){const e=t.view.graph,i=e.getFoldingImage(t);if(e.isFoldingEnabled()&&i){if(!t.control){const s=new app_Rectangle.A(0,0,i.width,i.height);t.control=new app_ImageShape.A(s,i.src),t.control.preserveImageAspect=!1,t.control.dialect=e.dialect,this.initControl(t,t.control,!0,this.createControlClickHandler(t))}}else t.control&&(t.control.destroy(),t.control=null)}createControlClickHandler(t){const e=t.view.graph;return i=>{if(this.forceControlClickHandler||e.isEnabled()){const s=!t.cell.isCollapsed();e.foldCells(s,!1,[t.cell],!1,i),app_InternalEvent.A.consume(i)}}}initControl(t,e,i,s){const n=t.view.graph;n.isHtmlLabel(t.cell)&&app_Client.A.NO_FO&&n.dialect===app_Constants.$p.SVG?(e.dialect=app_Constants.$p.PREFERHTML,e.init(n.container),e.node.style.zIndex=String(1)):e.init(t.view.getOverlayPane());const l=e.node;if(s&&!app_Client.A.IS_IOS&&(n.isEnabled()&&(l.style.cursor="pointer"),app_InternalEvent.A.addListener(l,"click",s)),i){let e=null;app_InternalEvent.A.addGestureListeners(l,(i=>{e=new app_Point.A((0,app_EventUtils.El)(i),(0,app_EventUtils.xJ)(i)),n.fireMouseEvent(app_InternalEvent.A.MOUSE_DOWN,new app_InternalMouseEvent.A(i,t)),app_InternalEvent.A.consume(i)}),(e=>{n.fireMouseEvent(app_InternalEvent.A.MOUSE_MOVE,new app_InternalMouseEvent.A(e,t))}),(e=>{n.fireMouseEvent(app_InternalEvent.A.MOUSE_UP,new app_InternalMouseEvent.A(e,t)),app_InternalEvent.A.consume(e)})),s&&app_Client.A.IS_IOS&&l.addEventListener("touchend",(t=>{if(e){const i=n.getEventTolerance();Math.abs(e.x-(0,app_EventUtils.El)(t))<i&&Math.abs(e.y-(0,app_EventUtils.xJ)(t))<i&&(s.call(s,t),app_InternalEvent.A.consume(t))}}),!0)}return l}isShapeEvent(t,e){return!0}isLabelEvent(t,e){return!0}installListeners(t){const e=t.view.graph,i=i=>{let s=t;const n=(0,app_EventUtils.el)(i);if(n&&e.dialect!==app_Constants.$p.SVG&&"IMG"===n.nodeName||app_Client.A.IS_TOUCH){const t=(0,app_EventUtils.El)(i),n=(0,app_EventUtils.xJ)(i),l=(0,app_styleUtils.ce)(e.container,t,n),a=e.getCellAt(l.x,l.y);s=a?e.view.getState(a):null}return s};t.shape&&(app_InternalEvent.A.addGestureListeners(t.shape.node,(i=>{this.isShapeEvent(t,i)&&e.fireMouseEvent(app_InternalEvent.A.MOUSE_DOWN,new app_InternalMouseEvent.A(i,t))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(app_InternalEvent.A.MOUSE_MOVE,new app_InternalMouseEvent.A(s,i(s)))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(app_InternalEvent.A.MOUSE_UP,new app_InternalMouseEvent.A(s,i(s)))})),e.isNativeDblClickEnabled()&&app_InternalEvent.A.addListener(t.shape.node,"dblclick",(i=>{this.isShapeEvent(t,i)&&(e.dblClick(i,t.cell),app_InternalEvent.A.consume(i))})))}redrawLabel(t,e){const i=t.view.graph,s=this.getLabelValue(t),n=i.isWrapping(t.cell),l=i.isLabelClipped(t.cell),a=i.isHtmlLabel(t.cell)||s&&(0,app_domUtils.Ll)(s)?app_Constants.$p.STRICTHTML:i.dialect,r=t.style.overflow??"visible";if(!t.text||t.text.wrap===n&&t.text.clipped===l&&t.text.overflow===r&&t.text.dialect===a||(t.text.destroy(),t.text=null),null==t.text&&null!=s&&((0,app_domUtils.Ll)(s)||s.length>0)?this.createLabel(t,s):null==t.text||null!=s&&0!=s.length||(t.text.destroy(),t.text=null),null!=t.text){e&&(null!=t.text.lastValue&&this.isTextShapeInvalid(t,t.text)&&(t.text.lastValue=null),t.text.resetStyles(),t.text.apply(t),t.text.valign=t.getVerticalAlign());const i=this.getLabelBounds(t),o=this.getTextScale(t);if(this.resolveColor(t,"color","fontColor"),e||t.text.value!==s||t.text.wrap!==n||t.text.overflow!==r||t.text.clipped!==l||t.text.scale!==o||t.text.dialect!==a||null==t.text.bounds||!t.text.bounds.equals(i)){t.text.dialect=a,t.text.value=s,t.text.bounds=i,t.text.scale=o,t.text.wrap=n,t.text.clipped=l,t.text.overflow=r;const e=t.text.node.style.visibility;this.redrawLabelShape(t.text),t.text.node.style.visibility=e}}}isTextShapeInvalid(t,e){function i(i,s,n){let l=!1;return l="spacingTop"===s||"spacingRight"===s||"spacingBottom"===s||"spacingLeft"===s?parseFloat(String(e[i]))-parseFloat(String(e.spacing))!==(t.style[s]||n):e[i]!==(t.style[s]||n),l}return i("fontStyle","fontStyle",app_Constants.fm)||i("family","fontFamily",app_Constants.CT)||i("size","fontSize",app_Constants.FV)||i("color","fontColor","black")||i("align","align","")||i("valign","verticalAlign","")||i("spacing","spacing",2)||i("spacingTop","spacingTop",0)||i("spacingRight","spacingRight",0)||i("spacingBottom","spacingBottom",0)||i("spacingLeft","spacingLeft",0)||i("horizontal","horizontal",!0)||i("background","labelBackgroundColor",null)||i("border","labelBorderColor",null)||i("opacity","textOpacity",100)||i("textDirection","textDirection",app_Constants.Sr)}redrawLabelShape(t){t.redraw()}getTextScale(t){return t.view.scale}getLabelBounds(t){const{scale:e}=t.view,i=t.cell.isEdge();let s=new app_Rectangle.A(t.absoluteOffset.x,t.absoluteOffset.y);if(i){const i=t.text.getSpacing();s.x+=i.x*e,s.y+=i.y*e;const n=t.cell.getGeometry();null!=n&&(s.width=Math.max(0,n.width*e),s.height=Math.max(0,n.height*e))}else{if(t.text.isPaintBoundsInverted()){const t=s.x;s.x=s.y,s.y=t}s.x+=t.x,s.y+=t.y,s.width=Math.max(1,t.width),s.height=Math.max(1,t.height)}if(t.text.isPaintBoundsInverted()){const e=(t.width-t.height)/2;s.x+=e,s.y-=e;const i=s.width;s.width=s.height,s.height=i}if(null!=t.shape){const e=t.style.labelPosition??app_Constants.Ec.CENTER,i=t.style.verticalLabelPosition??app_Constants.Ec.MIDDLE;e===app_Constants.Ec.CENTER&&i===app_Constants.Ec.MIDDLE&&(s=t.shape.getLabelBounds(s))}const n=t.style.labelWidth??null;return null!=n&&(s.width=n*e),i||this.rotateLabelBounds(t,s),s}rotateLabelBounds(t,e){if(e.y-=t.text.margin.y*e.height,e.x-=t.text.margin.x*e.width,!this.legacySpacing||"fill"!==t.style.overflow&&"width"!==t.style.overflow){const i=t.view.scale,s=t.text.getSpacing();e.x+=s.x*i,e.y+=s.y*i;const n=t.style.labelPosition??app_Constants.Ec.CENTER,l=t.style.verticalLabelPosition??app_Constants.Ec.MIDDLE,a=t.style.labelWidth??null;e.width=Math.max(0,e.width-(n===app_Constants.Ec.CENTER&&null==a?t.text.spacingLeft*i+t.text.spacingRight*i:0)),e.height=Math.max(0,e.height-(l===app_Constants.Ec.MIDDLE?t.text.spacingTop*i+t.text.spacingBottom*i:0))}const i=t.text.getTextRotation();if(0!==i&&null!=t&&t.cell.isVertex()){const s=t.getCenterX(),n=t.getCenterY();if(e.x!==s||e.y!==n){const t=i*(Math.PI/180),l=(0,app_mathUtils.Iq)(new app_Point.A(e.x,e.y),Math.cos(t),Math.sin(t),new app_Point.A(s,n));e.x=l.x,e.y=l.y}}}redrawCellOverlays(t,e=!1){if(this.createCellOverlays(t),null!=t.overlays){const i=(0,app_mathUtils.zi)(t.style.rotation??0,90),s=(0,app_mathUtils.eh)(i),n=Math.cos(s),l=Math.sin(s);t.overlays.visit(((s,a)=>{const r=a.overlay.getBounds(t);if(!t.cell.isEdge()&&null!=t.shape&&0!==i){let e=r.getCenterX(),i=r.getCenterY();const s=(0,app_mathUtils.Iq)(new app_Point.A(e,i),n,l,new app_Point.A(t.getCenterX(),t.getCenterY()));e=s.x,i=s.y,r.x=Math.round(e-r.width/2),r.y=Math.round(i-r.height/2)}!e&&null!=a.bounds&&a.scale===t.view.scale&&a.bounds.equals(r)||(a.bounds=r,a.scale=t.view.scale,a.redraw())}))}}redrawControl(t,e=!1){const i=t.view.graph.getFoldingImage(t);if(null!=t.control&&null!=i){const s=this.getControlBounds(t,i.width,i.height),n=this.legacyControlPosition?t.style.rotation??0:t.shape.getTextRotation(),l=t.view.scale;!e&&t.control.scale===l&&t.control.bounds.equals(s)&&t.control.rotation===n||(t.control.rotation=n,t.control.bounds=s,t.control.scale=l,t.control.redraw())}}getControlBounds(t,e,i){if(null!=t.control){const s=t.view.scale;let n=t.getCenterX(),l=t.getCenterY();if(!t.cell.isEdge()&&(n=t.x+e*s,l=t.y+i*s,null!=t.shape)){let e=t.shape.getShapeRotation();if(this.legacyControlPosition)e=t.style.rotation??0;else if(t.shape.isPaintBoundsInverted()){const e=(t.width-t.height)/2;n+=e,l-=e}if(0!==e){const i=(0,app_mathUtils.eh)(e),s=Math.cos(i),a=Math.sin(i),r=(0,app_mathUtils.Iq)(new app_Point.A(n,l),s,a,new app_Point.A(t.getCenterX(),t.getCenterY()));n=r.x,l=r.y}}return t.cell.isEdge(),new app_Rectangle.A(Math.round(n-e/2*s),Math.round(l-i/2*s),Math.round(e*s),Math.round(i*s))}return null}insertStateAfter(t,e,i){const s=t.view.graph,n=this.getShapesForState(t);for(let l=0;l<n.length;l+=1)if(null!=n[l]&&null!=n[l].node){const a=n[l].node.parentNode!==t.view.getDrawPane()&&n[l].node.parentNode!==t.view.getOverlayPane(),r=a?i:e;if(null!=r&&r.nextSibling!==n[l].node)null==r.nextSibling?r.parentNode.appendChild(n[l].node):r.parentNode.insertBefore(n[l].node,r.nextSibling);else if(null==r){const e=n[l].node;if(e.parentNode===s.container){let{canvas:i}=t.view;for(;null!=i&&i.parentNode!==s.container;)i=i.parentNode;null!=i&&null!=i.nextSibling?i.nextSibling!==e&&e.parentNode.insertBefore(e,i.nextSibling):e.parentNode.appendChild(e)}else null!=e.parentNode&&null!=e.parentNode.firstChild&&e.parentNode.firstChild!=e&&e.parentNode.insertBefore(e,e.parentNode.firstChild)}a?i=n[l].node:e=n[l].node}return[e,i]}getShapesForState(t){return[t.shape,t.text,t.control]}redraw(t,e=!1,i=!0){const s=this.redrawShape(t,e,i);null!=t.shape&&i&&(this.redrawLabel(t,s),this.redrawCellOverlays(t,s),this.redrawControl(t,s))}redrawShape(t,e=!1,i=!0){let s=!1;const n=t.view.graph;if(null!=t.shape&&null!=t.shape.style&&null!=t.style&&t.shape.style.shape!==t.style.shape&&(t.shape.destroy(),t.shape=null),null==t.shape&&null!=n.container&&t.cell!==t.view.currentRoot&&(t.cell.isVertex()||t.cell.isEdge())){if(t.shape=this.createShape(t),null!=t.shape){t.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,t.shape.antiAlias=this.antiAlias,this.createIndicatorShape(t),this.initializeShape(t),this.createCellOverlays(t),this.installListeners(t);const e=n.getPlugin("SelectionCellsHandler");e?.updateHandler(t)}}else if(!e&&null!=t.shape&&(!app_equalEntries(t.shape.style,t.style)||this.checkPlaceholderStyles(t))){t.shape.resetStyles(),this.configureShape(t);const i=n.getPlugin("SelectionCellsHandler");i?.updateHandler(t),e=!0}return null!=t.shape&&t.shape.indicatorShape!=this.getShape(t.getIndicatorShape())&&(null!=t.shape.indicator&&(t.shape.indicator.destroy(),t.shape.indicator=null),this.createIndicatorShape(t),null!=t.shape.indicatorShape&&(t.shape.indicator=new t.shape.indicatorShape,t.shape.indicator.dialect=t.shape.dialect,t.shape.indicator.init(t.node),e=!0)),t.shape&&(this.createControl(t),(e||this.isShapeInvalid(t,t.shape))&&(t.absolutePoints.length>0?(t.shape.points=t.absolutePoints.slice(),t.shape.bounds=null):(t.shape.points=[],t.shape.bounds=new app_Rectangle.A(t.x,t.y,t.width,t.height)),t.shape.scale=t.view.scale,null==i||i?this.doRedrawShape(t):t.shape.updateBoundingBox(),s=!0)),s}doRedrawShape(t){t.shape?.redraw()}isShapeInvalid(t,e){return null==e.bounds||e.scale!==t.view.scale||0===t.absolutePoints.length&&!e.bounds.equals(t)||t.absolutePoints.length>0&&!app_equalPoints(e.points,t.absolutePoints)}destroy(t){t.shape&&(t.text&&(t.text.destroy(),t.text=null),t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=new app_util_Dictionary.A,t.control&&(t.control.destroy(),t.control=null),t.shape.destroy(),t.shape=null)}}app_CellRenderer.defaultShapes={};const app_cell_CellRenderer=app_CellRenderer;var app_cloneUtils=__webpack_require__(766),app_CellPath=__webpack_require__(577),app_Utils=__webpack_require__(675);class app_Cell{constructor(t=null,e=null,i={}){this.invalidating=!1,this.onInit=null,this.overlays=[],this.id=null,this.value=null,this.geometry=null,this.style={},this.vertex=!1,this.edge=!1,this.connectable=!0,this.visible=!0,this.collapsed=!1,this.parent=null,this.source=null,this.target=null,this.children=[],this.edges=[],this.mxTransient=["id","value","parent","source","target","children","edges"],this.value=t,this.setGeometry(e),this.setStyle(i),this.onInit&&this.onInit()}getChildren(){return this.children||[]}getId(){return this.id}setId(t){this.id=t}getValue(){return this.value}setValue(t){this.value=t}valueChanged(t){const e=this.getValue();return this.setValue(t),e}getGeometry(){return this.geometry}setGeometry(t){this.geometry=t}getStyle(){return this.style}getClonedStyle(){return(0,app_cloneUtils.o)(this.getStyle())}setStyle(t){this.style=t}isVertex(){return this.vertex}setVertex(t){this.vertex=t}isEdge(){return this.edge}setEdge(t){this.edge=t}isConnectable(){return this.connectable}setConnectable(t){this.connectable=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isCollapsed(){return this.collapsed}setCollapsed(t){this.collapsed=t}getParent(){return this.parent}setParent(t){this.parent=t}getTerminal(t=!1){return t?this.source:this.target}setTerminal(t,e){return e?this.source=t:this.target=t,t}getChildCount(){return this.children.length}getIndex(t){return null===t?-1:this.children.indexOf(t)}getChildAt(t){return this.children[t]}insert(t,e){return void 0===e&&(e=this.getChildCount(),t.getParent()===this&&e--),t.removeFromParent(),t.setParent(this),this.children.splice(e,0,t),t}remove(t){let e=null;return t>=0&&(e=this.getChildAt(t),e&&(this.children.splice(t,1),e.setParent(null))),e}removeFromParent(){if(this.parent){const t=this.parent.getIndex(this);this.parent.remove(t)}}getEdgeCount(){return this.edges.length}getEdgeIndex(t){return this.edges.indexOf(t)}getEdgeAt(t){return this.edges[t]}insertEdge(t,e=!1){return t.removeFromTerminal(e),t.setTerminal(this,e),(0===this.edges.length||t.getTerminal(!e)!==this||this.edges.indexOf(t)<0)&&this.edges.push(t),t}removeEdge(t,e=!1){if(null!=t){if(t.getTerminal(!e)!==this&&null!=this.edges){const e=this.getEdgeIndex(t);e>=0&&this.edges.splice(e,1)}t.setTerminal(null,e)}return t}removeFromTerminal(t){const e=this.getTerminal(t);e&&e.removeEdge(this,t)}hasAttribute(t){const e=this.getValue();return(0,app_Utils.Vq)(e)&&(e.nodeType===app_Constants.Js.ELEMENT&&e.hasAttribute?e.hasAttribute(t):(0,app_Utils.Vq)(e.getAttribute?.(t)))}getAttribute(t,e){const i=this.getValue();return((0,app_Utils.Vq)(i)&&i.nodeType===app_Constants.Js.ELEMENT?i.getAttribute?.(t):null)??e}setAttribute(t,e){const i=this.getValue();(0,app_Utils.Vq)(i)&&i.nodeType===app_Constants.Js.ELEMENT&&i.setAttribute?.(t,e)}clone(){const t=(0,app_cloneUtils.o)(this,this.mxTransient);return t.setValue(this.cloneValue()),t}cloneValue(){let t=this.getValue();return(0,app_Utils.Vq)(t)&&("function"==typeof t.clone?t=t.clone():(0,app_Utils.Vq)(t.nodeType)&&t.cloneNode&&(t=t.cloneNode(!0))),t}getNearestCommonAncestor(t){let e=app_CellPath.A.create(t);if(e.length>0){let i=this,s=app_CellPath.A.create(i);if(e.length<s.length){i=t;const n=s;s=e,e=n}for(;i&&s;){const t=i.getParent();if(0===e.indexOf(s+app_CellPath.A.PATH_SEPARATOR)&&t)return i;s=app_CellPath.A.getParentPath(s),i=t}}return null}isAncestor(t){for(;t&&t!==this;)t=t.getParent();return t===this}getChildVertices(){return this.getChildCells(!0,!1)}getChildEdges(){return this.getChildCells(!1,!0)}getChildCells(t=!1,e=!1){const i=this.getChildCount(),s=[];for(let n=0;n<i;n+=1){const i=this.getChildAt(n);(!e&&!t||e&&i.isEdge()||t&&i.isVertex())&&s.push(i)}return s}getDirectedEdgeCount(t,e=null){let i=0;const s=this.getEdgeCount();for(let n=0;n<s;n+=1){const s=this.getEdgeAt(n);s!==e&&s&&s.getTerminal(t)===this&&(i+=1)}return i}getConnections(){return this.getEdges(!0,!0,!1)}getIncomingEdges(){return this.getEdges(!0,!1,!1)}getOutgoingEdges(){return this.getEdges(!1,!0,!1)}getEdges(t=!0,e=!0,i=!0){const s=this.getEdgeCount(),n=[];for(let l=0;l<s;l+=1){const s=this.getEdgeAt(l),a=s.getTerminal(!0),r=s.getTerminal(!1);(i&&a===r||a!==r&&(t&&r===this||e&&a===this))&&n.push(s)}return n}getOrigin(){let t=new app_Point.A;const e=this.getParent();if(e&&(t=e.getOrigin(),!this.isEdge())){const e=this.getGeometry();e&&(t.x+=e.x,t.y+=e.y)}return t}getDescendants(){return this.filterDescendants(null)}filterDescendants(t){let e=[];(null===t||t(this))&&e.push(this);const i=this.getChildCount();for(let s=0;s<i;s+=1){const i=this.getChildAt(s);e=e.concat(i.filterDescendants(t))}return e}getRoot(){let t=this,e=t;for(;t;)e=t,t=t.getParent();return e}}const app_cell_Cell=app_Cell;var app_UndoableEdit=__webpack_require__(592);class app_ChildChange{constructor(t,e,i,s=0){this.model=t,this.parent=e,this.previous=e,this.child=i,this.index=s,this.previousIndex=s}execute(){let t=this.child.getParent();const e=t?t.getIndex(this.child):0;this.previous||this.connect(this.child,!1),t=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=t,this.index=this.previousIndex,this.previousIndex=e}connect(t,e=!0){const i=t.getTerminal(!0),s=t.getTerminal(!1);i&&(e?this.model.terminalForCellChanged(t,i,!0):this.model.terminalForCellChanged(t,null,!0)),s&&(e?this.model.terminalForCellChanged(t,s,!1):this.model.terminalForCellChanged(t,null,!1)),t.setTerminal(i,!0),t.setTerminal(s,!1);const n=t.getChildCount();for(let i=0;i<n;i+=1)this.connect(t.getChildAt(i),e)}}const app_undoable_changes_ChildChange=app_ChildChange;class app_CollapseChange{constructor(t,e,i){this.model=t,this.cell=e,this.collapsed=i,this.previous=i}execute(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)}}const app_undoable_changes_CollapseChange=app_CollapseChange;class app_GeometryChange{constructor(t,e,i){this.model=t,this.cell=e,this.geometry=i,this.previous=i}execute(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)}}const app_undoable_changes_GeometryChange=app_GeometryChange;class app_RootChange{constructor(t,e){this.model=t,this.root=e,this.previous=e}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}const app_undoable_changes_RootChange=app_RootChange;class app_StyleChange{constructor(t,e,i){this.model=t,this.cell=e,this.style=i,this.previous=i}execute(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)}}const app_undoable_changes_StyleChange=app_StyleChange;class app_TerminalChange{constructor(t,e,i,s){this.model=t,this.cell=e,this.terminal=i,this.previous=i,this.source=s}execute(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)}}const app_undoable_changes_TerminalChange=app_TerminalChange;class app_ValueChange{constructor(t,e,i){this.model=t,this.cell=e,this.value=i,this.previous=i}execute(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)}}const app_undoable_changes_ValueChange=app_ValueChange;class app_VisibleChange{constructor(t,e,i){this.model=t,this.cell=e,this.visible=i,this.previous=i}execute(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)}}const app_undoable_changes_VisibleChange=app_VisibleChange;var app_ObjectIdentity=__webpack_require__(909);const app_filterCells=t=>e=>{const i=[];for(let s=0;s<e.length;s+=1)t(e[s])&&i.push(e[s]);return i},app_getOpposites=(t,e,i=!0,s=!0)=>t.reduce(((t,n)=>{const l=n.getTerminal(!0),a=n.getTerminal(!1);return l===e&&null!=a&&a!==e&&s?t.push(a):a===e&&null!=l&&l!==e&&i&&t.push(l),t}),[]),app_getTopmostCells=t=>{const e=new app_util_Dictionary.A,i=[];for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let s=0;s<t.length;s+=1){const n=t[s];let l=!0,a=n.getParent();for(;null!=a;){if(e.get(a)){l=!1;break}a=a.getParent()}l&&i.push(n)}return i},app_getParents=t=>{const e=[],i=new Dictionary;for(const s of t){const t=s.getParent();null==t||i.get(t)||(i.put(t,!0),e.push(t))}return e},app_cloneCell=(t=null,e=!0)=>t?app_cloneCells([t],e)[0]:null,app_cloneCells=(t,e=!0,i={})=>{const s=[];for(const n of t)s.push(app_cloneCellImpl(n,i,e));for(let e=0;e<s.length;e+=1)null!=s[e]&&app_restoreClone(s[e],t[e],i);return s},app_cloneCellImpl=(t,e={},i=!1)=>{const s=app_ObjectIdentity.A.get(t);let n=e?e[s]:null;if(null==n&&(n=t.clone(),e[s]=n,i)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=app_cloneCellImpl(t.getChildAt(s),e,!0);n.insert(i)}}return n},app_restoreClone=(t,e,i)=>{const s=e.getTerminal(!0);if(null!=s){const e=i[app_ObjectIdentity.A.get(s)];null!=e&&e.insertEdge(t,!0)}const n=e.getTerminal(!1);if(null!=n){const e=i[app_ObjectIdentity.A.get(n)];null!=e&&e.insertEdge(t,!1)}const l=t.getChildCount();for(let s=0;s<l;s+=1)app_restoreClone(t.getChildAt(s),e.getChildAt(s),i)};class app_GraphDataModel extends app_EventSource.A{constructor(t=null){super(),this.root=null,this.cells={},this.maintainEdgeParent=!0,this.ignoreRelativeEdgeParent=!0,this.createIds=!0,this.prefix="",this.postfix="",this.nextId=0,this.currentEdit=null,this.updateLevel=0,this.endingUpdate=!1,this.currentEdit=this.createUndoableEdit(),null!=t?this.setRoot(t):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(t){this.createIds=t}createRoot(){const t=new app_cell_Cell;return t.insert(new app_cell_Cell),t}getCell(t){return this.cells?this.cells[t]:null}filterCells(t,e){return app_filterCells(e)(t)}getRoot(t=null){return t?t.getRoot():this.root}setRoot(t){return this.execute(new app_undoable_changes_RootChange(this,t)),t}rootChanged(t){const e=this.root;return this.root=t,this.nextId=0,this.cells=null,this.cellAdded(t),e}isRoot(t=null){return null!=t&&this.root===t}isLayer(t){return!!t&&this.isRoot(t.getParent())}contains(t){return this.root.isAncestor(t)}add(t,e,i=null){if(e!==t&&null!=t&&null!=e){null==i&&(i=t.getChildCount());const s=t!==e.getParent();this.execute(new app_undoable_changes_ChildChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParents(e)}return e}cellAdded(t){if(null!=t){if(null==t.getId()&&this.createIds&&t.setId(this.createId(t)),null!=t.getId()){let e=this.getCell(t.getId());if(e!==t){for(;null!=e;)t.setId(this.createId(t)),e=this.getCell(t.getId());null==this.cells&&(this.cells={}),this.cells[t.getId()]=t}}(0,app_mathUtils.kf)(String(t.getId()))&&(this.nextId=Math.max(this.nextId,parseInt(t.getId())));for(const e of t.getChildren())this.cellAdded(e)}}createId(t){const e=this.nextId;return this.nextId++,this.prefix+e+this.postfix}updateEdgeParents(t,e=this.getRoot(t)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.updateEdgeParents(i,e)}const s=t.getEdgeCount(),n=[];for(let e=0;e<s;e+=1)n.push(t.getEdgeAt(e));for(let t=0;t<n.length;t+=1){const i=n[t];e.isAncestor(i)&&this.updateEdgeParent(i,e)}}updateEdgeParent(t,e){let i=t.getTerminal(!0),s=t.getTerminal(!1),n=null;for(;null!=i&&!i.isEdge()&&null!=i.geometry&&i.geometry.relative;)i=i.getParent();for(;null!=s&&this.ignoreRelativeEdgeParent&&!s.isEdge()&&null!=s.geometry&&s.geometry.relative;)s=s.getParent();if(e.isAncestor(i)&&e.isAncestor(s)&&(i===s?n=i?i.getParent():null:i&&(n=i.getNearestCommonAncestor(s)),null!=n&&(n.getParent()!==this.root||n.isAncestor(t))&&t&&t.getParent()!==n)){let e=t.getGeometry();if(null!=e){const i=t.getParent().getOrigin(),s=n.getOrigin(),l=s.x-i.x,a=s.y-i.y;e=e.clone(),e.translate(-l,-a),this.setGeometry(t,e)}this.add(n,t,n.getChildCount())}}remove(t){return t===this.root?this.setRoot(null):null!=t.getParent()&&this.execute(new app_undoable_changes_ChildChange(this,null,t)),t}cellRemoved(t){if(null!=t&&null!=this.cells){for(let e=t.getChildCount()-1;e>=0;e--)this.cellRemoved(t.getChildAt(e));null!=this.cells&&null!=t.getId()&&delete this.cells[t.getId()]}}parentForCellChanged(t,e,i){const s=t.getParent();if(null!=e)e===s&&s.getIndex(t)===i||e.insert(t,i);else if(null!=s){const e=s.getIndex(t);s.remove(e)}const n=e?this.contains(e):null,l=this.contains(s);return n&&!l?this.cellAdded(t):l&&!n&&this.cellRemoved(t),s}setTerminal(t,e,i){const s=e!==t.getTerminal(i);return this.execute(new app_undoable_changes_TerminalChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParent(t,this.getRoot()),e}setTerminals(t,e,i){this.beginUpdate();try{this.setTerminal(t,e,!0),this.setTerminal(t,i,!1)}finally{this.endUpdate()}}terminalForCellChanged(t,e,i=!1){const s=t.getTerminal(i);return null!=e?e.insertEdge(t,i):null!=s&&s.removeEdge(t,i),s}getEdgesBetween(t,e,i=!1){const s=t.getEdgeCount(),n=e.getEdgeCount();let l=t,a=s;n<s&&(a=n,l=e);const r=[];for(let s=0;s<a;s+=1){const n=l.getEdgeAt(s),a=n.getTerminal(!0),o=n.getTerminal(!1);(a===t&&o===e||!i&&o===t&&a===e)&&r.push(n)}return r}setValue(t,e){return this.execute(new app_undoable_changes_ValueChange(this,t,e)),e}valueForCellChanged(t,e){return t.valueChanged(e)}setGeometry(t,e){return e!==t.getGeometry()&&this.execute(new app_undoable_changes_GeometryChange(this,t,e)),e}geometryForCellChanged(t,e){const i=t.getGeometry();return t.setGeometry(e),i}setStyle(t,e){e!==t.getStyle()&&this.execute(new app_undoable_changes_StyleChange(this,t,e))}styleForCellChanged(t,e){const i=t.getStyle();return t.setStyle(e),i}setCollapsed(t,e){return e!==t.isCollapsed()&&this.execute(new app_undoable_changes_CollapseChange(this,t,e)),e}collapsedStateForCellChanged(t,e){const i=t.isCollapsed();return t.setCollapsed(e),i}setVisible(t,e){return e!==t.isVisible()&&this.execute(new app_undoable_changes_VisibleChange(this,t,e)),e}visibleStateForCellChanged(t,e){const i=t.isVisible();return t.setVisible(e),i}execute(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.EXECUTE,{change:t})),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.EXECUTED,{change:t})),this.endUpdate()}batchUpdate(t){this.beginUpdate();try{t()}finally{this.endUpdate()}}beginUpdate(){this.updateLevel+=1,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.BEGIN_UPDATE)),1===this.updateLevel&&this.fireEvent(new app_EventObject.A(app_InternalEvent.A.START_EDIT))}endUpdate(){if(this.updateLevel-=1,0===this.updateLevel&&this.fireEvent(new app_EventObject.A(app_InternalEvent.A.END_EDIT)),!this.endingUpdate){this.endingUpdate=0===this.updateLevel,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.END_UPDATE,{edit:this.currentEdit}));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new app_EventObject.A(app_InternalEvent.A.BEFORE_UNDO,{edit:this.currentEdit}));const t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify(),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.UNDO,{edit:t}))}}finally{this.endingUpdate=!1}}}createUndoableEdit(t=!0){const e=new app_UndoableEdit.A(this,t);return e.notify=()=>{e.source.fireEvent(new app_EventObject.A(app_InternalEvent.A.CHANGE,{edit:e,changes:e.changes})),e.source.fireEvent(new app_EventObject.A(app_InternalEvent.A.NOTIFY,{edit:e,changes:e.changes}))},e}mergeChildren(t,e,i=!0){this.beginUpdate();try{const s={};this.mergeChildrenImpl(t,e,i,s);for(const t in s){const e=s[t];let i=e.getTerminal(!0);null!=i&&(i=s[app_CellPath.A.create(i)],this.setTerminal(e,i,!0)),i=e.getTerminal(!1),null!=i&&(i=s[app_CellPath.A.create(i)],this.setTerminal(e,i,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(t,e,i,s={}){this.beginUpdate();try{const n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);if("function"==typeof n.getId){const t=n.getId();let l=null==t||n.isEdge()&&i?null:this.getCell(t);if(null==l){const i=n.clone();i.setId(t),i.setTerminal(n.getTerminal(!0),!0),i.setTerminal(n.getTerminal(!1),!1),l=e.insert(i),this.cellAdded(l)}s[app_CellPath.A.create(n)]=l,this.mergeChildrenImpl(n,l,i,s)}}}finally{this.endUpdate()}}}const app_view_GraphDataModel=app_GraphDataModel;class app_Stylesheet{constructor(){this.styles=new Map,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){const t={};return t.shape=app_Constants.IW.RECTANGLE,t.perimeter="rectanglePerimeter",t.verticalAlign=app_Constants.Ec.MIDDLE,t.align=app_Constants.Ec.CENTER,t.fillColor="#C3D9FF",t.strokeColor="#6482B9",t.fontColor="#774400",t}createDefaultEdgeStyle(){const t={};return t.shape=app_Constants.IW.CONNECTOR,t.endArrow=app_Constants._v.CLASSIC,t.verticalAlign=app_Constants.Ec.MIDDLE,t.align=app_Constants.Ec.CENTER,t.strokeColor="#6482B9",t.fontColor="#446299",t}putDefaultVertexStyle(t){this.putCellStyle("defaultVertex",t)}putDefaultEdgeStyle(t){this.putCellStyle("defaultEdge",t)}getDefaultVertexStyle(){return this.styles.get("defaultVertex")}getDefaultEdgeStyle(){return this.styles.get("defaultEdge")}putCellStyle(t,e){this.styles.set(t,e)}getCellStyle(t,e){let i=t.ignoreDefaultStyle?{}:{...e};t.baseStyleNames&&(i=t.baseStyleNames.reduce(((t,e)=>({...t,...this.styles.get(e)})),i));for(const e of Object.keys(t))void 0!==t[e]&&(t[e]==app_Constants.x3?delete i[e]:i[e]=t[e]);return"baseStyleNames"in i&&delete i.baseStyleNames,"ignoreDefaultStyle"in i&&delete i.ignoreDefaultStyle,i}}var app_CellState=__webpack_require__(953);const app_SideToSide=(t,e,i,s,n)=>{const{view:l}=t;let a=null!=s&&s.length>0?s[0]:null;const r=t.absolutePoints,o=r[0],h=r[r.length-1];if(null!=a&&(a=l.transformControlPoint(t,a)),null!=o&&((e=new app_CellState.A).x=o.x,e.y=o.y),null!=h&&((i=new app_CellState.A).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width),r=null!=a?a.x:Math.round(s+(t-s)/2);let o=l.getRoutingCenterY(e),h=l.getRoutingCenterY(i);if(null!=a&&(a.y>=e.y&&a.y<=e.y+e.height&&(o=a.y),a.y>=i.y&&a.y<=i.y+i.height&&(h=a.y)),(0,app_mathUtils.gR)(i,r,o)||(0,app_mathUtils.gR)(e,r,o)||n.push(new app_Point.A(r,o)),(0,app_mathUtils.gR)(i,r,h)||(0,app_mathUtils.gR)(e,r,h)||n.push(new app_Point.A(r,h)),1===n.length)if(null!=a)(0,app_mathUtils.gR)(i,r,a.y)||(0,app_mathUtils.gR)(e,r,a.y)||n.push(new app_Point.A(r,a.y));else{const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);n.push(new app_Point.A(r,t+(s-t)/2))}}},app_TopToBottom=(t,e,i,s,n)=>{const{view:l}=t;let a=null!=s&&s.length>0?s[0]:null;const r=t.absolutePoints,o=r[0],h=r[r.length-1];if(null!=a&&(a=l.transformControlPoint(t,a)),null!=o&&((e=new app_CellState.A).x=o.x,e.y=o.y),null!=h&&((i=new app_CellState.A).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);let r=l.getRoutingCenterX(e);null!=a&&a.x>=e.x&&a.x<=e.x+e.width&&(r=a.x);const o=null!=a?a.y:Math.round(s+(t-s)/2);if((0,app_mathUtils.gR)(i,r,o)||(0,app_mathUtils.gR)(e,r,o)||n.push(new app_Point.A(r,o)),r=null!=a&&a.x>=i.x&&a.x<=i.x+i.width?a.x:l.getRoutingCenterX(i),(0,app_mathUtils.gR)(i,r,o)||(0,app_mathUtils.gR)(e,r,o)||n.push(new app_Point.A(r,o)),1===n.length)if(null!=a&&1===n.length)(0,app_mathUtils.gR)(i,a.x,o)||(0,app_mathUtils.gR)(e,a.x,o)||n.push(new app_Point.A(a.x,o));else{const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width);n.push(new app_Point.A(t+(s-t)/2,o))}}},app_ElbowConnector=(t,e,i,s,n)=>{let l=null!=s&&s.length>0?s[0]:null,a=!1,r=!1;if(null!=e&&null!=i)if(null!=l){const s=Math.min(e.x,i.x),n=Math.max(e.x+e.width,i.x+i.width),o=Math.min(e.y,i.y),h=Math.max(e.y+e.height,i.y+i.height);l=t.view.transformControlPoint(t,l),a=l.y<o||l.y>h,r=l.x<s||l.x>n}else a=Math.max(e.x,i.x)===Math.min(e.x+e.width,i.x+i.width),a||(r=Math.max(e.y,i.y)===Math.min(e.y+e.height,i.y+i.height));r||!a&&t.style.elbow!==app_Constants.aq.VERTICAL?app_SideToSide(t,e,i,s,n):app_TopToBottom(t,e,i,s,n)},app_EntityRelationConnectorConfig={segment:app_Constants.Q5},app_resetEntityRelationConnectorConfig=()=>{app_EntityRelationConnectorConfig.segment=ENTITY_SEGMENT},app_OrthogonalConnectorConfig={buffer:10,pointsFallback:!0},app_originalOrthogonalConnectorConfig={...app_OrthogonalConnectorConfig},app_resetOrthogonalConnectorConfig=()=>{shallowCopy(app_originalOrthogonalConnectorConfig,app_OrthogonalConnectorConfig)},app_ManhattanConnectorConfig={maxAllowedDirectionChange:90,maxLoops:2e3,endDirections:Object.values(app_Constants.M8),startDirections:Object.values(app_Constants.M8),step:12},app_originalManhattanConnectorConfig={};(0,app_cloneUtils.I)(app_ManhattanConnectorConfig,app_originalManhattanConnectorConfig);const app_resetManhattanConnectorConfig=()=>{shallowCopy(app_originalManhattanConnectorConfig,app_ManhattanConnectorConfig)},app_EntityRelation=(t,e,i,s,n)=>{const{view:l}=t,a=(t.style?.segment??app_EntityRelationConnectorConfig.segment)*l.scale,r=t.absolutePoints,o=r[0],h=r[r.length-1];let p=!1;if(null!=e){const t=e.cell.getGeometry();t.relative?p=t.x<=.5:null!=i&&(p=(null!=h?h.x:i.x+i.width)<(null!=o?o.x:e.x))}if(null!=o)(e=new app_CellState.A).x=o.x,e.y=o.y;else{if(null==e)return;{const i=(0,app_mathUtils.ct)(e,t,!0,app_Constants.TE.NONE);i!==app_Constants.TE.NONE&&i!==app_Constants.TE.WEST+app_Constants.TE.EAST&&(p=i===app_Constants.TE.WEST)}}let d=!0;if(null!=i){const t=i.cell.getGeometry();t.relative?d=t.x<=.5:null!=e&&(d=(null!=o?o.x:e.x+e.width)<(null!=h?h.x:i.x))}if(null!=h)(i=new app_CellState.A).x=h.x,i.y=h.y;else if(null!=i){const e=(0,app_mathUtils.ct)(i,t,!1,app_Constants.TE.NONE);e!==app_Constants.TE.NONE&&e!=app_Constants.TE.WEST+app_Constants.TE.EAST&&(d=e===app_Constants.TE.WEST)}if(null!=e&&null!=i){const t=p?e.x:e.x+e.width,s=l.getRoutingCenterY(e),r=d?i.x:i.x+i.width,o=l.getRoutingCenterY(i),h=a;let c=p?-h:h;const u=new app_Point.A(t+c,s);c=d?-h:h;const g=new app_Point.A(r+c,o);if(p===d){const e=p?Math.min(t,r)-a:Math.max(t,r)+a;n.push(new app_Point.A(e,s)),n.push(new app_Point.A(e,o))}else if(u.x<g.x===p){const t=s+(o-s)/2;n.push(u),n.push(new app_Point.A(u.x,t)),n.push(new app_Point.A(g.x,t)),n.push(g)}else n.push(u),n.push(g)}},app_Loop=(t,e,i,s,n)=>{const l=t.absolutePoints,a=l[0],r=l[l.length-1];if(null==a||null==r){if(null!=e){const{view:i}=t,{graph:l}=i;let a=null!=s&&s.length>0?s[0]:null;null!=a&&(a=i.transformControlPoint(t,a),(0,app_mathUtils.gR)(e,a.x,a.y)&&(a=null));let r=0,o=0,h=0,p=0;const d=(t.style.segment??l.gridSize)*i.scale,c=t.style?.direction??app_Constants.M8.WEST;c===app_Constants.M8.NORTH||c===app_Constants.M8.SOUTH?(r=i.getRoutingCenterX(e),o=d):(h=i.getRoutingCenterY(e),p=d),null==a||a.x<e.x||a.x>e.x+e.width?null!=a?(r=a.x,p=Math.max(Math.abs(h-a.y),p)):c===app_Constants.M8.NORTH?h=e.y-2*o:c===app_Constants.M8.SOUTH?h=e.y+e.height+2*o:r=c===app_Constants.M8.EAST?e.x-2*p:e.x+e.width+2*p:null!==a&&(r=i.getRoutingCenterX(e),o=Math.max(Math.abs(r-a.x),p),h=a.y,p=0),n.push(new app_Point.A(r-o,h-p)),n.push(new app_Point.A(r+o,h+p))}}else if(null!=s&&s.length>0)for(let e=0;e<s.length;e+=1){let i=s[e];i=t.view.transformControlPoint(t,i),n.push(new app_Point.A(i.x,i.y))}};class app_Geometry extends app_Rectangle.A{constructor(t=0,e=0,i=0,s=0){super(t,e,i,s),this.TRANSLATE_CONTROL_POINTS=!0,this.alternateBounds=null,this.sourcePoint=null,this.targetPoint=null,this.points=null,this.offset=null,this.relative=!1}setRelative(t){this.relative=t}swap(){if(this.alternateBounds){const t=new app_Rectangle.A(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=t}}getTerminalPoint(t){return t?this.sourcePoint:this.targetPoint}setTerminalPoint(t,e){return e?this.sourcePoint=t:this.targetPoint=t,t}rotate(t,e){const i=(0,app_mathUtils.eh)(t),s=Math.cos(i),n=Math.sin(i);if(!this.relative){const t=new app_Point.A(this.getCenterX(),this.getCenterY()),i=(0,app_mathUtils.Iq)(t,s,n,e);this.x=Math.round(i.x-this.width/2),this.y=Math.round(i.y-this.height/2)}if(this.sourcePoint){const t=(0,app_mathUtils.Iq)(this.sourcePoint,s,n,e);this.sourcePoint.x=Math.round(t.x),this.sourcePoint.y=Math.round(t.y)}if(this.targetPoint){const t=(0,app_mathUtils.Iq)(this.targetPoint,s,n,e);this.targetPoint.x=Math.round(t.x),this.targetPoint.y=Math.round(t.y)}if(this.points)for(let t=0;t<this.points.length;t+=1)if(this.points[t]){const i=(0,app_mathUtils.Iq)(this.points[t],s,n,e);this.points[t].x=Math.round(i.x),this.points[t].y=Math.round(i.y)}}translate(t,e){if(this.relative||(this.x+=t,this.y+=e),this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x+t,this.sourcePoint.y=this.sourcePoint.y+e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x+t,this.targetPoint.y=this.targetPoint.y+e),this.TRANSLATE_CONTROL_POINTS&&this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x+t,this.points[i].y=this.points[i].y+e)}scale(t,e,i){if(this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x*t,this.sourcePoint.y=this.sourcePoint.y*e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x*t,this.targetPoint.y=this.targetPoint.y*e),this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x*t,this.points[i].y=this.points[i].y*e);this.relative||(this.x*=t,this.y*=e,i&&(e=t=Math.min(t,e)),this.width*=t,this.height*=e)}equals(t){return!!t&&super.equals(t)&&this.relative===t.relative&&(null===this.sourcePoint&&null===t.sourcePoint||!!this.sourcePoint?.equals(t.sourcePoint))&&(null===this.targetPoint&&null===t.targetPoint||!!this.targetPoint?.equals(t.targetPoint))&&app_equalPoints(this.points,t.points)&&(null===this.alternateBounds&&null===t.alternateBounds||!!this.alternateBounds?.equals(t.alternateBounds))&&(null===this.offset&&null===t.offset||!!this.offset?.equals(t.offset))}clone(){return(0,app_cloneUtils.o)(this)}}const app_geometry_Geometry=app_Geometry;function app_scalePointArray(t,e){let i=[];if(null!=t)for(let s=0;s<t.length;s+=1)null!=t[s]?i[s]=new app_Point.A(Math.round(t[s].x/e*10)/10,Math.round(t[s].y/e*10)/10):i[s]=null;else i=null;return i}function app_scaleCellState(t,e){let i=null;return null!=t&&(i=t.clone(),i.setRect(Math.round(t.x/e*10)/10,Math.round(t.y/e*10)/10,Math.round(t.width/e*10)/10,Math.round(t.height/e*10)/10)),i}const app_SegmentConnector=(t,e,i,s,n)=>{const l=app_scalePointArray(t.absolutePoints,t.view.scale),a=app_scaleCellState(e,t.view.scale),r=app_scaleCellState(i,t.view.scale);let o=n.length>0?n[0]:null,h=!0,p=null;function d(e){return e.x=Math.round(e.x*t.view.scale*10)/10,e.y=Math.round(e.y*t.view.scale*10)/10,(null==o||Math.abs(o.x-e.x)>=1||Math.abs(o.y-e.y)>=Math.max(1,t.view.scale))&&(n.push(e),o=e),o}let c=l[0];null==c&&null!=a?c=new app_Point.A(t.view.getRoutingCenterX(a),t.view.getRoutingCenterY(a)):null!=c&&(c=c.clone());const u=l.length-1;let g=null;if(null!=s&&s.length>0){let e=[];for(let i=0;i<s.length;i+=1){const n=t.view.transformControlPoint(t,s[i],!0);null!=n&&e.push(n)}if(0===e.length)return;null!=c&&null!=e[0]&&(Math.abs(e[0].x-c.x)<1&&(e[0].x=c.x),Math.abs(e[0].y-c.y)<1&&(e[0].y=c.y)),g=l[u],null!=g&&null!=e[e.length-1]&&(Math.abs(e[e.length-1].x-g.x)<1&&(e[e.length-1].x=g.x),Math.abs(e[e.length-1].y-g.y)<1&&(e[e.length-1].y=g.y)),p=e[0];let i=a,n=l[0],o=!1,_=!1,f=p;null!=n&&(i=null);for(let t=0;t<2;t+=1){const s=null!=n&&n.x===f.x,a=null!=n&&n.y===f.y,p=null!=i&&f.y>=i.y&&f.y<=i.y+i.height,d=null!=i&&f.x>=i.x&&f.x<=i.x+i.width;if(o=a||null==n&&p,_=s||null==n&&d,0!=t||!(o&&_||s&&a)){if(null!=n&&!a&&!s&&(p||d)){h=!p;break}if(_||o){h=o,1===t&&(h=e.length%2==0?o:_);break}}i=r,n=l[u],null!=n&&(i=null),f=e[e.length-1],s&&a&&(e=e.slice(1))}h&&(null!=l[0]&&l[0].y!==p.y||null==l[0]&&null!=a&&(p.y<a.y||p.y>a.y+a.height))?d(new app_Point.A(c.x,p.y)):!h&&(null!=l[0]&&l[0].x!==p.x||null==l[0]&&null!=a&&(p.x<a.x||p.x>a.x+a.width))&&d(new app_Point.A(p.x,c.y)),h?c.y=p.y:c.x=p.x;for(let t=0;t<e.length;t+=1)h=!h,p=e[t],h?c.y=p.y:c.x=p.x,d(c.clone())}else p=c,h=!0;if(c=l[u],null==c&&null!=r&&(c=new app_Point.A(t.view.getRoutingCenterX(r),t.view.getRoutingCenterY(r))),null!=c&&null!=p&&(h&&(null!=l[u]&&l[u].y!==p.y||null==l[u]&&null!=r&&(p.y<r.y||p.y>r.y+r.height))?d(new app_Point.A(c.x,p.y)):!h&&(null!=l[u]&&l[u].x!==p.x||null==l[u]&&null!=r&&(p.x<r.x||p.x>r.x+r.width))&&d(new app_Point.A(p.x,c.y))),null==l[0]&&null!=a)for(;n.length>1&&null!=n[1]&&(0,app_mathUtils.gR)(a,n[1].x,n[1].y);)n.splice(1,1);if(null==l[u]&&null!=r)for(;n.length>1&&null!=n[n.length-1]&&(0,app_mathUtils.gR)(r,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);null!=g&&null!=n[n.length-1]&&Math.abs(g.x-n[n.length-1].x)<=1&&Math.abs(g.y-n[n.length-1].y)<=1&&(n.splice(n.length-1,1),null!=n[n.length-1]&&(Math.abs(n[n.length-1].x-g.x)<1&&(n[n.length-1].x=g.x),Math.abs(n[n.length-1].y-g.y)<1&&(n[n.length-1].y=g.y)))},app_dirVectors=[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],app_wayPoints1=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],app_routePatterns=[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],app_vertexSeparations=[],app_limits=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],app_SIDE_MASK=480,app_CENTER_MASK=512,app_SOURCE_MASK=1024,app_TARGET_MASK=2048,app_VERTEX_MASK=3072;function app_getJettySize(t,e){const i=app_OrthogonalConnectorConfig.buffer;let s=(e?t.style.sourceJettySize:t.style.targetJettySize)??t.style.jettySize??i;if("auto"===s)if(((e?t.style.startArrow:t.style.endArrow)??app_Constants.x3)!==app_Constants.x3){const n=(e?t.style.startSize:t.style.endSize)??app_Constants.wh;s=Math.max(2,Math.ceil((n+i)/i))*i}else s=2*i;return s}const app_OrthogonalConnector=(t,e,i,s,n)=>{const l=app_scalePointArray(t.absolutePoints,t.view.scale),a=app_scaleCellState(e,t.view.scale),r=app_scaleCellState(i,t.view.scale),o=null!=a&&a.cell.isEdge(),h=null!=r&&r.cell.isEdge(),p=l[0],d=l[l.length-1];let c=null!=a?a.x:p.x,u=null!=a?a.y:p.y,g=null!=a?a.width:0,_=null!=a?a.height:0,f=null!=r?r.x:d.x,C=null!=r?r.y:d.y,y=null!=r?r.width:0,E=null!=r?r.height:0,v=app_getJettySize(t,!0),m=app_getJettySize(t,!1);null!=a&&r===a&&(m=Math.max(v,m),v=m);const w=m+v;let x=!1;if(null!=p&&null!=d){const t=d.x-p.x,e=d.y-p.y;x=t*t+e*e<w*w}if(x||app_OrthogonalConnectorConfig.pointsFallback&&null!=s&&s.length>0||o||h)return void app_SegmentConnector(t,e,i,s,n);const S=[app_Constants.TE.ALL,app_Constants.TE.ALL];let b=0;if(null!=a&&(S[0]=(0,app_mathUtils.ct)(a,t,!0,app_Constants.TE.ALL),b=a.style.rotation??0,0!==b)){const t=(0,app_mathUtils.UX)(new app_Rectangle.A(c,u,g,_),b);c=t.x,u=t.y,g=t.width,_=t.height}if(null!=r&&(S[1]=(0,app_mathUtils.ct)(r,t,!1,app_Constants.TE.ALL),b=r.style.rotation??0,0!==b)){const t=(0,app_mathUtils.UX)(new app_Rectangle.A(f,C,y,E),b);f=t.x,C=t.y,y=t.width,E=t.height}const A=[0,0],M=[[c,u,g,_],[f,C,y,E]],T=[v,m];for(let t=0;t<2;t+=1)app_limits[t][1]=M[t][0]-T[t],app_limits[t][2]=M[t][1]-T[t],app_limits[t][4]=M[t][0]+M[t][2]+T[t],app_limits[t][8]=M[t][1]+M[t][3]+T[t];const P=M[0][0]+M[0][2]/2,I=M[0][1]+M[0][3]/2,O=P-(M[1][0]+M[1][2]/2),L=I-(M[1][1]+M[1][3]/2);let H=0;O<0?H=L<0?2:1:L<=0&&(H=3,0===O&&(H=2));let D=null;null!=a&&(D=p);const R=[[.5,.5],[.5,.5]];for(let t=0;t<2;t+=1)null!=D&&(R[t][0]=(D.x-M[t][0])/M[t][2],Math.abs(D.x-M[t][0])<=1?A[t]=app_Constants.TE.WEST:Math.abs(D.x-M[t][0]-M[t][2])<=1&&(A[t]=app_Constants.TE.EAST),R[t][1]=(D.y-M[t][1])/M[t][3],Math.abs(D.y-M[t][1])<=1?A[t]=app_Constants.TE.NORTH:Math.abs(D.y-M[t][1]-M[t][3])<=1&&(A[t]=app_Constants.TE.SOUTH)),D=null,null!=r&&(D=d);const k=M[0][1]-(M[1][1]+M[1][3]),B=M[0][0]-(M[1][0]+M[1][2]),V=M[1][1]-(M[0][1]+M[0][3]),U=M[1][0]-(M[0][0]+M[0][2]);app_vertexSeparations[1]=Math.max(B-w,0),app_vertexSeparations[2]=Math.max(k-w,0),app_vertexSeparations[4]=Math.max(V-w,0),app_vertexSeparations[3]=Math.max(U-w,0);const N=[],z=[],G=[];z[0]=B>=U?app_Constants.TE.WEST:app_Constants.TE.EAST,G[0]=k>=V?app_Constants.TE.NORTH:app_Constants.TE.SOUTH,z[1]=(0,app_mathUtils.Qg)(z[0]),G[1]=(0,app_mathUtils.Qg)(G[0]);const F=B>=U?B:U,W=k>=V?k:V,$=[[0,0],[0,0]];let Y=!1;for(let t=0;t<2;t+=1)0===A[t]&&(z[t]&S[t]||(z[t]=(0,app_mathUtils.Qg)(z[t])),G[t]&S[t]||(G[t]=(0,app_mathUtils.Qg)(G[t])),$[t][0]=G[t],$[t][1]=z[t]);W>0&&F>0&&((z[0]&S[0])>0&&(G[1]&S[1])>0?($[0][0]=z[0],$[0][1]=G[0],$[1][0]=G[1],$[1][1]=z[1],Y=!0):(G[0]&S[0])>0&&(z[1]&S[1])>0&&($[0][0]=G[0],$[0][1]=z[0],$[1][0]=z[1],$[1][1]=G[1],Y=!0)),W>0&&!Y&&($[0][0]=G[0],$[0][1]=z[0],$[1][0]=G[1],$[1][1]=z[1],Y=!0),F>0&&!Y&&($[0][0]=z[0],$[0][1]=G[0],$[1][0]=z[1],$[1][1]=G[1],Y=!0);for(let t=0;t<2;t+=1)0===A[t]&&($[t][0]&S[t]||($[t][0]=$[t][1]),N[t]=$[t][0]&S[t],N[t]|=($[t][1]&S[t])<<8,N[t]|=($[1-t][t]&S[t])<<16,N[t]|=($[1-t][1-t]&S[t])<<24,15&N[t]||(N[t]=N[t]<<8),3840&N[t]||(N[t]=15&N[t]|N[t]>>8),983040&N[t]||(N[t]=65535&N[t]|(251658240&N[t])>>8),A[t]=15&N[t],S[t]!==app_Constants.TE.WEST&&S[t]!==app_Constants.TE.NORTH&&S[t]!==app_Constants.TE.EAST&&S[t]!==app_Constants.TE.SOUTH||(A[t]=S[t]));let X=A[0]===app_Constants.TE.EAST?3:A[0],q=A[1]===app_Constants.TE.EAST?3:A[1];X-=H,q-=H,X<1&&(X+=4),q<1&&(q+=4);const j=app_routePatterns[X-1][q-1];switch(app_wayPoints1[0][0]=M[0][0],app_wayPoints1[0][1]=M[0][1],A[0]){case app_Constants.TE.WEST:app_wayPoints1[0][0]-=v,app_wayPoints1[0][1]+=R[0][1]*M[0][3];break;case app_Constants.TE.SOUTH:app_wayPoints1[0][0]+=R[0][0]*M[0][2],app_wayPoints1[0][1]+=M[0][3]+v;break;case app_Constants.TE.EAST:app_wayPoints1[0][0]+=M[0][2]+v,app_wayPoints1[0][1]+=R[0][1]*M[0][3];break;case app_Constants.TE.NORTH:app_wayPoints1[0][0]+=R[0][0]*M[0][2],app_wayPoints1[0][1]-=v}let K=0,Q=(A[0]&(app_Constants.TE.EAST|app_Constants.TE.WEST))>0?0:1;const J=Q;let Z=0;for(let t=0;t<j.length;t+=1){const e=15&j[t];let i=e===app_Constants.TE.EAST?3:e;i+=H,i>4&&(i-=4);const s=app_dirVectors[i-1];Z=i%2>0?0:1,Z!==Q&&(K++,app_wayPoints1[K][0]=app_wayPoints1[K-1][0],app_wayPoints1[K][1]=app_wayPoints1[K-1][1]);const n=(j[t]&app_TARGET_MASK)>0,l=(j[t]&app_SOURCE_MASK)>0;let a=(j[t]&app_SIDE_MASK)>>5;a<<=H,a>15&&(a>>=4);const r=(j[t]&app_CENTER_MASK)>0;if((l||n)&&a<9){let t=0;const e=l?0:1;if(t=r&&0===Z?M[e][0]+R[e][0]*M[e][2]:r?M[e][1]+R[e][1]*M[e][3]:app_limits[e][a],0===Z){const e=(t-app_wayPoints1[K][0])*s[0];e>0&&(app_wayPoints1[K][0]+=s[0]*e)}else{const e=(t-app_wayPoints1[K][1])*s[1];e>0&&(app_wayPoints1[K][1]+=s[1]*e)}}else r&&(app_wayPoints1[K][0]+=s[0]*Math.abs(app_vertexSeparations[i]/2),app_wayPoints1[K][1]+=s[1]*Math.abs(app_vertexSeparations[i]/2));K>0&&app_wayPoints1[K][Z]===app_wayPoints1[K-1][Z]?K--:Q=Z}for(let e=0;e<=K&&(e!==K||(((A[1]&(app_Constants.TE.EAST|app_Constants.TE.WEST))>0?0:1)===J?0:1)==(K+1)%2);e+=1)n.push(new app_Point.A(Math.round(app_wayPoints1[e][0]*t.view.scale*10)/10,Math.round(app_wayPoints1[e][1]*t.view.scale*10)/10));let tt=1;for(;tt<n.length;)null==n[tt-1]||null==n[tt]||n[tt-1].x!==n[tt].x||n[tt-1].y!==n[tt].y?tt++:n.splice(tt,1)},app_ManhattanConnector=(t,e,i,s,n)=>{function l(t,e){return t.x+=e.x||0,t.y+=e.y||0,t.width+=e.width||0,t.height+=e.height||0,t}function a(t,e){return e*Math.round(t/e)}function r(t,e,i){return t.x=a(t.x,e),t.y=a(t.y,i||e),t}function o(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}function h(t){return new app_Point.A(t.x+t.width/2,t.y+t.height/2)}function p(t,e){return new app_Point.A(t.x-e.x,t.y-e.y)}function d(t,e,i){return t.x+=e||0,t.y+=i||0,t}function c(t,e){const i=e.clone(),s=-(i.y-t.y),n=i.x-t.x;return 180*("0"==s.toFixed(10)&&"0"==n.toFixed(10)?0:Math.atan2(s,n))/Math.PI}function u(t){return new app_Point.A(0===t.x?0:Math.abs(t.x)/t.x,0===t.y?0:Math.abs(t.y)/t.y)}function g(t){const e=t.split(-1===t.indexOf("@")?" ":"@");return new app_Point.A(parseInt(e[0],10),parseInt(e[1],10))}function _(t){return`${t.x}@${t.y}`}function f(t){const e=t.view.graph,i=e.getCellBounds(t.cell,!1,!1)?.clone();if(!i)return;const s=e.view,{scale:n,translate:l}=s,{x:a,y:r}=l,o=t=>Math.round(10*t)/10;return new app_Rectangle.A(o(i.x/n-a),o(i.y/n-r),o(i.width/n),o(i.height/n))}const C=app_ManhattanConnectorConfig.step,y={paddingBox:new app_geometry_Geometry(-C,-C,2*C,2*C),directions:[{offsetX:C,offsetY:0,cost:C,angle:x(c(new app_Point.A(0,0),new app_Point.A(C,0)))},{offsetX:0,offsetY:C,cost:C,angle:x(c(new app_Point.A(0,0),new app_Point.A(0,C)))},{offsetX:-C,offsetY:0,cost:C,angle:x(c(new app_Point.A(0,0),new app_Point.A(-C,0)))},{offsetX:0,offsetY:-C,cost:C,angle:x(c(new app_Point.A(0,0),new app_Point.A(0,-C)))}],directionMap:{east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1}},penaltiesGenerator:t=>45==t||90==t||180==t?C/2:0,draggingRoute:null,previousDirAngle:0};class E{constructor(t){this.options=t,this.mapGridSize=100,this.map=new Map}build(t,e){const i=t?.view.graph||e?.view.graph;if(i)return Array.from(i.getView().getCellStates()).filter((t=>t.cell&&t.cell.isVertex()&&!t.cell.isEdge())).map((t=>f(t))).map((t=>t?l(t,this.options.paddingBox):null)).forEach((t=>{if(!t)return;const e=r(new app_Point.A(t.x,t.y),this.mapGridSize),i=r(new app_Point.A(t.x+t.width,t.y+t.height),this.mapGridSize);for(let s=e.x;s<=i.x;s+=this.mapGridSize)for(let n=e.y;n<=i.y;n+=this.mapGridSize){const e=s+"@"+n,i=this.map.get(e)||[];this.map.has(e)||this.map.set(e,i),i.push(t)}}))}isPointAccessible(t){const e=_(r(t.clone(),this.mapGridSize)),i=this.map.get(e);return!i||i.every((e=>!o(e,t)))}}class v{constructor(){this.items=[],this.hash=new Map}add(t,e){const i=this.hash.get(t);i?(i.value=e,this.items.splice(this.items.indexOf(t),1)):this.hash.set(t,{value:e,open:!0}),this.items.push(t),this.items.sort(((t,e)=>{const i=this.hash.get(t),s=this.hash.get(e);return i&&s?i.value-s.value:0}))}remove(t){const e=this.hash.get(t);e&&(e.open=!1)}isOpen(t){const e=this.hash.get(t);return e&&1==e.open}isClose(t){const e=this.hash.get(t);return e&&0==e.open}isEmpty(){return 0==this.items.length}pop(){const t=this.items.shift();return t&&this.remove(t),t}}function m(t,e,i,s){const n=[];let l,a=u(p(s,e)),r=e;for(;t[_(r)];){if(l=t[_(r)],!l)continue;const e=u(p(r,l));e.equals(a)||(n.unshift(r),a=e),r=l}return u(p(r,i)).equals(a)||n.unshift(r),n}function w(t,e,i){const s=app_ManhattanConnectorConfig.step,n=h(t),l=[];for(const a of e){const e=i.directionMap[a],h=e.x*t.width/2,p=e.y*t.height/2,c=d(n.clone(),h,p);o(t,c)&&d(c,e.x*s,e.y*s),l.push(r(c,s))}return l}function x(t){return t%360+(t<0?360:0)}function S(t,e,i){const s=360/i;return Math.floor(x(c(t,e)+s/2)/s)*s}function b(t,e){const i=Math.abs(t-e);return i>180?360-i:i}function A(t,e){let i=1/0;for(let l=0,a=e.length;l<a;l++){const a=(s=t,n=e[l],Math.abs(n.x-s.x)+Math.abs(n.y-s.y));a<i&&(i=a)}var s,n;return i}function M(t,e,i,s){const n=f(i),l=s?e.style.exitY:e.style.entryY,a=s?app_ManhattanConnectorConfig.startDirections.every((t=>t!=app_Constants.M8.NORTH&&t!=app_Constants.M8.SOUTH)):app_ManhattanConnectorConfig.endDirections.every((t=>t!=app_Constants.M8.NORTH&&t!=app_Constants.M8.SOUTH));if(null!=l&&a){const e=n?.height||0;t.y=null!=n?.y?n?.y+e*l:t.y-e/2+e*l}const r=s?e.style.exitX:e.style.entryX,o=s?app_ManhattanConnectorConfig.startDirections.every((t=>t!=app_Constants.M8.WEST&&t!=app_Constants.M8.EAST)):app_ManhattanConnectorConfig.endDirections.every((t=>t!=app_Constants.M8.WEST&&t!=app_Constants.M8.EAST));if(null!=r&&o){const e=n?.width||0;t.x=null!=n?.x?n?.x+e*r:t.x-e/2+e*(r||0)}}!function(t,e,i,s,n,a){if(null!=s&&s.length>0||null==e||null==i)return void app_SegmentConnector(t,e,i,s,n);let o=f(e);o=o?l(o,a.paddingBox):void 0;let p=f(i);p=p?l(p,a.paddingBox):void 0;const c=new E(a);if(c.build(e,i),!o||!p)return app_OrthogonalConnector(t,e,i,s,n);const u=function(t,e,i,s){const n=app_ManhattanConnectorConfig.step,l=w(t,app_ManhattanConnectorConfig.startDirections,s).filter((t=>i.isPointAccessible(t))),a=r(h(t),n),o=w(e,app_ManhattanConnectorConfig.endDirections,s).filter((t=>i.isPointAccessible(t))),p=r(h(e),n);if(l.length>0&&o.length>0){const t=new v,e={},n={};l.forEach((e=>{const i=_(e);t.add(i,A(e,o)),n[i]=0}));let r=app_ManhattanConnectorConfig.maxLoops;const h=o.map((t=>_(t)));let c,u;for(;!t.isEmpty()&&r>0;){const l=t.pop();if(null==l)continue;const f=g(l),C=n[l];if(u=c,c=e[l]?S(e[l],f,s.directions.length):0!=s.previousDirAngle?s.previousDirAngle:S(a,f,s.directions.length),h.indexOf(l)>=0){const t=b(c,S(f,p,s.directions.length));if(f.equals(p)||t<180)return s.previousDirAngle=c,m(e,f,a,p)}for(let l=0;l<s.directions.length;l++){const a=s.directions[l],r=b(c,a.angle);if(u&&r>app_ManhattanConnectorConfig.maxAllowedDirectionChange)continue;const h=d(f.clone(),a.offsetX,a.offsetY),p=_(h);if(t.isClose(p)||!i.isPointAccessible(h))continue;const g=C+a.cost+s.penaltiesGenerator(r);(!t.isOpen(p)||g<n[p])&&(e[p]=f,n[p]=g,t.add(p,g+A(h,o)))}r--}return null}return null}(o,p,c,a);if(null==u||0==u.length)return app_OrthogonalConnector(t,e,i,s,n);t.style&&(t.visibleSourceState&&u.length>0&&M(u[0],t,t.visibleSourceState,!0),t.visibleTargetState&&u.length>1&&M(u[u.length-1],t,t.visibleTargetState,!1));const C=t.view.scale;u.forEach((e=>n.push(new app_Point.A(Math.round((e.x+t.view.translate.x)*C*10)/10,Math.round((e.y+t.view.translate.y)*C*10)/10))))}(t,e,i,s,n,y)};class app_EdgeStyle{}app_EdgeStyle.EntityRelation=app_EntityRelation,app_EdgeStyle.Loop=app_Loop,app_EdgeStyle.ElbowConnector=app_ElbowConnector,app_EdgeStyle.SideToSide=app_SideToSide,app_EdgeStyle.TopToBottom=app_TopToBottom,app_EdgeStyle.SegmentConnector=app_SegmentConnector,app_EdgeStyle.OrthConnector=app_OrthogonalConnector,app_EdgeStyle.ManhattanConnector=app_ManhattanConnector;const app_style_EdgeStyle=app_EdgeStyle;class app_CellHighlight{constructor(t,e,i,s){this.strokeWidth=0,this.dashed=!1,this.opacity=100,this.shape=null,this.keepOnTop=!1,this.state=null,this.spacing=2,this.graph=t,this.highlightColor=e??app_Constants.Vj,this.strokeWidth=i??app_Constants.es,this.dashed=s??!1,this.opacity=app_Constants.V8,this.repaintHandler=()=>{if(this.state){const t=this.graph.view.getState(this.state.cell);t?(this.state=t,this.repaint()):this.hide()}},this.graph.getView().addListener(app_InternalEvent.A.SCALE,this.repaintHandler),this.graph.getView().addListener(app_InternalEvent.A.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(app_InternalEvent.A.DOWN,this.resetHandler),this.graph.getView().addListener(app_InternalEvent.A.UP,this.resetHandler)}setHighlightColor(t){this.highlightColor=t,this.shape&&(this.shape.stroke=t)}drawHighlight(){if(this.shape=this.createShape(),this.repaint(),this.shape){const t=this.shape.node;!this.keepOnTop&&t?.parentNode?.firstChild!==t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}}createShape(){if(!this.state)return null;const t=this.graph.cellRenderer.createShape(this.state);return t.svgStrokeTolerance=this.graph.getEventTolerance(),t.points=this.state.absolutePoints,t.apply(this.state),t.stroke=this.highlightColor,t.opacity=this.opacity,t.isDashed=this.dashed,t.isShadow=!1,t.dialect=app_Constants.$p.SVG,t.init(this.graph.getView().getOverlayPane()),app_InternalEvent.A.redirectMouseEvents(t.node,this.graph,this.state),this.graph.dialect!==app_Constants.$p.SVG?t.pointerEvents=!1:t.svgPointerEvents="stroke",t}getStrokeWidth(t=null){return this.strokeWidth}repaint(){this.state&&this.shape&&(this.shape.scale=this.state.view.scale,this.state.cell.isEdge()?(this.shape.strokeWidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new app_Rectangle.A(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=this.state.style.rotation??0,this.shape.strokeWidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())}hide(){this.highlight(null)}highlight(t=null){this.state!==t&&(this.shape&&(this.shape.destroy(),this.shape=null),this.state=t,this.state&&this.drawHighlight())}isHighlightAt(t,e){let i=!1;if(this.shape&&document.elementFromPoint){let s=document.elementFromPoint(t,e);for(;s;){if(s===this.shape.node){i=!0;break}s=s.parentNode}}return i}destroy(){const t=this.graph;t.getView().removeListener(this.resetHandler),t.getView().removeListener(this.repaintHandler),t.getDataModel().removeListener(this.repaintHandler),this.shape&&(this.shape.destroy(),this.shape=null)}}const app_cell_CellHighlight=app_CellHighlight;class app_CellMarker extends app_EventSource.A{constructor(t,e=app_Constants.Vj,i=app_Constants.G7,s=app_Constants.ir){super(),this.enabled=!0,this.hotspot=app_Constants.ir,this.hotspotEnabled=!1,this.currentColor=app_Constants.x3,this.validState=null,this.markedState=null,this.graph=t,this.validColor=e,this.invalidColor=i,this.hotspot=s,this.highlight=new app_cell_CellHighlight(t)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setHotspot(t){this.hotspot=t}getHotspot(){return this.hotspot}setHotspotEnabled(t){this.hotspotEnabled=t}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return!!this.validState}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState&&(this.markedState=null,this.unmark())}process(t){let e=null;return this.isEnabled()&&(e=this.getState(t),this.setCurrentState(e,t)),e}setCurrentState(t,e,i){const s=!!t&&this.isValidState(t);i=i??this.getMarkerColor(e.getEvent(),t,s),this.validState=s?t:null,t===this.markedState&&i===this.currentColor||(this.currentColor=i,t&&this.currentColor!==app_Constants.x3?(this.markedState=t,this.mark()):this.markedState&&(this.markedState=null,this.unmark()))}markCell(t,e){const i=this.graph.getView().getState(t);i&&(this.currentColor=e??this.validColor,this.markedState=i,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(t){return!0}getMarkerColor(t,e,i){return i?this.validColor:this.invalidColor}getState(t){const e=this.graph.getView(),i=this.getCell(t);if(!i)return null;const s=this.getStateToMark(e.getState(i));return s&&this.intersects(s,t)?s:null}getCell(t){return t.getCell()}getStateToMark(t){return t}intersects(t,e){const i=e.getGraphX(),s=e.getGraphY();return!this.hotspotEnabled||(0,app_mathUtils.KP)(t,i,s,this.hotspot,app_Constants.vd,app_Constants.DK)}destroy(){this.highlight.destroy()}}const app_cell_CellMarker=app_CellMarker;class app_EllipseShape extends app_Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}}const app_node_EllipseShape=app_EllipseShape;class app_ConnectionConstraint{constructor(t,e=!0,i=null,s=0,n=0){this.perimeter=!0,this.name=null,this.dx=0,this.dy=0,this.point=t,this.perimeter=e,this.name=i,this.dx=s,this.dy=n}}const app_other_ConnectionConstraint=app_ConnectionConstraint;class app_ConstraintHandler{constructor(t){this.pointImage=new app_image_ImageBox(`${app_Client.A.imageBasePath}/point.gif`,5,5),this.currentFocus=null,this.currentFocusArea=null,this.focusIcons=[],this.constraints=null,this.currentConstraint=null,this.focusHighlight=null,this.focusPoints=[],this.currentPoint=null,this.enabled=!0,this.highlightColor=app_Constants.Vj,this.mouseleaveHandler=null,this.graph=t,this.resetHandler=()=>{this.currentFocus&&!this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()},this.graph.model.addListener(app_InternalEvent.A.CHANGE,this.resetHandler),this.graph.view.addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(app_InternalEvent.A.TRANSLATE,this.resetHandler),this.graph.view.addListener(app_InternalEvent.A.SCALE,this.resetHandler),this.graph.addListener(app_InternalEvent.A.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}reset(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=[]}getTolerance(t){return this.graph.getEventTolerance()}getImageForConstraint(t,e,i){return this.pointImage}isEventIgnored(t,e=!1){return!1}isStateIgnored(t,e=!1){return!1}destroyIcons(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[]}destroyFocusHighlight(){this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(t){return(0,app_EventUtils.RT)(t.getEvent())}getCellForEvent(t,e){let i=t.getCell();if(i||!e||t.getGraphX()===e.x&&t.getGraphY()===e.y||(i=this.graph.getCellAt(e.x,e.y)),i&&!i.isConnectable()){const t=i.getParent();t&&t.isVertex()&&t.isConnectable()&&(i=t)}return i?this.graph.isCellLocked(i)?null:i:null}update(t,e,i,s){if(this.isEnabled()&&!this.isEventIgnored(t)){!this.mouseleaveHandler&&this.graph.container&&(this.mouseleaveHandler=()=>{this.reset()},app_InternalEvent.A.addListener(this.graph.container,"mouseleave",this.resetHandler));const n=this.getTolerance(t),l=s?s.x:t.getGraphX(),a=s?s.y:t.getGraphY(),r=new app_Rectangle.A(l-n,a-n,2*n,2*n),o=new app_Rectangle.A(t.getGraphX()-n,t.getGraphY()-n,2*n,2*n),h=this.graph.view.getState(this.getCellForEvent(t,s));this.isKeepFocusEvent(t)||this.currentFocusArea&&this.currentFocus&&!h&&this.currentFocus.cell.isVertex()&&(0,app_mathUtils.HY)(this.currentFocusArea,o)||h===this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(t,h,e)),this.currentConstraint=null,this.currentPoint=null;let p,d=null;if(this.focusIcons.length>0&&this.constraints&&(!h||this.currentFocus===h)){const t=o.getCenterX(),n=o.getCenterY();for(let l=0;l<this.focusIcons.length;l+=1){const a=t-this.focusIcons[l].bounds.getCenterX(),c=n-this.focusIcons[l].bounds.getCenterY();if(p=a*a+c*c,(this.intersects(this.focusIcons[l],o,e,i)||s&&this.intersects(this.focusIcons[l],r,e,i))&&(null===d||p<d)){if(this.currentConstraint=this.constraints[l],this.currentPoint=this.focusPoints[l],d=p,p=this.focusIcons[l].bounds.clone(),p.grow(app_Constants.bF+1),p.width-=1,p.height-=1,!this.focusHighlight){const t=this.createHighlightShape();t.dialect=app_Constants.$p.SVG,t.pointerEvents=!1,t.init(this.graph.getView().getOverlayPane()),this.focusHighlight=t;const e=()=>this.currentFocus?this.currentFocus:h;app_InternalEvent.A.redirectMouseEvents(t.node,this.graph,e)}this.focusHighlight.bounds=p,this.focusHighlight.redraw()}}}this.currentConstraint||this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus&&this.constraints&&this.focusIcons.length>0){const t=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=t,this.currentFocusArea=new app_Rectangle.A(t.x,t.y,t.width,t.height);for(let e=0;e<this.constraints.length;e+=1){const i=this.graph.getConnectionPoint(t,this.constraints[e]),s=this.getImageForConstraint(t,this.constraints[e],i),n=new app_Rectangle.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height);this.focusIcons[e].bounds=n,this.focusIcons[e].redraw(),this.currentFocusArea.add(this.focusIcons[e].bounds),this.focusPoints[e]=i}}}setFocus(t,e,i){if(this.constraints=e&&!this.isStateIgnored(e,i)&&e.cell.isConnectable()?this.isEnabled()?this.graph.getAllConnectionConstraints(e,i)??[]:[]:null,this.constraints&&e){this.currentFocus=e,this.currentFocusArea=new app_Rectangle.A(e.x,e.y,e.width,e.height);for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[];for(let t=0;t<this.constraints.length;t+=1){const i=this.graph.getConnectionPoint(e,this.constraints[t]),s=this.getImageForConstraint(e,this.constraints[t],i),{src:n}=s,l=new app_Rectangle.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height),a=new app_ImageShape.A(l,n);a.dialect=this.graph.dialect!==app_Constants.$p.SVG?app_Constants.$p.MIXEDHTML:app_Constants.$p.SVG,a.preserveImageAspect=!1,a.init(this.graph.getView().getDecoratorPane()),a.node.previousSibling&&a.node.parentNode?.insertBefore(a.node,a.node.parentNode.firstChild);const r=()=>this.currentFocus?this.currentFocus:e;a.redraw(),app_InternalEvent.A.redirectMouseEvents(a.node,this.graph,r),this.currentFocusArea.add(a.bounds),this.focusIcons.push(a),this.focusPoints.push(i)}this.currentFocusArea.grow(this.getTolerance(t))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){const t=new app_RectangleShape.A(new app_Rectangle.A,this.highlightColor,this.highlightColor,app_Constants.es);return t.opacity=app_Constants.V8,t}intersects(t,e,i,s){return(0,app_mathUtils.HY)(t.bounds,e)}onDestroy(){this.reset(),this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.mouseleaveHandler&&this.graph.container&&(app_InternalEvent.A.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}const app_handler_ConstraintHandler=app_ConstraintHandler,app_EdgeHandlerConfig={addBendOnShiftClickEnabled:!1,connectFillColor:app_Constants.XW,handleShape:"square",removeBendOnShiftClickEnabled:!1,selectionColor:app_Constants.nh,selectionDashed:app_Constants.Xy,selectionStrokeWidth:app_Constants.MO,virtualBendOpacity:20,virtualBendsEnabled:!1},app_defaultEdgeHandlerConfig={...app_EdgeHandlerConfig},app_resetEdgeHandlerConfig=()=>{shallowCopy(app_defaultEdgeHandlerConfig,app_EdgeHandlerConfig)},app_HandleConfig={fillColor:app_Constants.yS,labelFillColor:app_Constants.dZ,labelSize:app_Constants.aQ,size:app_Constants.r5,strokeColor:app_Constants.XA},app_defaultHandleConfig={...app_HandleConfig},app_resetHandleConfig=()=>{shallowCopy(app_defaultHandleConfig,app_HandleConfig)},app_VertexHandlerConfig={rotationEnabled:!1,selectionColor:app_Constants.SR,selectionStrokeWidth:app_Constants.Jk,selectionDashed:app_Constants.MQ},app_defaultVertexHandlerConfig={...app_VertexHandlerConfig},app_resetVertexHandlerConfig=()=>{shallowCopy(app_defaultVertexHandlerConfig,app_VertexHandlerConfig)};class app_EdgeHandler{constructor(t){if(this.error=null,this.bends=[],this.cloneEnabled=!0,this.dblClickRemoveEnabled=!1,this.mergeRemoveEnabled=!1,this.straightRemoveEnabled=!1,this.parentHighlightEnabled=!1,this.preferHtml=!1,this.allowHandleBoundsCheck=!0,this.snapToTerminals=!1,this.handleImage=null,this.labelHandleImage=null,this.tolerance=0,this.outlineConnect=!1,this.manageLabelHandle=!1,this.currentPoint=null,this.parentHighlight=null,this.index=null,this.isSource=!1,this.isTarget=!1,this.isLabel=!1,this.points=[],this.snapPoint=null,this.abspoints=[],this.startX=0,this.startY=0,this.outline=!0,this.active=!0,this.state=t,this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new app_handler_ConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!==app_Constants.$p.SVG?app_Constants.$p.MIXEDHTML:app_Constants.$p.SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(app_Constants.Lm.MOVABLE_EDGE),app_InternalEvent.A.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode===this.graph.container,!this.preferHtml){const t=this.state.getVisibleTerminalState(!0);if(null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container),!this.preferHtml){const t=this.state.getVisibleTerminalState(!1);null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container)}}const e=this.graph.getPlugin("SelectionHandler");e&&(this.graph.getSelectionCount()<e.maxCells||e.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new app_Point.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(app_Constants.Lm.LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.updateParentHighlight(),this.redraw(),this.escapeHandler=(e,i)=>{const s=null!=this.index;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,t.view.isRendering())},this.state.view.graph.addListener(app_InternalEvent.A.ESCAPE,this.escapeHandler)}isParentHighlightVisible(){const t=this.state.cell.getParent();return t?!this.graph.isCellSelected(t):null}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=app_Rectangle.A.fromRectangle(i),this.parentHighlight.redraw())}else i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&i&&!i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=app_Constants.$p.SVG,this.parentHighlight.pointerEvents=!1,i.style.rotation&&(this.parentHighlight.rotation=i.style.rotation),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}createCustomHandles(){return[]}isVirtualBendsEnabled(t){return app_EdgeHandlerConfig.virtualBendsEnabled&&(null==this.state.style.edgeStyle||this.state.style.edgeStyle===app_Constants.x3||this.state.style.noEdgeStyle)&&"arrow"!==this.state.style.shape}isCellEnabled(t){return!0}isAddPointEvent(t){return(0,app_EventUtils.RT)(t)}isRemovePointEvent(t){return(0,app_EventUtils.RT)(t)}getSelectionPoints(t){return t.absolutePoints}createParentHighlightShape(t){const e=new app_RectangleShape.A(app_Rectangle.A.fromRectangle(t),app_Constants.x3,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}createSelectionShape(t){const e=new(0,this.state.shape.constructor);return e.outline=!0,e.apply(this.state),e.isDashed=this.isSelectionDashed(),e.stroke=this.getSelectionColor(),e.isShadow=!1,e}getSelectionColor(){return app_EdgeHandlerConfig.selectionColor}getSelectionStrokeWidth(){return app_EdgeHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return app_EdgeHandlerConfig.selectionDashed}isConnectableCell(t){return!0}getCellAt(t,e){return this.outlineConnect?null:this.graph.getCellAt(t,e)}createMarker(){return new app_EdgeHandlerCellMarker(this.graph,this)}validateConnection(t,e){return this.graph.getEdgeValidationError(this.state.cell,t,e)}createBends(){const{cell:t}=this.state,e=[];for(let i=0;i<this.abspoints.length;i+=1)if(this.isHandleVisible(i)){const s=0===i,n=i===this.abspoints.length-1,l=s||n;(l||this.graph.isCellBendable(t))&&(t=>{const s=this.createHandleShape(t);this.initBend(s,(()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,t)})),this.isHandleEnabled(i)&&s.setCursor(l?app_Constants.Lm.TERMINAL_HANDLE:app_Constants.Lm.BEND_HANDLE),e.push(s),l||(this.points.push(new app_Point.A(0,0)),s.node.style.visibility="hidden")})(i)}return e}createVirtualBends(){const{cell:t}=this.state,e=(this.abspoints[0],[]);if(this.graph.isCellBendable(t))for(let t=1;t<this.abspoints.length;t+=1)(t=>{this.initBend(t),t.setCursor(app_Constants.Lm.VIRTUAL_BEND_HANDLE),e.push(t)})(this.createHandleShape());return e}isHandleEnabled(t){return!0}isHandleVisible(t){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),s=this.state.cell.getGeometry();return(s?this.graph.view.getEdgeStyle(this.state,s.points||void 0,e,i):null)!==app_style_EdgeStyle.EntityRelation||0===t||t===this.abspoints.length-1}createHandleShape(t){if(this.handleImage){const t=new app_ImageShape.A(new app_Rectangle.A(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}let e=app_HandleConfig.size;return this.preferHtml&&(e-=1),new("circle"===app_EdgeHandlerConfig.handleShape?app_node_EllipseShape:app_RectangleShape.A)(new app_Rectangle.A(0,0,e,e),app_HandleConfig.fillColor,app_HandleConfig.strokeColor)}createLabelHandleShape(){if(this.labelHandleImage){const t=new app_ImageShape.A(new app_Rectangle.A(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return t.preserveImageAspect=!1,t}const t=app_HandleConfig.labelSize;return new app_RectangleShape.A(new app_Rectangle.A(0,0,t,t),app_HandleConfig.labelFillColor,app_HandleConfig.strokeColor)}initBend(t,e){this.preferHtml?(t.dialect=app_Constants.$p.STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!==app_Constants.$p.SVG?app_Constants.$p.MIXEDHTML:app_Constants.$p.SVG,t.init(this.graph.getView().getOverlayPane())),app_InternalEvent.A.redirectMouseEvents(t.node,this.graph,this.state,null,null,null,e),app_Client.A.IS_TOUCH&&t.node.setAttribute("pointer-events","none")}getHandleForEvent(t){let e=null;const i=(0,app_EventUtils.Er)(t.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&i>0?new app_Rectangle.A(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;let n=Number.POSITIVE_INFINITY;function l(e){if(e&&e.bounds&&e.node&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility&&(t.isSource(e)||s&&(0,app_mathUtils.HY)(e.bounds,s))){const i=t.getGraphX()-e.bounds.getCenterX(),s=t.getGraphY()-e.bounds.getCenterY(),l=i*i+s*s;if(l<=n)return n=l,!0}return!1}if(this.isCustomHandleEvent(t)&&this.customHandles)for(let t=this.customHandles.length-1;t>=0;t--)if(l(this.customHandles[t].shape))return app_InternalEvent.A.CUSTOM_HANDLE-t;(t.isSource(this.state.text)||l(this.labelShape))&&(e=app_InternalEvent.A.LABEL_HANDLE);for(let t=0;t<this.bends.length;t+=1)l(this.bends[t])&&(e=t);if(this.virtualBends&&this.isAddVirtualBendEvent(t))for(let t=0;t<this.virtualBends.length;t+=1)l(this.virtualBends[t])&&(e=app_InternalEvent.A.VIRTUAL_HANDLE-t);return e}isAddVirtualBendEvent(t){return!0}isCustomHandleEvent(t){return!0}mouseDown(t,e){const i=this.getHandleForEvent(e);if(null!==i&&this.bends[i]){const t=this.bends[i].bounds;t&&(this.snapPoint=new app_Point.A(t.getCenterX(),t.getCenterY()))}if(app_EdgeHandlerConfig.addBendOnShiftClickEnabled&&null===i&&this.isAddPointEvent(e.getEvent()))this.addPoint(this.state,e.getEvent()),e.consume();else if(null!==i&&!e.isConsumed()&&this.graph.isEnabled()){const t=e.getCell();app_EdgeHandlerConfig.removeBendOnShiftClickEnabled&&this.isRemovePointEvent(e.getEvent())?this.removePoint(this.state,i):(i!==app_InternalEvent.A.LABEL_HANDLE||t&&this.graph.isLabelMovable(t))&&(this.virtualBends&&i<=app_InternalEvent.A.VIRTUAL_HANDLE&&(0,app_styleUtils.Ko)(this.virtualBends[app_InternalEvent.A.VIRTUAL_HANDLE-i].node,100),this.start(e.getX(),e.getY(),i)),e.consume()}}start(t,e,i){if(this.startX=t,this.startY=e,this.isSource=0!==this.bends.length&&0===i,this.isTarget=0!==this.bends.length&&i===this.bends.length-1,this.isLabel=i===app_InternalEvent.A.LABEL_HANDLE,this.isSource||this.isTarget){const{cell:t}=this.state,e=t.getTerminal(this.isSource);(null==e&&this.graph.isTerminalPointMovable(t,this.isSource)||null!=e&&this.graph.isCellDisconnectable(t,e,this.isSource))&&(this.index=i)}else this.index=i;if(null!==this.index&&this.index<=app_InternalEvent.A.CUSTOM_HANDLE&&this.index>app_InternalEvent.A.VIRTUAL_HANDLE&&null!=this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)t!==app_InternalEvent.A.CUSTOM_HANDLE-this.index&&this.customHandles[t].setVisible(!1)}clonePreviewState(t,e){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.getGridSize()*this.graph.getView().scale/2}updateHint(t,e){}removeHint(){}roundLength(t){return Math.round(t)}isSnapToTerminalsEvent(t){return this.snapToTerminals&&!(0,app_EventUtils.CA)(t.getEvent())}getPointForEvent(t){const e=this.graph.getView(),{scale:i}=e,s=new app_Point.A(this.roundLength(t.getGraphX()/i)*i,this.roundLength(t.getGraphY()/i)*i),n=this.getSnapToTerminalTolerance();let l=!1,a=!1;if(n>0&&this.isSnapToTerminalsEvent(t)){const t=t=>{if(t){const{x:e}=t;Math.abs(s.x-e)<n&&(s.x=e,l=!0);const{y:i}=t;Math.abs(s.y-i)<n&&(s.y=i,a=!0)}},i=i=>{i&&t(new app_Point.A(e.getRoutingCenterX(i),e.getRoutingCenterY(i)))};i(this.state.getVisibleTerminalState(!0)),i(this.state.getVisibleTerminalState(!1));for(let e=0;e<this.state.absolutePoints.length;e+=1)t(this.state.absolutePoints[e])}if(this.graph.isGridEnabledEvent(t.getEvent())){const t=e.translate;l||(s.x=(this.graph.snap(s.x/i-t.x)+t.x)*i),a||(s.y=(this.graph.snap(s.y/i-t.y)+t.y)*i)}return s}getPreviewTerminalState(t){if(this.constraintHandler.update(t,this.isSource,!0,t.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus&&this.constraintHandler.currentConstraint){this.marker.highlight&&this.marker.highlight.shape&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");const t=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)),!this.isSource),e=t?t.cell:null,i=this.isSource?this.constraintHandler.currentFocus.cell:e,s=this.isSource?e:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(i,s);let n=null;return null===this.error&&(n=this.constraintHandler.currentFocus),(null!==this.error||n&&!this.isCellEnabled(n.cell))&&this.constraintHandler.reset(),n}if(!this.graph.isIgnoreTerminalEvent(t.getEvent())){this.marker.process(t);const e=this.marker.getValidState();return e&&!this.isCellEnabled(e.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}return this.marker.reset(),null}getPreviewPoints(t,e){const i=this.state.cell.getGeometry();if(!i)return null;let s=(i.points||[]).slice();const n=new app_Point.A(t.x,t.y);let l=null;if(this.isSource||this.isTarget||null===this.index)this.graph.isResetEdgesOnConnect()&&(s=[]);else{if(this.convertPoint(n,!1),this.index<=app_InternalEvent.A.VIRTUAL_HANDLE&&s.splice(app_InternalEvent.A.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(let e=0;e<this.bends.length;e+=1)if(e!==this.index){const i=this.bends[e];i&&(0,app_mathUtils.gR)(i.bounds,t.x,t.y)&&(this.index<=app_InternalEvent.A.VIRTUAL_HANDLE?s.splice(app_InternalEvent.A.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),l=s)}if(!l&&this.straightRemoveEnabled&&(!e||!(0,app_EventUtils.CA)(e.getEvent()))){const e=this.graph.getEventTolerance()*this.graph.getEventTolerance(),i=this.state.absolutePoints.slice();i[this.index]=t;const n=this.state.getVisibleTerminalState(!0);if(null!=n){const t=this.graph.getConnectionConstraint(this.state,n,!0);null!=t&&null!=this.graph.getConnectionPoint(n,t)||(i[0]=new app_Point.A(n.view.getRoutingCenterX(n),n.view.getRoutingCenterY(n)))}const o=this.state.getVisibleTerminalState(!1);if(null!=o){const t=this.graph.getConnectionConstraint(this.state,o,!1);null!=t&&null!=this.graph.getConnectionPoint(o,t)||(i[i.length-1]=new app_Point.A(o.view.getRoutingCenterX(o),o.view.getRoutingCenterY(o)))}a=this.index,r=t,a>0&&a<i.length-1&&(0,app_mathUtils.E8)(i[a-1].x,i[a-1].y,i[a+1].x,i[a+1].y,r.x,r.y)<e&&(s.splice(a-1,1),l=s)}}null==l&&this.index>app_InternalEvent.A.VIRTUAL_HANDLE&&(s[this.index-1]=n)}var a,r;return null!=l?l:s}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,app_styleUtils.A3)(this.graph.container),i=t.getEvent(),s=(0,app_EventUtils.El)(i),n=(0,app_EventUtils.xJ)(i),l=document.documentElement,a=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),r=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-a,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-r;return this.outlineConnect&&!(0,app_EventUtils.RT)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,app_EventUtils.CA)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updatePreviewState(t,e,i,s,n=!1){const l=this.isSource?i:this.state.getVisibleTerminalState(!0),a=this.isTarget?i:this.state.getVisibleTerminalState(!1);let r=this.graph.getConnectionConstraint(t,l,!0),o=this.graph.getConnectionConstraint(t,a,!1),h=this.constraintHandler.currentConstraint;if(null==h&&n&&(null!=i?(s.isSource(this.marker.highlight.shape)&&(e=new app_Point.A(s.getGraphX(),s.getGraphY())),h=this.graph.getOutlineConstraint(e,i,s),this.constraintHandler.setFocus(s,i,this.isSource),this.constraintHandler.currentConstraint=h,this.constraintHandler.currentPoint=e):h=new app_other_ConnectionConstraint(null)),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const t=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=n?app_Constants.eX:"transparent",this.marker.highlight.shape.strokeWidth=app_Constants.XZ/t/t,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const e=s.getCell();this.marker.highlight.shape.stroke=e&&e.isConnectable()&&this.marker.getValidState()!==s.getState()?"transparent":app_Constants.Vj,this.marker.highlight.shape.strokeWidth=app_Constants.es/t/t,this.marker.highlight.repaint()}}this.isSource?r=h:this.isTarget&&(o=h),(this.isSource||this.isTarget)&&(null!=h&&null!=h.point?(t.style[this.isSource?"exitX":"entryX"]=h.point.x,t.style[this.isSource?"exitY":"entryY"]=h.point.y):(delete t.style[this.isSource?"exitX":"entryX"],delete t.style[this.isSource?"exitY":"entryY"])),t.setVisibleTerminalState(l,!0),t.setVisibleTerminalState(a,!1),this.isSource&&null==l||t.view.updateFixedTerminalPoint(t,l,!0,r),this.isTarget&&null==a||t.view.updateFixedTerminalPoint(t,a,!1,o),(this.isSource||this.isTarget)&&null==i&&(t.setAbsoluteTerminalPoint(e,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.isAllowDanglingEdges()?null:"")),t.view.updatePoints(t,this.points,l,a),t.view.updateFloatingTerminalPoints(t,l,a)}mouseMove(t,e){if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(e),this.error=null,!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,app_EventUtils.RT)(e.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=app_InternalEvent.A.CUSTOM_HANDLE&&this.index>app_InternalEvent.A.VIRTUAL_HANDLE)null!=this.customHandles&&(this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-this.index].positionChanged(),null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="none"));else if(this.isLabel&&this.label)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,e);let t=this.isSource||this.isTarget?this.getPreviewTerminalState(e):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?this.currentPoint=this.constraintHandler.currentPoint.clone():this.outlineConnect&&((this.isSource||this.isTarget)&&this.isOutlineConnectEvent(e)?t=this.marker.highlight.state:null!=t&&t!==e.getState()&&e.getCell()?.isConnectable()&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),t=null)),null==t||this.isCellEnabled(t.cell)||(t=null,this.marker.reset()),this.currentPoint){const i=this.clonePreviewState(this.currentPoint,null!=t?t.cell:null);this.updatePreviewState(i,this.currentPoint,t,e,this.outline);const s=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(s),this.abspoints=i.absolutePoints,this.active=!0,this.updateHint(e,this.currentPoint)}}this.drawPreview(),app_InternalEvent.A.consume(e.getEvent()),e.consume()}}mouseUp(t,e){if(null!=this.index&&null!=this.marker){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="");let t=this.state.cell;const{index:i}=this;if(this.index=null,e.getX()!==this.startX||e.getY()!==this.startY){const s=!this.graph.isIgnoreTerminalEvent(e.getEvent())&&this.graph.isCloneEvent(e.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(i<=app_InternalEvent.A.CUSTOM_HANDLE&&i>app_InternalEvent.A.VIRTUAL_HANDLE){if(null!=this.customHandles){const t=this.graph.getDataModel();t.beginUpdate();try{this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i].execute(e),null!=this.shape&&null!=this.shape.node&&(this.shape.apply(this.state),this.shape.redraw())}finally{t.endUpdate()}}}else if(this.isLabel&&this.label)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){let i=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell),!i&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!==this.marker.highlight.shape.stroke&&"white"!==this.marker.highlight.shape.stroke&&(i=this.marker.validState.cell),i){const n=this.graph.getDataModel(),l=t.getParent();n.beginUpdate();try{if(s){let e=t.getGeometry();const i=this.graph.cloneCell(t);n.add(l,i,l.getChildCount()),null!=e&&(e=e.clone(),n.setGeometry(i,e));const s=t.getTerminal(!this.isSource);this.graph.connectCell(i,s,!this.isSource),t=i}t=this.connect(t,i,this.isSource,s,e)}finally{n.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){const e=this.abspoints[this.isSource?0:this.abspoints.length-1];e.x=this.roundLength(e.x/this.graph.view.scale-this.graph.view.translate.x),e.y=this.roundLength(e.y/this.graph.view.scale-this.graph.view.translate.y);const i=t.getParent(),n=i?this.graph.getView().getState(i):null;null!=n&&(e.x-=n.origin.x,e.y-=n.origin.y),e.x-=this.graph.getPanDx()/this.graph.view.scale,e.y-=this.graph.getPanDy()/this.graph.view.scale,t=this.changeTerminalPoint(t,e,this.isSource,s)}}else this.active?t=this.changePoints(t,this.points,s):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(e.getEvent())&&this.graph.selectCellForEvent(this.state.cell,e.getEvent());null!=this.marker&&(this.reset(),t!==this.state.cell&&this.graph.setSelectionCell(t)),e.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.points=[],this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.marker&&this.marker.reset(),this.constraintHandler.reset(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].reset();this.setPreviewColor(app_EdgeHandlerConfig.selectionColor),this.removeHint(),this.redraw()}setPreviewColor(t){this.shape.stroke=t}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x),t.y=Math.round(t.y/i-s.y);const n=this.state.cell.getParent(),l=n?this.graph.getView().getState(n):n;return l&&(t.x-=l.origin.x,t.y-=l.origin.y),t}moveLabel(t,e,i){const s=this.graph.getDataModel();let n=t.cell.getGeometry();if(null!=n){const{scale:l}=this.graph.getView();if(n=n.clone(),n.relative){let s=this.graph.getView().getRelativePoint(t,e,i);n.x=Math.round(1e4*s.x)/1e4,n.y=Math.round(s.y),n.offset=new app_Point.A(0,0),s=this.graph.view.getPoint(t,n),n.offset=new app_Point.A(Math.round((e-s.x)/l),Math.round((i-s.y)/l))}else{const s=t.absolutePoints,a=s[0],r=s[s.length-1];if(null!=a&&null!=r){const t=a.x+(r.x-a.x)/2,s=a.y+(r.y-a.y)/2;n.offset=new app_Point.A(Math.round((e-t)/l),Math.round((i-s)/l)),n.x=0,n.y=0}}s.setGeometry(t.cell,n)}}connect(t,e,i,s,n){return t.getParent(),this.graph.batchUpdate((()=>{let s=this.constraintHandler.currentConstraint;null==s&&(s=new app_other_ConnectionConstraint(null)),this.graph.connectCell(t,e,i,s)})),t}changeTerminalPoint(t,e,i,s){const n=this.graph.getDataModel();return n.batchUpdate((()=>{if(s){const e=t.getParent(),s=t.getTerminal(!i);t=this.graph.cloneCell(t),n.add(e,t,e.getChildCount()),n.setTerminal(t,s,!i)}let l=t.getGeometry();null!=l&&(l=l.clone(),l.setTerminalPoint(e,i),n.setGeometry(t,l),this.graph.connectCell(t,null,i,new app_other_ConnectionConstraint(null)))})),t}changePoints(t,e,i){const s=this.graph.getDataModel();return s.batchUpdate((()=>{if(i){const e=t.getParent(),i=t.getTerminal(!0),n=t.getTerminal(!1);t=this.graph.cloneCell(t),s.add(e,t,e.getChildCount()),s.setTerminal(t,i,!0),s.setTerminal(t,n,!1)}let n=t.getGeometry();null!=n&&(n=n.clone(),n.points=e,s.setGeometry(t,n))})),t}addPoint(t,e){const i=(0,app_styleUtils.ce)(this.graph.container,(0,app_EventUtils.El)(e),(0,app_EventUtils.xJ)(e)),s=this.graph.isGridEnabledEvent(e);this.convertPoint(i,s),this.addPointAt(t,i.x,i.y),app_InternalEvent.A.consume(e)}addPointAt(t,e,i){let s=t.cell.getGeometry();const n=new app_Point.A(e,i);if(null!=s){s=s.clone();const e=this.graph.view.translate,i=this.graph.view.scale;let l=new app_Point.A(e.x*i,e.y*i);const a=this.state.cell.getParent();if(a&&a.isVertex()){const t=this.graph.view.getState(a);t&&(l=new app_Point.A(t.x,t.y))}const r=(0,app_mathUtils.JQ)(t,n.x*i+l.x,n.y*i+l.y);null==s.points?s.points=[n]:s.points.splice(r,0,n),this.graph.getDataModel().setGeometry(t.cell,s),this.refresh(),this.redraw()}}removePoint(t,e){if(e>0&&e<this.abspoints.length-1){let i=this.state.cell.getGeometry();null!=i&&null!=i.points&&(i=i.clone(),(i.points||[]).splice(e-1,1),this.graph.getDataModel().setGeometry(t.cell,i),this.refresh(),this.redraw())}}getHandleFillColor(t){const e=0===t,{cell:i}=this.state,s=i.getTerminal(e);let n=app_HandleConfig.fillColor;return null!=s&&!this.graph.isCellDisconnectable(i,s,e)||null==s&&!this.graph.isTerminalPointMovable(i,e)?n=app_Constants.J8:null!=s&&this.graph.isCellDisconnectable(i,s,e)&&(n=app_EdgeHandlerConfig.connectFillColor),n}redraw(t){this.abspoints=this.state.absolutePoints.slice();const e=this.state.cell.getGeometry();if(e){const t=e.points;if(null!=this.bends&&this.bends.length>0&&null!=t){null==this.points&&(this.points=[]);for(let e=1;e<this.bends.length-1;e+=1)null!=this.bends[e]&&null!=this.abspoints[e]&&(this.points[e-1]=t[e-1])}}this.drawPreview(),t||this.redrawHandles()}redrawHandles(){const{cell:t}=this.state;let e=this.labelShape.bounds;this.label=new app_Point.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new app_Rectangle.A(Math.round(this.label.x-e.width/2),Math.round(this.label.y-e.height/2),e.width,e.height);const i=this.graph.getLabel(t);if(this.labelShape.visible=null!=i&&i.length>0&&this.graph.isLabelMovable(t),null!=this.bends&&this.bends.length>0){const t=this.abspoints.length-1,i=this.abspoints[0],s=i.x,n=i.y;e=this.bends[0].bounds,this.bends[0].bounds=new app_Rectangle.A(Math.floor(s-e.width/2),Math.floor(n-e.height/2),e.width,e.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);const l=this.abspoints[t],a=l.x,r=l.y,o=this.bends.length-1;e=this.bends[o].bounds,this.bends[o].bounds=new app_Rectangle.A(Math.floor(a-e.width/2),Math.floor(r-e.height/2),e.width,e.height),this.bends[o].fill=this.getHandleFillColor(o),this.bends[o].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[o].bounds),this.redrawInnerBends(i,l)}if(this.virtualBends&&this.virtualBends.length>0){let t=this.abspoints[0];for(let e=0;e<this.virtualBends.length;e+=1)if(null!=this.virtualBends[e]&&null!=this.abspoints[e+1]){const i=this.abspoints[e+1],s=this.virtualBends[e],n=t.x+(i.x-t.x)/2,l=t.y+(i.y-t.y)/2;s.bounds&&(s.bounds=new app_Rectangle.A(Math.floor(n-s.bounds.width/2),Math.floor(l-s.bounds.height/2),s.bounds.width,s.bounds.height),s.redraw()),(0,app_styleUtils.Ko)(s.node,app_EdgeHandlerConfig.virtualBendOpacity),t=i,this.manageLabelHandle&&this.checkLabelHandle(s.bounds)}}if(this.labelShape.redraw(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}setHandlesVisible(t){for(let e=0;e<this.bends.length;e+=1)this.bends[e].node.style.display=t?"":"none";if(this.virtualBends)for(let e=0;e<this.virtualBends.length;e+=1)this.virtualBends[e].node.style.display=t?"":"none";if(this.labelShape.node.style.display=t?"":"none",this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}redrawInnerBends(t,e){for(let t=1;t<this.bends.length-1;t+=1)if(null!=this.bends[t])if(null!=this.abspoints[t]){const{x:e}=this.abspoints[t],{y:i}=this.abspoints[t],s=this.bends[t].bounds;if(this.bends[t].node.style.visibility="visible",this.bends[t].bounds=new app_Rectangle.A(Math.round(e-s.width/2),Math.round(i-s.height/2),s.width,s.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[t].bounds);else if(null==this.handleImage&&this.labelShape.visible&&(0,app_mathUtils.HY)(this.bends[t].bounds,this.labelShape.bounds)){const s=app_HandleConfig.size+3,n=s;this.bends[t].bounds=new app_Rectangle.A(Math.round(e-s/2),Math.round(i-n/2),s,n)}this.bends[t].redraw()}else this.bends[t].destroy()}checkLabelHandle(t){const e=this.labelShape.bounds;(0,app_mathUtils.HY)(t,e)&&(t.getCenterY()<e.getCenterY()?e.y=t.y+t.height:e.y=t.y-e.height)}drawPreview(){try{if(this.isLabel){const t=this.labelShape.bounds,e=new app_Rectangle.A(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);t.equals(e)||(this.labelShape.bounds=e,this.labelShape.redraw())}null==this.shape||app_equalPoints(this.shape.points,this.abspoints)||(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokeWidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.updateParentHighlight()}catch(t){}}refresh(){null!=this.state&&(this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.destroyBends(this.bends),this.bends=this.createBends(),this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node))}isDestroyed(){return null==this.shape}destroyBends(t){if(null!=t)for(let e=0;e<t.length;e+=1)null!=t[e]&&t[e].destroy()}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.marker.destroy(),this.marker=null,this.shape.destroy(),this.shape=null,this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.labelShape.destroy(),this.labelShape=null,this.constraintHandler.onDestroy(),this.constraintHandler=null,this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=[]),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=[]),this.destroyBends(this.bends),this.bends=[],this.removeHint()}}class app_EdgeHandlerCellMarker extends app_cell_CellMarker{constructor(t,e,i=app_Constants.Vj,s=app_Constants.G7,n=app_Constants.ir){super(t,i,s,n),this.getCell=t=>{let e=super.getCell(t);if(e!==this.edgeHandler.state.cell&&e||!this.edgeHandler.currentPoint||(e=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),e&&!e.isConnectable()){const t=e.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.graph.isSwimlane(e)&&this.edgeHandler.currentPoint&&this.graph.hitsSwimlaneContent(e,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(e)||e===this.edgeHandler.state.cell||e&&!this.edgeHandler.graph.connectableEdges&&e.isEdge()||this.edgeHandler.state.cell.isAncestor(e))&&(e=null),e&&!e.isConnectable()&&(e=null),e},this.isValidState=t=>{const e=this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource),i=this.edgeHandler.graph.view.getState(e),s=this.edgeHandler.graph.view.getTerminalPort(t,i,!this.edgeHandler.isSource),n=s?s.cell:null,l=this.edgeHandler.isSource?t.cell:n,a=this.edgeHandler.isSource?n:t.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(l,a),!this.edgeHandler.error},this.edgeHandler=e}}const app_handler_EdgeHandler=app_EdgeHandler;class app_VertexHandler{isRotationEnabled(){return app_VertexHandlerConfig.rotationEnabled}constructor(t){this.sizers=[],this.singleSizer=!1,this.index=null,this.allowHandleBoundsCheck=!0,this.handleImage=null,this.handlesVisible=!0,this.tolerance=0,this.parentHighlightEnabled=!1,this.rotationRaster=!0,this.rotationCursor="crosshair",this.livePreview=!1,this.movePreviewToFront=!1,this.manageSizers=!1,this.constrainGroupByChildren=!1,this.rotationHandleVSpacing=-16,this.horizontalOffset=0,this.verticalOffset=0,this.minBounds=null,this.x0=0,this.y0=0,this.customHandles=[],this.inTolerance=!1,this.startX=0,this.startY=0,this.rotationShape=null,this.currentAlpha=null,this.startAngle=0,this.startDist=0,this.ghostPreview=null,this.livePreviewActive=!1,this.childOffsetX=0,this.childOffsetY=0,this.parentState=null,this.parentHighlight=null,this.unscaledBounds=null,this.preview=null,this.labelShape=null,this.edgeHandlers=[],this.EMPTY_POINT=new app_Point.A,this.state=t,this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new app_Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=app_Constants.$p.SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=this.state.style.rotation??0,this.selectionBorder.init(this.graph.getView().getOverlayPane()),app_InternalEvent.A.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(app_Constants.Lm.MOVABLE_VERTEX);const e=this.graph.getPlugin("SelectionHandler");if(e&&(e.maxCells<=0||this.graph.getSelectionCount()<e.maxCells)){const t=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){let e=0;t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",e++)),this.sizers.push(this.createSizer("n-resize",e++)),this.sizers.push(this.createSizer("ne-resize",e++)),this.sizers.push(this.createSizer("w-resize",e++)),this.sizers.push(this.createSizer("e-resize",e++)),this.sizers.push(this.createSizer("sw-resize",e++)),this.sizers.push(this.createSizer("s-resize",e++))),this.sizers.push(this.createSizer("se-resize",e++)));const i=this.state.cell.getGeometry();null==i||i.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(app_Constants.Lm.LABEL_HANDLE,app_InternalEvent.A.LABEL_HANDLE,app_HandleConfig.labelSize,app_HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(app_Constants.Lm.MOVABLE_VERTEX,app_InternalEvent.A.LABEL_HANDLE,void 0,app_HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,app_InternalEvent.A.ROTATION_HANDLE,app_HandleConfig.size+3,app_HandleConfig.fillColor),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds(),this.escapeHandler=(t,e)=>{this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(app_InternalEvent.A.ESCAPE,this.escapeHandler)}isRotationHandleVisible(){const t=this.graph.getPlugin("SelectionHandler"),e=!t||t.maxCells<=0||this.graph.getSelectionCount()<t.maxCells;return this.graph.isEnabled()&&this.isRotationEnabled()&&this.graph.isCellRotatable(this.state.cell)&&e}isConstrainedEvent(t){return(0,app_EventUtils.RT)(t.getEvent())||"fixed"===this.state.style.aspect}isCenteredEvent(t,e){return!1}createCustomHandles(){return[]}updateMinBounds(){const t=this.graph.getChildCells(this.state.cell);if(t.length>0&&(this.minBounds=this.graph.view.getBounds(t),this.minBounds)){const t=this.state.view.scale,e=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=t,this.minBounds.y/=t,this.minBounds.width/=t,this.minBounds.height/=t,this.x0=this.state.x/t-e.x,this.y0=this.state.y/t-e.y}}getSelectionBounds(t){return new app_Rectangle.A(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))}createParentHighlightShape(t){return this.createSelectionShape(t)}createSelectionShape(t){const e=new app_RectangleShape.A(app_Rectangle.A.fromRectangle(t),app_Constants.x3,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}getSelectionColor(){return app_VertexHandlerConfig.selectionColor}getSelectionStrokeWidth(){return app_VertexHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return app_VertexHandlerConfig.selectionDashed}createSizer(t,e,i=app_HandleConfig.size,s=app_HandleConfig.fillColor){const n=new app_Rectangle.A(0,0,i,i),l=this.createSizerShape(n,e,s);return l.bounds&&l.isHtmlAllowed()&&this.state.text&&this.state.text.node.parentNode===this.graph.container?(l.bounds.height-=1,l.bounds.width-=1,l.dialect=app_Constants.$p.STRICTHTML,l.init(this.graph.container)):(l.dialect=this.graph.dialect!==app_Constants.$p.SVG?app_Constants.$p.MIXEDHTML:app_Constants.$p.SVG,l.init(this.graph.getView().getOverlayPane())),app_InternalEvent.A.redirectMouseEvents(l.node,this.graph,this.state),this.graph.isEnabled()&&l.setCursor(t),this.isSizerVisible(e)||(l.visible=!1),l}isSizerVisible(t){return!0}createSizerShape(t,e,i=app_HandleConfig.fillColor){if(this.handleImage){t=new app_Rectangle.A(t.x,t.y,this.handleImage.width,this.handleImage.height);const e=new app_ImageShape.A(t,this.handleImage.src);return e.preserveImageAspect=!1,e}const s=app_HandleConfig.strokeColor;return e===app_InternalEvent.A.ROTATION_HANDLE?new app_node_EllipseShape(t,i,s):new app_RectangleShape.A(t,i,s)}moveSizerTo(t,e,i){t&&t.bounds&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(i-t.bounds.height/2),t.node&&"none"!==t.node.style.display&&t.redraw())}getHandleForEvent(t){const e=(0,app_EventUtils.Er)(t.getEvent())?1:this.tolerance,i=this.allowHandleBoundsCheck&&e>0?new app_Rectangle.A(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null,s=e=>{const s=e&&e.constructor!==app_ImageShape.A&&this.allowHandleBoundsCheck?e.strokeWidth+e.svgStrokeTolerance:null,n=s?new app_Rectangle.A(t.getGraphX()-Math.floor(s/2),t.getGraphY()-Math.floor(s/2),s,s):i;return e&&e.bounds&&(t.isSource(e)||n&&(0,app_mathUtils.HY)(e.bounds,n)&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility)};if(s(this.rotationShape))return app_InternalEvent.A.ROTATION_HANDLE;if(s(this.labelShape))return app_InternalEvent.A.LABEL_HANDLE;for(let t=0;t<this.sizers.length;t+=1)if(s(this.sizers[t]))return t;if(null!=this.customHandles&&this.isCustomHandleEvent(t))for(let t=this.customHandles.length-1;t>=0;t--)if(s(this.customHandles[t].shape))return app_InternalEvent.A.CUSTOM_HANDLE-t;return null}isCustomHandleEvent(t){return!0}mouseDown(t,e){if(!e.isConsumed()&&this.graph.isEnabled()){const t=this.getHandleForEvent(e);t&&(this.start(e.getGraphX(),e.getGraphY(),t),e.consume())}}isLivePreviewBorder(){return this.state.shape&&this.state.shape.fill===app_Constants.x3&&this.state.shape.stroke===app_Constants.x3}start(t,e,i){if(this.livePreviewActive=this.livePreview&&0===this.state.cell.getChildCount(),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=t,this.startY=e,this.index<=app_InternalEvent.A.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{const{model:t}=this.state.view.graph,e=this.state.cell.getParent();if(this.state.view.currentRoot!==e&&e&&(e.isVertex()||e.isEdge())&&(this.parentState=this.state.view.graph.view.getState(e)),this.selectionBorder.node.style.display=i===app_InternalEvent.A.ROTATION_HANDLE?"inline":"none",this.livePreviewActive&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),app_Client.A.IS_SVG&&0!=(this.state.style.rotation??0)||null==this.state.text||this.state.text.node.parentNode!==this.graph.container?(this.preview.dialect=app_Constants.$p.SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=app_Constants.$p.STRICTHTML,this.preview.init(this.graph.container))),i===app_InternalEvent.A.ROTATION_HANDLE){const t=this.getRotationHandlePosition(),e=t.x-this.state.getCenterX(),i=t.y-this.state.getCenterY();this.startAngle=0!==e?180*Math.atan(i/e)/Math.PI+90:0,this.startDist=Math.sqrt(e*e+i*i)}if(this.livePreviewActive){this.hideSizers(),i===app_InternalEvent.A.ROTATION_HANDLE&&this.rotationShape?this.rotationShape.node.style.display="":i===app_InternalEvent.A.LABEL_HANDLE&&this.labelShape?this.labelShape.node.style.display="":this.sizers[i]?this.sizers[i].node.style.display="":i<=app_InternalEvent.A.CUSTOM_HANDLE&&this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i].setVisible(!0);const t=this.state.cell.getEdges();this.edgeHandlers=[];const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i]);s&&this.edgeHandlers.push(s)}}}}createGhostPreview(){const t=this.graph.cellRenderer.createShape(this.state);return t.init(this.graph.view.getOverlayPane()),t.scale=this.state.view.scale,t.bounds=this.bounds,t.outline=!0,t}setHandlesVisible(t){this.handlesVisible=t;for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].node.style.display=t?"":"none";for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(t){this.inTolerance&&null!==this.startX&&null!==this.startY&&((0,app_EventUtils.Er)(t.getEvent())||Math.abs(t.getGraphX()-this.startX)>this.graph.getEventTolerance()||Math.abs(t.getGraphY()-this.startY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}updateHint(t){}removeHint(){}roundAngle(t){return Math.round(10*t)/10}roundLength(t){return Math.round(100*t)/100}mouseMove(t,e){e.isConsumed()||null==this.index?!this.graph.isMouseDown&&this.getHandleForEvent(e)&&e.consume(!1):(this.checkTolerance(e),this.inTolerance||(this.index<=app_InternalEvent.A.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokeWidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.movePreviewToFront&&this.moveToFront(),this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-this.index].positionChanged())):this.index===app_InternalEvent.A.LABEL_HANDLE?this.moveLabel(e):(this.index===app_InternalEvent.A.ROTATION_HANDLE?this.rotateVertex(e):this.resizeVertex(e),this.updateHint(e))),e.consume())}isGhostPreview(){return this.state.cell.getChildCount()>0}moveLabel(t){const e=new app_Point.A(t.getGraphX(),t.getGraphY()),i=this.graph.view.translate,{scale:s}=this.graph.view;this.graph.isGridEnabledEvent(t.getEvent())&&(e.x=(this.graph.snap(e.x/s-i.x)+i.x)*s,e.y=(this.graph.snap(e.y/s-i.y)+i.y)*s);const n=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],e.x,e.y)}rotateVertex(t){const e=new app_Point.A(t.getGraphX(),t.getGraphY());let i=this.state.x+this.state.width/2-e.x,s=this.state.y+this.state.height/2-e.y;if(this.currentAlpha=0!==i?180*Math.atan(s/i)/Math.PI+90:s<0?180:0,i>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(t.getEvent())){let t;i=e.x-this.state.getCenterX(),s=e.y-this.state.getCenterY();const n=Math.sqrt(i*i+s*s);t=n-this.startDist<2?15:n-this.startDist<25?5:1,this.currentAlpha=Math.round(this.currentAlpha/t)*t}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(t){const e=new app_Point.A(this.state.getCenterX(),this.state.getCenterY()),i=(0,app_mathUtils.eh)(this.state.style.rotation??0),s=new app_Point.A(t.getGraphX(),t.getGraphY()),n=this.graph.view.translate,{scale:l}=this.graph.view;let a=Math.cos(-i),r=Math.sin(-i),o=s.x-this.startX,h=s.y-this.startY;const p=r*o+a*h;o=a*o-r*h,h=p;const d=this.state.cell.getGeometry();if(d&&null!==this.index&&(this.unscaledBounds=this.union(d,o/l,h/l,this.index,this.graph.isGridEnabledEvent(t.getEvent()),1,new app_Point.A(0,0),this.isConstrainedEvent(t),this.isCenteredEvent(this.state,t))),d&&!d.relative){let t=this.graph.getMaximumGraphBounds();if(null!=t&&null!=this.parentState&&(t=app_Rectangle.A.fromRectangle(t),t.x-=(this.parentState.x-n.x*l)/l,t.y-=(this.parentState.y-n.y*l)/l),this.graph.isConstrainChild(this.state.cell)){let e=this.graph.getCellContainmentArea(this.state.cell);if(null!=e){const i=this.graph.getOverlap(this.state.cell);i>0&&(e=app_Rectangle.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),t?(t=app_Rectangle.A.fromRectangle(t),t.intersect(e)):t=e}}t&&this.unscaledBounds&&(this.unscaledBounds.x<t.x&&(this.unscaledBounds.width-=t.x-this.unscaledBounds.x,this.unscaledBounds.x=t.x),this.unscaledBounds.y<t.y&&(this.unscaledBounds.height-=t.y-this.unscaledBounds.y,this.unscaledBounds.y=t.y),this.unscaledBounds.x+this.unscaledBounds.width>t.x+t.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-t.x-t.width),this.unscaledBounds.y+this.unscaledBounds.height>t.y+t.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-t.y-t.height))}if(this.unscaledBounds){const s=this.bounds;this.bounds=new app_Rectangle.A((this.parentState?this.parentState.x:n.x*l)+this.unscaledBounds.x*l,(this.parentState?this.parentState.y:n.y*l)+this.unscaledBounds.y*l,this.unscaledBounds.width*l,this.unscaledBounds.height*l),d&&d.relative&&this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),a=Math.cos(i),r=Math.sin(i);const p=new app_Point.A(this.bounds.getCenterX(),this.bounds.getCenterY());o=p.x-e.x,h=p.y-e.y;const c=a*o-r*h-o,u=r*o+a*h-h,g=this.bounds.x-this.state.x,_=this.bounds.y-this.state.y,f=a*g-r*_,C=r*g+a*_;this.bounds.x+=c,this.bounds.y+=u,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+c/l),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+u/l),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.state.cell.isCollapsed()||0===c&&0===u?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+f,this.childOffsetY=this.state.y-this.bounds.y+C),s.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(t),null!=this.preview?this.drawPreview():this.updateParentHighlight())}}updateLivePreview(t){const{scale:e}=this.graph.view,i=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new app_Point.A(this.state.x/e-i.x,this.state.y/e-i.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;let n=this.state.absoluteOffset;n=new app_Point.A(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;const l=this.state.cell.getGeometry();if(null!=l){const t=l.offset||this.EMPTY_POINT;null==t||l.relative||(this.state.absoluteOffset.x=this.state.view.scale*t.x,this.state.absoluteOffset.y=this.state.view.scale*t.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.movePreviewToFront&&this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text&&this.state.text.node&&this.state.text.node.nextSibling||this.state.shape&&this.state.shape.node&&this.state.shape.node.nextSibling&&(!this.state.text||this.state.shape.node.nextSibling!==this.state.text.node))&&(this.state.shape&&this.state.shape.node&&this.state.shape.node.parentNode&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text&&this.state.text.node&&this.state.text.node.parentNode&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(t,e){if(null!=this.index&&null!=this.state){const t=new app_Point.A(e.getGraphX(),e.getGraphY()),{index:i}=this;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.batchUpdate((()=>{if(i<=app_InternalEvent.A.CUSTOM_HANDLE){if(null!=this.customHandles){const t=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i].active=!1,this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i].execute(e),null!=this.customHandles&&null!=this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i]&&(this.state.style=t,this.customHandles[app_InternalEvent.A.CUSTOM_HANDLE-i].positionChanged())}}else if(i===app_InternalEvent.A.ROTATION_HANDLE)if(null!=this.currentAlpha){const t=this.currentAlpha-(this.state.style.rotation??0);0!==t&&this.rotateCell(this.state.cell,t)}else this.rotateClick();else{const s=this.graph.isGridEnabledEvent(e.getEvent()),n=(0,app_mathUtils.eh)(this.state.style.rotation??0),l=Math.cos(-n),a=Math.sin(-n);let r=t.x-this.startX,o=t.y-this.startY;const h=a*r+l*o;r=l*r-a*o,o=h;const p=this.graph.view.scale,d=this.isRecursiveResize(this.state,e);this.resizeCell(this.state.cell,this.roundLength(r/p),this.roundLength(o/p),i,s,this.isConstrainedEvent(e),d)}})),e.consume(),this.reset(),this.redrawHandles()}}isRecursiveResize(t,e){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(t,e,i){if(0!==e){const s=this.graph.getDataModel();if(t.isVertex()||t.isEdge()){if(!t.isEdge()){const i=(this.graph.getCurrentCellStyle(t).rotation??0)+e;this.graph.setCellStyles("rotation",i,[t])}let n=t.getGeometry();if(n&&i){const l=i.getGeometry();if(null==l||i.isEdge()||(n=n.clone(),n.rotate(e,new app_Point.A(l.width/2,l.height/2)),s.setGeometry(t,n)),t.isVertex()&&!n.relative||t.isEdge()){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.rotateCell(t.getChildAt(s),e,t)}}}}}reset(){if(null!==this.index&&"none"===this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.index=null,this.currentAlpha=null,this.preview&&(this.preview.destroy(),this.preview=null),this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive){for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].node.style.display="";this.state.control&&this.state.control.node&&(this.state.control.node.style.visibility="")}for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].active?(this.customHandles[t].active=!1,this.customHandles[t].reset()):this.customHandles[t].setVisible(!0);this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new app_Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),this.removeHint(),this.redrawHandles(),this.edgeHandlers=[],this.handlesVisible=!0,this.unscaledBounds=null}resizeCell(t,e,i,s,n,l,a){let r=t.getGeometry();if(r)if(s===app_InternalEvent.A.LABEL_HANDLE&&this.labelShape&&this.labelShape.bounds){const e=-(0,app_mathUtils.eh)(this.state.style.rotation??0),i=Math.cos(e),s=Math.sin(e),{scale:n}=this.graph.view,l=(0,app_mathUtils.Iq)(new app_Point.A(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/n),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/n)),i,s);r=r.clone(),null==r.offset?r.offset=l:(r.offset.x+=l.x,r.offset.y+=l.y),this.graph.model.setGeometry(t,r)}else if(this.unscaledBounds){const{scale:e}=this.graph.view;0===this.childOffsetX&&0===this.childOffsetY||this.moveChildren(t,Math.round(this.childOffsetX/e),Math.round(this.childOffsetY/e)),this.graph.resizeCell(t,this.unscaledBounds,a)}}moveChildren(t,e,i){const s=this.graph.getDataModel(),n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);let a=n.getGeometry();null!=a&&(a=a.clone(),a.translate(e,i),s.setGeometry(n,a))}}union(t,e,i,s,n,l,a,r,o){if(n=n&&this.graph.isGridEnabled(),this.singleSizer){let s=t.x+t.width+e,a=t.y+t.height+i;n&&(s=this.graph.snap(s/l)*l,a=this.graph.snap(a/l)*l);const r=new app_Rectangle.A(t.x,t.y,0,0);return r.add(new app_Rectangle.A(s,a,0,0)),r}const h=t.width,p=t.height;let d=t.x-a.x*l,c=d+h,u=t.y-a.y*l,g=u+p;const _=d+h/2,f=u+p/2;s>4?(g+=i,g=n?this.graph.snap(g/l)*l:Math.round(g/l)*l):s<3&&(u+=i,u=n?this.graph.snap(u/l)*l:Math.round(u/l)*l),0===s||3===s||5===s?(d+=e,d=n?this.graph.snap(d/l)*l:Math.round(d/l)*l):2!==s&&4!==s&&7!==s||(c+=e,c=n?this.graph.snap(c/l)*l:Math.round(c/l)*l);let C=c-d,y=g-u;if(r){const t=this.state.cell.getGeometry();if(null!=t){const e=t.width/t.height;1===s||2===s||7===s||6===s?C=y*e:y=C/e,0===s&&(d=c-C,u=g-y)}}if(o){C+=C-h,y+=y-p;const t=_-(d+C/2),e=f-(u+y/2);d+=t,u+=e,c+=t,g+=e}C<0&&(d+=C,C=Math.abs(C)),y<0&&(u+=y,y=Math.abs(y));const E=new app_Rectangle.A(d+a.x*l,u+a.y*l,C,y);return null!=this.minBounds&&(E.width=Math.max(E.width,this.minBounds.x*l+this.minBounds.width*l+Math.max(0,this.x0*l-E.x)),E.height=Math.max(E.height,this.minBounds.y*l+this.minBounds.height*l+Math.max(0,this.y0*l-E.y))),E}redraw(t){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new app_Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),t||this.redrawHandles()}getHandlePadding(){const t=new app_Point.A(0,0);let e=this.tolerance;return this.sizers.length>0&&this.sizers[0].bounds&&(this.bounds.width<2*this.sizers[0].bounds.width+2*e||this.bounds.height<2*this.sizers[0].bounds.height+2*e)&&(e/=2,t.x=this.sizers[0].bounds.width+e,t.y=this.sizers[0].bounds.height+e),t}getSizerBounds(){return this.bounds}redrawHandles(){let t=this.getSizerBounds();const e=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.handlesVisible&&this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}if(this.sizers.length>0&&this.sizers[0]){if(null===this.index&&this.manageSizers&&this.sizers.length>=8){const i=this.getHandlePadding();this.horizontalOffset=i.x,this.verticalOffset=i.y,0===this.horizontalOffset&&0===this.verticalOffset||(t=new app_Rectangle.A(t.x,t.y,t.width,t.height),t.x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(this.sizers[0].bounds&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e)?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):this.handlesVisible&&(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}const i=t.x+t.width,s=t.y+t.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],i,s);else{const e=t.x+t.width/2,n=t.y+t.height/2;if(this.sizers.length>=8){const l=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],a=(0,app_mathUtils.eh)(this.state.style.rotation??0),r=Math.cos(a),o=Math.sin(a),h=Math.round(4*a/Math.PI),p=new app_Point.A(t.getCenterX(),t.getCenterY());let d=(0,app_mathUtils.Iq)(new app_Point.A(t.x,t.y),r,o,p);this.moveSizerTo(this.sizers[0],d.x,d.y),this.sizers[0].setCursor(l[(0,app_mathUtils.zi)(0+h,l.length)]),d.x=e,d.y=t.y,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[1],d.x,d.y),this.sizers[1].setCursor(l[(0,app_mathUtils.zi)(1+h,l.length)]),d.x=i,d.y=t.y,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[2],d.x,d.y),this.sizers[2].setCursor(l[(0,app_mathUtils.zi)(2+h,l.length)]),d.x=t.x,d.y=n,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[3],d.x,d.y),this.sizers[3].setCursor(l[(0,app_mathUtils.zi)(7+h,l.length)]),d.x=i,d.y=n,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[4],d.x,d.y),this.sizers[4].setCursor(l[(0,app_mathUtils.zi)(3+h,l.length)]),d.x=t.x,d.y=s,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[5],d.x,d.y),this.sizers[5].setCursor(l[(0,app_mathUtils.zi)(6+h,l.length)]),d.x=e,d.y=s,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[6],d.x,d.y),this.sizers[6].setCursor(l[(0,app_mathUtils.zi)(5+h,l.length)]),d.x=i,d.y=s,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[7],d.x,d.y),this.sizers[7].setCursor(l[(0,app_mathUtils.zi)(4+h,l.length)]),d.x=e+this.state.absoluteOffset.x,d.y=n+this.state.absoluteOffset.y,d=(0,app_mathUtils.Iq)(d,r,o,p),this.moveSizerTo(this.sizers[8],d.x,d.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],e+this.state.absoluteOffset.x,n+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(this.rotationShape){const t=(0,app_mathUtils.eh)(this.currentAlpha??this.state.style.rotation??0),e=Math.cos(t),i=Math.sin(t),s=new app_Point.A(this.state.getCenterX(),this.state.getCenterY()),n=(0,app_mathUtils.Iq)(this.getRotationHandlePosition(),e,i,s);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,n.x,n.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()||!this.handlesVisible?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=this.state.style.rotation??0),null!=this.edgeHandlers)for(let t=0;t<this.edgeHandlers.length;t+=1)this.edgeHandlers[t].redraw()}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}getRotationHandlePosition(){return new app_Point.A(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){const t=this.state.cell.getParent();return!!t&&!this.graph.isCellSelected(t)}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=app_Rectangle.A.fromRectangle(i),this.parentHighlight.redraw())}else null!=i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&null!=i&&null==i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=app_Constants.$p.SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=i.style.rotation??0,this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}drawPreview(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode===this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=this.state.style.rotation??0,this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}isDestroyed(){return null==this.selectionBorder}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=()=>{},this.preview&&(this.preview.destroy(),this.preview=null),this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder&&this.selectionBorder.destroy(),this.labelShape=null,this.removeHint();for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].destroy();this.sizers=[];for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].destroy();this.customHandles=[]}}const app_handler_VertexHandler=app_VertexHandler;class app_MaxXmlRequest{constructor(t,e=null,i="POST",s=!0,n=null,l=null){this.binary=!1,this.withCredentials=!1,this.request=null,this.decodeSimulateValues=!1,this.url=t,this.params=e,this.method=i||"POST",this.async=s,this.username=n,this.password=l}isBinary(){return this.binary}setBinary(t){this.binary=t}getText(){return this.request.responseText}isReady(){return 4===this.request.readyState}getDocumentElement(){const t=this.getXml();return null!=t?t.documentElement:null}getXml(){let t=this.request.responseXML;return null!=t&&null!=t.documentElement||(t=(new DOMParser).parseFromString(this.request.responseText,"text/xml")),t}getStatus(){return null!=this.request?this.request.status:null}create(){const t=new XMLHttpRequest;return this.isBinary()&&t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t}send(t=null,e=null,i=null,s=null){this.request=this.create(),null!=this.request&&(null!=t&&(this.request.onreadystatechange=()=>{this.isReady()&&(t(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),window.XMLHttpRequest&&null!=i&&null!=s&&(this.request.timeout=i,this.request.ontimeout=s),this.request.send(this.params))}setRequestHeaders(t,e){null!=e&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(t,e=null){let i=null;(t=t||document)===document&&(i=window.onbeforeunload,window.onbeforeunload=null);const s=t.createElement("form");s.setAttribute("method",this.method),s.setAttribute("action",this.url),null!=e&&s.setAttribute("target",e),s.style.display="none",s.style.visibility="hidden";const n=this.params,l=n.indexOf("&")>0?n.split("&"):n.split(" ");for(let e=0;e<l.length;e+=1){const i=l[e].indexOf("=");if(i>0){const n=l[e].substring(0,i);let a=l[e].substring(i+1);this.decodeSimulateValues&&(a=decodeURIComponent(a));const r=t.createElement("textarea");r.setAttribute("wrap","off"),r.setAttribute("name",n),(0,app_domUtils.M9)(r,a),s.appendChild(r)}}t.body.appendChild(s),s.submit(),null!=s.parentNode&&s.parentNode.removeChild(s),null!=i&&(window.onbeforeunload=i)}}const app_load=t=>{const e=new app_MaxXmlRequest(t,null,"GET",!1);return e.send(),e},app_get=(t,e=null,i=null,s=!1,n=null,l=null,a=null)=>{const r=new app_MaxXmlRequest(t,null,"GET"),{setRequestHeaders:o}=r;return a&&(r.setRequestHeaders=(t,e)=>{o.apply(void 0,[t,e]);for(const e in a)t.setRequestHeader(e,a[e])}),null!=s&&r.setBinary(s),r.send(e,i,n,l),r},app_getAll=(t,e,i)=>{let s=t.length;const n=[];let l=0;const a=()=>{0==l&&null!=i&&i(),l++};for(let i=0;i<t.length;i+=1)((t,i)=>{app_get(t,(t=>{const l=t.getStatus();l<200||l>299?a():(n[i]=t,s--,0==s&&e(n))}),a)})(t[i],i);0==s&&e(n)},app_post=(t,e=null,i,s=null)=>new app_MaxXmlRequest(t,e).send(i,s),app_MaxXmlRequest_submit=(t,e,i,s)=>new app_MaxXmlRequest(t,e).simulate(i,s),app_util_MaxXmlRequest=null;var app_config=__webpack_require__(902);class app_Translations{}app_Translations.resources={},app_Translations.extension=".txt",app_Translations.resourcesEncoded=!1,app_Translations.loadDefaultBundle=!0,app_Translations.loadSpecialBundle=!0,app_Translations.isLanguageSupported=t=>{const e=app_config.F.getLanguages();return!e||e.indexOf(t)>=0},app_Translations.getDefaultBundle=(t,e)=>app_Translations.loadDefaultBundle||!app_Translations.isLanguageSupported(e)?t+app_Translations.extension:null,app_Translations.getSpecialBundle=(t,e)=>{if(!app_config.F.getLanguages()||!app_Translations.isLanguageSupported(e)){const t=e.indexOf("-");t>0&&(e=e.substring(0,t))}return app_Translations.loadSpecialBundle&&app_Translations.isLanguageSupported(e)&&e!=app_config.F.getDefaultLanguage()?`${t}_${e}${app_Translations.extension}`:null},app_Translations.add=(t,e=null,i=null)=>{if(e??(e=app_config.F.getLanguage()?.toLowerCase()??app_Constants.x3),e!==app_Constants.x3){const s=app_Translations.getDefaultBundle(t,e),n=app_Translations.getSpecialBundle(t,e),l=()=>{if(null!=n)if(i)app_get(n,(t=>{app_Translations.parse(t.getText()),i()}),(()=>{i()}));else try{const t=app_load(n);t.isReady()&&app_Translations.parse(t.getText())}catch(t){}else null!=i&&i()};if(null!=s)if(i)app_get(s,(t=>{app_Translations.parse(t.getText()),l()}),(()=>{l()}));else try{const t=app_load(s);t.isReady()&&app_Translations.parse(t.getText()),l()}catch(t){}else l()}},app_Translations.parse=t=>{if(null!=t){const e=t.split("\n");for(let t=0;t<e.length;t+=1)if("#"!==e[t].charAt(0)){const i=e[t].indexOf("=");if(i>0){const s=e[t].substring(0,i);let n=e[t].length;13===e[t].charCodeAt(n-1)&&n--;let l=e[t].substring(i+1,n);app_Translations.resourcesEncoded?(l=l.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),app_Translations.resources[s]=unescape(l)):app_Translations.resources[s]=l}}}},app_Translations.get=(t,e=null,i=null)=>{let s=app_Translations.resources[t];return null==s&&(s=i),null!=s&&null!=e&&(s=app_Translations.replacePlaceholders(s,e)),s},app_Translations.replacePlaceholders=(t,e)=>{const i=[];let s=null;for(let n=0;n<t.length;n+=1){const l=t.charAt(n);"{"===l?s="":null!=s&&"}"===l?(s=parseInt(s)-1,s>=0&&s<e.length&&i.push(e[s]),s=null):null!=s?s+=l:i.push(l)}return i.join("")},app_Translations.loadResources=t=>{app_Translations.add(`${app_Client.A.basePath}/resources/editor`,null,(()=>{app_Translations.add(`${app_Client.A.basePath}/resources/graph`,null,t)}))};const app_i18n_Translations=app_Translations;class app_ElbowEdgeHandler extends app_handler_EdgeHandler{constructor(t){super(t),this.flipEnabled=!0,this.doubleClickOrientationResource=app_config.F.isEnabled()?"doubleClickOrientation":""}createBends(){const t=[];let e=this.createHandleShape(0);return this.initBend(e),e.setCursor(app_Constants.Lm.TERMINAL_HANDLE),t.push(e),t.push(this.createVirtualBend((t=>{!(0,app_EventUtils.fm)(t)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell),app_InternalEvent.A.consume(t))}))),this.points.push(new app_Point.A(0,0)),e=this.createHandleShape(2),this.initBend(e),e.setCursor(app_Constants.Lm.TERMINAL_HANDLE),t.push(e),t}createVirtualBend(t){const e=this.createHandleShape();return this.initBend(e,t),e.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(e.node.style.display="none"),e}getCursorForBend(){return this.state.style.edgeStyle===app_Constants.bR.TOPTOBOTTOM||this.state.style.edgeStyle===app_Constants.bR.ELBOW&&this.state.style.elbow===app_Constants.aq.VERTICAL?"row-resize":"col-resize"}getTooltipForNode(t){let e=null;return null==this.bends||null==this.bends[1]||t!==this.bends[1].node&&t.parentNode!==this.bends[1].node||(e=this.doubleClickOrientationResource,e=app_i18n_Translations.get(e)||e),e}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),{origin:n}=this.state;return e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x-n.x),t.y=Math.round(t.y/i-s.y-n.y),t}redrawInnerBends(t,e){const i=this.state.cell.getGeometry(),s=this.state.absolutePoints;let n=null;s.length>1?(t=s[1],e=s[s.length-2]):null!=i.points&&i.points.length>0&&(n=s[0]),n=null==n?new app_Point.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2):new app_Point.A(this.graph.getView().scale*(n.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(n.y+this.graph.getView().translate.y+this.state.origin.y));const l=this.bends[1].bounds;let a=l.width,r=l.height,o=new app_Rectangle.A(Math.round(n.x-a/2),Math.round(n.y-r/2),a,r);this.manageLabelHandle?this.checkLabelHandle(o):null==this.handleImage&&this.labelShape.visible&&this.labelShape.bounds&&(0,app_mathUtils.HY)(o,this.labelShape.bounds)&&(a=app_HandleConfig.size+3,r=a,o=new app_Rectangle.A(Math.floor(n.x-a/2),Math.floor(n.y-r/2),a,r)),this.bends[1].bounds=o,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}}const app_handler_ElbowEdgeHandler=app_ElbowEdgeHandler;class app_EdgeSegmentHandler extends app_handler_ElbowEdgeHandler{constructor(t){super(t),this.points=[]}getCurrentPoints(){let t=this.state.absolutePoints;const e=Math.max(1,this.graph.view.scale);if(2===t.length&&t[0]&&t[1]||3===t.length&&t[0]&&t[1]&&t[2]&&(Math.abs(t[0].x-t[1].x)<e&&Math.abs(t[1].x-t[2].x)<e||Math.abs(t[0].y-t[1].y)<e&&Math.abs(t[1].y-t[2].y)<e)){const e=t[0].x+(t[t.length-1].x-t[0].x)/2,i=t[0].y+(t[t.length-1].y-t[0].y)/2;t=[t[0],new app_Point.A(e,i),new app_Point.A(e,i),t[t.length-1]]}return t}getPreviewPoints(t){if(this.isSource||this.isTarget)return super.getPreviewPoints(t);const e=this.getCurrentPoints();let i=this.convertPoint(e[0].clone(),!1);t=this.convertPoint(t.clone(),!1);let s=[];for(let n=1;n<e.length;n+=1){const l=this.convertPoint(e[n].clone(),!1);n===this.index&&(0===Math.round(i.x-l.x)&&(i.x=t.x,l.x=t.x),0===Math.round(i.y-l.y)&&(i.y=t.y,l.y=t.y)),n<e.length-1&&s.push(l),i=l}if(1===s.length){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),n=this.state.view.getScale(),l=this.state.view.getTranslate(),a=s[0].x*n+l.x,r=s[0].y*n+l.y;(null!=e&&(0,app_mathUtils.gR)(e,a,r)||null!=i&&(0,app_mathUtils.gR)(i,a,r))&&(s=[t,t])}return s}updatePreviewState(t,e,i,s){if(super.updatePreviewState(t,e,i,s),!this.isSource&&!this.isTarget){e=this.convertPoint(e.clone(),!1);const i=t.absolutePoints;let s=i[0],n=i[1],l=[];for(let t=2;t<i.length;t+=1){const e=i[t];0===Math.round(s.x-n.x)&&0===Math.round(n.x-e.x)||0===Math.round(s.y-n.y)&&0===Math.round(n.y-e.y)||l.push(this.convertPoint(n.clone(),!1)),s=n,n=e}const a=this.state.getVisibleTerminalState(!0),r=this.state.getVisibleTerminalState(!1),o=this.state.absolutePoints,h=i[i.length-1];if(0===l.length&&i[0]&&h&&(0===Math.round(i[0].x-h.x)||0===Math.round(i[0].y-h.y)))l=[e,e];else if(5===i.length&&2===l.length&&null!=a&&null!=r&&null!=o&&0===Math.round(o[0].x-o[o.length-1].x)){const i=this.graph.getView(),s=i.getScale(),n=i.getTranslate();let o=i.getRoutingCenterY(a)/s-n.y;const h=this.graph.getConnectionConstraint(t,a,!0);if(null!=h){const t=this.graph.getConnectionPoint(a,h);null!=t&&(this.convertPoint(t,!1),o=t.y)}let p=i.getRoutingCenterY(r)/s-n.y;const d=this.graph.getConnectionConstraint(t,r,!1);if(d){const t=this.graph.getConnectionPoint(r,d);null!=t&&(this.convertPoint(t,!1),p=t.y)}l=[new app_Point.A(e.x,o),new app_Point.A(e.x,p)]}this.points=l,t.view.updateFixedTerminalPoints(t,a,r),t.view.updatePoints(t,this.points,a,r),t.view.updateFloatingTerminalPoints(t,a,r)}}connect(t,e,i,s,n){const l=this.graph.getDataModel();let a=t.getGeometry(),r=null;if(null!=a&&null!=a.points&&a.points.length>0){const t=this.abspoints;let e=t[0],i=t[1];r=[];for(let s=2;s<t.length;s+=1){const n=t[s];!(e&&i&&n)||0===Math.round(e.x-i.x)&&0===Math.round(i.x-n.x)||0===Math.round(e.y-i.y)&&0===Math.round(i.y-n.y)||r.push(this.convertPoint(i.clone(),!1)),e=i,i=n}}return this.graph.batchUpdate((()=>{null!=r&&(a=t.getGeometry(),null!=a&&(a=a.clone(),a.points=r,l.setGeometry(t,a))),t=super.connect(t,e,i,s,n)})),t}getTooltipForNode(t){return null}start(t,e,i){super.start(t,e,i),null==this.bends||null==this.bends[i]||this.isSource||this.isTarget||(0,app_styleUtils.Ko)(this.bends[i].node,100)}createBends(){const t=[];let e=this.createHandleShape(0);this.initBend(e),e.setCursor(app_Constants.Lm.TERMINAL_HANDLE),t.push(e);const i=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(let s=0;s<i.length-1;s+=1){e=this.createVirtualBend(),t.push(e);let n=0===Math.round(i[s].x-i[s+1].x);0===Math.round(i[s].y-i[s+1].y)&&s<i.length-2&&(n=0===Math.round(i[s].x-i[s+2].x)),e.setCursor(n?"col-resize":"row-resize"),this.points.push(new app_Point.A(0,0))}}return e=this.createHandleShape(i.length),this.initBend(e),e.setCursor(app_Constants.Lm.TERMINAL_HANDLE),t.push(e),t}redraw(){this.refresh(),super.redraw()}redrawInnerBends(t,e){if(this.graph.isCellBendable(this.state.cell)){const i=this.getCurrentPoints();if(null!=i&&i.length>1){let s=!1;if(4===i.length&&i[0]&&i[1]&&i[2]&&i[3]&&0===Math.round(i[1].x-i[2].x)&&0===Math.round(i[1].y-i[2].y))if(s=!0,0===Math.round(i[0].y-i[i.length-1].y)){const t=i[0].x+(i[i.length-1].x-i[0].x)/2;i[1]=new app_Point.A(t,i[1].y),i[2]=new app_Point.A(t,i[2].y)}else{const t=i[0].y+(i[i.length-1].y-i[0].y)/2;i[1]=new app_Point.A(i[1].x,t),i[2]=new app_Point.A(i[2].x,t)}for(let s=0;s<i.length-1;s+=1)if(null!=this.bends[s+1]){t=i[s],e=i[s+1];const n=new app_Point.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2),l=this.bends[s+1].bounds;this.bends[s+1].bounds=new app_Rectangle.A(Math.floor(n.x-l.width/2),Math.floor(n.y-l.height/2),l.width,l.height),this.bends[s+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[s+1].bounds)}s&&((0,app_styleUtils.Ko)(this.bends[1].node,app_EdgeHandlerConfig.virtualBendOpacity),(0,app_styleUtils.Ko)(this.bends[3].node,app_EdgeHandlerConfig.virtualBendOpacity))}}}}const app_handler_EdgeSegmentHandler=app_EdgeSegmentHandler;class app_SelectionChange{constructor(t,e=[],i=[]){this.graph=t,this.added=e.slice(),this.removed=i.slice()}execute(){const t=this.graph.getSelectionModel();for(const e of this.removed)t.cellRemoved(e);for(const e of this.added)t.cellAdded(e);[this.added,this.removed]=[this.removed,this.added],t.fireEvent(new app_EventObject.A(app_InternalEvent.A.CHANGE,{added:this.added,removed:this.removed}))}}const app_undoable_changes_SelectionChange=app_SelectionChange;class app_GraphSelectionModel extends app_EventSource.A{constructor(t){super(),this.doneResource=app_config.F.isEnabled()?"done":"",this.updatingSelectionResource=app_config.F.isEnabled()?"updatingSelection":"",this.singleSelection=!1,this.graph=t,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(t){this.singleSelection=t}isSelected(t){return this.cells.indexOf(t)>=0}isEmpty(){return 0===this.cells.length}clear(){this.changeSelection(null,this.cells)}setCell(t){this.setCells(t?[t]:[])}setCells(t){this.singleSelection&&(t=[this.getFirstSelectableCell(t)]);const e=[];for(let i=0;i<t.length;i+=1)this.graph.isCellSelectable(t[i])&&e.push(t[i]);this.changeSelection(e,this.cells)}getFirstSelectableCell(t){for(let e=0;e<t.length;e+=1)if(this.graph.isCellSelectable(t[e]))return t[e];return null}addCell(t){this.addCells([t])}addCells(t){let e=null;if(this.singleSelection){e=this.cells;const i=this.getFirstSelectableCell(t);t=i?[i]:[]}const i=[];for(let e=0;e<t.length;e+=1)!this.isSelected(t[e])&&this.graph.isCellSelectable(t[e])&&i.push(t[e]);this.changeSelection(i,e)}removeCell(t){this.removeCells([t])}removeCells(t){const e=[];for(let i=0;i<t.length;i+=1)this.isSelected(t[i])&&e.push(t[i]);this.changeSelection(null,e)}changeSelection(t=null,e=null){if(t&&t.length>0&&t[0]||e&&e.length>0&&e[0]){const i=new app_undoable_changes_SelectionChange(this.graph,t||[],e||[]);i.execute();const s=new app_UndoableEdit.A(this.graph,!1);s.add(i),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.UNDO,{edit:s}))}}cellAdded(t){this.isSelected(t)||this.cells.push(t)}cellRemoved(t){const e=this.cells.indexOf(t);e>=0&&this.cells.splice(e,1)}}const app_view_GraphSelectionModel=app_GraphSelectionModel;class app_RhombusShape extends app_Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(){return!0}paintVertexShape(t,e,i,s,n){const l=s/2,a=n/2,r=(this.style?.arcSize??app_Constants.xU)/2;t.begin(),this.addPoints(t,[new app_Point.A(e+l,i),new app_Point.A(e+s,i+a),new app_Point.A(e+l,i+n),new app_Point.A(e,i+a)],this.isRounded,r,!0),t.fillAndStroke()}}const app_node_RhombusShape=app_RhombusShape;class app_CylinderShape extends app_Shape.A{constructor(t,e,i,s=1){super(),this.maxHeight=40,this.svgStrokeTolerance=0,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n,!1),t.fillAndStroke(),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),t.begin(),this.redrawPath(t,e,i,s,n,!0),t.stroke())}getCylinderSize(t,e,i,s){return Math.min(this.maxHeight,Math.round(s/5))}redrawPath(t,e,i,s,n,l=!1){const a=this.getCylinderSize(e,i,s,n);(l&&this.fill!==app_Constants.x3||!l&&this.fill===app_Constants.x3)&&(t.moveTo(0,a),t.curveTo(0,2*a,s,2*a,s,a),l||(t.stroke(),t.begin())),l||(t.moveTo(0,a),t.curveTo(0,-a/3,s,-a/3,s,a),t.lineTo(s,n-a),t.curveTo(s,n+a/3,0,n+a/3,0,n-a),t.close())}}const app_node_CylinderShape=app_CylinderShape;class app_ActorShape extends app_Shape.A{constructor(t=null,e=app_Constants.x3,i=app_Constants.x3,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n),t.fillAndStroke()}redrawPath(t,e,i,s,n){const l=s/3;t.moveTo(0,n),t.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),t.curveTo(s/2-l,2*n/5,s/2-l,0,s/2,0),t.curveTo(s/2+l,0,s/2+l,2*n/5,s/2,2*n/5),t.curveTo(s,2*n/5,s,3*n/5,s,n),t.close()}}const app_geometry_ActorShape=app_ActorShape;class app_TriangleShape extends app_geometry_ActorShape{constructor(){super()}isRoundable(){return!0}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??app_Constants.xU)/2;this.addPoints(t,[new app_Point.A(0,0),new app_Point.A(s,.5*n),new app_Point.A(0,n)],this.isRounded,l,!0)}}const app_node_TriangleShape=app_TriangleShape;class app_HexagonShape extends app_geometry_ActorShape{constructor(){super()}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??app_Constants.xU)/2;this.addPoints(t,[new app_Point.A(.25*s,0),new app_Point.A(.75*s,0),new app_Point.A(s,.5*n),new app_Point.A(.75*s,n),new app_Point.A(.25*s,n),new app_Point.A(0,.5*n)],this.isRounded,l,!0)}}const app_node_HexagonShape=app_HexagonShape;class app_CloudShape extends app_geometry_ActorShape{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}redrawPath(t,e,i,s,n){t.moveTo(.25*s,.25*n),t.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),t.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),t.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),t.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),t.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),t.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),t.close()}}const app_node_CloudShape=app_CloudShape;class app_LineShape extends app_Shape.A{constructor(t,e,i=1,s=!1){super(),this.bounds=t,this.stroke=e,this.strokeWidth=i,this.vertical=s}paintVertexShape(t,e,i,s,n){if(t.begin(),this.vertical){const l=e+s/2;t.moveTo(l,i),t.lineTo(l,i+n)}else{const l=i+n/2;t.moveTo(e,l),t.lineTo(e+s,l)}t.stroke()}}const app_edge_LineShape=app_LineShape;class app_ArrowShape extends app_Shape.A{constructor(t,e,i,s=1,n=app_Constants.pC,l=app_Constants.qG,a=app_Constants.gK){super(),this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.spacing=l,this.endSize=a}augmentBoundingBox(t){super.augmentBoundingBox(t);const e=Math.max(this.arrowWidth,this.endSize);t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){const i=app_Constants.qG,s=app_Constants.pC,n=app_Constants.gK,l=e[0],a=e[e.length-1],r=a.x-l.x,o=a.y-l.y,h=Math.sqrt(r*r+o*o),p=h-2*i-n,d=r/h,c=o/h,u=p*d,g=p*c,_=s*c/3,f=-s*d/3,C=l.x-_/2+i*d,y=l.y-f/2+i*c,E=C+_,v=y+f,m=E+u,w=v+g,x=m+_,S=w+f,b=x-3*_,A=S-3*f;t.begin(),t.moveTo(C,y),t.lineTo(E,v),t.lineTo(m,w),t.lineTo(x,S),t.lineTo(a.x-i*d,a.y-i*c),t.lineTo(b,A),t.lineTo(b+_,A+f),t.close(),t.fillAndStroke()}}const app_edge_ArrowShape=app_ArrowShape;class app_ArrowConnectorShape extends app_Shape.A{constructor(t,e,i,s=1,n=app_Constants.pC,l=app_Constants.qG,a=app_Constants.gK/5){super(),this.useSvgBoundingBox=!0,this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.arrowSpacing=l,this.startSize=app_Constants.gK/5,this.endSize=a}isRoundable(){return!0}resetStyles(){super.resetStyles(),this.arrowSpacing=app_Constants.qG}apply(t){super.apply(t),this.style&&null!=this.style.startSize&&null!=this.style.endSize&&(this.startSize=3*this.style.startSize,this.endSize=3*this.style.endSize)}augmentBoundingBox(t){super.augmentBoundingBox(t);let e=this.getEdgeWidth();this.isMarkerStart()&&(e=Math.max(e,this.getStartArrowWidth())),this.isMarkerEnd()&&(e=Math.max(e,this.getEndArrowWidth())),t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){let i=this.strokeWidth;this.outline&&(i=Math.max(1,this.style?.strokeWidth??0));const s=this.getStartArrowWidth()+i,n=this.getEndArrowWidth()+i,l=this.outline?this.getEdgeWidth()+i:this.getEdgeWidth(),a=this.isOpenEnded(),r=this.isMarkerStart(),o=this.isMarkerEnd(),h=a?0:this.arrowSpacing+i/2,p=this.startSize+i,d=this.endSize+i,c=this.isArrowRounded(),u=e[e.length-1];let g=1;for(;g<e.length-1&&e[g].x===e[0].x&&e[g].y===e[0].y;)g++;const _=e[g].x-e[0].x,f=e[g].y-e[0].y,C=Math.sqrt(_*_+f*f);if(0===C)return;let y,E,v=_/C,m=v,w=f/C,x=w,S=l*w,b=-l*v;const A=[];c?t.setLineJoin("round"):e.length>2&&t.setMiterLimit(1.42),t.begin();const M=v,T=w;if(r&&!a)this.paintMarker(t,e[0].x,e[0].y,v,w,p,s,l,h,!0);else{const i=e[0].x+S/2+h*v,s=e[0].y+b/2+h*w,n=e[0].x-S/2+h*v,l=e[0].y-b/2+h*w;a?(t.moveTo(i,s),A.push((()=>{t.lineTo(n,l)}))):(t.moveTo(n,l),t.lineTo(i,s))}let P=0,I=0,O=0;for(let i=0;i<e.length-2;i+=1){const s=(0,app_mathUtils._C)(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(P=e[i+2].x-e[i+1].x,I=e[i+2].y-e[i+1].y,O=Math.sqrt(P*P+I*I),0!==O){m=P/O,x=I/O;const n=v*m+w*x,a=Math.max(Math.sqrt((n+1)/2),.04);y=v+m,E=w+x;const r=Math.sqrt(y*y+E*E);if(0!==r){y/=r,E/=r;const n=Math.max(a,Math.min(this.strokeWidth/200+.04,.35)),o=0!==s&&c?Math.max(.1,n):Math.max(a,.06),h=e[i+1].x+E*l/2/o,p=e[i+1].y-y*l/2/o,d=e[i+1].x-E*l/2/o,u=e[i+1].y+y*l/2/o;if(0!==s&&c)if(-1===s){const e=d+w*l,i=u-v*l,s=d+x*l,n=u-m*l;t.lineTo(e,i),t.quadTo(h,p,s,n),((e,i)=>{A.push((()=>{t.lineTo(e,i)}))})(d,u)}else t.lineTo(h,p),((e,i)=>{const s=h-w*l,n=p+v*l,a=h-x*l,r=p+m*l;A.push((()=>{t.quadTo(e,i,s,n)})),A.push((()=>{t.lineTo(a,r)}))})(d,u);else t.lineTo(h,p),((e,i)=>{A.push((()=>{t.lineTo(e,i)}))})(d,u);v=m,w=x}}}if(S=l*x,b=-l*m,o&&!a)this.paintMarker(t,u.x,u.y,-v,-w,d,n,l,h,!1);else{t.lineTo(u.x-h*m+S/2,u.y-h*x+b/2);const e=u.x-h*m-S/2,i=u.y-h*x-b/2;a?(t.moveTo(e,i),A.splice(0,0,(()=>{t.moveTo(e,i)}))):t.lineTo(e,i)}for(let t=A.length-1;t>=0;t--)A[t]();a?(t.end(),t.stroke()):(t.close(),t.fillAndStroke()),t.setShadow(!1),t.setMiterLimit(4),c&&t.setLineJoin("flat"),e.length>2&&(t.setMiterLimit(4),r&&!a&&(t.begin(),this.paintMarker(t,e[0].x,e[0].y,M,T,p,s,l,h,!0),t.stroke(),t.end()),o&&!a&&(t.begin(),this.paintMarker(t,u.x,u.y,-v,-w,d,n,l,h,!0),t.stroke(),t.end()))}paintMarker(t,e,i,s,n,l,a,r,o,h){const p=r/a,d=r*n/2,c=-r*s/2,u=(o+l)*s,g=(o+l)*n;h?t.moveTo(e-d+u,i-c+g):t.lineTo(e-d+u,i-c+g),t.lineTo(e-d/p+u,i-c/p+g),t.lineTo(e+o*s,i+o*n),t.lineTo(e+d/p+u,i+c/p+g),t.lineTo(e+d+u,i+c+g)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return app_Constants.pC}getEndArrowWidth(){return app_Constants.pC}getEdgeWidth(){return app_Constants.pC/3}isOpenEnded(){return!1}isMarkerStart(){return(this.style?.startArrow??app_Constants.x3)!==app_Constants.x3}isMarkerEnd(){return(this.style?.endArrow??app_Constants.x3)!==app_Constants.x3}}const app_edge_ArrowConnectorShape=app_ArrowConnectorShape;class app_DoubleEllipseShape extends app_Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintBackground(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}paintForeground(t,e,i,s,n){if(!this.outline){const l=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(s/5,n/5));e+=l,i+=l,n-=2*l,(s-=2*l)>0&&n>0&&t.ellipse(e,i,s,n),t.stroke()}}getLabelBounds(t){const e=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(t.width/5/this.scale,t.height/5/this.scale))*this.scale;return new app_Rectangle.A(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}const app_node_DoubleEllipseShape=app_DoubleEllipseShape;class app_SwimlaneShape extends app_Shape.A{constructor(t,e,i,s=1){super(),this.imageSize=16,this.imageSrc=null,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(t,e,i,s,n){return!0}getTitleSize(){return Math.max(0,this.style?.startSize??app_Constants.QX)}getLabelBounds(t){const e=this.getTitleSize(),i=new app_Rectangle.A(t.x,t.y,t.width,t.height),s=this.isHorizontal(),n=this.style?.flipH??!1,l=this.style?.flipV??!1,a=this.direction===app_Constants.M8.NORTH||this.direction===app_Constants.M8.SOUTH,r=s==!a,o=!r&&n!==(this.direction===app_Constants.M8.SOUTH||this.direction===app_Constants.M8.WEST),h=r&&l!==(this.direction===app_Constants.M8.SOUTH||this.direction===app_Constants.M8.WEST);if(a){const t=Math.min(i.width,e*this.scale);(o||h)&&(i.x+=i.width-t),i.width=t}else{const t=Math.min(i.height,e*this.scale);(o||h)&&(i.y+=i.height-t),i.height=t}return i}getGradientBounds(t,e,i,s,n){let l=this.getTitleSize();return this.isHorizontal()?(l=Math.min(l,n),new app_Rectangle.A(e,i,s,l)):(l=Math.min(l,s),new app_Rectangle.A(e,i,l,n))}getSwimlaneArcSize(t,e,i){return this.style?.absoluteArcSize?Math.min(t/2,Math.min(e/2,this.style?.arcSize??app_Constants.xU/2)):i*((this.style?.arcSize??100*app_Constants.fQ)/100)*3}isHorizontal(){return this.style?.horizontal??!0}paintVertexShape(t,e,i,s,n){let l=this.getTitleSize();const a=this.style?.swimlaneFillColor??app_Constants.x3,r=this.style?.swimlaneLine??!0;let o=0;l=this.isHorizontal()?Math.min(l,n):Math.min(l,s),t.translate(e,i),this.isRounded?(o=this.getSwimlaneArcSize(s,n,l),o=Math.min((this.isHorizontal()?n:s)-l,Math.min(l,o)),this.paintRoundedSwimlane(t,e,i,s,n,l,o,a,r)):this.paintSwimlane(t,e,i,s,n,l,a,r);const h=this.style?.separatorColor??app_Constants.x3;if(this.paintSeparator(t,e,i,s,n,l,h),this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x-e,l.y-i,l.width,l.height,this.imageSrc,!1,!1,!1)}this.glass&&(t.setShadow(!1),this.paintGlassEffect(t,0,0,s,l,o))}paintSwimlane(t,e,i,s,n,l,a,r){t.begin();let o=!0;this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==app_Constants.x3||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(0,0),t.lineTo(s,0),t.lineTo(s,l),t.fillAndStroke(),l<n&&(a!==app_Constants.x3&&o||(t.pointerEvents=!1),a!==app_Constants.x3&&t.setFillColor(a),t.begin(),t.moveTo(0,l),t.lineTo(0,n),t.lineTo(s,n),t.lineTo(s,l),a===app_Constants.x3?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(0,0),t.lineTo(0,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(a!==app_Constants.x3&&o||(t.pointerEvents=!1),a!==app_Constants.x3&&t.setFillColor(a),t.begin(),t.moveTo(l,0),t.lineTo(s,0),t.lineTo(s,n),t.lineTo(l,n),a===app_Constants.x3?t.stroke():t.fillAndStroke())),r&&this.paintDivider(t,e,i,s,n,l,a===app_Constants.x3)}paintRoundedSwimlane(t,e,i,s,n,l,a,r,o){t.begin();let h=!0;this.style&&null!=this.style.pointerEvents&&(h=this.style.pointerEvents),h||this.fill!==app_Constants.x3||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,a),t.quadTo(s,0,s-Math.min(s/2,a),0),t.lineTo(Math.min(s/2,a),0),t.quadTo(0,0,0,a),t.lineTo(0,l),t.fillAndStroke(),l<n&&(r!==app_Constants.x3&&h||(t.pointerEvents=!1),r!==app_Constants.x3&&t.setFillColor(r),t.begin(),t.moveTo(0,l),t.lineTo(0,n-a),t.quadTo(0,n,Math.min(s/2,a),n),t.lineTo(s-Math.min(s/2,a),n),t.quadTo(s,n,s,n-a),t.lineTo(s,l),r===app_Constants.x3?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(a,0),t.quadTo(0,0,0,Math.min(n/2,a)),t.lineTo(0,n-Math.min(n/2,a)),t.quadTo(0,n,a,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(r!==app_Constants.x3&&h||(t.pointerEvents=!1),r!==app_Constants.x3&&t.setFillColor(r),t.begin(),t.moveTo(l,n),t.lineTo(s-a,n),t.quadTo(s,n,s,n-Math.min(n/2,a)),t.lineTo(s,Math.min(n/2,a)),t.quadTo(s,0,s-a,0),t.lineTo(l,0),r===app_Constants.x3?t.stroke():t.fillAndStroke())),o&&this.paintDivider(t,e,i,s,n,l,r===app_Constants.x3)}paintDivider(t,e,i,s,n,l,a){a||t.setShadow(!1),t.begin(),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(s,l)):(t.moveTo(l,0),t.lineTo(l,n)),t.stroke()}paintSeparator(t,e,i,s,n,l,a){a!==app_Constants.x3&&(t.setStrokeColor(a),t.setDashed(!0),t.begin(),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,n)):(t.moveTo(l,0),t.lineTo(s,0)),t.stroke(),t.setDashed(!1))}getImageBounds(t,e,i,s){return this.isHorizontal()?new app_Rectangle.A(t+i-this.imageSize,e,this.imageSize,this.imageSize):new app_Rectangle.A(t,e,this.imageSize,this.imageSize)}}const app_node_SwimlaneShape=app_SwimlaneShape;class app_LabelShape extends app_RectangleShape.A{constructor(t,e,i,s){super(t,e,i,s),this.imageSize=app_Constants.tK,this.imageSrc=null,this.spacing=2,this.indicatorSize=10,this.indicatorSpacing=2,this.indicatorImageSrc=null}init(t){super.init(t),this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor===app_Constants.x3&&!!this.indicatorShape}paintForeground(t,e,i,s,n){this.paintImage(t,e,i,s,n),this.paintIndicator(t,e,i,s,n),super.paintForeground(t,e,i,s,n)}paintImage(t,e,i,s,n){if(this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.imageSrc,!1,!1,!1)}}getImageBounds(t,e,i,s){const n=this.style?.imageAlign??app_Constants.Ec.LEFT,l=this.style?.verticalAlign??app_Constants.Ec.MIDDLE,a=this.style?.imageWidth??app_Constants.tK,r=this.style?.imageHeight??app_Constants.tK,o=this.style?.spacing??this.spacing+5;return n===app_Constants.Ec.CENTER?t+=(i-a)/2:n===app_Constants.Ec.RIGHT?t+=i-a-o:t+=o,l===app_Constants.Ec.TOP?e+=o:l===app_Constants.Ec.BOTTOM?e+=s-r-o:e+=(s-r)/2,new app_Rectangle.A(t,e,a,r)}paintIndicator(t,e,i,s,n){if(this.indicator)this.indicator.bounds=this.getIndicatorBounds(e,i,s,n),this.indicator.paint(t);else if(this.indicatorImageSrc){const l=this.getIndicatorBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.indicatorImageSrc,!1,!1,!1)}}getIndicatorBounds(t,e,i,s){const n=this.style?.imageAlign??app_Constants.Ec.LEFT,l=this.style?.verticalAlign??app_Constants.Ec.MIDDLE,a=this.style?.indicatorWidth??this.indicatorSize,r=this.style?.indicatorHeight??this.indicatorSize,o=this.spacing+5;return n===app_Constants.Ec.RIGHT?t+=i-a-o:n===app_Constants.Ec.CENTER?t+=(i-a)/2:t+=o,l===app_Constants.Ec.BOTTOM?e+=s-r-o:l===app_Constants.Ec.TOP?e+=o:e+=(s-r)/2,new app_Rectangle.A(t,e,a,r)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.imageSrc&&this.bounds){const t=document.createElement("img");t.style.position="relative",t.setAttribute("border","0");const e=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);e.x-=this.bounds.x,e.y-=this.bounds.y,t.style.left=`${Math.round(e.x)}px`,t.style.top=`${Math.round(e.y)}px`,t.style.width=`${Math.round(e.width)}px`,t.style.height=`${Math.round(e.height)}px`,t.src=this.imageSrc,this.node.appendChild(t)}}}const app_node_LabelShape=app_LabelShape;let app_isDefaultElementsRegistered=!1;function app_registerDefaultShapes(){if(!app_isDefaultElementsRegistered){const t=[[app_Constants.IW.ACTOR,app_geometry_ActorShape],[app_Constants.IW.ARROW,app_edge_ArrowShape],[app_Constants.IW.ARROW_CONNECTOR,app_edge_ArrowConnectorShape],[app_Constants.IW.CONNECTOR,app_edge_ConnectorShape],[app_Constants.IW.CLOUD,app_node_CloudShape],[app_Constants.IW.CYLINDER,app_node_CylinderShape],[app_Constants.IW.DOUBLE_ELLIPSE,app_node_DoubleEllipseShape],[app_Constants.IW.ELLIPSE,app_node_EllipseShape],[app_Constants.IW.HEXAGON,app_node_HexagonShape],[app_Constants.IW.IMAGE,app_ImageShape.A],[app_Constants.IW.LABEL,app_node_LabelShape],[app_Constants.IW.LINE,app_edge_LineShape],[app_Constants.IW.RECTANGLE,app_RectangleShape.A],[app_Constants.IW.RHOMBUS,app_node_RhombusShape],[app_Constants.IW.SWIMLANE,app_node_SwimlaneShape],[app_Constants.IW.TRIANGLE,app_node_TriangleShape]];for(const[e,i]of t)app_cell_CellRenderer.registerShape(e,i);app_isDefaultElementsRegistered=!0}}const app_EllipsePerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width/2,r=t.height/2,o=n+a,h=l+r,p=i.x,d=i.y,c=parseInt(String(p-o)),u=parseInt(String(d-h));if(0===c&&0!==u)return new app_Point.A(o,h+r*u/Math.abs(u));if(0===c&&0===u)return new app_Point.A(p,d);if(s){if(d>=l&&d<=l+t.height){const t=d-h;let e=Math.sqrt(a*a*(1-t*t/(r*r)))||0;return p<=n&&(e=-e),new app_Point.A(o+e,d)}if(p>=n&&p<=n+t.width){const t=p-o;let e=Math.sqrt(r*r*(1-t*t/(a*a)))||0;return d<=l&&(e=-e),new app_Point.A(p,h+e)}}const g=u/c,_=h-g*o,f=a*a*g*g+r*r,C=-2*o*f,y=a*a*g*g*o*o+r*r*o*o-a*a*r*r,E=Math.sqrt(C*C-4*f*y),v=(-C+E)/(2*f),m=(-C-E)/(2*f),w=g*v+_,x=g*m+_;let S=0,b=0;return Math.sqrt(Math.pow(v-p,2)+Math.pow(w-d,2))<Math.sqrt(Math.pow(m-p,2)+Math.pow(x-d,2))?(S=v,b=w):(S=m,b=x),new app_Point.A(S,b)},app_HexagonPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width,r=t.height,o=t.getCenterX(),h=t.getCenterY(),p=i.x,d=i.y,c=p-o,u=d-h,g=-Math.atan2(u,c),_=Math.PI,f=Math.PI/2;let C=new app_Point.A(o,h);const y=e?.style?.direction??app_Constants.M8.EAST,E=y===app_Constants.M8.NORTH||y===app_Constants.M8.SOUTH;let v=new app_Point.A,m=new app_Point.A;if((p<n&&d<l||p<n&&d>l+r||p>n+a&&d<l||p>n+a&&d>l+r)&&(s=!1),s){if(E){if(p===o){if(d<=l)return new app_Point.A(o,l);if(d>=l+r)return new app_Point.A(o,l+r)}else if(p<n){if(d===l+r/4)return new app_Point.A(n,l+r/4);if(d===l+3*r/4)return new app_Point.A(n,l+3*r/4)}else if(p>n+a){if(d===l+r/4)return new app_Point.A(n+a,l+r/4);if(d===l+3*r/4)return new app_Point.A(n+a,l+3*r/4)}else if(p===n){if(d<h)return new app_Point.A(n,l+r/4);if(d>h)return new app_Point.A(n,l+3*r/4)}else if(p===n+a){if(d<h)return new app_Point.A(n+a,l+r/4);if(d>h)return new app_Point.A(n+a,l+3*r/4)}if(d===l)return new app_Point.A(o,l);if(d===l+r)return new app_Point.A(o,l+r);p<o?d>l+r/4&&d<l+3*r/4?(v=new app_Point.A(n,l),m=new app_Point.A(n,l+r)):d<l+r/4?(v=new app_Point.A(n-Math.floor(.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n+a,l-Math.floor(.25*r))):d>l+3*r/4&&(v=new app_Point.A(n-Math.floor(.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n+a,l+Math.floor(1.25*r))):p>o&&(d>l+r/4&&d<l+3*r/4?(v=new app_Point.A(n+a,l),m=new app_Point.A(n+a,l+r)):d<l+r/4?(v=new app_Point.A(n,l-Math.floor(.25*r)),m=new app_Point.A(n+Math.floor(1.5*a),l+Math.floor(.5*r))):d>l+3*r/4&&(v=new app_Point.A(n+Math.floor(1.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n,l+Math.floor(1.25*r))))}else{if(d===h){if(p<=n)return new app_Point.A(n,l+r/2);if(p>=n+a)return new app_Point.A(n+a,l+r/2)}else if(d<l){if(p===n+a/4)return new app_Point.A(n+a/4,l);if(p===n+3*a/4)return new app_Point.A(n+3*a/4,l)}else if(d>l+r){if(p===n+a/4)return new app_Point.A(n+a/4,l+r);if(p===n+3*a/4)return new app_Point.A(n+3*a/4,l+r)}else if(d===l){if(p<o)return new app_Point.A(n+a/4,l);if(p>o)return new app_Point.A(n+3*a/4,l)}else if(d===l+r){if(p<o)return new app_Point.A(n+a/4,l+r);if(d>h)return new app_Point.A(n+3*a/4,l+r)}if(p===n)return new app_Point.A(n,h);if(p===n+a)return new app_Point.A(n+a,h);d<h?p>n+a/4&&p<n+3*a/4?(v=new app_Point.A(n,l),m=new app_Point.A(n+a,l)):p<n+a/4?(v=new app_Point.A(n-Math.floor(.25*a),l+r),m=new app_Point.A(n+Math.floor(.5*a),l-Math.floor(.5*r))):p>n+3*a/4&&(v=new app_Point.A(n+Math.floor(.5*a),l-Math.floor(.5*r)),m=new app_Point.A(n+Math.floor(1.25*a),l+r)):d>h&&(p>n+a/4&&p<n+3*a/4?(v=new app_Point.A(n,l+r),m=new app_Point.A(n+a,l+r)):p<n+a/4?(v=new app_Point.A(n-Math.floor(.25*a),l),m=new app_Point.A(n+Math.floor(.5*a),l+Math.floor(1.5*r))):p>n+3*a/4&&(v=new app_Point.A(n+Math.floor(.5*a),l+Math.floor(1.5*r)),m=new app_Point.A(n+Math.floor(1.25*a),l)))}let t=o,e=h;p>=n&&p<=n+a?(t=p,e=d<h?l+r:l):d>=l&&d<=l+r&&(e=d,t=p<o?n+a:n),C=(0,app_mathUtils.E$)(t,e,i.x,i.y,v.x,v.y,m.x,m.y)}else{if(E){const t=Math.atan2(r/4,a/2);if(g===t)return new app_Point.A(n+a,l+Math.floor(.25*r));if(g===f)return new app_Point.A(n+Math.floor(.5*a),l);if(g===_-t)return new app_Point.A(n,l+Math.floor(.25*r));if(g===-t)return new app_Point.A(n+a,l+Math.floor(.75*r));if(g===-f)return new app_Point.A(n+Math.floor(.5*a),l+r);if(g===-_+t)return new app_Point.A(n,l+Math.floor(.75*r));g<t&&g>-t?(v=new app_Point.A(n+a,l),m=new app_Point.A(n+a,l+r)):g>t&&g<f?(v=new app_Point.A(n,l-Math.floor(.25*r)),m=new app_Point.A(n+Math.floor(1.5*a),l+Math.floor(.5*r))):g>f&&g<_-t?(v=new app_Point.A(n-Math.floor(.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n+a,l-Math.floor(.25*r))):g>_-t&&g<=_||g<-_+t&&g>=-_?(v=new app_Point.A(n,l),m=new app_Point.A(n,l+r)):g<-t&&g>-f?(v=new app_Point.A(n+Math.floor(1.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n,l+Math.floor(1.25*r))):g<-f&&g>-_+t&&(v=new app_Point.A(n-Math.floor(.5*a),l+Math.floor(.5*r)),m=new app_Point.A(n+a,l+Math.floor(1.25*r)))}else{const t=Math.atan2(r/2,a/4);if(g===t)return new app_Point.A(n+Math.floor(.75*a),l);if(g===_-t)return new app_Point.A(n+Math.floor(.25*a),l);if(g===_||g===-_)return new app_Point.A(n,l+Math.floor(.5*r));if(0===g)return new app_Point.A(n+a,l+Math.floor(.5*r));if(g===-t)return new app_Point.A(n+Math.floor(.75*a),l+r);if(g===-_+t)return new app_Point.A(n+Math.floor(.25*a),l+r);g>0&&g<t?(v=new app_Point.A(n+Math.floor(.5*a),l-Math.floor(.5*r)),m=new app_Point.A(n+Math.floor(1.25*a),l+r)):g>t&&g<_-t?(v=new app_Point.A(n,l),m=new app_Point.A(n+a,l)):g>_-t&&g<_?(v=new app_Point.A(n-Math.floor(.25*a),l+r),m=new app_Point.A(n+Math.floor(.5*a),l-Math.floor(.5*r))):g<0&&g>-t?(v=new app_Point.A(n+Math.floor(.5*a),l+Math.floor(1.5*r)),m=new app_Point.A(n+Math.floor(1.25*a),l)):g<-t&&g>-_+t?(v=new app_Point.A(n,l+r),m=new app_Point.A(n+a,l+r)):g<-_+t&&g>-_&&(v=new app_Point.A(n-Math.floor(.25*a),l),m=new app_Point.A(n+Math.floor(.5*a),l+Math.floor(1.5*r)))}C=(0,app_mathUtils.E$)(o,h,i.x,i.y,v.x,v.y,m.x,m.y)}return null==C?new app_Point.A(o,h):C},app_RectanglePerimeter=(t,e,i,s=!1)=>{const n=t.getCenterX(),l=t.getCenterY(),a=i.x-n,r=i.y-l,o=Math.atan2(r,a),h=new app_Point.A(0,0),p=Math.PI,d=Math.PI/2-o,c=Math.atan2(t.height,t.width);return o<-p+c||o>p-c?(h.x=t.x,h.y=l-t.width*Math.tan(o)/2):o<-c?(h.y=t.y,h.x=n-t.height*Math.tan(d)/2):o<c?(h.x=t.x+t.width,h.y=l+t.width*Math.tan(o)/2):(h.y=t.y+t.height,h.x=n+t.height*Math.tan(d)/2),s&&(i.x>=t.x&&i.x<=t.x+t.width?h.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(h.y=i.y),i.x<t.x?h.x=t.x:i.x>t.x+t.width&&(h.x=t.x+t.width),i.y<t.y?h.y=t.y:i.y>t.y+t.height&&(h.y=t.y+t.height)),h},app_RhombusPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width,r=t.height,o=n+a/2,h=l+r/2,p=i.x,d=i.y;if(o===p)return h>d?new app_Point.A(o,l):new app_Point.A(o,l+r);if(h===d)return o>p?new app_Point.A(n,h):new app_Point.A(n+a,h);let c=o,u=h;return s&&(p>=n&&p<=n+a?c=p:d>=l&&d<=l+r&&(u=d)),p<o?d<h?(0,app_mathUtils.E$)(p,d,c,u,o,l,n,h):(0,app_mathUtils.E$)(p,d,c,u,o,l+r,n,h):d<h?(0,app_mathUtils.E$)(p,d,c,u,o,l,n+a,h):(0,app_mathUtils.E$)(p,d,c,u,o,l+r,n+a,h)},app_TrianglePerimeter=(t,e,i,s=!1)=>{const n=null!=e?e.style.direction:null,l=n===app_Constants.M8.NORTH||n===app_Constants.M8.SOUTH,{x:a}=t,{y:r}=t,o=t.width,h=t.height;let p=a+o/2,d=r+h/2,c=new app_Point.A(a,r),u=new app_Point.A(a+o,d),g=new app_Point.A(a,r+h);n===app_Constants.M8.NORTH?(c=g,u=new app_Point.A(p,r),g=new app_Point.A(a+o,r+h)):n===app_Constants.M8.SOUTH?(u=new app_Point.A(p,r+h),g=new app_Point.A(a+o,r)):n===app_Constants.M8.WEST&&(c=new app_Point.A(a+o,r),u=new app_Point.A(a,d),g=new app_Point.A(a+o,r+h));let _=i.x-p,f=i.y-d;const C=l?Math.atan2(_,f):Math.atan2(f,_),y=l?Math.atan2(o,h):Math.atan2(h,o);let E=!1;E=n===app_Constants.M8.NORTH||n===app_Constants.M8.WEST?C>-y&&C<y:C<-Math.PI+y||C>Math.PI-y;let v=null;if(E)v=s&&(l&&i.x>=c.x&&i.x<=g.x||!l&&i.y>=c.y&&i.y<=g.y)?l?new app_Point.A(i.x,c.y):new app_Point.A(c.x,i.y):n===app_Constants.M8.NORTH?new app_Point.A(a+o/2+h*Math.tan(C)/2,r+h):n===app_Constants.M8.SOUTH?new app_Point.A(a+o/2-h*Math.tan(C)/2,r):n===app_Constants.M8.WEST?new app_Point.A(a+o,r+h/2+o*Math.tan(C)/2):new app_Point.A(a,r+h/2-o*Math.tan(C)/2);else{if(s){const t=new app_Point.A(p,d);i.y>=r&&i.y<=r+h?(t.x=l?p:n===app_Constants.M8.WEST?a+o:a,t.y=i.y):i.x>=a&&i.x<=a+o&&(t.x=i.x,t.y=l?n===app_Constants.M8.NORTH?r+h:r:d),_=i.x-t.x,f=i.y-t.y,p=t.x,d=t.y}v=l&&i.x<=a+o/2||!l&&i.y<=r+h/2?(0,app_mathUtils.E$)(i.x,i.y,p,d,c.x,c.y,u.x,u.y):(0,app_mathUtils.E$)(i.x,i.y,p,d,u.x,u.y,g.x,g.y)}return null==v&&(v=new app_Point.A(p,d)),v},app_Perimeter={RectanglePerimeter:app_RectanglePerimeter,EllipsePerimeter:app_EllipsePerimeter,RhombusPerimeter:app_RhombusPerimeter,TrianglePerimeter:app_TrianglePerimeter,HexagonPerimeter:app_HexagonPerimeter},app_style_Perimeter=app_Perimeter;var app_StyleRegistry=__webpack_require__(127);let app_isDefaultsRegistered=!1;const app_registerDefaultStyleElements=()=>{app_isDefaultsRegistered||(app_StyleRegistry.A.putValue(app_Constants.bR.ELBOW,app_style_EdgeStyle.ElbowConnector),app_StyleRegistry.A.putValue(app_Constants.bR.ENTITY_RELATION,app_style_EdgeStyle.EntityRelation),app_StyleRegistry.A.putValue(app_Constants.bR.LOOP,app_style_EdgeStyle.Loop),app_StyleRegistry.A.putValue(app_Constants.bR.MANHATTAN,app_style_EdgeStyle.ManhattanConnector),app_StyleRegistry.A.putValue(app_Constants.bR.ORTHOGONAL,app_style_EdgeStyle.OrthConnector),app_StyleRegistry.A.putValue(app_Constants.bR.SEGMENT,app_style_EdgeStyle.SegmentConnector),app_StyleRegistry.A.putValue(app_Constants.bR.SIDETOSIDE,app_style_EdgeStyle.SideToSide),app_StyleRegistry.A.putValue(app_Constants.bR.TOPTOBOTTOM,app_style_EdgeStyle.TopToBottom),app_StyleRegistry.A.putValue(app_Constants.aY.ELLIPSE,app_style_Perimeter.EllipsePerimeter),app_StyleRegistry.A.putValue(app_Constants.aY.HEXAGON,app_style_Perimeter.HexagonPerimeter),app_StyleRegistry.A.putValue(app_Constants.aY.RECTANGLE,app_style_Perimeter.RectanglePerimeter),app_StyleRegistry.A.putValue(app_Constants.aY.RHOMBUS,app_style_Perimeter.RhombusPerimeter),app_StyleRegistry.A.putValue(app_Constants.aY.TRIANGLE,app_style_Perimeter.TrianglePerimeter),app_isDefaultsRegistered=!0)},app_CellsMixin={cellsResizable:!0,cellsBendable:!0,cellsSelectable:!0,cellsDisconnectable:!0,autoSizeCells:!1,autoSizeCellsOnAdd:!1,cellsLocked:!1,cellsCloneable:!0,cellsDeletable:!0,cellsMovable:!0,extendParents:!0,extendParentsOnAdd:!0,extendParentsOnMove:!1,getBoundingBox(t){let e=null;if(t.length>0)for(const i of t)if(i.isVertex()||i.isEdge()){const t=this.getView().getBoundingBox(this.getView().getState(i),!0);t&&(e?e.add(t):e=app_Rectangle.A.fromRectangle(t))}return e},removeStateForCell(t){for(const e of t.getChildren())this.removeStateForCell(e);this.getView().invalidate(t,!1,!0),this.getView().removeState(t)},getCurrentCellStyle(t,e=!1){const i=e?null:this.getView().getState(t);return i?i.style:this.getCellStyle(t)},getCellStyle(t){const e=t.getStyle(),i=this.getStylesheet(),s=t.isEdge()?i.getDefaultEdgeStyle():i.getDefaultVertexStyle();return this.postProcessCellStyle(i.getCellStyle(e,s??{}))},postProcessCellStyle(t){if(!t.image)return t;const e=t.image;let i=this.getImageFromBundles(e);if(i?t.image=i:i=e,i&&"data:image/"===i.substring(0,11)){if("data:image/svg+xml,<"===i.substring(0,20))i=i.substring(0,19)+encodeURIComponent(i.substring(19));else if("data:image/svg+xml,%3C"!==i.substring(0,22)){const t=i.indexOf(",");t>0&&";base64,"!==i.substring(t-7,t+1)&&(i=`${i.substring(0,t)};base64,${i.substring(t+1)}`)}t.image=i}return t},setCellStyle(t,e){e=e??this.getSelectionCells(),this.batchUpdate((()=>{for(const i of e)this.getDataModel().setStyle(i,t)}))},toggleCellStyle(t,e=!1,i){return i=i??this.getSelectionCell(),this.toggleCellStyles(t,e,[i])},toggleCellStyles(t,e=!1,i){let s=!1;return(i=i??this.getSelectionCells()).length>0&&(s=!(this.getCurrentCellStyle(i[0])[t]??e),this.setCellStyles(t,s,i)),s},setCellStyles(t,e,i){i=i??this.getSelectionCells(),(0,app_styleUtils.nf)(this.getDataModel(),i,t,e)},toggleCellStyleFlags(t,e,i){i=i??this.getSelectionCells(),this.setCellStyleFlags(t,e,null,i)},setCellStyleFlags(t,e,i=null,s){(s=s??this.getSelectionCells()).length>0&&(null===i&&(i=!(((this.getCurrentCellStyle(s[0])[t]||0)&e)===e)),(0,app_styleUtils.fE)(this.getDataModel(),s,t,e,i))},alignCells(t,e,i=null){if((e=e??this.getSelectionCells()).length>1){if(null===i)for(const s of e){const e=this.getView().getState(s);if(e&&!s.isEdge())if(null===i){if(t===app_Constants.Ec.CENTER){i=e.x+e.width/2;break}if(t===app_Constants.Ec.RIGHT)i=e.x+e.width;else if(t===app_Constants.Ec.TOP)i=e.y;else{if(t===app_Constants.Ec.MIDDLE){i=e.y+e.height/2;break}i=t===app_Constants.Ec.BOTTOM?e.y+e.height:e.x}}else i=t===app_Constants.Ec.RIGHT?Math.max(i,e.x+e.width):t===app_Constants.Ec.TOP?Math.min(i,e.y):t===app_Constants.Ec.BOTTOM?Math.max(i,e.y+e.height):Math.min(i,e.x)}if(null!==i){const s=this.getView().scale;this.batchUpdate((()=>{const n=i;for(const i of e){const e=this.getView().getState(i);if(null!=e){let l=i.getGeometry();null==l||i.isEdge()||(l=l.clone(),t===app_Constants.Ec.CENTER?l.x+=(n-e.x-e.width/2)/s:t===app_Constants.Ec.RIGHT?l.x+=(n-e.x-e.width)/s:t===app_Constants.Ec.TOP?l.y+=(n-e.y)/s:t===app_Constants.Ec.MIDDLE?l.y+=(n-e.y-e.height/2)/s:t===app_Constants.Ec.BOTTOM?l.y+=(n-e.y-e.height)/s:l.x+=(n-e.x)/s,this.resizeCell(i,l))}}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ALIGN_CELLS,{align:t,cells:e}))}))}}return e},cloneCell(t,e=!1,i={},s=!1){return this.cloneCells([t],e,i,s)[0]},cloneCells(t,e=!0,i={},s=!1){let n;const l=new app_util_Dictionary.A,a=[];for(const e of t)l.put(e,!0),a.push(e);if(a.length>0){const{scale:a}=this.getView(),r=this.getView().translate,o=[];n=app_cloneCells(t,!0,i);for(let i=0;i<t.length;i+=1){const h=t[i],p=n[i];if(!e&&p.isEdge()&&null!==this.getEdgeValidationError(p,p.getTerminal(!0),p.getTerminal(!1)));else{o.push(p);const t=p.getGeometry();if(t){const e=this.getView().getState(h),i=h.getParent(),n=i?this.getView().getState(i):null;if(e&&n){const i=s?0:n.origin.x,o=s?0:n.origin.y;if(p.isEdge()){const s=e.absolutePoints;let n=h.getTerminal(!0);for(;n&&!l.get(n);)n=n.getParent();!n&&s[0]&&t.setTerminalPoint(new app_Point.A(s[0].x/a-r.x,s[0].y/a-r.y),!0);let p=h.getTerminal(!1);for(;p&&!l.get(p);)p=p.getParent();const d=s[s.length-1];!p&&d&&t.setTerminalPoint(new app_Point.A(d.x/a-r.x,d.y/a-r.y),!1);const{points:c}=t;if(c)for(const t of c)t.x+=i,t.y+=o}else t.translate(i,o)}}}}n=o}else n=[];return n},addCell(t,e=null,i=null,s=null,n=null){return this.addCells([t],e,i,s,n)[0]},addCells(t,e=null,i=null,s=null,n=null,l=!1){const a=e??this.getDefaultParent(),r=i??a.getChildCount();return this.batchUpdate((()=>{this.cellsAdded(t,a,r,s,n,l,!0),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ADD_CELLS,{cells:t,p:a,i:r,source:s,target:n}))})),t},cellsAdded(t,e,i,s=null,n=null,l=!1,a=!1,r=!0){this.batchUpdate((()=>{const o=l?this.getView().getState(e):null,h=o?o.origin:null,p=new app_Point.A(0,0);t.forEach(((t,l)=>{const o=t.getParent();if(h&&t!==e&&e!==o){const e=o?this.getView().getState(o):null,i=e?e.origin:p;let s=t.getGeometry();if(s){const e=i.x-h.x,n=i.y-h.y;s=s.clone(),s.translate(e,n),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.getDataModel().setGeometry(t,s)}}e===o&&i+l>e.getChildCount()&&i--,this.getDataModel().add(e,t,i+l),this.autoSizeCellsOnAdd&&this.autoSizeCell(t,!0),(!r||r)&&this.isExtendParentsOnAdd(t)&&this.isExtendParent(t)&&this.extendParent(t),a&&!a||this.constrainChild(t),s&&this.cellConnected(t,s,!0),n&&this.cellConnected(t,n,!1)})),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_ADDED,{cells:t,parent:e,index:i,source:s,target:n,absolute:l}))}))},autoSizeCell(t,e=!0){if(e)for(const e of t.getChildren())this.autoSizeCell(e);t.isVertex()&&this.isAutoSizeCell(t)&&this.updateCellSize(t)},removeCells(t=null,e=!0){if(t||(t=this.getDeletableCells(this.getSelectionCells())),e)t=this.getDeletableCells(this.addAllEdges(t));else{t=t.slice();const e=this.getDeletableCells(this.getAllEdges(t)),i=new app_util_Dictionary.A;for(const e of t)i.put(e,!0);for(const s of e)this.getView().getState(s)||i.get(s)||(i.put(s,!0),t.push(s))}return this.batchUpdate((()=>{this.cellsRemoved(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REMOVE_CELLS,{cells:t,includeEdges:e}))})),t??[]},cellsRemoved(t){if(t.length>0){const{scale:e}=this.getView(),i=this.getView().translate;this.batchUpdate((()=>{const s=new app_util_Dictionary.A;for(const e of t)s.put(e,!0);for(const n of t){const t=this.getAllEdges([n]),l=(t,s)=>{let l=t.getGeometry();if(l){const a=t.getTerminal(s);let r=!1,o=a;for(;o;){if(n===o){r=!0;break}o=o.getParent()}if(r){l=l.clone();const n=this.getView().getState(t);if(n){const t=n.absolutePoints,a=t[s?0:t.length-1];l.setTerminalPoint(new app_Point.A(a.x/e-i.x-n.origin.x,a.y/e-i.y-n.origin.y),s)}else if(a){const t=this.getView().getState(a);t&&l.setTerminalPoint(new app_Point.A(t.getCenterX()/e-i.x,t.getCenterY()/e-i.y),s)}this.getDataModel().setGeometry(t,l),this.getDataModel().setTerminal(t,null,s)}}};for(const e of t)s.get(e)||(s.put(e,!0),l(e,!0),l(e,!1));this.getDataModel().remove(n)}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_REMOVED,{cells:t}))}))}},toggleCells(t=!1,e,i=!0){return e=e??this.getSelectionCells(),i&&(e=this.addAllEdges(e)),this.batchUpdate((()=>{this.cellsToggled(e,t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.TOGGLE_CELLS,{show:t,cells:e,includeEdges:i}))})),e},cellsToggled(t,e=!1){t.length>0&&this.batchUpdate((()=>{for(const i of t)this.getDataModel().setVisible(i,e)}))},updateCellSize(t,e=!1){return this.batchUpdate((()=>{this.cellSizeUpdated(t,e),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.UPDATE_CELL_SIZE,{cell:t,ignoreChildren:e}))})),t},cellSizeUpdated(t,e=!1){this.batchUpdate((()=>{const i=this.getPreferredSizeForCell(t);let s=t.getGeometry();if(i&&s){const n=t.isCollapsed();if(s=s.clone(),this.isSwimlane(t)){const e=this.getCellStyle(t),l=t.getStyle();e.horizontal??1?(l.startSize=i.height+8,n&&(s.height=i.height+8),s.width=i.width):(l.startSize=i.width+8,n&&(s.width=i.width+8),s.height=i.height),this.getDataModel().setStyle(t,l)}else{const e=this.getView().createState(t),n=e.style.align??app_Constants.Ec.CENTER;n===app_Constants.Ec.RIGHT?s.x+=s.width-i.width:n===app_Constants.Ec.CENTER&&(s.x+=Math.round((s.width-i.width)/2));const l=e.getVerticalAlign();l===app_Constants.Ec.BOTTOM?s.y+=s.height-i.height:l===app_Constants.Ec.MIDDLE&&(s.y+=Math.round((s.height-i.height)/2)),s.width=i.width,s.height=i.height}if(!e&&!n){const e=this.getView().getBounds(t.getChildren());if(null!=e){const t=this.getView().translate,{scale:i}=this.getView(),n=(e.x+e.width)/i-s.x-t.x,l=(e.y+e.height)/i-s.y-t.y;s.width=Math.max(s.width,n),s.height=Math.max(s.height,l)}}this.cellsResized([t],[s],!1)}}))},getPreferredSizeForCell(t,e=null){let i=null;const s=this.getView().createState(t),{style:n}=s;if(!t.isEdge()){const t=n.fontSize||app_Constants.FV;let l=0,a=0;(s.getImageSrc()||n.image)&&n.shape===app_Constants.IW.LABEL&&(n.verticalAlign===app_Constants.Ec.MIDDLE&&(l+=n.imageWidth||app_Constants.tK),n.align!==app_Constants.Ec.CENTER&&(a+=n.imageHeight||app_Constants.tK)),l+=2*(n.spacing||0),l+=n.spacingLeft||0,l+=n.spacingRight||0,a+=2*(n.spacing||0),a+=n.spacingTop||0,a+=n.spacingBottom||0;const r=this.getFoldingImage(s);r&&(l+=r.width+8);let o=this.getCellRenderer().getLabelValue(s);if(o&&o.length>0){this.isHtmlLabel(s.cell)||(o=(0,app_StringUtils.bG)(o,!1)),o=o.replace(/\n/g,"<br>");const r=(0,app_styleUtils.i4)(o,t,n.fontFamily,e,n.fontStyle);let h=r.width+l,p=r.height+a;if(!(n.horizontal??1)){const t=p;p=h,h=t}this.isGridEnabled()&&(h=this.snap(h+this.getGridSize()/2),p=this.snap(p+this.getGridSize()/2)),i=new app_Rectangle.A(0,0,h,p)}else{const t=4*this.getGridSize();i=new app_Rectangle.A(0,0,t,t)}}return i},resizeCell(t,e,i=!1){return this.resizeCells([t],[e],i)[0]},resizeCells(t,e,i){return i=i??this.isRecursiveResize(),this.batchUpdate((()=>{const s=this.cellsResized(t,e,i);this.fireEvent(new app_EventObject.A(app_InternalEvent.A.RESIZE_CELLS,{cells:t,bounds:e,prev:s}))})),t},cellsResized(t,e,i=!1){const s=[];return t.length===e.length&&this.batchUpdate((()=>{t.forEach(((t,n)=>{s.push(this.cellResized(t,e[n],!1,i)),this.isExtendParent(t)&&this.extendParent(t),this.constrainChild(t)})),this.isResetEdgesOnResize()&&this.resetEdges(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_RESIZED,{cells:t,bounds:e,prev:s}))})),s},cellResized(t,e,i=!1,s=!1){const n=t.getGeometry();if(n&&(n.x!==e.x||n.y!==e.y||n.width!==e.width||n.height!==e.height)){const l=n.clone();if(!i&&l.relative){const{offset:t}=l;t&&(t.x+=e.x-l.x,t.y+=e.y-l.y)}else l.x=e.x,l.y=e.y;l.width=e.width,l.height=e.height,l.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(l.x=Math.max(0,l.x),l.y=Math.max(0,l.y)),this.batchUpdate((()=>{s&&this.resizeChildCells(t,l),this.getDataModel().setGeometry(t,l),this.constrainChildCells(t)}))}return n},resizeChildCells(t,e){const i=t.getGeometry();if(i){const s=0!==i.width?e.width/i.width:1,n=0!==i.height?e.height/i.height:1;for(const e of t.getChildren())this.scaleCell(e,s,n,!0)}},constrainChildCells(t){for(const e of t.getChildren())this.constrainChild(e)},scaleCell(t,e,i,s=!1){let n=t.getGeometry();if(n){const l=this.getCurrentCellStyle(t);n=n.clone();const{x:a}=n,{y:r}=n,o=n.width,h=n.height;n.scale(e,i,"fixed"===l.aspect),l.resizeWidth?n.width=o*e:l.resizeWidth||(n.width=o),l.resizeHeight?n.height=h*i:l.resizeHeight||(n.height=h),this.isCellMovable(t)||(n.x=a,n.y=r),this.isCellResizable(t)||(n.width=o,n.height=h),t.isVertex()?this.cellResized(t,n,!0,s):this.getDataModel().setGeometry(t,n)}},extendParent(t){const e=t.getParent();let i=e?e.getGeometry():null;if(e&&i&&!e.isCollapsed()){const s=t.getGeometry();s&&!s.relative&&(i.width<s.x+s.width||i.height<s.y+s.height)&&(i=i.clone(),i.width=Math.max(i.width,s.x+s.width),i.height=Math.max(i.height,s.y+s.height),this.cellsResized([e],[i],!1))}},importCells(t,e,i,s=null,n=null,l={}){return this.moveCells(t,e,i,!0,s,n,l)},moveCells(t,e=0,i=0,s=!1,n=null,l=null,a={}){if(0!==e||0!==i||s||n){const r=t=app_getTopmostCells(t);this.batchUpdate((()=>{const o=new app_util_Dictionary.A;for(const e of t)o.put(e,!0);const h=t=>{for(;t;){if(o.get(t))return!0;t=t.getParent()}return!1},p=[];for(const e of t){const t=e.getGeometry(),i=e.getParent();(!t||!t.relative||i&&!i.isEdge()||i&&!h(i.getTerminal(!0))&&!h(i.getTerminal(!1)))&&p.push(e)}t=p,s&&(t=this.cloneCells(t,this.isCloneInvalidEdges(),a),n||(n=this.getDefaultParent()));const d=this.isAllowNegativeCoordinates();if(n&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(t,e,i,!s&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),!n,this.isExtendParentsOnMove()&&!n),this.setAllowNegativeCoordinates(d),n){const e=n.getChildCount();this.cellsAdded(t,n,e,null,null,!0),s&&t.forEach(((t,e)=>{const i=t.getGeometry(),s=r[e].getParent();i&&i.relative&&s&&s.isEdge()&&this.getDataModel().contains(s)&&this.getDataModel().add(s,t)}))}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.MOVE_CELLS,{cells:t,dx:e,dy:i,clone:s,target:n,event:l}))}))}return t},cellsMoved(t,e,i,s=!1,n=!1,l=!1){0===e&&0===i||this.batchUpdate((()=>{s&&this.disconnectGraph(t);for(const s of t)this.translateCell(s,e,i),l&&this.isExtendParent(s)?this.extendParent(s):n&&this.constrainChild(s);this.isResetEdgesOnMove()&&this.resetEdges(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_MOVED,{cells:t,dx:e,dy:i,disconnect:s}))}))},translateCell(t,e,i){let s=t.getGeometry();if(s){if(s=s.clone(),s.translate(e,i),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),s.relative&&!t.isEdge()){const n=t.getParent();let l=0;if(n.isVertex()&&(l=this.getCurrentCellStyle(n).rotation??0),0!==l){const t=(0,app_mathUtils.eh)(-l),s=Math.cos(t),n=Math.sin(t),a=(0,app_mathUtils.Iq)(new app_Point.A(e,i),s,n,new app_Point.A(0,0));e=a.x,i=a.y}s.offset?(s.offset.x=s.offset.x+e,s.offset.y=s.offset.y+i):s.offset=new app_Point.A(e,i)}this.getDataModel().setGeometry(t,s)}},getCellContainmentArea(t){if(!t.isEdge()){const e=t.getParent();if(e&&e!==this.getDefaultParent()){const t=e.getGeometry();if(t){let i=0,s=0,n=t.width,l=t.height;if(this.isSwimlane(e)){const t=this.getStartSize(e),a=this.getCurrentCellStyle(e),r=a.direction??app_Constants.M8.EAST,o=a.flipH??!1,h=a.flipV??!1;if(r===app_Constants.M8.SOUTH||r===app_Constants.M8.NORTH){const e=t.width;t.width=t.height,t.height=e}(r===app_Constants.M8.EAST&&!h||r===app_Constants.M8.NORTH&&!o||r===app_Constants.M8.WEST&&h||r===app_Constants.M8.SOUTH&&o)&&(i=t.width,s=t.height),n-=t.width,l-=t.height}return new app_Rectangle.A(i,s,n,l)}}}return null},constrainChild(t,e=!0){let i=t.getGeometry();if(i&&(this.isConstrainRelativeChildren()||!i.relative)){const e=t.getParent();let s=this.getMaximumGraphBounds();if(s&&e){const t=this.getBoundingBoxFromGeometry([e],!1);t&&(s=app_Rectangle.A.fromRectangle(s),s.x-=t.x,s.y-=t.y)}if(this.isConstrainChild(t)){let e=this.getCellContainmentArea(t);if(e){const i=this.getOverlap(t);i>0&&(e=app_Rectangle.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),s?(s=app_Rectangle.A.fromRectangle(s),s.intersect(e)):s=e}}if(s){const e=[t];if(!t.isCollapsed()){const i=t.getDescendants();for(const t of i)t.isVisible()&&e.push(t)}const n=this.getBoundingBoxFromGeometry(e,!1);if(n){i=i.clone();let e=0;i.width>s.width&&(e=i.width-s.width,i.width-=e),n.x+n.width>s.x+s.width&&(e-=n.x+n.width-s.x-s.width-e);let l=0;i.height>s.height&&(l=i.height-s.height,i.height-=l),n.y+n.height>s.y+s.height&&(l-=n.y+n.height-s.y-s.height-l),n.x<s.x&&(e-=n.x-s.x),n.y<s.y&&(l-=n.y-s.y),0===e&&0===l||(i.relative?(i.offset||(i.offset=new app_Point.A),i.offset.x+=e,i.offset.y+=l):(i.x+=e,i.y+=l)),this.getDataModel().setGeometry(t,i)}}}},getChildCells(t,e=!1,i=!1){const s=(t=t??this.getDefaultParent()).getChildCells(e,i),n=[];for(const t of s)t.isVisible()&&n.push(t);return n},getCellAt(t,e,i=null,s=!0,n=!0,l=null){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i)for(let a=i.getChildCount()-1;a>=0;a--){const r=i.getChildAt(a),o=this.getCellAt(t,e,r,s,n,l);if(o)return o;if(r.isVisible()&&(n&&r.isEdge()||s&&r.isVertex())){const i=this.getView().getState(r);if(i&&(!l||!l(i,t,e))&&this.intersects(i,t,e))return r}}return null},getCells(t,e,i,s,n=null,l=[],a=null,r=null,o=!1){if(i>0||s>0||a){const h=this.getDataModel(),p=t+i,d=e+s;if(n||(n=this.getCurrentRoot())||(n=h.getRoot()),n)for(const h of n.getChildren()){const n=this.getView().getState(h);if(n&&h.isVisible()&&(!r||!r(n))){const c=n.style.rotation??0;let u=n;0!==c&&(u=(0,app_mathUtils.UX)(u,c));const g=a&&h.isVertex()&&(0,app_mathUtils.HY)(a,u)||!a&&(h.isEdge()||h.isVertex())&&u.x>=t&&u.y+u.height<=d&&u.y>=e&&u.x+u.width<=p;g&&l.push(h),g&&!o||this.getCells(t,e,i,s,h,l,a,r,o)}}}return l},getCellsBeyond(t,e,i=null,s=!1,n=!1){const l=[];if((s||n)&&(i||(i=this.getDefaultParent()),i))for(const a of i.getChildren()){const i=this.getView().getState(a);a.isVisible()&&i&&(!s||i.x>=t)&&(!n||i.y>=e)&&l.push(a)}return l},intersects(t,e,i){const s=t.absolutePoints;if(s.length>0){const t=this.getEventTolerance()*this.getEventTolerance();let n=s[0];for(let l=1;l<s.length;l+=1){const a=s[l];if(n&&a&&(0,app_mathUtils.E8)(n.x,n.y,a.x,a.y,e,i)<=t)return!0;n=a}}else{const s=(0,app_mathUtils.eh)(t.style.rotation??0);if(0!==s){const n=Math.cos(-s),l=Math.sin(-s),a=new app_Point.A(t.getCenterX(),t.getCenterY()),r=(0,app_mathUtils.Iq)(new app_Point.A(e,i),n,l,a);e=r.x,i=r.y}if((0,app_mathUtils.gR)(t,e,i))return!0}return!1},isValidAncestor:(t,e,i=!1)=>i?e.isAncestor(t):t?.getParent()===e,isCellLocked(t){const e=t.getGeometry();return this.isCellsLocked()||!!e&&t.isVertex()&&e.relative},isCellsLocked(){return this.cellsLocked},setCellsLocked(t){this.cellsLocked=t},getCloneableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellCloneable(t)))},isCellCloneable(t){return this.isCellsCloneable()&&(this.getCurrentCellStyle(t).cloneable??!0)},isCellsCloneable(){return this.cellsCloneable},setCellsCloneable(t){this.cellsCloneable=t},getExportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canExportCell(t)))},canExportCell(t=null){return this.isExportEnabled()},getImportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canImportCell(t)))},canImportCell(t=null){return this.isImportEnabled()},isCellSelectable(t){return this.isCellsSelectable()},isCellsSelectable(){return this.cellsSelectable},setCellsSelectable(t){this.cellsSelectable=t},getDeletableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellDeletable(t)))},isCellDeletable(t){return this.isCellsDeletable()&&(this.getCurrentCellStyle(t).deletable??!0)},isCellsDeletable(){return this.cellsDeletable},setCellsDeletable(t){this.cellsDeletable=t},isCellRotatable(t){return this.getCurrentCellStyle(t).rotatable??!0},getMovableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellMovable(t)))},isCellMovable(t){return this.isCellsMovable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).movable??!0)},isCellsMovable(){return this.cellsMovable},setCellsMovable(t){this.cellsMovable=t},isCellResizable(t){return this.isCellsResizable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).resizable??!0)},isCellsResizable(){return this.cellsResizable},setCellsResizable(t){this.cellsResizable=t},isCellBendable(t){return this.isCellsBendable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).bendable??!0)},isCellsBendable(){return this.cellsBendable},setCellsBendable(t){this.cellsBendable=t},isAutoSizeCell(t){return this.isAutoSizeCells()||(this.getCurrentCellStyle(t).autoSize??!1)},isAutoSizeCells(){return this.autoSizeCells},setAutoSizeCells(t){this.autoSizeCells=t},isExtendParent(t){return!t.isEdge()&&this.isExtendParents()},isExtendParents(){return this.extendParents},setExtendParents(t){this.extendParents=t},isExtendParentsOnAdd(t){return this.extendParentsOnAdd},setExtendParentsOnAdd(t){this.extendParentsOnAdd=t},isExtendParentsOnMove(){return this.extendParentsOnMove},setExtendParentsOnMove(t){this.extendParentsOnMove=t},getCursorForCell:t=>null,getCellBounds(t,e=!1,i=!1){let s=[t];e&&(s=s.concat(t.getEdges()));let n=this.getView().getBounds(s);if(i)for(const i of t.getChildren()){const t=this.getCellBounds(i,e,!0);n&&t?n.add(t):n=t}return n},getBoundingBoxFromGeometry(t,e=!1){let i=null,s=null;for(const n of t)if(e||n.isVertex()){const e=n.getGeometry();if(e){let l=null;if(n.isEdge()){const t=t=>{t&&(s?s.add(new app_Rectangle.A(t.x,t.y,0,0)):s=new app_Rectangle.A(t.x,t.y,0,0))};n.getTerminal(!0)||t(e.getTerminalPoint(!0)),n.getTerminal(!1)||t(e.getTerminalPoint(!1));const i=e.points;if(i&&i.length>0){s=new app_Rectangle.A(i[0].x,i[0].y,0,0);for(let e=1;e<i.length;e++)t(i[e])}l=s}else{const i=n.getParent();e.relative&&i?i.isVertex()&&i!==this.getView().currentRoot&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l=new app_Rectangle.A(e.x*s.width,e.y*s.height,e.width,e.height),t.indexOf(i)>=0&&(l.x+=s.x,l.y+=s.y))):(l=app_Rectangle.A.fromRectangle(e),i&&i.isVertex()&&t.indexOf(i)>=0&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l.x+=s.x,l.y+=s.y))),l&&e.offset&&(l.x+=e.offset.x,l.y+=e.offset.y);const a=this.getCurrentCellStyle(n);if(l){const t=a.rotation??0;0!==t&&(l=(0,app_mathUtils.UX)(l,t))}}l&&(i?i.add(l):i=app_Rectangle.A.fromRectangle(l))}}return i}},app_ConnectionsMixin={constrainChildren:!0,constrainRelativeChildren:!1,disconnectOnMove:!0,cellsDisconnectable:!0,getOutlineConstraint(t,e,i){if(e.shape){const i=this.getView().getPerimeterBounds(e),s=e.style.direction;if(s===app_Constants.M8.NORTH||s===app_Constants.M8.SOUTH){i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2;const t=i.width;i.width=i.height,i.height=t}const n=(0,app_mathUtils.eh)(e.shape.getShapeRotation());if(0!==n){const e=Math.cos(-n),s=Math.sin(-n),l=new app_Point.A(i.getCenterX(),i.getCenterY());t=(0,app_mathUtils.Iq)(t,e,s,l)}let l=1,a=1,r=0,o=0;if(e.cell.isVertex()){let t=e.style.flipH,n=e.style.flipV;if(s===app_Constants.M8.NORTH||s===app_Constants.M8.SOUTH){const e=t;t=n,n=e}t&&(l=-1,r=-i.width),n&&(a=-1,o=-i.height)}t=new app_Point.A((t.x-i.x)*l-r+i.x,(t.y-i.y)*a-o+i.y);const h=0===i.width?0:Math.round(1e3*(t.x-i.x)/i.width)/1e3,p=0===i.height?0:Math.round(1e3*(t.y-i.y)/i.height)/1e3;return new app_other_ConnectionConstraint(new app_Point.A(h,p),!1)}return null},getAllConnectionConstraints:(t,e)=>t?.shape?.stencil?.constraints??null,getConnectionConstraint(t,e,i=!1){let s=null;const n=t.style[i?"exitX":"entryX"];if(void 0!==n){const e=t.style[i?"exitY":"entryY"];void 0!==e&&(s=new app_Point.A(n,e))}let l=!1,a=0,r=0;return s&&(l=t.style[i?"exitPerimeter":"entryPerimeter"]||!1,a=t.style[i?"exitDx":"entryDx"],r=t.style[i?"exitDy":"entryDy"],a=Number.isFinite(a)?a:0,r=Number.isFinite(r)?r:0),new app_other_ConnectionConstraint(s,l,null,a,r)},setConnectionConstraint(t,e,i=!1,s=null){s&&this.batchUpdate((()=>{s&&s.point?s.point&&(this.setCellStyles(i?"exitX":"entryX",s.point.x,[t]),this.setCellStyles(i?"exitY":"entryY",s.point.y,[t]),this.setCellStyles(i?"exitDx":"entryDx",s.dx,[t]),this.setCellStyles(i?"exitDy":"entryDy",s.dy,[t]),s.perimeter?this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]):this.setCellStyles(i?"exitPerimeter":"entryPerimeter","0",[t])):(this.setCellStyles(i?"exitX":"entryX",null,[t]),this.setCellStyles(i?"exitY":"entryY",null,[t]),this.setCellStyles(i?"exitDx":"entryDx",null,[t]),this.setCellStyles(i?"exitDy":"entryDy",null,[t]),this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]))}))},getConnectionPoint(t,e,i=!0){let s=null;if(e.point){const i=this.getView().getPerimeterBounds(t),n=new app_Point.A(i.getCenterX(),i.getCenterY()),l=t.style.direction;let a=0;t.style.anchorPointDirection&&(l===app_Constants.M8.NORTH?a+=270:l===app_Constants.M8.WEST?a+=180:l===app_Constants.M8.SOUTH&&(a+=90),l!==app_Constants.M8.NORTH&&l!==app_Constants.M8.SOUTH||i.rotate90());const{scale:r}=this.getView();s=new app_Point.A(i.x+e.point.x*i.width+e.dx*r,i.y+e.point.y*i.height+e.dy*r);let o=t.style.rotation||0;if(e.perimeter){if(0!==a){let t=0,e=0;90===a?e=1:180===a?t=-1:270===a&&(e=-1),s=(0,app_mathUtils.Iq)(s,t,e,n)}s=this.getView().getPerimeterPoint(t,s,!1)}else if(o+=a,t.cell.isVertex()){let e=t.style.flipH,n=t.style.flipV;if(l===app_Constants.M8.NORTH||l===app_Constants.M8.SOUTH){const t=e;e=n,n=t}e&&(s.x=2*i.getCenterX()-s.x),n&&(s.y=2*i.getCenterY()-s.y)}if(0!==o&&s){const t=(0,app_mathUtils.eh)(o),e=Math.cos(t),i=Math.sin(t);s=(0,app_mathUtils.Iq)(s,e,i,n)}}return i&&s&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),s},connectCell(t,e=null,i=!1,s=null){return this.batchUpdate((()=>{const n=t.getTerminal(i);this.cellConnected(t,e,i,s),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CONNECT_CELL,"edge",t,"terminal",e,"source",i,"previous",n))})),t},cellConnected(t,e,i=!1,s=null){this.batchUpdate((()=>{const n=t.getTerminal(i);if(this.setConnectionConstraint(t,e,i,s),this.isPortsEnabled()){let s=null;e&&this.isPort(e)&&(s=e.getId(),e=this.getTerminalForPort(e,i));const n=i?"sourcePort":"targetPort";this.setCellStyles(n,s,[t])}this.getDataModel().setTerminal(t,e,i),this.isResetEdgesOnConnect()&&this.resetEdge(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELL_CONNECTED,"edge",t,"terminal",e,"source",i,"previous",n))}))},disconnectGraph(t){this.batchUpdate((()=>{const{scale:e,translate:i}=this.getView(),s=new app_util_Dictionary.A;for(let e=0;e<t.length;e+=1)s.put(t[e],!0);for(const n of t)if(n.isEdge()){let t=n.getGeometry();if(t){const l=this.getView().getState(n),a=n.getParent(),r=a?this.getView().getState(a):null;if(l&&r){t=t.clone();const a=-r.origin.x,o=-r.origin.y,h=l.absolutePoints;let p=n.getTerminal(!0);if(p&&this.isCellDisconnectable(n,p,!0)){for(;p&&!s.get(p);)p=p.getParent();!p&&h[0]&&(t.setTerminalPoint(new app_Point.A(h[0].x/e-i.x+a,h[0].y/e-i.y+o),!0),this.getDataModel().setTerminal(n,null,!0))}let d=n.getTerminal(!1);if(d&&this.isCellDisconnectable(n,d,!1)){for(;d&&!s.get(d);)d=d.getParent();if(!d){const s=h[h.length-1];s&&(t.setTerminalPoint(new app_Point.A(s.x/e-i.x+a,s.y/e-i.y+o),!1),this.getDataModel().setTerminal(n,null,!1))}}this.getDataModel().setGeometry(n,t)}}}}))},getConnections(t,e=null){return this.getEdges(t,e,!0,!0,!1)},isConstrainChild(t){return this.isConstrainChildren()&&!!t.getParent()&&!t.getParent().isEdge()},isConstrainChildren(){return this.constrainChildren},setConstrainChildren(t){this.constrainChildren=t},isConstrainRelativeChildren(){return this.constrainRelativeChildren},setConstrainRelativeChildren(t){this.constrainRelativeChildren=t},isDisconnectOnMove(){return this.disconnectOnMove},setDisconnectOnMove(t){this.disconnectOnMove=t},isCellDisconnectable(t,e=null,i=!1){return this.isCellsDisconnectable()&&!this.isCellLocked(t)},isCellsDisconnectable(){return this.cellsDisconnectable},setCellsDisconnectable(t){this.cellsDisconnectable=t},isValidSource(t){return null==t&&this.isAllowDanglingEdges()||null!=t&&(!t.isEdge()||this.isConnectableEdges())&&t.isConnectable()},isValidTarget(t){return this.isValidSource(t)},isValidConnection(t,e){return this.isValidSource(t)&&this.isValidTarget(e)},setConnectable(t){const e=this.getPlugin("ConnectionHandler");e?.setEnabled(t)},isConnectable(){const t=this.getPlugin("ConnectionHandler");return t?.isEnabled()??!1}},app_DragDropMixin={dropEnabled:!1,splitEnabled:!0,autoScroll:!0,isAutoScroll(){return this.autoScroll},autoExtend:!0,isAutoExtend(){return this.autoExtend},isDropEnabled(){return this.dropEnabled},setDropEnabled(t){this.dropEnabled=t},isSplitEnabled(){return this.splitEnabled},setSplitEnabled(t){this.splitEnabled=t},isSplitTarget(t,e=[],i){if(t.isEdge()&&1===e.length&&e[0].isConnectable()&&!this.getEdgeValidationError(t,t.getTerminal(!0),e[0])){const i=t.getTerminal(!0),s=t.getTerminal(!1);return!e[0].isAncestor(i)&&!e[0].isAncestor(s)}return!1}},app_EdgeMixin={resetEdgesOnResize:!1,isResetEdgesOnResize(){return this.resetEdgesOnResize},resetEdgesOnMove:!1,isResetEdgesOnMove(){return this.resetEdgesOnMove},resetEdgesOnConnect:!0,isResetEdgesOnConnect(){return this.resetEdgesOnConnect},connectableEdges:!1,allowDanglingEdges:!0,cloneInvalidEdges:!1,alternateEdgeStyle:{},edgeLabelsMovable:!0,isEdgeLabelsMovable(){return this.edgeLabelsMovable},setEdgeLabelsMovable(t){this.edgeLabelsMovable=t},setAllowDanglingEdges(t){this.allowDanglingEdges=t},isAllowDanglingEdges(){return this.allowDanglingEdges},setConnectableEdges(t){this.connectableEdges=t},isConnectableEdges(){return this.connectableEdges},setCloneInvalidEdges(t){this.cloneInvalidEdges=t},isCloneInvalidEdges(){return this.cloneInvalidEdges},flipEdge(t){return this.alternateEdgeStyle&&this.batchUpdate((()=>{const e=t.getStyle();Object.keys(e).length?this.getDataModel().setStyle(t,this.alternateEdgeStyle):this.getDataModel().setStyle(t,{}),this.resetEdge(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.FLIP_EDGE,{edge:t}))})),t},splitEdge(t,e,i,s=0,n=0,l,a,r=null){r=r??t.getParent();const o=t.getTerminal(!0);return this.batchUpdate((()=>{if(!i){i=this.cloneCell(t);const e=this.getView().getState(t);let l=i.getGeometry();if(l&&e){const i=this.getView().translate,a=this.getView().scale,r=(0,app_mathUtils.JQ)(e,(s+i.x)*a,(n+i.y)*a);l.points=l.points.slice(0,r),l=t.getGeometry(),l&&(l=l.clone(),l.points=l.points.slice(r),this.getDataModel().setGeometry(t,l))}}this.cellsMoved(e,s,n,!1,!1),this.cellsAdded(e,r,r?r.getChildCount():0,null,null,!0),this.cellsAdded([i],r,r?r.getChildCount():0,o,e[0],!1),this.cellConnected(t,e[0],!0),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.SPLIT_EDGE,{edge:t,cells:e,newEdge:i,dx:s,dy:n}))})),i},insertEdge(...t){let e,i,s,n,l,a;if(1===t.length&&"object"==typeof t[0]){const r=t[0];e=r.parent,i=r.id,s=r.value,n=r.source,l=r.target,a=r.style}else[e,i,s,n,l,a]=t;const r=this.createEdge(e,i,s,n,l,a);return this.addEdge(r,e,n,l)},createEdge(t=null,e,i,s=null,n=null,l={}){const a=new app_cell_Cell(i,new app_geometry_Geometry,l);return a.setId(e),a.setEdge(!0),a.geometry.relative=!0,a},addEdge(t,e=null,i=null,s=null,n=null){return this.addCell(t,e,n,i,s)},addAllEdges(t){const e=t.slice();return app_removeDuplicates(e.concat(this.getAllEdges(t)))},getAllEdges(t){let e=[];if(t)for(let i=0;i<t.length;i+=1){const s=t[i].getEdgeCount();for(let n=0;n<s;n++)e.push(t[i].getEdgeAt(n));const n=t[i].getChildren();e=e.concat(this.getAllEdges(n))}return e},getIncomingEdges(t,e=null){return this.getEdges(t,e,!0,!1,!1)},getOutgoingEdges(t,e=null){return this.getEdges(t,e,!1,!0,!1)},getEdges(t,e=null,i=!0,s=!0,n=!0,l=!1){let a=[];const r=t.isCollapsed(),o=t.getChildCount();for(let e=0;e<o;e+=1){const n=t.getChildAt(e);!r&&n.isVisible()||(a=a.concat(n.getEdges(i,s)))}a=a.concat(t.getEdges(i,s));const h=[];for(let r=0;r<a.length;r+=1){const o=this.getView().getState(a[r]),p=o?o.getVisibleTerminal(!0):this.getView().getVisibleTerminal(a[r],!0),d=o?o.getVisibleTerminal(!1):this.getView().getVisibleTerminal(a[r],!1);(n&&p===d||p!==d&&(i&&d===t&&(!e||this.isValidAncestor(p,e,l))||s&&p===t&&(!e||this.isValidAncestor(d,e,l))))&&h.push(a[r])}return h},getChildEdges(t){return this.getChildCells(t,!1,!0)},getEdgesBetween(t,e,i=!1){const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const a=this.getView().getState(s[l]),r=a?a.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[l],!0),o=a?a.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[l],!1);(r===t&&o===e||!i&&r===e&&o===t)&&n.push(s[l])}return n},resetEdges(t){const e=new app_util_Dictionary.A;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getEdges();for(let t=0;t<s.length;t++){const i=this.getView().getState(s[t]),n=i?i.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[t],!0),l=i?i.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[t],!1);e.get(n)&&e.get(l)||this.resetEdge(s[t])}this.resetEdges(t[i].getChildren())}}))},resetEdge(t){let e=t.getGeometry();return e&&e.points&&e.points.length>0&&(e=e.clone(),e.points=[],this.getDataModel().setGeometry(t,e)),t}},app_EditingMixin={cellsEditable:!0,startEditing(t){this.startEditingAtCell(null,t)},startEditingAtCell(t=null,e){if(!e||!(0,app_EventUtils.DO)(e))if(t){this.fireEvent(new app_EventObject.A(app_InternalEvent.A.START_EDITING,{cell:t,event:e}));const i=this.getPlugin("CellEditorHandler");i?.startEditing(t,e),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.EDITING_STARTED,{cell:t,event:e}))}else(t=this.getSelectionCell())&&!this.isCellEditable(t)&&(t=null)},getEditingValue(t,e){return this.convertValueToString(t)},stopEditing(t=!1){const e=this.getPlugin("CellEditorHandler");e?.stopEditing(t),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.EDITING_STOPPED,{cancel:t}))},labelChanged(t,e,i){return this.batchUpdate((()=>{const s=t.value;this.cellLabelChanged(t,e,this.isAutoSizeCell(t)),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.LABEL_CHANGED,{cell:t,value:e,old:s,event:i}))})),t},cellLabelChanged(t,e,i=!1){this.batchUpdate((()=>{this.getDataModel().setValue(t,e),i&&this.cellSizeUpdated(t,!1)}))},isEditing(t=null){const e=this.getPlugin("CellEditorHandler"),i=e?.getEditingCell();return t?t===i:!!i},isCellEditable(t){return this.isCellsEditable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).editable??!0)},isCellsEditable(){return this.cellsEditable},setCellsEditable(t){this.cellsEditable=t}},app_EventsMixin={lastTouchEvent:null,doubleClickCounter:0,lastTouchCell:null,fireDoubleClick:null,tapAndHoldThread:null,lastMouseX:null,lastMouseY:null,isMouseTrigger:null,ignoreMouseEvents:null,mouseMoveRedirect:null,mouseUpRedirect:null,lastEvent:null,escapeEnabled:!0,invokesStopCellEditing:!0,enterStopsCellEditing:!1,isMouseDown:!1,nativeDblClickEnabled:!0,doubleTapEnabled:!0,doubleTapTimeout:500,doubleTapTolerance:25,lastTouchX:0,lastTouchY:0,lastTouchTime:0,tapAndHoldEnabled:!0,tapAndHoldDelay:500,tapAndHoldInProgress:!1,tapAndHoldValid:!1,initialTouchX:0,initialTouchY:0,tolerance:4,isNativeDblClickEnabled(){return this.nativeDblClickEnabled},getEventTolerance(){return this.tolerance},setEventTolerance(t){this.tolerance=t},escape(t){this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ESCAPE,{event:t}))},click(t){const e=t.getEvent();let i=t.getCell();const s=new app_EventObject.A(app_InternalEvent.A.CLICK,{event:e,cell:i});if(t.isConsumed()&&s.consume(),this.fireEvent(s),this.isEnabled()&&!(0,app_EventUtils.fm)(e)&&!s.isConsumed()){if(i){if(this.isTransparentClickEvent(e)){let e=!1;const s=this.getCellAt(t.graphX,t.graphY,null,!1,!1,(t=>{const s=this.isCellSelected(t.cell);return e=e||s,!e||s||t.cell!==i&&t.cell.isAncestor(i)}));s&&(i=s)}}else if(this.isSwimlaneSelectionEnabled()&&(i=this.getSwimlaneAt(t.getGraphX(),t.getGraphY()),!(null==i||this.isToggleEvent(e)&&(0,app_EventUtils.CA)(e)))){let t=i,s=[];for(;null!=t;){t=t.getParent();const e=this.getView().getState(t);this.isSwimlane(t)&&null!=e&&s.push(t)}if(s.length>0){s=s.reverse(),s.splice(0,0,i),s.push(i);for(let t=0;t<s.length-1;t+=1)this.isCellSelected(s[t])&&(i=s[this.isToggleEvent(e)?t:t+1])}}i?this.selectCellForEvent(i,e):this.isToggleEvent(e)||this.clearSelection()}return!1},dblClick(t,e=null){const i=new app_EventObject.A(app_InternalEvent.A.DOUBLE_CLICK,{event:t,cell:e});this.fireEvent(i),this.isEnabled()&&!(0,app_EventUtils.fm)(t)&&!i.isConsumed()&&e&&this.isCellEditable(e)&&!this.isEditing(e)&&(this.startEditingAtCell(e,t),app_InternalEvent.A.consume(t))},tapAndHold(t){const e=t.getEvent(),i=new app_EventObject.A(app_InternalEvent.A.TAP_AND_HOLD,{event:e,cell:t.getCell()}),s=this.getPlugin("PanningHandler"),n=this.getPlugin("ConnectionHandler");if(this.fireEvent(i),i.isConsumed()&&s&&(s.panningTrigger=!1),this.isEnabled()&&!(0,app_EventUtils.fm)(e)&&!i.isConsumed()&&n&&n.isEnabled()){const e=n.marker.getCell(t);if(e){const i=this.getView().getState(e);i&&(n.marker.currentColor=n.marker.validColor,n.marker.markedState=i,n.marker.mark(),n.first=new app_Point.A(t.getGraphX(),t.getGraphY()),n.edgeState=n.createEdgeState(t),n.previous=i,n.fireEvent(new app_EventObject.A(app_InternalEvent.A.START,{state:n.previous})))}}},addMouseListener(t){this.mouseListeners.push(t)},removeMouseListener(t){for(let e=0;e<this.mouseListeners.length;e+=1)if(this.mouseListeners[e]===t){this.mouseListeners.splice(e,1);break}},updateMouseEvent(t,e){const i=(0,app_styleUtils.ce)(this.getContainer(),t.getX(),t.getY());if(t.graphX=i.x-this.getPanDx(),t.graphY=i.y-this.getPanDy(),!t.getCell()&&this.isMouseDown&&e===app_InternalEvent.A.MOUSE_MOVE){const e=this.getCellAt(i.x,i.y,null,!0,!0,(t=>!t.shape||t.shape.paintBackground!==this.paintBackground||t.style.pointerEvents||t.shape.fill!==app_Constants.x3));t.state=e?this.getView().getState(e):null}return t},getStateForTouchEvent(t){const e=(0,app_EventUtils.El)(t),i=(0,app_EventUtils.xJ)(t),s=(0,app_styleUtils.ce)(this.getContainer(),e,i),n=this.getCellAt(s.x,s.y);return n?this.getView().getState(n):null},isEventIgnored(t,e,i){const s=(0,app_EventUtils.Er)(e.getEvent());let n=!1;e.getEvent()===this.lastEvent?n=!0:this.lastEvent=e.getEvent();const l=this.getEventSource();return l&&t!==app_InternalEvent.A.MOUSE_MOVE?(app_InternalEvent.A.removeGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.setEventSource(null)):!app_Client.A.IS_GC&&l&&e.getSource()!==l?n=!0:l&&app_Client.A.IS_TOUCH&&t===app_InternalEvent.A.MOUSE_DOWN&&!s&&!(0,app_EventUtils.ew)(e.getEvent())&&(this.setEventSource(e.getSource()),this.mouseMoveRedirect=t=>{this.fireMouseEvent(app_InternalEvent.A.MOUSE_MOVE,new app_InternalMouseEvent.A(t,this.getStateForTouchEvent(t)))},this.mouseUpRedirect=t=>{this.fireMouseEvent(app_InternalEvent.A.MOUSE_UP,new app_InternalMouseEvent.A(t,this.getStateForTouchEvent(t)))},app_InternalEvent.A.addGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(t,e,i)&&(n=!0),!(0,app_EventUtils.$Y)(this.lastEvent)&&t!==app_InternalEvent.A.MOUSE_MOVE&&2===this.lastEvent.detail||(t===app_InternalEvent.A.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:t!==app_InternalEvent.A.MOUSE_DOWN||this.isMouseDown?!n&&((!app_Client.A.IS_FF||t!==app_InternalEvent.A.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!==s||t===app_InternalEvent.A.MOUSE_DOWN&&this.isMouseDown||t===app_InternalEvent.A.MOUSE_UP&&!this.isMouseDown)&&(n=!0):(this.isMouseDown=!0,this.isMouseTrigger=s),n||t!==app_InternalEvent.A.MOUSE_DOWN||(this.lastMouseX=e.getX(),this.lastMouseY=e.getY()),n)},isSyntheticEventIgnored(t,e,i){let s=!1;const n=(0,app_EventUtils.Er)(e.getEvent());return this.ignoreMouseEvents&&n&&t!==app_InternalEvent.A.MOUSE_MOVE?(this.ignoreMouseEvents=t!==app_InternalEvent.A.MOUSE_UP,s=!0):app_Client.A.IS_FF&&!n&&t===app_InternalEvent.A.MOUSE_UP&&(this.ignoreMouseEvents=!0),s},isEventSourceIgnored(t,e){const i=e.getSource();if(!i)return!0;const s=i.nodeName?i.nodeName.toLowerCase():"",n=!(0,app_EventUtils.Er)(e.getEvent())||(0,app_EventUtils.Lg)(e.getEvent());return t===app_InternalEvent.A.MOUSE_DOWN&&n&&("select"===s||"option"===s||"input"===s&&"checkbox"!==i.type&&"radio"!==i.type&&"button"!==i.type&&"submit"!==i.type&&"file"!==i.type)},getEventState:t=>t,fireMouseEvent(t,e,i){if(i=i??this,this.isEventSourceIgnored(t,e)){const t=this.getPlugin("TooltipHandler");t&&t.hide()}else{if(e=this.updateMouseEvent(e,t),!this.nativeDblClickEnabled&&!(0,app_EventUtils.$Y)(e.getEvent())||this.doubleTapEnabled&&app_Client.A.IS_TOUCH&&((0,app_EventUtils.kH)(e.getEvent())||(0,app_EventUtils.ew)(e.getEvent()))){const i=(new Date).getTime();if(t===app_InternalEvent.A.MOUSE_DOWN)if(this.lastTouchEvent&&this.lastTouchEvent!==e.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter+=1;let i=!1;if(t===app_InternalEvent.A.MOUSE_UP){if(e.getCell()===this.lastTouchCell&&this.lastTouchCell){this.lastTouchTime=0;const t=this.lastTouchCell;this.lastTouchCell=null,this.dblClick(e.getEvent(),t),i=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(i)return void app_InternalEvent.A.consume(e.getEvent())}else this.lastTouchEvent&&this.lastTouchEvent===e.getEvent()||(this.lastTouchCell=e.getCell(),this.lastTouchX=e.getX(),this.lastTouchY=e.getY(),this.lastTouchTime=i,this.lastTouchEvent=e.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||t===app_InternalEvent.A.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;const t=this.lastTouchCell;return this.lastTouchCell=null,this.isMouseDown=!1,void((t||((0,app_EventUtils.kH)(e.getEvent())||(0,app_EventUtils.ew)(e.getEvent()))&&(app_Client.A.IS_GC||app_Client.A.IS_SF))&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance?this.dblClick(e.getEvent(),t):app_InternalEvent.A.consume(e.getEvent()))}}if(!this.isEventIgnored(t,e,i)){const s=e.getState();if(e.state=s?this.getEventState(s):null,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.FIRE_MOUSE_EVENT,{eventName:t,event:e})),app_Client.A.IS_SF||app_Client.A.IS_GC||e.getEvent().target!==this.getContainer()){const s=this.getContainer();if(t===app_InternalEvent.A.MOUSE_MOVE&&this.isMouseDown&&this.isAutoScroll()&&!(0,app_EventUtils.DO)(e.getEvent()))this.scrollPointToVisible(e.getGraphX(),e.getGraphY(),this.isAutoExtend());else if(t===app_InternalEvent.A.MOUSE_UP&&this.isIgnoreScrollbars()&&this.isTranslateToScrollPosition()&&(0!==s.scrollLeft||0!==s.scrollTop)){const t=this.getView().scale,e=this.getView().translate;this.getView().setTranslate(e.x-s.scrollLeft/t,e.y-s.scrollTop/t),s.scrollLeft=0,s.scrollTop=0}const n=this.mouseListeners;e.getEvent().preventDefault||(e.getEvent().returnValue=!0);for(const s of n)t===app_InternalEvent.A.MOUSE_DOWN?s.mouseDown(i,e):t===app_InternalEvent.A.MOUSE_MOVE?s.mouseMove(i,e):t===app_InternalEvent.A.MOUSE_UP&&s.mouseUp(i,e);t===app_InternalEvent.A.MOUSE_UP&&this.click(e)}if(((0,app_EventUtils.kH)(e.getEvent())||(0,app_EventUtils.ew)(e.getEvent()))&&t===app_InternalEvent.A.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=e.getGraphX(),this.initialTouchY=e.getGraphY();const t=()=>{this.tapAndHoldValid&&this.tapAndHold(e),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(t,this.tapAndHoldDelay),this.tapAndHoldValid=!0}else t===app_InternalEvent.A.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-e.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-e.getGraphY())<this.tolerance);const n=this.getPlugin("CellEditorHandler");t===app_InternalEvent.A.MOUSE_DOWN&&this.isEditing()&&!n?.isEventSource(e.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(t,e,i)}}},consumeMouseEvent(t,e,i){i=i??this,t===app_InternalEvent.A.MOUSE_DOWN&&(0,app_EventUtils.kH)(e.getEvent())&&e.consume(!1)},fireGestureEvent(t,e=null){this.lastTouchTime=0,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.GESTURE,{event:t,cell:e}))},sizeDidChange(){const t=this.getGraphBounds(),e=this.getBorder();let i=Math.max(0,t.x)+t.width+2*e,s=Math.max(0,t.y)+t.height+2*e;const n=this.getMinimumContainerSize();if(n&&(i=Math.max(i,n.width),s=Math.max(s,n.height)),this.isResizeContainer()&&this.doResizeContainer(i,s),this.isPreferPageSize()||this.isPageVisible()){const e=this.getPreferredPageSize(t,Math.max(1,i),Math.max(1,s));i=e.width*this.getView().scale,s=e.height*this.getView().scale}const l=this.getMinimumGraphSize();l&&(i=Math.max(i,l.width*this.getView().scale),s=Math.max(s,l.height*this.getView().scale)),i=Math.ceil(i),s=Math.ceil(s);const a=this.getView().getDrawPane().ownerSVGElement;a&&(a.style.minWidth=`${Math.max(1,i)}px`,a.style.minHeight=`${Math.max(1,s)}px`,a.style.width="100%",a.style.height="100%"),this.updatePageBreaks(this.isPageBreaksVisible(),i,s),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.SIZE,{bounds:t}))},isCloneEvent:t=>(0,app_EventUtils.qt)(t),isTransparentClickEvent:t=>!1,isToggleEvent:t=>app_Client.A.IS_MAC?(0,app_EventUtils.UT)(t):(0,app_EventUtils.qt)(t),isGridEnabledEvent:t=>!(0,app_EventUtils.CA)(t),isConstrainedEvent:t=>(0,app_EventUtils.RT)(t),isIgnoreTerminalEvent:t=>!1,getPointForEvent(t,e=!0){const i=(0,app_styleUtils.ce)(this.getContainer(),(0,app_EventUtils.El)(t),(0,app_EventUtils.xJ)(t)),s=this.getView().scale,n=this.getView().translate,l=e?this.getGridSize()/2:0;return i.x=this.snap(i.x/s-n.x-l),i.y=this.snap(i.y/s-n.y-l),i},isEscapeEnabled(){return this.escapeEnabled},setEscapeEnabled(t){this.escapeEnabled=t},isInvokesStopCellEditing(){return this.invokesStopCellEditing},setInvokesStopCellEditing(t){this.invokesStopCellEditing=t},isEnterStopsCellEditing(){return this.enterStopsCellEditing},setEnterStopsCellEditing(t){this.enterStopsCellEditing=t},getCursorForMouseEvent(t){const e=t.getCell();return e?this.getCursorForCell(e):null}},app_FoldingMixin={options:{foldingEnabled:!0,collapsedImage:new app_image_ImageBox(`${app_Client.A.imageBasePath}/collapsed.gif`,9,9),expandedImage:new app_image_ImageBox(`${app_Client.A.imageBasePath}/expanded.gif`,9,9),collapseToPreferredSize:!0},collapseExpandResource:app_config.F.isEnabled()?"collapse-expand":"",getCollapseExpandResource(){return this.collapseExpandResource},isFoldingEnabled(){return this.options.foldingEnabled},getFoldableCells(t,e=!1){return this.getDataModel().filterCells(t,(t=>this.isCellFoldable(t,e)))},isCellFoldable(t,e){return t.getChildCount()>0&&(this.getCurrentCellStyle(t).foldable??!0)},getFoldingImage(t){if(null!=t&&this.isFoldingEnabled()&&!t.cell.isEdge()){const e=t.cell.isCollapsed();if(this.isCellFoldable(t.cell,!e))return e?this.options.collapsedImage:this.options.expandedImage}return null},foldCells(t=!1,e=!1,i=null,s=!1,n=null){return null==i&&(i=this.getFoldableCells(this.getSelectionCells(),t)),this.stopEditing(!1),this.batchUpdate((()=>{this.cellsFolded(i,t,e,s),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.FOLD_CELLS,"collapse",t,"recurse",e,"cells",i))})),i},cellsFolded(t=null,e=!1,i=!1,s=!1){null!=t&&t.length>0&&this.batchUpdate((()=>{for(let n=0;n<t.length;n+=1)if((!s||this.isCellFoldable(t[n],e))&&e!==t[n].isCollapsed()){if(this.getDataModel().setCollapsed(t[n],e),this.swapBounds(t[n],e),this.isExtendParent(t[n])&&this.extendParent(t[n]),i){const s=t[n].getChildren();this.cellsFolded(s,e,i)}this.constrainChild(t[n])}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_FOLDED,{cells:t,collapse:e,recurse:i}))}))},swapBounds(t,e=!1){let i=t.getGeometry();null!=i&&(i=i.clone(),this.updateAlternateBounds(t,i,e),i.swap(),this.getDataModel().setGeometry(t,i))},updateAlternateBounds(t=null,e=null,i=!1){if(null!=t&&null!=e){const i=this.getCurrentCellStyle(t);if(null==e.alternateBounds){let s=e;if(this.options.collapseToPreferredSize){const e=this.getPreferredSizeForCell(t);if(null!=e){s=e;const t=i.startSize??0;t>0&&(s.height=Math.max(s.height,t))}}e.alternateBounds=new app_Rectangle.A(0,0,s.width,s.height)}if(null!=e.alternateBounds){e.alternateBounds.x=e.x,e.alternateBounds.y=e.y;const t=(0,app_mathUtils.eh)(i.rotation||0);if(0!==t){const i=e.alternateBounds.getCenterX()-e.getCenterX(),s=e.alternateBounds.getCenterY()-e.getCenterY(),n=Math.cos(t),l=Math.sin(t),a=n*i-l*s,r=l*i+n*s;e.alternateBounds.x+=a-i,e.alternateBounds.y+=r-s}}}}},app_GroupingMixin={groupCells(t,e=0,i){i||(i=(0,app_styleUtils.gU)(this.getSelectionCells(),!0)),i||(i=this.getCellsForGroup(i)),null==t&&(t=this.createGroupCell(i));const s=this.getBoundsForGroup(t,i,e);if(i.length>1&&null!=s){let n=t.getParent();null==n&&(n=i[0].getParent()),this.batchUpdate((()=>{null==t.getGeometry()&&this.getDataModel().setGeometry(t,new app_geometry_Geometry);let l=n.getChildCount();this.cellsAdded([t],n,l,null,null,!1,!1,!1),l=t.getChildCount(),this.cellsAdded(i,t,l,null,null,!1,!1,!1),this.cellsMoved(i,-s.x,-s.y,!1,!1,!1),this.cellsResized([t],[s],!1),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.GROUP_CELLS,{group:t,border:e,cells:i}))}))}return t},getCellsForGroup(t){const e=[];if(null!=t&&t.length>0){const i=t[0].getParent();e.push(t[0]);for(let s=1;s<t.length;s+=1)t[s].getParent()===i&&e.push(t[s])}return e},getBoundsForGroup(t,e,i){const s=this.getBoundingBoxFromGeometry(e,!0);if(null!=s){if(this.isSwimlane(t)){const e=this.getStartSize(t);s.x-=e.width,s.y-=e.height,s.width+=e.width,s.height+=e.height}null!=i&&(s.x-=i,s.y-=i,s.width+=2*i,s.height+=2*i)}return s},createGroupCell(t){const e=new app_cell_Cell("");return e.setVertex(!0),e.setConnectable(!1),e},ungroupCells(t){let e=[];return null==t&&(t=this.getCellsForUngroup()),null!=t&&t.length>0&&this.batchUpdate((()=>{const i=t;for(let t=0;t<i.length;t+=1){let s=i[t].getChildren();if(null!=s&&s.length>0){s=s.slice();const n=i[t].getParent(),l=n.getChildCount();this.cellsAdded(s,n,l,null,null,!0),e=e.concat(s);for(const t of s){const e=this.getView().getState(t);let i=t.getGeometry();null!=e&&null!=i&&i.relative&&(i=i.clone(),i.x=e.origin.x,i.y=e.origin.y,i.relative=!1,this.getDataModel().setGeometry(t,i))}}}this.removeCellsAfterUngroup(i),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.UNGROUP_CELLS,{cells:t}))})),e},getCellsForUngroup(){const t=this.getSelectionCells(),e=[];for(let i=0;i<t.length;i+=1)t[i].isVertex()&&t[i].getChildCount()>0&&e.push(t[i]);return e},removeCellsAfterUngroup(t){this.cellsRemoved(this.addAllEdges(t))},removeCellsFromParent(t){return null==t&&(t=this.getSelectionCells()),this.batchUpdate((()=>{const e=this.getDefaultParent(),i=e.getChildCount();this.cellsAdded(t,e,i,null,null,!0),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REMOVE_CELLS_FROM_PARENT,{cells:t}))})),t},updateGroupBounds(t,e=0,i=!1,s=0,n=0,l=0,a=0){return null==t&&(t=this.getSelectionCells()),e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:0,n=null!=n?n:0,l=null!=l?l:0,a=null!=a?a:0,this.batchUpdate((()=>{for(let r=t.length-1;r>=0;r--){let o=t[r].getGeometry();if(null==o)continue;const h=this.getChildCells(t[r]);if(null!=h&&h.length>0){const p=this.getBoundingBoxFromGeometry(h,!0);if(null!=p&&p.width>0&&p.height>0){const d=this.isSwimlane(t[r])?this.getActualStartSize(t[r],!0):new app_Rectangle.A;o=o.clone(),i&&(o.x=Math.round(o.x+p.x-e-d.x-a),o.y=Math.round(o.y+p.y-e-d.y-s)),o.width=Math.round(p.width+2*e+d.x+a+n+d.width),o.height=Math.round(p.height+2*e+d.y+s+l+d.height),this.getDataModel().setGeometry(t[r],o),this.moveCells(h,e+d.x-p.x+a,e+d.y-p.y+s)}}}})),t},enterGroup(t){null!=(t=t||this.getSelectionCell())&&this.isValidRoot(t)&&(this.getView().setCurrentRoot(t),this.clearSelection())},exitGroup(){const t=this.getDataModel().getRoot(),e=this.getCurrentRoot();if(null!=e){let i=e.getParent();for(;i!==t&&!this.isValidRoot(i)&&i.getParent()!==t;)i=i.getParent();i===t||i.getParent()===t?this.getView().setCurrentRoot(null):this.getView().setCurrentRoot(i),null!=this.getView().getState(e)&&this.setSelectionCell(e)}}},app_ImageMixin={addImageBundle(t){this.imageBundles.push(t)},removeImageBundle(t){const e=[];for(let i=0;i<this.imageBundles.length;i+=1)this.imageBundles[i]!==t&&e.push(this.imageBundles[i]);this.imageBundles=e},getImageFromBundles(t){if(t)for(let e=0;e<this.imageBundles.length;e+=1){const i=this.imageBundles[e].getImage(t);if(i)return i}return null}},app_LabelMixin={getLabel(t){let e="";return this.isLabelsVisible()&&null!=t&&(this.getCurrentCellStyle(t).noLabel||(e=this.convertValueToString(t))),e},isHtmlLabel(t){return this.isHtmlLabels()},labelsVisible:!0,isLabelsVisible(){return this.labelsVisible},htmlLabels:!1,isHtmlLabels(){return this.htmlLabels},setHtmlLabels(t){this.htmlLabels=t},isWrapping(t){return"wrap"===this.getCurrentCellStyle(t).whiteSpace},isLabelClipped(t){return"hidden"===this.getCurrentCellStyle(t).overflow},isLabelMovable(t){return!this.isCellLocked(t)&&(t.isEdge()&&this.isEdgeLabelsMovable()||t.isVertex()&&this.isVertexLabelsMovable())}},app_OrderMixin={orderCells(t=!1,e){return e||(e=this.getSelectionCells()),e||(e=(0,app_styleUtils.gU)(this.getSelectionCells(),!0)),this.batchUpdate((()=>{this.cellsOrdered(e,t);const i=new app_EventObject.A(app_InternalEvent.A.ORDER_CELLS,"back",t,"cells",e);this.fireEvent(i)})),e},cellsOrdered(t,e=!1){this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getParent();e?this.getDataModel().add(s,t[i],i):this.getDataModel().add(s,t[i],s?s.getChildCount()-1:0)}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CELLS_ORDERED,{back:e,cells:t}))}))}};class app_CellOverlay extends app_EventSource.A{constructor(t,e=null,i="right",s="bottom",n=new app_Point.A,l="help"){super(),this.align="right",this.verticalAlign="bottom",this.offset=new app_Point.A,this.cursor="help",this.defaultOverlap=.5,this.image=t,this.tooltip=e,this.align=i,this.verticalAlign=s,this.offset=n,this.cursor=l}getBounds(t){const e=t.cell.isEdge(),i=t.view.scale;let s=null;const n=this.image,l=n.width,a=n.height;if(e){const e=t.absolutePoints;if(e.length%2==1)s=e[Math.floor(e.length/2)];else{const t=e.length/2,i=e[t-1],n=e[t];s=new app_Point.A(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}}else{if(s=new app_Point.A,"left"===this.align)s.x=t.x;else if("center"===this.align)s.x=t.x+t.width/2;else{if("right"!==this.align)throw new Error;s.x=t.x+t.width}if("top"===this.verticalAlign)s.y=t.y;else if("middle"===this.verticalAlign)s.y=t.y+t.height/2;else{if("bottom"!==this.verticalAlign)throw new Error;s.y=t.y+t.height}}return new app_Rectangle.A(Math.round(s.x-(l*this.defaultOverlap-this.offset.x)*i),Math.round(s.y-(a*this.defaultOverlap-this.offset.y)*i),l*i,a*i)}toString(){return this.tooltip}}const app_cell_CellOverlay=app_CellOverlay,app_OverlaysMixin={addCellOverlay(t,e){t.overlays.push(e);const i=this.getView().getState(t);return i&&this.getCellRenderer().redraw(i),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ADD_OVERLAY,{cell:t,overlay:e})),e},getCellOverlays:t=>t.overlays,removeCellOverlay(t,e=null){if(e){const i=t.overlays.indexOf(e);if(i>=0){t.overlays.splice(i,1);const s=this.getView().getState(t);s&&this.getCellRenderer().redraw(s),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REMOVE_OVERLAY,{cell:t,overlay:e}))}else e=null}else this.removeCellOverlays(t);return e},removeCellOverlays(t){const{overlays:e}=t;t.overlays=[];const i=this.getView().getState(t);i&&this.getCellRenderer().redraw(i);for(let i=0;i<e.length;i+=1)this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REMOVE_OVERLAY,"cell",t,"overlay",e[i]));return e},clearCellOverlays(t=null){if(!(t=t??this.getDataModel().getRoot()))return;this.removeCellOverlays(t);const e=t.getChildCount();for(let i=0;i<e;i+=1){const e=t.getChildAt(i);this.clearCellOverlays(e)}},setCellWarning(t,e=null,i,s=!1){if(i=i??this.getWarningImage(),e&&e.length>0){const n=new app_cell_CellOverlay(i,`<font color=red>${e}</font>`);return s&&n.addListener(app_InternalEvent.A.CLICK,((e,i)=>{this.isEnabled()&&this.setSelectionCell(t)})),this.addCellOverlay(t,n)}return this.removeCellOverlays(t),null}},app_PageBreaksMixin={horizontalPageBreaks:null,verticalPageBreaks:null,updatePageBreaks(t,e,i){const{scale:s,translate:n}=this.getView(),l=this.getPageFormat(),a=s*this.getPageScale(),r=new app_Rectangle.A(0,0,l.width*a,l.height*a),o=app_Rectangle.A.fromRectangle(this.getGraphBounds());o.width=Math.max(1,o.width),o.height=Math.max(1,o.height),r.x=Math.floor((o.x-n.x*s)/r.width)*r.width+n.x*s,r.y=Math.floor((o.y-n.y*s)/r.height)*r.height+n.y*s,o.width=Math.ceil((o.width+(o.x-r.x))/r.width)*r.width,o.height=Math.ceil((o.height+(o.y-r.y))/r.height)*r.height;const h=(t=t&&Math.min(r.width,r.height)>this.getMinPageBreakDist())?Math.ceil(o.height/r.height)+1:0,p=t?Math.ceil(o.width/r.width)+1:0,d=(p-1)*r.width,c=(h-1)*r.height;null==this.horizontalPageBreaks&&h>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&p>0&&(this.verticalPageBreaks=[]);const u=t=>{if(null!=t){const e=t===this.horizontalPageBreaks?h:p;for(let i=0;i<=e;i+=1){const e=t===this.horizontalPageBreaks?[new app_Point.A(Math.round(r.x),Math.round(r.y+i*r.height)),new app_Point.A(Math.round(r.x+d),Math.round(r.y+i*r.height))]:[new app_Point.A(Math.round(r.x+i*r.width),Math.round(r.y)),new app_Point.A(Math.round(r.x+i*r.width),Math.round(r.y+c))];if(null!=t[i])t[i].points=e,t[i].redraw();else{const s=new app_edge_PolylineShape(e,this.getPageBreakColor());s.dialect=this.getDialect(),s.pointerEvents=!1,s.isDashed=this.isPageBreakDashed(),s.init(this.getView().backgroundPane),s.redraw(),t[i]=s}}for(let i=e;i<t.length;i+=1)t[i].destroy();t.splice(e,t.length-e)}};u(this.horizontalPageBreaks),u(this.verticalPageBreaks)}},app_PanningMixin={shiftPreview1:null,shiftPreview2:null,useScrollbarsForPanning:!0,isUseScrollbarsForPanning(){return this.useScrollbarsForPanning},timerAutoScroll:!1,isTimerAutoScroll(){return this.timerAutoScroll},allowAutoPanning:!1,isAllowAutoPanning(){return this.allowAutoPanning},panDx:0,getPanDx(){return this.panDx},setPanDx(t){this.panDx=t},panDy:0,getPanDy(){return this.panDy},setPanDy(t){this.panDy=t},panGraph(t,e){const i=this.getContainer();if(this.useScrollbarsForPanning&&(0,app_styleUtils.uM)(i))i.scrollLeft=-t,i.scrollTop=-e;else{const s=this.getView().getCanvas();if(0===t&&0===e){if(s.removeAttribute("transform"),this.shiftPreview1){let t=this.shiftPreview1.firstChild;for(;t;){const e=t.nextSibling;i.appendChild(t),t=e}this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,i.appendChild(s.parentNode);const e=this.shiftPreview2;for(t=e.firstChild;t;){const e=t.nextSibling;i.appendChild(t),t=e}e.parentNode&&e.parentNode.removeChild(e),this.shiftPreview2=null}}else{if(s.setAttribute("transform",`translate(${t},${e})`),!this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";let t=this.shiftPreview1,e=i.firstChild;for(;e;){const i=e.nextSibling;e!==s.parentNode?t.appendChild(e):t=this.shiftPreview2,e=i}this.shiftPreview1.firstChild&&i.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild&&i.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=`${t}px`,this.shiftPreview1.style.top=`${e}px`,this.shiftPreview2&&(this.shiftPreview2.style.left=`${t}px`,this.shiftPreview2.style.top=`${e}px`)}this.panDx=t,this.panDy=e,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN))}},scrollCellToVisible(t,e=!1){const i=-this.getView().translate.x,s=-this.getView().translate.y,n=this.getView().getState(t);if(n){const t=new app_Rectangle.A(i+n.x,s+n.y,n.width,n.height);if(e&&this.getContainer()){const e=this.getContainer().clientWidth,i=this.getContainer().clientHeight;t.x=t.getCenterX()-e/2,t.width=e,t.y=t.getCenterY()-i/2,t.height=i}const l=new app_Point.A(this.getView().translate.x,this.getView().translate.y);if(this.scrollRectToVisible(t)){const t=new app_Point.A(this.getView().translate.x,this.getView().translate.y);this.getView().translate.x=l.x,this.getView().translate.y=l.y,this.getView().setTranslate(t.x,t.y)}}},scrollRectToVisible(t){let e=!1;const i=this.getContainer(),s=i.offsetWidth,n=i.offsetHeight,l=Math.min(s,t.width),a=Math.min(n,t.height);if((0,app_styleUtils.uM)(i)){t.x+=this.getView().translate.x,t.y+=this.getView().translate.y;let e=i.scrollLeft-t.x;const s=Math.max(e-i.scrollLeft,0);e>0?i.scrollLeft-=e+2:(e=t.x+l-i.scrollLeft-i.clientWidth,e>0&&(i.scrollLeft+=e+2));let n=i.scrollTop-t.y;const r=Math.max(0,n-i.scrollTop);n>0?i.scrollTop-=n+2:(n=t.y+a-i.scrollTop-i.clientHeight,n>0&&(i.scrollTop+=n+2)),this.useScrollbarsForPanning||0==s&&0==r||this.getView().setTranslate(s,r)}else{const i=-this.getView().translate.x,r=-this.getView().translate.y,o=this.getView().scale;if(t.x+l>i+s&&(this.getView().translate.x-=(t.x+l-s-i)/o,e=!0),t.y+a>r+n&&(this.getView().translate.y-=(t.y+a-n-r)/o,e=!0),t.x<i&&(this.getView().translate.x+=(i-t.x)/o,e=!0),t.y<r&&(this.getView().translate.y+=(r-t.y)/o,e=!0),e){this.getView().refresh();const t=this.getPlugin("SelectionCellsHandler");t&&t.refresh()}}return e},setPanning(t){const e=this.getPlugin("PanningHandler");e&&(e.panningEnabled=t)}},app_PortsMixin={portsEnabled:!0,isPort:t=>!1,getTerminalForPort:(t,e=!1)=>t.getParent(),isPortsEnabled(){return this.portsEnabled},setPortsEnabled(t){this.portsEnabled=t}},app_SelectionMixin={selectionModel:null,getSelectionModel(){return this.selectionModel},setSelectionModel(t){this.selectionModel=t},isCellSelected(t){return this.selectionModel.isSelected(t)},isSelectionEmpty(){return this.selectionModel.isEmpty()},clearSelection(){this.selectionModel.clear()},getSelectionCount(){return this.selectionModel.cells.length},getSelectionCell(){return this.selectionModel.cells[0]},getSelectionCells(){return this.selectionModel.cells.slice()},setSelectionCell(t){this.selectionModel.setCell(t)},setSelectionCells(t){this.selectionModel.setCells(t)},addSelectionCell(t){this.selectionModel.addCell(t)},addSelectionCells(t){this.selectionModel.addCells(t)},removeSelectionCell(t){this.selectionModel.removeCell(t)},removeSelectionCells(t){this.selectionModel.removeCells(t)},selectRegion(t,e){const i=this.getCells(t.x,t.y,t.width,t.height);return this.selectCellsForEvent(i,e),i},selectNextCell(){this.selectCell(!0)},selectPreviousCell(){this.selectCell()},selectParentCell(){this.selectCell(!1,!0)},selectChildCell(){this.selectCell(!1,!1,!0)},selectCell(t=!1,e=!1,i=!1){const s=this.selectionModel.cells.length>0?this.selectionModel.cells[0]:null;this.selectionModel.cells.length>1&&this.selectionModel.clear();const n=s?s.getParent():this.getDefaultParent(),l=n.getChildCount();if(!s&&l>0){const t=n.getChildAt(0);this.setSelectionCell(t)}else if(n&&(!s||e)&&this.getView().getState(n)&&n.getGeometry())this.getCurrentRoot()!==n&&this.setSelectionCell(n);else if(s&&i){if(s.getChildCount()>0){const t=s.getChildAt(0);this.setSelectionCell(t)}}else if(l>0){let e=n.getIndex(s);if(t){e++;const t=n.getChildAt(e%l);this.setSelectionCell(t)}else{e--;const t=e<0?l-1:e,i=n.getChildAt(t);this.setSelectionCell(i)}}},selectAll(t,e=!1){t=t??this.getDefaultParent();const i=e?t.filterDescendants((e=>e!==t&&!!this.getView().getState(e))):t.getChildren();this.setSelectionCells(i)},selectVertices(t,e=!1){this.selectCells(!0,!1,t,e)},selectEdges(t){this.selectCells(!1,!0,t)},selectCells(t=!1,e=!1,i,s=!1){const n=(i=i??this.getDefaultParent()).filterDescendants((i=>{const n=i.getParent();return!!this.getView().getState(i)&&((s||0===i.getChildCount())&&i.isVertex()&&t&&n&&!n.isEdge()||i.isEdge()&&e)}));this.setSelectionCells(n)},selectCellForEvent(t,e){const i=this.isCellSelected(t);this.isToggleEvent(e)?i?this.removeSelectionCell(t):this.addSelectionCell(t):i&&1===this.getSelectionCount()||this.setSelectionCell(t)},selectCellsForEvent(t,e){this.isToggleEvent(e)?this.addSelectionCells(t):this.setSelectionCells(t)},isSiblingSelected(t){const e=t.getParent(),i=e.getChildCount();for(let s=0;s<i;s+=1){const i=e.getChildAt(s);if(t!==i&&this.isCellSelected(i))return!0}return!1},getSelectionCellsForChanges(t,e=null){const i=new app_util_Dictionary.A,s=[],n=t=>{if(!i.get(t)&&this.getDataModel().contains(t))if(t.isEdge()||t.isVertex())i.put(t,!0),s.push(t);else{const e=t.getChildCount();for(let i=0;i<e;i+=1)n(t.getChildAt(i))}};for(let i=0;i<t.length;i+=1){const s=t[i];if(!(s.constructor===app_undoable_changes_RootChange||e&&e(s))){let t=null;s instanceof app_undoable_changes_ChildChange?t=s.child:s.cell&&s.cell instanceof app_cell_Cell&&(t=s.cell),t&&n(t)}}return s},updateSelection(){const t=this.getSelectionCells(),e=[];for(const i of t)if(this.getDataModel().contains(i)&&i.isVisible()){let t=i.getParent();for(;t&&t!==this.getView().currentRoot;){if(t.isCollapsed()||!t.isVisible()){e.push(i);break}t=t.getParent()}}else e.push(i);this.removeSelectionCells(e)}},app_SnapMixin={snapTolerance:0,getSnapTolerance(){return this.snapTolerance},gridSize:10,gridEnabled:!0,snap(t){return this.gridEnabled&&(t=Math.round(t/this.gridSize)*this.gridSize),t},snapDelta(t,e,i=!1,s=!1,n=!1){const l=this.getView().translate,a=this.getView().scale;if(!i&&this.gridEnabled){const i=this.gridSize*a*.5;if(!s){const s=e.x-(this.snap(e.x/a-l.x)+l.x)*a;Math.abs(t.x-s)<i?t.x=0:t.x=this.snap(t.x/a)*a-s}if(!n){const s=e.y-(this.snap(e.y/a-l.y)+l.y)*a;Math.abs(t.y-s)<i?t.y=0:t.y=this.snap(t.y/a)*a-s}}else{const i=.5*a;if(!s){const s=e.x-(Math.round(e.x/a-l.x)+l.x)*a;Math.abs(t.x-s)<i?t.x=0:t.x=Math.round(t.x/a)*a-s}if(!n){const s=e.y-(Math.round(e.y/a-l.y)+l.y)*a;Math.abs(t.y-s)<i?t.y=0:t.y=Math.round(t.y/a)*a-s}}return t},isGridEnabled(){return this.gridEnabled},setGridEnabled(t){this.gridEnabled=t},getGridSize(){return this.gridSize},setGridSize(t){this.gridSize=t}},app_SwimlaneMixin={swimlaneSelectionEnabled:!0,swimlaneNesting:!0,swimlaneIndicatorColorAttribute:"fillColor",getSwimlane(t=null){for(;t&&!this.isSwimlane(t);)t=t.getParent();return t},getSwimlaneAt(t,e,i){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i){const s=i.getChildCount();for(let n=0;n<s;n+=1){const s=i.getChildAt(n);if(s){const i=this.getSwimlaneAt(t,e,s);if(null!=i)return i;if(s.isVisible()&&this.isSwimlane(s)){const i=this.getView().getState(s);if(i&&this.intersects(i,t,e))return s}}}}return null},hitsSwimlaneContent(t,e,i){const s=this.getView().getState(t),n=this.getStartSize(t);if(s){const t=this.getView().getScale();if(e-=s.x,i-=s.y,n.width>0&&e>0&&e>n.width*t)return!0;if(n.height>0&&i>0&&i>n.height*t)return!0}return!1},getStartSize(t,e=!1){const i=new app_Rectangle.A,s=this.getCurrentCellStyle(t,e),n=s.startSize??app_Constants.QX;return s.horizontal??1?i.height=n:i.width=n,i},getSwimlaneDirection(t){const e=t.direction??app_Constants.M8.EAST,i=t.flipH,s=t.flipV;let n=t.horizontal??1?0:3;e===app_Constants.M8.NORTH?n--:e===app_Constants.M8.WEST?n+=2:e===app_Constants.M8.SOUTH&&(n+=1);const l=(0,app_mathUtils.zi)(n,2);return i&&1===l&&(n+=2),s&&0===l&&(n+=2),[app_Constants.M8.NORTH,app_Constants.M8.EAST,app_Constants.M8.SOUTH,app_Constants.M8.WEST][(0,app_mathUtils.zi)(n,4)]},getActualStartSize(t,e=!1){const i=new app_Rectangle.A;if(this.isSwimlane(t,e)){const s=this.getCurrentCellStyle(t,e),n=s.startSize??app_Constants.QX,l=this.getSwimlaneDirection(s);l===app_Constants.M8.NORTH?i.y=n:l===app_Constants.M8.WEST?i.x=n:l===app_Constants.M8.SOUTH?i.height=n:i.width=n}return i},isSwimlane(t,e=!1){return!(!t||t.getParent()===this.getDataModel().getRoot()||t.isEdge())&&this.getCurrentCellStyle(t,e).shape===app_Constants.IW.SWIMLANE},isValidDropTarget(t,e,i){return t&&(this.isSplitEnabled()&&this.isSplitTarget(t,e,i)||!t.isEdge()&&(this.isSwimlane(t)||t.getChildCount()>0&&!t.isCollapsed()))},getDropTarget(t,e,i=null,s=!1){if(!this.isSwimlaneNesting())for(let e=0;e<t.length;e+=1)if(this.isSwimlane(t[e]))return null;const n=(0,app_styleUtils.ce)(this.getContainer(),(0,app_EventUtils.El)(e),(0,app_EventUtils.xJ)(e));n.x-=this.getPanDx(),n.y-=this.getPanDy();const l=this.getSwimlaneAt(n.x,n.y);if(i){if(l){let t=l.getParent();for(;t&&this.isSwimlane(t)&&t!==i;)t=t.getParent();t===i&&(i=l)}}else i=l;for(;i&&!this.isValidDropTarget(i,t,e)&&!this.getDataModel().isLayer(i);)i=i.getParent();let a=i;if(!s)for(;a&&t.indexOf(a)<0;)a=a.getParent();return this.getDataModel().isLayer(i)||a?null:i},isSwimlaneNesting(){return this.swimlaneNesting},setSwimlaneNesting(t){this.swimlaneNesting=t},isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled},setSwimlaneSelectionEnabled(t){this.swimlaneSelectionEnabled=t}},app_TerminalMixin={isTerminalPointMovable:(t,e)=>!0,getOpposites(t,e=null,i=!0,s=!0){const n=[],l=new app_util_Dictionary.A;for(let a=0;a<t.length;a+=1){const r=this.getView().getState(t[a]),o=r?r.getVisibleTerminal(!0):this.getView().getVisibleTerminal(t[a],!0),h=r?r.getVisibleTerminal(!1):this.getView().getVisibleTerminal(t[a],!1);o===e&&h&&h!==e&&s?l.get(h)||(l.put(h,!0),n.push(h)):h===e&&o&&o!==e&&i&&(l.get(o)||(l.put(o,!0),n.push(o)))}return n}},app_TooltipMixin={getTooltip(t,e,i,s){let n=null;if(!t.control||e!==t.control.node&&e.parentNode!==t.control.node||(n=this.getCollapseExpandResource(),n=(0,app_StringUtils.bG)(app_i18n_Translations.get(n)||n,!0).replace(/\\n/g,"<br>")),!n&&t.overlays&&t.overlays.visit(((t,i)=>{n||e!==i.node&&e.parentNode!==i.node||(n=i.overlay?i.overlay.toString()??null:null)})),!n){const i=this.getPlugin("SelectionCellsHandler"),s=i?.getHandler(t.cell);s&&"getTooltipForNode"in s&&"function"==typeof s.getTooltipForNode&&(n=s.getTooltipForNode(e))}return n||(n=this.getTooltipForCell(t.cell)),n},getTooltipForCell(t){let e=null;return e=t&&"getTooltip"in t?t.getTooltip():this.convertValueToString(t),e},setTooltips(t){const e=this.getPlugin("TooltipHandler");e?.setEnabled(t)}},app_ValidationMixin={validationAlert(t){alert(t)},isEdgeValid(t,e,i){return!this.getEdgeValidationError(t,e,i)},getEdgeValidationError(t=null,e=null,i=null){if(t&&!this.isAllowDanglingEdges()&&(!e||!i))return"";if(t&&!t.getTerminal(!0)&&!t.getTerminal(!1))return null;if(!this.isAllowLoops()&&e===i&&e)return"";if(!this.isValidConnection(e,i))return"";if(e&&i){let s="";if(!this.isMultigraph()){const n=this.getDataModel().getEdgesBetween(e,i,!0);(n.length>1||1===n.length&&n[0]!==t)&&(s+=`${app_i18n_Translations.get(this.getAlreadyConnectedResource())||this.getAlreadyConnectedResource()}\n`)}const n=e.getDirectedEdgeCount(!0,t),l=i.getDirectedEdgeCount(!1,t);for(const a of this.multiplicities){const r=a.check(this,t,e,i,n,l);null!=r&&(s+=r)}const a=this.validateEdge(t,e,i);return null!=a&&(s+=a),s.length>0?s:null}return this.isAllowDanglingEdges()?null:""},validateEdge:(t=null,e=null,i=null)=>null,validateGraph(t=null,e){if(!(t=t??this.getDataModel().getRoot()))return"The root does not exist!";e=e??{};let i=!0;const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);let l=e;this.isValidRoot(s)&&(l={});const a=this.validateGraph(s,l);a?this.setCellWarning(s,a.replace(/\n/g,"<br>")):this.setCellWarning(s,null),i=i&&null==a}let n="";t&&t.isCollapsed()&&!i&&(n+=`${app_i18n_Translations.get(this.getContainsValidationErrorsResource())||this.getContainsValidationErrorsResource()}\n`),t&&t.isEdge()?n+=this.getEdgeValidationError(t,t.getTerminal(!0),t.getTerminal(!1))||"":n+=this.getCellValidationError(t)||"";const l=this.validateCell(t,e);return null!=l&&(n+=l),null==t.getParent()&&this.getView().validate(),n.length>0||!i?n:null},getCellValidationError(t){const e=t.getDirectedEdgeCount(!0),i=t.getDirectedEdgeCount(!1),s=t.getValue();let n="";for(let t=0;t<this.multiplicities.length;t+=1){const l=this.multiplicities[t];(l.source&&(0,app_domUtils.Ll)(s,l.type,l.attr,l.value)&&(e>l.max||e<l.min)||!l.source&&(0,app_domUtils.Ll)(s,l.type,l.attr,l.value)&&(i>l.max||i<l.min))&&(n+=`${l.countError}\n`)}return n.length>0?n:null},validateCell:(t,e)=>null},app_VertexMixin={vertexLabelsMovable:!1,allowNegativeCoordinates:!0,isAllowNegativeCoordinates(){return this.allowNegativeCoordinates},setAllowNegativeCoordinates(t){this.allowNegativeCoordinates=t},insertVertex(...t){let e,i,s,n,l,a,r,o,h,p;if(1===t.length&&"object"==typeof t[0]){const d=t[0];e=d.parent,i=d.id,s=d.value,n="x"in d?d.x:d.position?.[0],l="y"in d?d.y:d.position?.[1],a="width"in d?d.width:d.size?.[0],r="height"in d?d.height:d.size?.[1],o=d.style,h=d.relative,p=d.geometryClass}else[e,i,s,n,l,a,r,o,h,p]=t;const d=this.createVertex(e,i,s,n,l,a,r,o,h,p);return this.addCell(d,e)},createVertex(t,e,i,s,n,l,a,r,o=!1,h=app_geometry_Geometry){const p=new h(s,n,l,a);p.relative=o;const d=new app_cell_Cell(i,p,r);return d.setId(e),d.setVertex(!0),d.setConnectable(!0),d},getChildVertices(t){return this.getChildCells(t,!0,!1)},isVertexLabelsMovable(){return this.vertexLabelsMovable},setVertexLabelsMovable(t){this.vertexLabelsMovable=t}},app_ZoomMixin={zoomFactor:1.2,keepSelectionVisibleOnZoom:!1,centerZoom:!0,zoomIn(){this.zoom(this.zoomFactor)},zoomOut(){this.zoom(1/this.zoomFactor)},zoomActual(){1===this.getView().scale?this.getView().setTranslate(0,0):(this.getView().translate.x=0,this.getView().translate.y=0,this.getView().setScale(1))},zoomTo(t,e=!1){this.zoom(t/this.getView().scale,e)},zoom(t,e){e=e??this.centerZoom;const i=Math.round(this.getView().scale*t*100)/100,s=this.getView().getState(this.getSelectionCell()),n=this.getContainer();if(t=i/this.getView().scale,this.keepSelectionVisibleOnZoom&&null!=s){const e=new app_Rectangle.A(s.x*t,s.y*t,s.width*t,s.height*t);this.getView().scale=i,this.scrollRectToVisible(e)||(this.getView().revalidate(),this.getView().setScale(i))}else{const s=(0,app_styleUtils.uM)(this.getContainer());if(e&&!s){let e=n.offsetWidth,s=n.offsetHeight;if(t>1){const n=(t-1)/(2*i);e*=-n,s*=-n}else{const i=(1/t-1)/(2*this.getView().scale);e*=i,s*=i}this.getView().scaleAndTranslate(i,this.getView().translate.x+e,this.getView().translate.y+s)}else{const l=this.getView().translate.x,a=this.getView().translate.y,r=n.scrollLeft,o=n.scrollTop;if(this.getView().setScale(i),s){let i=0,s=0;e&&(i=n.offsetWidth*(t-1)/2,s=n.offsetHeight*(t-1)/2),n.scrollLeft=(this.getView().translate.x-l)*this.getView().scale+Math.round(r*t+i),n.scrollTop=(this.getView().translate.y-a)*this.getView().scale+Math.round(o*t+s)}}}},zoomToRect(t){const e=this.getContainer(),i=e.clientWidth/t.width/(e.clientHeight/t.height);t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);let s=Math.min(e.scrollWidth,t.x+t.width),n=Math.min(e.scrollHeight,t.y+t.height);if(t.width=s-t.x,t.height=n-t.y,i<1){const s=t.height/i,l=(s-t.height)/2;t.height=s;const a=Math.min(t.y,l);t.y-=a,n=Math.min(e.scrollHeight,t.y+t.height),t.height=n-t.y}else{const n=t.width*i,l=(n-t.width)/2;t.width=n;const a=Math.min(t.x,l);t.x-=a,s=Math.min(e.scrollWidth,t.x+t.width),t.width=s-t.x}const l=e.clientWidth/t.width,a=this.getView().scale*l;(0,app_styleUtils.uM)(this.getContainer())?(this.getView().setScale(a),e.scrollLeft=Math.round(t.x*l),e.scrollTop=Math.round(t.y*l)):this.getView().scaleAndTranslate(a,this.getView().translate.x-t.x/this.getView().scale,this.getView().translate.y-t.y/this.getView().scale)}},app_applyGraphMixins=t=>{const e=(0,app_Utils.rU)(t);for(const t of[app_CellsMixin,app_ConnectionsMixin,app_DragDropMixin,app_EdgeMixin,app_EditingMixin,app_EventsMixin,app_FoldingMixin,app_GroupingMixin,app_ImageMixin,app_LabelMixin,app_OrderMixin,app_PageBreaksMixin,app_OverlaysMixin,app_PanningMixin,app_PortsMixin,app_SelectionMixin,app_SnapMixin,app_SwimlaneMixin,app_TerminalMixin,app_TooltipMixin,app_ValidationMixin,app_VertexMixin,app_ZoomMixin])e(t)};class app_CellEditorHandler{constructor(t){this.clearOnChange=!1,this.bounds=null,this.resizeThread=null,this.textDirection=null,this.textarea=null,this.editingCell=null,this.trigger=null,this.modified=!1,this.autoSize=!0,this.selectText=!0,this.emptyLabelText=app_Client.A.IS_FF?"<br>":"",this.escapeCancelsEditing=!0,this.textNode=null,this.zIndex=5,this.minResize=new app_Rectangle.A(0,20),this.wordWrapPadding=0,this.blurEnabled=!1,this.initialValue=null,this.align=null,this.graph=t,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.changeHandler=t=>{this.editingCell&&!this.graph.getView().getState(this.editingCell,!1)&&this.stopEditing(!0)},this.graph.getView().addListener(app_InternalEvent.A.SCALE,this.zoomHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,this.zoomHandler),this.graph.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=String(!0),app_Client.A.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position="absolute",this.installListeners(this.textarea)}applyValue(t,e){this.graph.labelChanged(t.cell,e,this.trigger)}setAlign(t){this.textarea&&(this.textarea.style.textAlign=t),this.align=t,this.resize()}getInitialValue(t,e){let i=(0,app_StringUtils.bG)(this.graph.getEditingValue(t.cell,e),!1);return i=(0,app_StringUtils.K7)(i,"<div><br></div>"),i.replace(/\n/g,"<br>")}getCurrentValue(t){return this.textarea?(0,app_domUtils.uq)(Array.from(this.textarea.childNodes)):null}isCancelEditingKeyEvent(t){return this.escapeCancelsEditing||(0,app_EventUtils.RT)(t)||(0,app_EventUtils.qt)(t)||(0,app_EventUtils.UT)(t)}installListeners(t){app_InternalEvent.A.addListener(t,"dragstart",(t=>{this.graph.stopEditing(!1),app_InternalEvent.A.consume(t)})),app_InternalEvent.A.addListener(t,"blur",(t=>{this.blurEnabled&&this.focusLost()})),app_InternalEvent.A.addListener(t,"keydown",(t=>{(0,app_EventUtils.fm)(t)||(this.isStopEditingEvent(t)?(this.graph.stopEditing(!1),app_InternalEvent.A.consume(t)):27===t.keyCode&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(t)),app_InternalEvent.A.consume(t)))}));const e=e=>{null!=this.editingCell&&this.clearOnChange&&t.innerHTML===this.getEmptyLabelText()&&(!app_Client.A.IS_FF||8!==e.keyCode&&46!==e.keyCode)&&(this.clearOnChange=!1,t.innerHTML="")};app_InternalEvent.A.addListener(t,"keypress",e),app_InternalEvent.A.addListener(t,"paste",e);const i=t=>{if(null!=this.editingCell){const t=this.textarea;0===t.innerHTML.length||"<br>"===t.innerHTML?(t.innerHTML=this.getEmptyLabelText(),this.clearOnChange=t.innerHTML.length>0):this.clearOnChange=!1}};app_InternalEvent.A.addListener(t,"input",i),app_InternalEvent.A.addListener(t,"cut",i),app_InternalEvent.A.addListener(t,"paste",i);const s=t=>{null!=this.editingCell&&this.autoSize&&!(0,app_EventUtils.fm)(t)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout((()=>{this.resizeThread=null,this.resize()}),0))};app_InternalEvent.A.addListener(t,"input",s),app_InternalEvent.A.addListener(window,"resize",s),app_InternalEvent.A.addListener(t,"cut",s),app_InternalEvent.A.addListener(t,"paste",s)}isStopEditingEvent(t){return 113===t.keyCode||this.graph.isEnterStopsCellEditing()&&13===t.keyCode&&!(0,app_EventUtils.qt)(t)&&!(0,app_EventUtils.RT)(t)}isEventSource(t){return(0,app_EventUtils.el)(t)===this.textarea}resize(){const t=this.editingCell?this.graph.getView().getState(this.editingCell):null;if(t){if(null!=this.textarea){const e=t.cell.isEdge(),{scale:i}=this.graph.getView();let s=null;if(this.autoSize&&"fill"!==t.style.overflow){const n=t.style.labelWidth??null;if(s=null!=t.text&&null==this.align?t.text.margin:null,null==s&&(s=(0,app_styleUtils.oM)(this.align??t.style.align??app_Constants.Ec.CENTER,t.style.verticalAlign??app_Constants.Ec.MIDDLE)),e){if(this.bounds=new app_Rectangle.A(t.absoluteOffset.x,t.absoluteOffset.y,0,0),null!=n){const t=(n+2)*i;this.bounds.width=t,this.bounds.x+=s.x*t}}else{let e=app_Rectangle.A.fromRectangle(t),s=t.style.labelPosition??app_Constants.Ec.CENTER,l=t.style.verticalLabelPosition??app_Constants.Ec.MIDDLE;if(e=null!=t.shape&&"center"===s&&"middle"===l?t.shape.getLabelBounds(e):e,null!=n&&(e.width=n*i),!t.view.graph.cellRenderer.legacySpacing||"width"!==t.style.overflow){const a=new app_node_TextShape,r=(t.style.spacing??2)*i,o=((t.style.spacingTop??0)+a.baseSpacingTop)*i+r,h=((t.style.spacingRight??0)+a.baseSpacingRight)*i+r,p=((t.style.spacingBottom??0)+a.baseSpacingBottom)*i+r,d=((t.style.spacingLeft??0)+a.baseSpacingLeft)*i+r;s=null!=t.style.labelPosition?t.style.labelPosition:"center",l=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle",e=new app_Rectangle.A(e.x+d,e.y+o,e.width-(s===app_Constants.Ec.CENTER&&null==n?d+h:0),e.height-(l===app_Constants.Ec.MIDDLE?o+p:0))}this.bounds=new app_Rectangle.A(e.x+t.absoluteOffset.x,e.y+t.absoluteOffset.y,e.width,e.height)}if(this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()){this.textarea.style.wordWrap=app_Constants.Cx,this.textarea.style.whiteSpace="normal";const t=Math.round(this.bounds.width/i)+this.wordWrapPadding;"relative"!==this.textarea.style.position?(this.textarea.style.width=`${t}px`,this.textarea.scrollWidth>t&&(this.textarea.style.width=`${this.textarea.scrollWidth}px`)):this.textarea.style.maxWidth=`${t}px`}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";this.textarea.scrollWidth,this.textarea.scrollHeight,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x-s.x*(this.bounds.width-2))+1)}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y-s.y*(this.bounds.height-4)+(-1===s.y?3:0))+1)}px`}else this.bounds=this.getEditorBounds(t),this.textarea.style.width=`${Math.round(this.bounds.width/i)}px`,this.textarea.style.height=`${Math.round(this.bounds.height/i)}px`,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x+1))}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y+1))}px`,this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()?(this.textarea.style.wordWrap=app_Constants.Cx,this.textarea.style.whiteSpace="normal","fill"!==t.style.overflow&&(this.textarea.style.width=`${Math.round(this.bounds.width/i)+this.wordWrapPadding}px`)):(this.textarea.style.whiteSpace="nowrap","fill"!==t.style.overflow&&(this.textarea.style.width=""));(0,app_styleUtils.FR)(this.textarea.style,"transformOrigin","0px 0px"),(0,app_styleUtils.FR)(this.textarea.style,"transform",`scale(${i},${i})${null==s?"":` translate(${100*s.x}%,${100*s.y}%)`}`)}}else this.stopEditing(!0)}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(t){return app_Constants.x3}startEditing(t,e=null){this.stopEditing(!0),this.align=null,null==this.textarea&&this.init();const i=this.graph.getPlugin("TooltipHandler");i?.hideTooltip();const s=this.graph.getView().getState(t);if(s){const{scale:i}=this.graph.getView(),n=s.style.fontSize??app_Constants.FV,l=s.style.fontFamily??app_Constants.CT,a=s.style.fontColor??"black",r=s.style.align??app_Constants.Ec.LEFT,o=(s.style.fontStyle||0)&app_Constants.mE.BOLD,h=(s.style.fontStyle||0)&app_Constants.mE.ITALIC,p=[];(s.style.fontStyle||0)&app_Constants.mE.UNDERLINE&&p.push("underline"),(s.style.fontStyle||0)&app_Constants.mE.STRIKETHROUGH&&p.push("line-through");const d=this.textarea;d.style.lineHeight=app_Constants.Fb?`${Math.round(n*app_Constants.$g)}px`:String(app_Constants.$g),d.style.backgroundColor=this.getBackgroundColor(s)||"transparent",d.style.textDecoration=p.join(" "),d.style.fontWeight=o?"bold":"normal",d.style.fontStyle=h?"italic":"",d.style.fontSize=`${Math.round(n)}px`,d.style.zIndex=String(this.zIndex),d.style.fontFamily=l,d.style.textAlign=r,d.style.outline="none",d.style.color=a;let c=this.textDirection=s.style.textDirection??app_Constants.Sr;"auto"===c&&(null===s.text||s.text.dialect===app_Constants.$p.STRICTHTML||(0,app_domUtils.Ll)(s.text.value)||(c=s.text.getAutoDirection())),"ltr"===c||"rtl"===c?d.setAttribute("dir",c):d.removeAttribute("dir"),d.innerHTML=this.getInitialValue(s,e)||"",this.initialValue=d.innerHTML,0===d.innerHTML.length||"<br>"===d.innerHTML?(d.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=d.innerHTML===this.getEmptyLabelText(),this.graph.container.appendChild(d),this.editingCell=t,this.trigger=e,this.textNode=null,null!==s.text&&this.isHideLabel(s)&&(this.textNode=s.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(s.cell.isEdge()||"fill"!==s.style.overflow)&&window.setTimeout((()=>{this.resize()}),0),this.resize();try{d.focus(),this.isSelectText()&&d.innerHTML.length>0&&(d.innerHTML!==this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1)}catch(t){}}}isSelectText(){return this.selectText}stopEditing(t=!1){if(this.editingCell){this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);const e=t?null:this.graph.view.getState(this.editingCell),i=this.textarea,s=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.bounds=null,i.blur(),(0,app_domUtils.wr)(),i.parentNode&&i.parentNode.removeChild(i),this.clearOnChange&&i.innerHTML===this.getEmptyLabelText()&&(i.innerHTML="",this.clearOnChange=!1),e&&(i.innerHTML!==s||null!==this.align)){this.prepareTextarea();const t=this.getCurrentValue(e);this.graph.batchUpdate((()=>{null!==t&&this.applyValue(e,t),null!==this.align&&this.graph.setCellStyles("align",this.align,[e.cell])}))}this.trigger=null,this.textarea&&app_InternalEvent.A.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){const t=this.textarea;t.lastChild&&"BR"===t.lastChild.nodeName&&t.removeChild(t.lastChild)}isHideLabel(t=null){return!0}getMinimumSize(t){const{scale:e}=this.graph.getView(),i=this.textarea;return new app_Rectangle.A(0,0,null===t.text?30:t.text.size*e+20,"left"===i.style.textAlign?120:40)}getEditorBounds(t){const e=t.cell.isEdge(),{scale:i}=this.graph.getView(),s=this.getMinimumSize(t),n=s.width,l=s.height;let a=null;if(!e&&t.view.graph.cellRenderer.legacySpacing&&"fill"===t.style.overflow)a=t.shape.getLabelBounds(app_Rectangle.A.fromRectangle(t));else{const s=new app_node_TextShape,r=(t.style.spacing??0)*i,o=((t.style.spacingTop??0)+s.baseSpacingTop)*i+r,h=((t.style.spacingRight??0)+s.baseSpacingRight)*i+r,p=((t.style.spacingBottom??0)+s.baseSpacingBottom)*i+r,d=((t.style.spacingLeft??0)+s.baseSpacingLeft)*i+r;a=new app_Rectangle.A(t.x,t.y,Math.max(n,t.width-d-h),Math.max(l,t.height-o-p));const c=null!=t.style.labelPosition?t.style.labelPosition:"center",u=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";if(a=null!=t.shape&&"center"===c&&"middle"===u?t.shape.getLabelBounds(a):a,e?(a.x=t.absoluteOffset.x,a.y=t.absoluteOffset.y,null!=t.text&&null!=t.text.boundingBox&&(t.text.boundingBox.x>0&&(a.x=t.text.boundingBox.x),t.text.boundingBox.y>0&&(a.y=t.text.boundingBox.y))):null!=t.text&&null!=t.text.boundingBox&&(a.x=Math.min(a.x,t.text.boundingBox.x),a.y=Math.min(a.y,t.text.boundingBox.y)),a.x+=d,a.y+=o,null!=t.text&&null!=t.text.boundingBox&&(e?(a.width=Math.max(n,t.text.boundingBox.width),a.height=Math.max(l,t.text.boundingBox.height)):(a.width=Math.max(a.width,t.text.boundingBox.width),a.height=Math.max(a.height,t.text.boundingBox.height))),t.cell.isVertex()){const e=t.style.labelPosition??app_Constants.Ec.CENTER;"left"===e?a.x-=t.width:"right"===e&&(a.x+=t.width);const i=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";"top"===i?a.y-=t.height:"bottom"===i&&(a.y+=t.height)}}return new app_Rectangle.A(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height))}getEmptyLabelText(t=null){return this.emptyLabelText??""}getEditingCell(){return this.editingCell}onDestroy(){this.textarea&&(app_InternalEvent.A.release(this.textarea),this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.zoomHandler)}}app_CellEditorHandler.pluginId="CellEditorHandler";const app_handler_CellEditorHandler=app_CellEditorHandler;class app_TooltipHandler{init(){document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),app_InternalEvent.A.addGestureListeners(this.div,(t=>{const e=(0,app_EventUtils.el)(t);e&&"A"!==e.nodeName&&this.hideTooltip()})),app_InternalEvent.A.addListener(this.graph.getContainer(),"mouseleave",(t=>{this.div!==t.relatedTarget&&this.hide()})))}constructor(t){this.zIndex=10005,this.delay=500,this.ignoreTouchEvents=!0,this.hideOnHover=!1,this.destroyed=!1,this.lastX=0,this.lastY=0,this.state=null,this.stateSource=!1,this.thread=null,this.enabled=!1,this.graph=t,this.graph.addMouseListener(this)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHideOnHover(){return this.hideOnHover}setHideOnHover(t){this.hideOnHover=t}getStateForEvent(t){return t.getState()}mouseDown(t,e){this.reset(e,!1),this.hideTooltip()}mouseMove(t,e){if(e.getX()!==this.lastX||e.getY()!==this.lastY){this.reset(e,!0);const t=this.getStateForEvent(e);(this.isHideOnHover()||t!==this.state||e.getSource()!==this.node&&(!this.stateSource||null!=t&&this.stateSource===(e.isSource(t.shape)||!e.isSource(t.text))))&&this.hideTooltip()}this.lastX=e.getX(),this.lastY=e.getY()}mouseUp(t,e){this.reset(e,!0),this.hideTooltip()}resetTimer(){this.thread&&(window.clearTimeout(this.thread),this.thread=null)}reset(t,e,i=null){if((!this.ignoreTouchEvents||(0,app_EventUtils.Er)(t.getEvent()))&&(this.resetTimer(),i=i??this.getStateForEvent(t),e&&this.isEnabled()&&i&&(!this.div||"hidden"==this.div.style.visibility))){const e=t.getSource(),s=t.getX(),n=t.getY(),l=t.isSource(i.shape)||t.isSource(i.text),a=this.graph.getPlugin("PopupMenuHandler");this.thread=window.setTimeout((()=>{if(i&&e&&!this.graph.isEditing()&&a&&!a.isMenuShowing()&&!this.graph.isMouseDown){const t=this.graph.getTooltip(i,e,s,n);this.show(t,s,n),this.state=i,this.node=e,this.stateSource=l}}),this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div&&(this.div.style.visibility="hidden",this.div.innerHTML="")}show(t,e,i){if(!this.destroyed&&t&&""!==t){const s=(0,app_styleUtils.ID)();this.div||this.init(),this.div.style.zIndex=String(this.zIndex),this.div.style.left=`${e+s.x}px`,this.div.style.top=`${i+app_Constants.jo+s.y}px`,(0,app_domUtils.Ll)(t)?(this.div.innerHTML="",this.div.appendChild(t)):this.div.innerHTML=t.replace(/\n/g,"<br>"),this.div.style.visibility="",(0,app_styleUtils.Uj)(this.div)}}onDestroy(){this.destroyed||(this.resetTimer(),this.graph.removeMouseListener(this),this.div&&app_InternalEvent.A.release(this.div),this.div?.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)}}app_TooltipHandler.pluginId="TooltipHandler";const app_handler_TooltipHandler=app_TooltipHandler;class app_SelectionCellsHandler extends app_EventSource.A{constructor(t){super(),this.enabled=!0,this.maxHandlers=100,this.graph=t,this.handlers=new app_util_Dictionary.A,this.graph.addMouseListener(this),this.refreshHandler=(t,e)=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(app_InternalEvent.A.CHANGE,this.refreshHandler),this.graph.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.refreshHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE,this.refreshHandler),this.graph.getView().addListener(app_InternalEvent.A.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(app_InternalEvent.A.DOWN,this.refreshHandler),this.graph.getView().addListener(app_InternalEvent.A.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getHandler(t){return this.handlers.get(t)}isHandled(t){return!!this.getHandler(t)}reset(){this.handlers.visit(((t,e)=>{e.reset.apply(e)}))}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){const t=this.handlers;this.handlers=new app_util_Dictionary.A;const e=(0,app_styleUtils.gU)(this.getHandledSelectionCells(),!1);for(let i=0;i<e.length;i+=1){const s=this.graph.view.getState(e[i]);if(s){let n=t.remove(e[i]);n&&(n.state!==s?(n.onDestroy(),n=null):this.isHandlerActive(n)||(n.refresh&&n.refresh(),n.redraw())),n&&this.handlers.put(e[i],n)}}t.visit(((t,e)=>{this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REMOVE,{state:e.state})),e.onDestroy()}));for(let t=0;t<e.length;t+=1){const i=this.graph.view.getState(e[t]);if(i){let s=this.handlers.get(e[t]);s?s.updateParentHighlight():(s=this.graph.createHandler(i),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ADD,{state:i})),this.handlers.put(e[t],s))}}}isHandlerActive(t){return null!==t.index}updateHandler(t){let e=this.handlers.remove(t.cell);if(e){const{index:i}=e,s=e.startX,n=e.startY;e.onDestroy(),e=this.graph.createHandler(t),e&&(this.handlers.put(t.cell,e),null!==i&&e.start(s,n,i))}}mouseDown(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseDown(t,e)}))}mouseMove(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseMove(t,e)}))}mouseUp(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseUp(t,e)}))}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.refreshHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler)}}app_SelectionCellsHandler.pluginId="SelectionCellsHandler";const app_handler_SelectionCellsHandler=app_SelectionCellsHandler;class app_MaxPopupMenu extends app_EventSource.A{constructor(t){super(),this.activeRow=null,this.eventReceiver=null,this.submenuImage=`${app_Client.A.imageBasePath}/submenu.gif`,this.zIndex=10006,this.useLeftButtonForPopup=!1,this.enabled=!0,this.itemCount=0,this.autoExpand=!1,this.smartSeparators=!1,this.labels=!0,this.willAddSeparator=!1,this.containsItems=!1,t&&(this.factoryMethod=t),this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=String(this.zIndex),this.div.appendChild(this.table),app_InternalEvent.A.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isPopupTrigger(t){return t.isPopupTrigger()||this.useLeftButtonForPopup&&(0,app_EventUtils.Lg)(t.getEvent())}addItem(t,e,i,s=null,n=null,l=!0,a=!0,r=!1){s=s??this,this.itemCount++,s.willAddSeparator&&(s.containsItems&&this.addSeparator(s,!0),s.willAddSeparator=!1),s.containsItems=!0;const o=document.createElement("tr");o.className="mxPopupMenuItem";const h=document.createElement("td");if(h.className="mxPopupMenuIcon",e){const t=document.createElement("img");t.src=e,h.appendChild(t)}else if(n){const t=document.createElement("div");t.className=n,h.appendChild(t)}if(o.appendChild(h),this.labels){const e=document.createElement("td");e.className="mxPopupMenuItem"+(l?"":" mxDisabled"),(0,app_domUtils.M9)(e,t),e.align="left",o.appendChild(e);const i=document.createElement("td");i.className="mxPopupMenuItem"+(l?"":" mxDisabled"),i.style.paddingRight="6px",i.style.textAlign="right",o.appendChild(i),null==s.div&&this.createSubmenu(s)}return s.tbody?.appendChild(o),a&&l&&(app_InternalEvent.A.addGestureListeners(o,(t=>{this.eventReceiver=o,s&&s.activeRow!=o&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),o.div&&(this.showSubmenu(s,o),s.activeRow=o)),app_InternalEvent.A.consume(t)}),(t=>{s&&s.activeRow!=o&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),this.autoExpand&&o.div&&(this.showSubmenu(s,o),s.activeRow=o)),r||(o.className="mxPopupMenuItemHover")}),(t=>{this.eventReceiver==o&&(s&&s.activeRow!=o&&this.hideMenu(),i?.(t)),this.eventReceiver=null,app_InternalEvent.A.consume(t)})),r||app_InternalEvent.A.addListener(o,"mouseout",(t=>{o.className="mxPopupMenuItem"}))),o}addCheckmark(t,e){if(t.firstChild){const i=t.firstChild.nextSibling;i.style.backgroundImage=`url('${e}')`,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="2px 50%"}}createSubmenu(t){t.table=document.createElement("table"),t.table.className="mxPopupMenu",t.tbody=document.createElement("tbody"),t.table.appendChild(t.tbody),t.div=document.createElement("div"),t.div.className="mxPopupMenu",t.div.style.position="absolute",t.div.style.display="inline",t.div.style.zIndex=String(this.zIndex),t.div.appendChild(t.table);const e=document.createElement("img");e.setAttribute("src",this.submenuImage),t.firstChild?.nextSibling?.nextSibling&&t.firstChild.nextSibling.nextSibling.appendChild(e)}showSubmenu(t,e){if(e.div){e.div.style.left=t.div.offsetLeft+e.offsetLeft+e.offsetWidth-1+"px",e.div.style.top=`${t.div.offsetTop+e.offsetTop}px`,document.body.appendChild(e.div);const i=e.div.offsetLeft,s=e.div.offsetWidth,n=(0,app_styleUtils.jb)(document),l=document.body,a=document.documentElement;i+s>n.x+(l.clientWidth||a.clientWidth)&&(e.div.style.left=`${Math.max(0,t.div.offsetLeft-s-6)}px`),(0,app_styleUtils.Uj)(e.div)}}addSeparator(t=null,e=!1){if(t=t||this,this.smartSeparators&&!e)t.willAddSeparator=!0;else if(t.tbody){t.willAddSeparator=!1;const e=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon",i.style.padding="0 0 0 0px",e.appendChild(i);const s=document.createElement("td");s.style.padding="0 0 0 0px",s.setAttribute("colSpan","2");const n=document.createElement("hr");n.setAttribute("size","1"),s.appendChild(n),e.appendChild(s),t.tbody.appendChild(e)}}popup(t,e,i,s){if(this.div&&this.tbody&&this.factoryMethod){for(this.div.style.left=`${t}px`,this.div.style.top=`${e}px`;this.tbody.firstChild;)app_InternalEvent.A.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,i,s),this.itemCount>0&&(this.showMenu(),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.SHOW)))}}isMenuShowing(){return this.div&&this.div.parentNode==document.body}showMenu(){document.body.appendChild(this.div),(0,app_styleUtils.Uj)(this.div)}hideMenu(){this.div&&(this.div.parentNode?.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.HIDE)))}hideSubmenu(t){t.activeRow&&(this.hideSubmenu(t.activeRow),t.activeRow.div.parentNode?.removeChild(t.activeRow.div),t.activeRow=null)}destroy(){this.div&&(app_InternalEvent.A.release(this.div),this.div.parentNode?.removeChild(this.div))}}const app_gui_MaxPopupMenu=app_MaxPopupMenu;class app_PopupMenuHandler extends app_gui_MaxPopupMenu{constructor(t){super(),this.inTolerance=!1,this.popupTrigger=!1,this.selectOnPopup=!0,this.clearSelectionOnBackground=!0,this.triggerX=null,this.triggerY=null,this.screenX=null,this.screenY=null,this.graph=t,this.graph.addMouseListener(this),this.gestureHandler=(t,e)=>{this.inTolerance=!1},this.graph.addListener(app_InternalEvent.A.GESTURE,this.gestureHandler),this.init()}init(){app_InternalEvent.A.addGestureListeners(this.div,(t=>{const e=this.graph.getPlugin("TooltipHandler");e?.hide()}))}isSelectOnPopup(t){return this.selectOnPopup}mouseDown(t,e){this.isEnabled()&&!(0,app_EventUtils.DO)(e.getEvent())&&(this.hideMenu(),this.triggerX=e.getGraphX(),this.triggerY=e.getGraphY(),this.screenX=(0,app_EventUtils.M4)(e.getEvent()).screenX,this.screenY=(0,app_EventUtils.M4)(e.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(e),this.inTolerance=!0)}mouseMove(t,e){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs((0,app_EventUtils.M4)(e.getEvent()).screenX-this.screenX)>this.graph.getEventTolerance()||Math.abs((0,app_EventUtils.M4)(e.getEvent()).screenY-this.screenY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}mouseUp(t,e){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){const t=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&null!=t&&!this.graph.isCellSelected(t)?this.graph.setSelectionCell(t):this.clearSelectionOnBackground&&null==t&&this.graph.clearSelection();const i=this.graph.getPlugin("TooltipHandler");i?.hide();const s=(0,app_styleUtils.ID)();this.popup(e.getX()+s.x+1,e.getY()+s.y+1,t,e.getEvent()),e.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(t){return t.getCell()}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}app_PopupMenuHandler.pluginId="PopupMenuHandler";const app_handler_PopupMenuHandler=app_PopupMenuHandler;var app_util_config=__webpack_require__(272);class app_ConnectionHandler extends app_EventSource.A{constructor(t,e=null){super(),this.previous=null,this.iconState=null,this.icons=[],this.cell=null,this.currentPoint=null,this.sourceConstraint=null,this.shape=null,this.icon=null,this.originalPoint=null,this.currentState=null,this.selectedIcon=null,this.waypoints=[],this.factoryMethod=null,this.moveIconFront=!1,this.moveIconBack=!1,this.connectImage=null,this.targetConnectImage=!1,this.enabled=!1,this.select=!0,this.createTarget=!1,this.error=null,this.waypointsEnabled=!1,this.ignoreMouseDown=!1,this.first=null,this.connectIconOffset=new app_Point.A(0,app_Constants.jo),this.edgeState=null,this.mouseDownCounter=0,this.movePreviewAway=!1,this.outlineConnect=!1,this.livePreview=!1,this.cursor=null,this.insertBeforeSource=!1,this.graph=t,this.factoryMethod=e,this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new app_handler_ConstraintHandler(this.graph),this.changeHandler=t=>{this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous&&!this.graph.view.getState(this.previous.cell)&&this.reset()},this.graph.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.changeHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE,this.changeHandler),this.graph.getView().addListener(app_InternalEvent.A.TRANSLATE,this.changeHandler),this.graph.getView().addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=t=>{this.reset()},this.graph.addListener(app_InternalEvent.A.START_EDITING,this.drillHandler),this.graph.getView().addListener(app_InternalEvent.A.DOWN,this.drillHandler),this.graph.getView().addListener(app_InternalEvent.A.UP,this.drillHandler),this.escapeHandler=()=>{this.reset()},this.graph.addListener(app_InternalEvent.A.ESCAPE,this.escapeHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isInsertBefore(t,e,i,s,n){return this.insertBeforeSource&&e!==i}isCreateTarget(t){return this.createTarget}setCreateTarget(t){this.createTarget=t}createShape(){const t=this.livePreview&&this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new app_edge_PolylineShape([],app_Constants.SU);return t&&t.node&&(t.dialect=app_Constants.$p.SVG,t.scale=this.graph.view.scale,t.pointerEvents=!1,t.isDashed=!0,t.init(this.graph.getView().getOverlayPane()),app_InternalEvent.A.redirectMouseEvents(t.node,this.graph,null)),t}isConnectableCell(t){return!0}createMarker(){return new app_ConnectionHandlerCellMarker(this.graph,this)}start(t,e,i,s){this.previous=t,this.first=new app_Point.A(e,i),this.edgeState=s??this.createEdgeState(),this.marker.currentColor=this.marker.validColor,this.marker.markedState=t,this.marker.mark(),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.START,{state:this.previous}))}isConnecting(){return!!this.first&&!!this.shape}isValidSource(t,e){return this.graph.isValidSource(t)}isValidTarget(t){return!0}validateConnection(t,e){return this.isValidTarget(e)?this.graph.getEdgeValidationError(null,t,e):""}getConnectImage(t){return this.connectImage}isMoveIconToFrontForState(t){return!(!t.text||t.text.node.parentNode!==this.graph.container)||this.moveIconFront}createIcons(t){const e=this.getConnectImage(t);if(e){this.iconState=t;const i=[],s=new app_Rectangle.A(0,0,e.width,e.height),n=new app_ImageShape.A(s,e.src,void 0,void 0,0);n.preserveImageAspect=!1,this.isMoveIconToFrontForState(t)?(n.dialect=app_Constants.$p.STRICTHTML,n.init(this.graph.container)):(n.dialect=app_Constants.$p.SVG,n.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&n.node.parentNode&&n.node.previousSibling&&n.node.parentNode.insertBefore(n.node,n.node.parentNode.firstChild)),n.node.style.cursor=app_Constants.Lm.CONNECT;const l=()=>this.currentState??t,a=t=>{(0,app_EventUtils.fm)(t)||(this.icon=n,this.graph.fireMouseEvent(app_InternalEvent.A.MOUSE_DOWN,new app_InternalMouseEvent.A(t,l())))};return app_InternalEvent.A.redirectMouseEvents(n.node,this.graph,l,a),i.push(n),this.redrawIcons(i,this.iconState),i}return[]}redrawIcons(t,e){if(t[0]&&t[0].bounds){const i=this.getIconPosition(t[0],e);t[0].bounds.x=i.x,t[0].bounds.y=i.y,t[0].redraw()}}getIconPosition(t,e){const{scale:i}=this.graph.getView();let s=e.getCenterX(),n=e.getCenterY();if(this.graph.isSwimlane(e.cell)){const t=this.graph.getStartSize(e.cell);s=0!==t.width?e.x+t.width*i/2:s,n=0!==t.height?e.y+t.height*i/2:n;const l=(0,app_mathUtils.eh)(e.style.rotation??0);if(0!==l){const t=Math.cos(l),i=Math.sin(l),a=new app_Point.A(e.getCenterX(),e.getCenterY()),r=(0,app_mathUtils.Iq)(new app_Point.A(s,n),t,i,a);s=r.x,n=r.y}}return new app_Point.A(s-t.bounds.width/2,n-t.bounds.height/2)}destroyIcons(){for(let t=0;t<this.icons.length;t+=1)this.icons[t].destroy();this.icons=[],this.icon=null,this.selectedIcon=null,this.iconState=null}isStartEvent(t){return null!==this.constraintHandler.currentFocus&&null!==this.constraintHandler.currentConstraint||null!==this.previous&&null===this.error&&(0===this.icons.length||null!==this.icon)}mouseDown(t,e){if(this.mouseDownCounter+=1,this.isEnabled()&&this.graph.isEnabled()&&!e.isConsumed()&&!this.isConnecting()&&this.isStartEvent(e)){if(this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new app_Point.A(e.getGraphX(),e.getGraphY()),this.edgeState=this.createEdgeState(e),this.mouseDownCounter=1,this.waypointsEnabled&&!this.shape&&(this.waypoints=[],this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState)),!this.previous&&this.edgeState&&this.edgeState.cell.geometry){const t=this.graph.getPointForEvent(e.getEvent());this.edgeState.cell.geometry.setTerminalPoint(t,!0)}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.START,{state:this.previous})),e.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(t){return!this.graph.isCellMovable(t.cell)}createEdgeState(t){return null}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,app_styleUtils.A3)(this.graph.container),i=t.getEvent(),s=(0,app_EventUtils.El)(i),n=(0,app_EventUtils.xJ)(i),l=document.documentElement,a=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),r=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-a,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-r;return this.outlineConnect&&!(0,app_EventUtils.RT)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,app_EventUtils.CA)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updateCurrentState(t,e){if(this.constraintHandler.update(t,!this.first,!1,!this.first||t.isSource(this.marker.highlight.shape)?null:e),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.highlight&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell&&this.marker.highlight.shape?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error||(this.currentState=this.constraintHandler.currentFocus),(this.error||this.currentState&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(t.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(t),this.currentState=this.marker.getValidState()),null==this.currentState||this.isCellEnabled(this.currentState.cell)||(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);const i=this.isOutlineConnectEvent(t);if(null!=this.currentState&&i){t.isSource(this.marker.highlight.shape)&&(e=new app_Point.A(t.getGraphX(),t.getGraphY()));const i=this.graph.getOutlineConstraint(e,this.currentState,t);this.constraintHandler.setFocus(t,this.currentState,!1),this.constraintHandler.currentConstraint=i,this.constraintHandler.currentPoint=e}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const e=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=app_Constants.eX,this.marker.highlight.shape.strokeWidth=app_Constants.XZ/e/e,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const i=t.getCell();i&&i.isConnectable()&&this.marker.getValidState()!==t.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=app_Constants.Vj,this.marker.highlight.shape.strokeWidth=app_Constants.es/e/e,this.marker.highlight.repaint()}}}}isCellEnabled(t){return!0}convertWaypoint(t){const e=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();t.x=t.x/e-i.x,t.y=t.y/e-i.y}snapToPreview(t,e){if(!(0,app_EventUtils.CA)(t.getEvent())&&this.previous){const i=this.graph.getGridSize()*this.graph.view.scale/2,s=this.sourceConstraint&&this.first?this.first:new app_Point.A(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(s.x-t.getGraphX())<i&&(e.x=s.x),Math.abs(s.y-t.getGraphY())<i&&(e.y=s.y)}}mouseMove(t,e){if(e.isConsumed()||!this.ignoreMouseDown&&!this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{!this.isEnabled()&&this.currentState&&(this.destroyIcons(),this.currentState=null);const t=this.graph.getView(),{scale:i}=t,s=t.translate;let n=new app_Point.A(e.getGraphX(),e.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(e.getEvent())&&(n=new app_Point.A((this.graph.snap(n.x/i-s.x)+s.x)*i,(this.graph.snap(n.y/i-s.y)+s.y)*i)),this.snapToPreview(e,n),this.currentPoint=n,(this.first||this.isEnabled()&&this.graph.isEnabled())&&(this.shape||!this.first||Math.abs(e.getGraphX()-this.first.x)>this.graph.getEventTolerance()||Math.abs(e.getGraphY()-this.first.y)>this.graph.getEventTolerance())&&this.updateCurrentState(e,n),this.first){let t=null,i=n;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(t=this.constraintHandler.currentConstraint,i=this.constraintHandler.currentPoint.clone()):this.previous&&!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,app_EventUtils.RT)(e.getEvent())&&(Math.abs(this.previous.getCenterX()-n.x)<Math.abs(this.previous.getCenterY()-n.y)?n.x=this.previous.getCenterX():n.y=this.previous.getCenterY());let s=this.first;if(this.selectedIcon&&this.selectedIcon.bounds){const t=this.selectedIcon.bounds.width,i=this.selectedIcon.bounds.height;if(this.currentState&&this.targetConnectImage){const t=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=t.x,this.selectedIcon.bounds.y=t.y}else{const s=new app_Rectangle.A(e.getGraphX()+this.connectIconOffset.x,e.getGraphY()+this.connectIconOffset.y,t,i);this.selectedIcon.bounds=s}this.selectedIcon.redraw()}if(this.edgeState)this.updateEdgeState(i,t),i=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],s=this.edgeState.absolutePoints[0];else{if(this.currentState&&!this.constraintHandler.currentConstraint){const t=this.getTargetPerimeterPoint(this.currentState,e);null!=t&&(i=t)}if(!this.sourceConstraint&&this.previous){const t=this.waypoints.length>0?this.waypoints[0]:i,n=this.getSourcePerimeterPoint(this.previous,t,e);n&&(s=n)}}if(!this.currentState&&this.movePreviewAway&&i){let t=s;if(this.edgeState&&this.edgeState.absolutePoints.length>=2){const e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];e&&(t=e)}if(t){const e=i.x-t.x,s=i.y-t.y,n=Math.sqrt(e*e+s*s);if(0===n)return;this.originalPoint=i.clone(),i.x-=4*e/n,i.y-=4*s/n}}else this.originalPoint=null;if(!this.shape){const t=Math.abs(e.getGraphX()-this.first.x),i=Math.abs(e.getGraphY()-this.first.y);(t>this.graph.getEventTolerance()||i>this.graph.getEventTolerance())&&(this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(e,n))}if(this.shape){if(this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{let t=[s];this.waypoints.length>0&&(t=t.concat(this.waypoints)),t.push(i),this.shape.points=t}this.drawPreview()}this.cursor&&(this.graph.container.style.cursor=this.cursor),app_InternalEvent.A.consume(e.getEvent()),e.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous===this.currentState||this.edgeState?this.previous!==this.currentState||null==this.currentState||0!==this.icons.length||this.graph.isMouseDown||e.consume():(this.destroyIcons(),!this.currentState||this.error||this.constraintHandler.currentConstraint||(this.icons=this.createIcons(this.currentState),0===this.icons.length&&(this.currentState.setCursor(app_Constants.Lm.CONNECT),e.consume())),this.previous=this.currentState):this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){let t=!1;const i=e.getSource();for(let e=0;e<this.icons.length&&!t;e+=1)t=i===this.icons[e].node||!!i&&i.parentNode===this.icons[e].node;t||this.updateIcons(this.currentState,this.icons,e)}}}updateEdgeState(t,e){if(!this.edgeState)return;this.sourceConstraint&&this.sourceConstraint.point&&(this.edgeState.style.exitX=this.sourceConstraint.point.x,this.edgeState.style.exitY=this.sourceConstraint.point.y),e&&e.point?(this.edgeState.style.entryX=e.point.x,this.edgeState.style.entryY=e.point.y):(this.edgeState.style.entryX=0,this.edgeState.style.entryY=0),this.edgeState.absolutePoints=[null,null!=this.currentState?null:t],this.sourceConstraint&&this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==e&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e));const i=[];for(let t=0;t<this.waypoints.length;t+=1){const e=this.waypoints[t].clone();this.convertWaypoint(e),i[t]=e}this.graph.view.updatePoints(this.edgeState,i,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(t,e){let i=null;const{view:s}=t,n=s.getPerimeterFunction(t);if(n&&this.previous&&this.edgeState){const e=this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new app_Point.A(this.previous.getCenterX(),this.previous.getCenterY()),l=n(s.getPerimeterBounds(t),this.edgeState,e,!1);l&&(i=l)}else i=new app_Point.A(t.getCenterX(),t.getCenterY());return i}getSourcePerimeterPoint(t,e,i){let s=null;const{view:n}=t,l=n.getPerimeterFunction(t),a=new app_Point.A(t.getCenterX(),t.getCenterY());if(l){const i=t.style.rotation??0,r=-i*(Math.PI/180);0!==i&&(e=(0,app_mathUtils.Iq)(new app_Point.A(e.x,e.y),Math.cos(r),Math.sin(r),a));let o=l(n.getPerimeterBounds(t),t,e,!1);o&&(0!==i&&(o=(0,app_mathUtils.Iq)(new app_Point.A(o.x,o.y),Math.cos(-r),Math.sin(-r),a)),s=o)}else s=a;return s}updateIcons(t,e,i){}isStopEvent(t){return!!t.getState()}addWaypointForEvent(t){if(!this.first)return;let e=(0,app_styleUtils.ce)(this.graph.container,t.getX(),t.getY());const i=Math.abs(e.x-this.first.x),s=Math.abs(e.y-this.first.y);if(this.waypoints.length>0||this.mouseDownCounter>1&&(i>this.graph.getEventTolerance()||s>this.graph.getEventTolerance())){const{scale:i}=this.graph.view;e=new app_Point.A(this.graph.snap(t.getGraphX()/i)*i,this.graph.snap(t.getGraphY()/i)*i),this.waypoints.push(e)}}checkConstraints(t,e){return!(t&&e&&t.point&&e.point&&t.point.equals(e.point)&&t.dx===e.dx&&t.dy===e.dy&&t.perimeter===e.perimeter)}mouseUp(t,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e))return this.addWaypointForEvent(e),void e.consume();const t=this.sourceConstraint,i=this.constraintHandler.currentConstraint,s=this.previous?this.previous.cell:null;let n=null;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&(n=this.constraintHandler.currentFocus.cell),!n&&this.currentState&&(n=this.currentState.cell),this.error||s&&n&&s===n&&!this.checkConstraints(t,i)?(null!=this.previous&&null!=this.marker.validState&&this.previous.cell===this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.validState.cell,e.getEvent()),null!=this.error&&this.error.length>0&&this.graph.validationAlert(this.error)):this.connect(s,n,e.getEvent(),e.getCell()),this.destroyIcons(),e.consume()}null!=this.first&&this.reset()}reset(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.RESET))}drawPreview(){this.updatePreview(null===this.error),this.shape&&this.shape.redraw()}updatePreview(t){this.shape&&(this.shape.strokeWidth=this.getEdgeWidth(t),this.shape.stroke=this.getEdgeColor(t))}getEdgeColor(t){return t?app_Constants.Vm:app_Constants.SU}getEdgeWidth(t){return t?3:1}connect(t,e,i,s=null){if(e||this.isCreateTarget(i)||this.graph.isAllowDanglingEdges()){const n=this.graph.getDataModel();let l=!1,a=null;n.beginUpdate();try{if(t&&!e&&!this.graph.isIgnoreTerminalEvent(i)&&this.isCreateTarget(i)&&(e=this.createTargetVertex(i,t))){if(s=this.graph.getDropTarget([e],i,s),l=!0,null!=s&&s.isEdge())s=this.graph.getDefaultParent();else{const t=s?this.graph.getView().getState(s):null;if(t){const i=e.getGeometry();i&&(i.x-=t.origin.x,i.y-=t.origin.y)}}this.graph.addCell(e,s)}let r=this.graph.getDefaultParent();t&&e&&t.getParent()===e.getParent()&&t.getParent()?.getParent()!==n.getRoot()&&(r=t.getParent(),t.geometry&&t.geometry.relative&&e.geometry&&e.geometry.relative&&(r=r.getParent()));let o=null,h={};if(this.edgeState?.cell&&(o=this.edgeState.cell.value,h=this.edgeState.cell.style??{}),a=this.insertEdge(r,"",o,t,e,h),a&&t){if(this.graph.setConnectionConstraint(a,t,!0,this.sourceConstraint),this.graph.setConnectionConstraint(a,e,!1,this.constraintHandler.currentConstraint),this.edgeState?.cell?.geometry&&n.setGeometry(a,this.edgeState.cell.geometry),r=t.getParent(),this.isInsertBefore(a,t,e,i,s)){let e=t;for(;e&&null!=e.parent&&null!=e.geometry&&e.geometry.relative&&e.parent!==a.parent;)e=e.getParent();null!=e&&null!=e.parent&&e.parent===a.parent&&n.add(r,a,e.parent.getIndex(e))}let o=a.getGeometry();if(null==o&&(o=new app_geometry_Geometry,o.relative=!0,n.setGeometry(a,o)),this.waypoints.length>0){const t=this.graph.view.scale,e=this.graph.view.translate;o.points=[];for(let i=0;i<this.waypoints.length;i+=1){const s=this.waypoints[i];o.points.push(new app_Point.A(s.x/t-e.x,s.y/t-e.y))}}if(!e&&this.currentPoint){const t=this.graph.view.translate,e=this.graph.view.scale,i=null!=this.originalPoint?new app_Point.A(this.originalPoint.x/e-t.x,this.originalPoint.y/e-t.y):new app_Point.A(this.currentPoint.x/e-t.x,this.currentPoint.y/e-t.y);i.x-=this.graph.getPanDx()/this.graph.view.scale,i.y-=this.graph.getPanDy()/this.graph.view.scale,o.setTerminalPoint(i,!1)}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.CONNECT,"cell",a,"terminal",e,"event",i,"target",s,"terminalInserted",l))}}catch(t){app_util_config.eo.logger.show();const e="Error in ConnectionHandler: "+(t instanceof Error?t.message+"\n"+t.stack:"unknown cause");app_util_config.eo.logger.debug(e)}finally{n.endUpdate()}this.select&&this.selectCells(a,l?e:null)}}selectCells(t,e){this.graph.setSelectionCell(t)}insertEdge(t,e,i,s,n,l){if(!this.factoryMethod)return this.graph.insertEdge(t,e,i,s,n,l);let a=this.createEdge(i,s,n,l);return a=this.graph.addEdge(a,t,s,n),a}createTargetVertex(t,e){let i=e.getGeometry();for(;i&&i.relative;)i=(e=e.getParent()).getGeometry();const s=this.graph.cloneCell(e);if(i=s.getGeometry(),i&&this.currentPoint){const t=this.graph.view.translate,s=this.graph.view.scale,n=new app_Point.A(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y);i.x=Math.round(n.x-i.width/2-this.graph.getPanDx()/s),i.y=Math.round(n.y-i.height/2-this.graph.getPanDy()/s);const l=this.getAlignmentTolerance();if(l>0){const n=this.graph.view.getState(e);if(null!=n){const e=n.x/s-t.x,a=n.y/s-t.y;Math.abs(e-i.x)<=l&&(i.x=Math.round(e)),Math.abs(a-i.y)<=l&&(i.y=Math.round(a))}}}return s}getAlignmentTolerance(t){return this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.graph.getSnapTolerance()}createEdge(t,e,i,s={}){let n=null;if(null!=this.factoryMethod&&(n=this.factoryMethod(e,i,s)),null==n){n=new app_cell_Cell(t||""),n.setEdge(!0),n.setStyle(s);const e=new app_geometry_Geometry;e.relative=!0,n.setGeometry(e)}return n}onDestroy(){this.graph.removeMouseListener(this),this.shape&&(this.shape.destroy(),this.shape=null),this.marker&&(this.marker.destroy(),this.marker=null),this.constraintHandler&&this.constraintHandler.onDestroy(),this.changeHandler&&(this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler)),this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler)),this.escapeHandler&&this.graph.removeListener(this.escapeHandler)}}app_ConnectionHandler.pluginId="ConnectionHandler";class app_ConnectionHandlerCellMarker extends app_cell_CellMarker{constructor(t,e,i=app_Constants.Vj,s=app_Constants.G7,n=app_Constants.ir){super(t,i,s,n),this.hotspotEnabled=!0,this.connectionHandler=e}getCell(t){let e=super.getCell(t);if(this.connectionHandler.error=null,!e&&this.connectionHandler.currentPoint&&(e=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),e&&!e.isConnectable()&&this.connectionHandler.cell){const t=this.connectionHandler.cell.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.connectionHandler.graph.isSwimlane(e)&&null!=this.connectionHandler.currentPoint&&this.connectionHandler.graph.hitsSwimlaneContent(e,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(e))&&(e=null),e?this.connectionHandler.isConnecting()?this.connectionHandler.previous&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,e),null!==this.connectionHandler.error&&0===this.connectionHandler.error.length&&(e=null,this.connectionHandler.isCreateTarget(t.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(e,t)||(e=null):!this.connectionHandler.isConnecting()||this.connectionHandler.isCreateTarget(t.getEvent())||this.connectionHandler.graph.isAllowDanglingEdges()||(this.connectionHandler.error=""),e}isValidState(t){return this.connectionHandler.isConnecting()?!this.connectionHandler.error:super.isValidState(t)}getMarkerColor(t,e,i){return!this.connectionHandler.connectImage||this.connectionHandler.isConnecting()?super.getMarkerColor(t,e,i):app_Constants.x3}intersects(t,e){return!(!this.connectionHandler.connectImage&&!this.connectionHandler.isConnecting())||super.intersects(t,e)}}const app_handler_ConnectionHandler=app_ConnectionHandler;class app_Guide{constructor(t,e){this.states=[],this.horizontal=!0,this.vertical=!0,this.guideX=null,this.guideY=null,this.rounded=!1,this.tolerance=2,this.graph=t,this.setStates(e)}setStates(t){this.states=t}isEnabledForEvent(t){return!0}getGuideTolerance(t=!1){return t&&this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.tolerance}createGuideShape(t=!1){const e=new app_edge_PolylineShape([],app_Constants.JP,app_Constants.Mn);return e.isDashed=!0,e}isStateIgnored(t){return!1}move(t=null,e,i=!1,s=!1){if((this.horizontal||this.vertical)&&t){const{scale:s}=this.graph.getView(),n=this.getGuideTolerance(i)*s,l=t.clone();l.x+=e.x,l.y+=e.y;let a=!1,r=null,o=null,h=!1,p=null,d=null,c=n,u=n;const g=l.x,_=l.x+l.width,f=l.getCenterX(),C=l.y,y=l.y+l.height,E=l.getCenterY(),v=(i,s,n)=>{let l=!1;n&&Math.abs(i-f)<c?(e.x=i-t.getCenterX(),c=Math.abs(i-f),l=!0):n||(Math.abs(i-g)<c?(e.x=i-t.x,c=Math.abs(i-g),l=!0):Math.abs(i-_)<c&&(e.x=i-t.x-t.width,c=Math.abs(i-_),l=!0)),l&&(r=s,o=i,this.guideX||(this.guideX=this.createGuideShape(!0),this.guideX.dialect=app_Constants.$p.SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),a=a||l},m=(i,s,n)=>{let l=!1;n&&Math.abs(i-E)<u?(e.y=i-t.getCenterY(),u=Math.abs(i-E),l=!0):n||(Math.abs(i-C)<u?(e.y=i-t.y,u=Math.abs(i-C),l=!0):Math.abs(i-y)<u&&(e.y=i-t.y-t.height,u=Math.abs(i-y),l=!0)),l&&(p=s,d=i,this.guideY||(this.guideY=this.createGuideShape(!1),this.guideY.dialect=app_Constants.$p.SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),h=h||l};for(let t=0;t<this.states.length;t+=1){const e=this.states[t];e&&!this.isStateIgnored(e)&&(this.horizontal&&(v(e.getCenterX(),e,!0),v(e.x,e,!1),v(e.x+e.width,e,!1),e.cell||v(e.getCenterX(),e,!1)),this.vertical&&(m(e.getCenterY(),e,!0),m(e.y,e,!1),m(e.y+e.height,e,!1),e.cell||m(e.getCenterY(),e,!1)))}this.graph.snapDelta(e,t,!i,a,h),e=this.getDelta(t,r,e.x,p,e.y);const w=this.graph.container;if(!a&&this.guideX)this.guideX.node.style.visibility="hidden";else if(this.guideX){let i=null,s=null;r&&(i=Math.min(t.y+e.y-this.graph.getPanDy(),r.y),s=Math.max(t.y+t.height+e.y-this.graph.getPanDy(),r.y+r.height)),this.guideX.points=null!==i&&null!==s?[new app_Point.A(o,i),new app_Point.A(o,s)]:[new app_Point.A(o,-this.graph.getPanDy()),new app_Point.A(o,w.scrollHeight-3-this.graph.getPanDy())],this.guideX.stroke=this.getGuideColor(r,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(h||null==this.guideY){if(null!=this.guideY){let i=null,s=null;null!=p&&null!=t&&(i=Math.min(t.x+e.x-this.graph.getPanDx(),p.x),s=Math.max(t.x+t.width+e.x-this.graph.getPanDx(),p.x+p.width)),null!=i&&null!=s&&null!==d?this.guideY.points=[new app_Point.A(i,d),new app_Point.A(s,d)]:null!==d&&(this.guideY.points=[new app_Point.A(-this.graph.getPanDx(),d),new app_Point.A(w.scrollWidth-3-this.graph.getPanDx(),d)]),this.guideY.stroke=this.getGuideColor(p,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}else this.guideY.node.style.visibility="hidden"}return e}getDelta(t,e=null,i,s=null,n){const l=this.graph.view.scale;return(this.rounded||null!=e&&null==e.cell)&&(i=Math.round((t.x+i)/l)*l-t.x),(this.rounded||null!=s&&null==s.cell)&&(n=Math.round((t.y+n)/l)*l-t.y),new app_Point.A(i,n)}getGuideColor(t,e){return app_Constants.JP}hide(){this.setVisible(!1)}setVisible(t){this.guideX&&(this.guideX.node.style.visibility=t?"visible":"hidden"),this.guideY&&(this.guideY.node.style.visibility=t?"visible":"hidden")}destroy(){this.guideX&&(this.guideX.destroy(),this.guideX=null),this.guideY&&(this.guideY.destroy(),this.guideY=null)}}const app_other_Guide=app_Guide;class app_SelectionHandler{constructor(t){this.refreshThread=null,this.maxCells=50,this.enabled=!0,this.highlightEnabled=!0,this.cloneEnabled=!0,this.moveEnabled=!0,this.guidesEnabled=!1,this.handlesVisible=!0,this.guide=null,this.currentDx=0,this.currentDy=0,this.updateCursor=!0,this.selectEnabled=!0,this.removeCellsFromParent=!0,this.removeEmptyParents=!1,this.connectOnDrop=!1,this.scrollOnMove=!0,this.minimumSize=6,this.previewColor="black",this.htmlPreview=!1,this.shape=null,this.scaleGrid=!1,this.rotationEnabled=!0,this.maxLivePreview=0,this.allowLivePreview=app_Client.A.IS_SVG,this.cell=null,this.delayedSelection=!1,this.first=null,this.cells=null,this.bounds=null,this.pBounds=null,this.allCells=new app_util_Dictionary.A,this.cellWasClicked=!1,this.cloning=!1,this.cellCount=0,this.target=null,this.suspended=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.highlight=null,this.graph=t,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(app_InternalEvent.A.PAN,this.panHandler),this.escapeHandler=(t,e)=>{this.reset()},this.graph.addListener(app_InternalEvent.A.ESCAPE,this.escapeHandler),this.refreshHandler=(t,e)=>{this.refreshThread&&window.clearTimeout(this.refreshThread),this.refreshThread=window.setTimeout((()=>{if(this.refreshThread=null,this.first&&!this.suspended&&this.cells){const t=this.currentDx,e=this.currentDy;if(this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),null!=this.pBounds||this.livePreviewUsed){if(this.currentDx=t,this.currentDy=e,this.updatePreview(),this.updateHint(),this.livePreviewUsed){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1,!0),this.updatePreview()}}else this.reset()}}),0)},this.graph.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.refreshHandler),this.graph.addListener(app_InternalEvent.A.REFRESH,this.refreshHandler),this.keyHandler=t=>{if(null!=this.graph.container&&"hidden"!==this.graph.container.style.visibility&&null!=this.first&&!this.suspended){const e=this.graph.isCloneEvent(t)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();e!==this.cloning&&(this.cloning=e,this.checkPreview(),this.updatePreview())}},"undefined"!=typeof document&&(app_InternalEvent.A.addListener(document,"keydown",this.keyHandler),app_InternalEvent.A.addListener(document,"keyup",this.keyHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(t){this.cloneEnabled=t}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(t){this.moveEnabled=t}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(t){this.selectEnabled=t}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(t){this.removeCellsFromParent=t}isPropagateSelectionCell(t,e,i){const s=t.getParent();if(e){const e=t.isEdge()?null:t.getGeometry();return!this.graph.isSiblingSelected(t)&&e&&e.relative||!this.graph.isSwimlane(s)}return(!this.graph.isToggleEvent(i.getEvent())||!this.graph.isSiblingSelected(t)&&!this.graph.isCellSelected(t)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(i.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(t){let e=t.getState();if((!this.graph.isToggleEvent(t.getEvent())||!(0,app_EventUtils.CA)(t.getEvent()))&&e&&!this.graph.isCellSelected(e.cell)){let i=e.cell.getParent(),s=i?this.graph.view.getState(i):null;for(;s&&!this.graph.isCellSelected(s.cell)&&(s.cell.isVertex()||s.cell.isEdge())&&this.isPropagateSelectionCell(e.cell,!0,t);)e=s,i=e.cell.getParent(),s=i?this.graph.view.getState(i):null}return e?e.cell:null}isDelayedSelection(t,e){let i=t;const s=this.graph.getPlugin("SelectionCellsHandler");if(!this.graph.isToggleEvent(e.getEvent())||!(0,app_EventUtils.CA)(e.getEvent()))for(;i;){if(s?.isHandled(i)){const t=this.graph.getPlugin("CellEditorHandler");return t?.getEditingCell()!==i}i=i.getParent()}return this.graph.isToggleEvent(e.getEvent())&&!(0,app_EventUtils.CA)(e.getEvent())}selectDelayed(t){const e=this.graph.getPlugin("PopupMenuHandler");if(!e||!e.isPopupTrigger(t)){let e=t.getCell();null===e&&(e=this.cell),e&&this.selectCellForEvent(e,t)}}selectCellForEvent(t,e){const i=this.graph.view.getState(t);if(i)if(e.isSource(i.control))this.graph.selectCellForEvent(t,e.getEvent());else{if(!this.graph.isToggleEvent(e.getEvent())||!(0,app_EventUtils.CA)(e.getEvent())){let i=t.getParent();for(;i&&this.graph.view.getState(i)&&(i.isVertex()||i.isEdge())&&this.isPropagateSelectionCell(t,!1,e);)i=(t=i).getParent()}this.graph.selectCellForEvent(t,e.getEvent())}return t}consumeMouseEvent(t,e){e.consume()}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&e.getState()&&!(0,app_EventUtils.DO)(e.getEvent())){const t=this.getInitialCellForEvent(e);if(t&&(this.delayedSelection=this.isDelayedSelection(t,e),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(t,e.getEvent()),this.isMoveEnabled())){const i=t.getGeometry();i&&this.graph.isCellMovable(t)&&(!t.isEdge()||this.graph.getSelectionCount()>1||i.points&&i.points.length>0||!t.getTerminal(!0)||!t.getTerminal(!1)||this.graph.isAllowDanglingEdges()||this.graph.isCloneEvent(e.getEvent())&&this.graph.isCellsCloneable())?this.start(t,e.getX(),e.getY()):this.delayedSelection&&(this.cell=t),this.cellWasClicked=!0,this.consumeMouseEvent(app_InternalEvent.A.MOUSE_DOWN,e)}}}getGuideStates(){const t=this.graph.getDefaultParent();return this.graph.view.getCellStates(t.filterDescendants((t=>{const e=t.getGeometry();return!!this.graph.view.getState(t)&&t.isVertex()&&!!e&&!e.relative})))}getCells(t){return!this.delayedSelection&&this.graph.isCellMovable(t)?[t]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(t){const e=this.getBoundingBox(t);if(e){if(e.width=Math.max(0,e.width-1),e.height=Math.max(0,e.height-1),e.width<this.minimumSize){const t=this.minimumSize-e.width;e.x-=t/2,e.width=this.minimumSize}else e.x=Math.round(e.x),e.width=Math.ceil(e.width);if(e.height<this.minimumSize){const t=this.minimumSize-e.height;e.y-=t/2,e.height=this.minimumSize}else e.y=Math.round(e.y),e.height=Math.ceil(e.height)}return e}getBoundingBox(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.graph.view.getState(t[i]);if(s){let n=null;t[i].isVertex()&&s.shape&&s.shape.boundingBox&&(n=s.shape.boundingBox),n&&(e?e.add(n):e=app_Rectangle.A.fromRectangle(n))}}return e}createPreviewShape(t){const e=new app_RectangleShape.A(t,app_Constants.x3,this.previewColor);return e.isDashed=!0,this.htmlPreview?(e.dialect=app_Constants.$p.STRICTHTML,e.init(this.graph.container)):(e.dialect=app_Constants.$p.SVG,e.init(this.graph.getView().getOverlayPane()),e.pointerEvents=!1,app_Client.A.IS_IOS&&(e.getSvgScreenOffset=()=>0)),e}createGuide(){return new app_other_Guide(this.graph,this.getGuideStates())}start(t,e,i,s){this.cell=t,this.first=(0,app_styleUtils.ce)(this.graph.container,e,i),this.cells=s||this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.cloning=!1,this.cellCount=0;for(let t=0;t<this.cells.length;t+=1)this.cellCount+=this.addStates(this.cells[t],this.allCells);if(this.guidesEnabled){this.guide=this.createGuide();const e=t.getParent(),i=e.getChildCount()<2,s=new app_util_Dictionary.A,n=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell);for(let t=0;t<n.length;t+=1){const e=this.graph.view.getState(n[t]);e&&!s.get(e)&&s.put(e,!0)}this.guide.isStateIgnored=t=>{const n=t.cell.getParent();return!!t.cell&&(!this.cloning&&!!this.isCellMoving(t.cell)||t.cell!==(this.target||e)&&!i&&!s.get(t)&&(!this.target||this.target.getChildCount()>=2)&&n!==(this.target||e))}}}addStates(t,e){const i=this.graph.view.getState(t);let s=0;if(i&&!e.get(t)){e.put(t,i),s++;const n=t.getChildCount();for(let i=0;i<n;i+=1)s+=this.addStates(t.getChildAt(i),e)}return s}isCellMoving(t){return this.allCells.get(t)}useGuidesForEvent(t){return!this.guide||this.guide.isEnabledForEvent(t.getEvent())&&!this.graph.isConstrainedEvent(t.getEvent())}snap(t){const e=this.scaleGrid?this.graph.view.scale:1;return t.x=this.graph.snap(t.x/e)*e,t.y=this.graph.snap(t.y/e)*e,t}getDelta(t){const e=(0,app_styleUtils.ce)(this.graph.container,t.getX(),t.getY());return this.first?new app_Point.A(e.x-this.first.x-this.graph.getPanDx(),e.y-this.first.y-this.graph.getPanDy()):new app_Point.A}updateHint(t){}removeHint(){}roundLength(t){return Math.round(100*t)/100}isValidDropTarget(t,e){return!!this.cell&&this.cell.getParent()!==t}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?this.cloning&&this.livePreviewActive||(this.livePreviewActive=!0,this.livePreviewUsed=!0):this.livePreviewUsed||this.shape||!this.bounds||(this.shape=this.createPreviewShape(this.bounds))}mouseMove(t,e){const{graph:i}=this;if(!e.isConsumed()&&i.isMouseDown&&this.cell&&this.first&&this.bounds&&!this.suspended){if((0,app_EventUtils.DO)(e.getEvent()))return void this.reset();let t=this.getDelta(e);const s=i.getEventTolerance();if(this.shape||this.livePreviewActive||Math.abs(t.x)>s||Math.abs(t.y)>s){this.highlight||(this.highlight=new app_cell_CellHighlight(this.graph,app_Constants.ag,3));const s=i.isCloneEvent(e.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),n=i.isGridEnabledEvent(e.getEvent()),l=e.getCell();let a=!0,r=null;this.cloning=s,i.isDropEnabled()&&this.highlightEnabled&&this.cells&&(r=i.getDropTarget(this.cells,e.getEvent(),l,s));let o=r?i.getView().getState(r):null,h=!1;if(o&&(s||r&&this.isValidDropTarget(r,e)))this.target!==r&&(this.target=r,this.setHighlightColor(app_Constants.ag)),h=!0;else if(this.target=null,this.connectOnDrop&&l&&this.cells&&1===this.cells.length&&l.isVertex()&&l.isConnectable()&&(o=i.getView().getState(l),o)){const t=null===i.getEdgeValidationError(null,this.cell,l)?app_Constants.Vm:app_Constants.$o;this.setHighlightColor(t),h=!0}o&&h?this.highlight.highlight(o):this.highlight.hide(),this.guide&&this.useGuidesForEvent(e)?(t=this.guide.move(this.bounds,t,n,s),a=!1):t=this.graph.snapDelta(t,this.bounds,!n,!1,!1),this.guide&&a&&this.guide.hide(),i.isConstrainedEvent(e.getEvent())&&(Math.abs(t.x)>Math.abs(t.y)?t.y=0:t.x=0),this.checkPreview(),this.currentDx===t.x&&this.currentDy===t.y||(this.currentDx=t.x,this.currentDy=t.y,this.updatePreview())}this.updateHint(e),this.consumeMouseEvent(app_InternalEvent.A.MOUSE_MOVE,e),app_InternalEvent.A.consume(e.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!e.isConsumed()&&(e.getState()||e.sourceState)&&!i.isMouseDown){let t=i.getCursorForMouseEvent(e);const s=e.getCell();!t&&s&&i.isEnabled()&&i.isCellMovable(s)&&(t=s.isEdge()?app_Constants.Lm.MOVABLE_EDGE:app_Constants.Lm.MOVABLE_VERTEX),t&&e.sourceState&&e.sourceState.setCursor(t)}}updatePreview(t=!1){if(this.livePreviewUsed&&!t){if(this.cells){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1),this.updateLivePreview(this.currentDx,this.currentDy)}}else this.updatePreviewShape()}updatePreviewShape(){this.shape&&this.pBounds&&(this.shape.bounds=new app_Rectangle.A(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(t,e){if(!this.suspended){const i=[];if(this.allCells&&this.allCells.visit(((s,n)=>{const l=n?this.graph.view.getState(n.cell):null;if(l!==n&&n&&(n.destroy(),l?this.allCells.put(n.cell,l):this.allCells.remove(n.cell),n=l),n){const s=n.clone();i.push([n,s]),n.shape&&(null===n.shape.originalPointerEvents&&(n.shape.originalPointerEvents=n.shape.pointerEvents),n.shape.pointerEvents=!1,n.text&&(null===n.text.originalPointerEvents&&(n.text.originalPointerEvents=n.text.pointerEvents),n.text.pointerEvents=!1)),n.cell.isVertex()&&(n.x+=t,n.y+=e,this.cloning?n.text&&(n.text.updateBoundingBox(),n.text.boundingBox&&(n.text.boundingBox.x+=t,n.text.boundingBox.y+=e),n.text.unrotatedBoundingBox&&(n.text.unrotatedBoundingBox.x+=t,n.text.unrotatedBoundingBox.y+=e)):(n.view.graph.cellRenderer.redraw(n,!0),n.view.invalidate(n.cell),n.invalid=!1,n.control&&n.control.node&&(n.control.node.style.visibility="hidden")))}})),0===i.length)this.reset();else{const s=this.graph.view.scale;for(let n=0;n<i.length;n+=1){const l=i[n][0];if(l.cell.isEdge()){const a=l.cell.getGeometry(),r=[];if(a&&a.points)for(let i=0;i<a.points.length;i++)a.points[i]&&r.push(new app_Point.A(a.points[i].x+t/s,a.points[i].y+e/s));let o=l.visibleSourceState,h=l.visibleTargetState;const p=i[n][1].absolutePoints;if(null!=o&&this.isCellMoving(o.cell))l.view.updateFixedTerminalPoint(l,o,!0,this.graph.getConnectionConstraint(l,o,!0));else{const i=p[0];i&&(l.setAbsoluteTerminalPoint(new app_Point.A(i.x+t,i.y+e),!0),o=null)}if(null!=h&&this.isCellMoving(h.cell))l.view.updateFixedTerminalPoint(l,h,!1,this.graph.getConnectionConstraint(l,h,!1));else{const i=p[p.length-1];i&&(l.setAbsoluteTerminalPoint(new app_Point.A(i.x+t,i.y+e),!1),h=null)}l.view.updatePoints(l,r,o,h),l.view.updateFloatingTerminalPoints(l,o,h),l.view.updateEdgeLabelOffset(l),l.invalid=!1,this.cloning||l.view.graph.cellRenderer.redraw(l,!0)}}this.graph.view.validate(),this.redrawHandles(i),this.resetPreviewStates(i)}}}redrawHandles(t){const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i][0].cell);s?.redraw(!0)}}resetPreviewStates(t){for(let e=0;e<t.length;e+=1)t[e][0].setState(t[e][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape&&(this.shape.node.style.visibility="hidden"),this.guide&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=!1,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape&&(this.shape.node.style.visibility="visible"),this.guide&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells.visit(((t,e)=>{e.shape&&null!==e.shape.originalPointerEvents&&(e.shape.pointerEvents=e.shape.originalPointerEvents,e.shape.originalPointerEvents=null,e.shape.bounds=null,e.text&&null!==e.text.originalPointerEvents&&(e.text.pointerEvents=e.text.originalPointerEvents,e.text.originalPointerEvents=null)),e.control&&e.control.node&&"hidden"===e.control.node.style.visibility&&(e.control.node.style.visibility=""),this.cloning||e.text&&e.text.updateBoundingBox(),e.view.invalidate(e.cell)})),this.graph.view.validate()}setHandlesVisibleForCells(t,e,i=!1){if(i||this.handlesVisible!==e){this.handlesVisible=e;const i=this.graph.getPlugin("SelectionCellsHandler");for(let s=0;s<t.length;s+=1){const n=i?.getHandler(t[s]);n&&(n.setHandlesVisible(e),e&&n.redraw())}}}setHighlightColor(t){this.highlight&&this.highlight.setHighlightColor(t)}mouseUp(t,e){if(!e.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell&&this.first&&(this.shape||this.livePreviewUsed)&&(0,app_mathUtils.kf)(this.currentDx)&&(0,app_mathUtils.kf)(this.currentDy)){const{graph:t}=this,i=e.getCell();if(this.connectOnDrop&&!this.target&&i&&i.isVertex()&&i.isConnectable()&&t.isEdgeValid(null,this.cell,i)){const s=t.getPlugin("ConnectionHandler");s?.connect(this.cell,i,e.getEvent())}else{const i=t.isCloneEvent(e.getEvent())&&t.isCellsCloneable()&&this.isCloneEnabled(),{scale:s}=t.getView(),n=this.roundLength(this.currentDx/s),l=this.roundLength(this.currentDy/s),a=this.target;a&&t.isSplitEnabled()&&this.cells&&t.isSplitTarget(a,this.cells,e.getEvent())?t.splitEdge(a,this.cells,null,n,l,e.getGraphX(),e.getGraphY()):this.cells&&this.moveCells(this.cells,n,l,i,this.target,e.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(e);this.cellWasClicked&&this.consumeMouseEvent(app_InternalEvent.A.MOUSE_UP,e),this.reset()}reset(){if(this.livePreviewUsed){this.resetLivePreview();const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!0)}this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.cellWasClicked=!1,this.suspended=!1,this.currentDx=0,this.currentDy=0,this.cellCount=0,this.cloning=!1,this.allCells.clear(),this.pBounds=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(t,e,i){if(t.isVertex()){const e=this.graph.getView().getState(t);if(e){let t=(0,app_styleUtils.ce)(this.graph.container,(0,app_EventUtils.El)(i),(0,app_EventUtils.xJ)(i));const s=(0,app_mathUtils.eh)(e.style.rotation??0);if(0!==s){const i=Math.cos(-s),n=Math.sin(-s),l=new app_Point.A(e.getCenterX(),e.getCenterY());t=(0,app_mathUtils.Iq)(t,i,n,l)}return!(0,app_mathUtils.gR)(e,t.x,t.y)}}return!1}moveCells(t,e,i,s,n,l){if(!this.cell)return;s&&(t=this.graph.getCloneableCells(t));const a=this.cell.getParent();!n&&a&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(a,t,l)&&(n=this.graph.getDefaultParent()),s=!!s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.batchUpdate((()=>{const a=[];if(!s&&n&&this.removeEmptyParents){const e=new app_util_Dictionary.A;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let i=0;i<t.length;i+=1){const s=t[i].getParent();s&&!e.get(s)&&(e.put(s,!0),a.push(s))}}t=this.graph.moveCells(t,e,i,s,n,l);const r=[];for(let t=0;t<a.length;t+=1)this.shouldRemoveParent(a[t])&&r.push(a[t]);this.graph.removeCells(r,!1)})),s&&this.graph.setSelectionCells(t),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(t[0])}shouldRemoveParent(t){const e=this.graph.view.getState(t);return null!=e&&(e.cell.isEdge()||e.cell.isVertex())&&this.graph.isCellDeletable(e.cell)&&0===e.cell.getChildCount()&&e.isTransparentState()}destroyShapes(){this.shape&&(this.shape.destroy(),this.shape=null),this.guide&&(this.guide.destroy(),this.guide=null),this.highlight&&(this.highlight.destroy(),this.highlight=null)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.graph.removeListener(this.escapeHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.removeListener(this.refreshHandler),app_InternalEvent.A.removeListener(document,"keydown",this.keyHandler),app_InternalEvent.A.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}}app_SelectionHandler.pluginId="SelectionHandler";const app_handler_SelectionHandler=app_SelectionHandler;class app_PanningManager{constructor(t){this.damper=1/6,this.delay=10,this.handleMouseOut=!0,this.border=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:(t,e)=>{},mouseMove:(t,e)=>{},mouseUp:(t,e)=>{this.active&&this.stop()}},t.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},app_InternalEvent.A.addListener(document,"mouseup",this.mouseUpListener);const e=()=>(this.scrollbars=(0,app_styleUtils.uM)(t.container),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop,window.setInterval((()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){const e=-t.container.scrollLeft-Math.ceil(this.dx),i=-t.container.scrollTop-Math.ceil(this.dy);t.panGraph(e,i),t.setPanDx(this.scrollLeft-t.container.scrollLeft),t.setPanDy(this.scrollTop-t.container.scrollTop),t.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN))}else t.panGraph(this.getDx(),this.getDy())}),this.delay));this.isActive=()=>this.active,this.getDx=()=>Math.round(this.tdx),this.getDy=()=>Math.round(this.tdy),this.start=()=>{this.t0x=t.view.translate.x,this.t0y=t.view.translate.y,this.active=!0},this.panTo=(i,s,n=0,l=0)=>{this.active||this.start(),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop;const a=t.container;this.dx=i+n-a.scrollLeft-a.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=i-a.scrollLeft,this.dx>0&&this.dx<this.border?this.dx-=this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+l-a.scrollTop-a.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=s-a.scrollTop,this.dy>0&&this.dy<this.border?this.dy-=this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=e())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=()=>{if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)t.setPanDx(0),t.setPanDy(0),t.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN));else{const e=t.getPanDx(),i=t.getPanDy();0==e&&0==i||(t.panGraph(0,0),t.view.setTranslate(this.t0x+e/t.view.scale,this.t0y+i/t.view.scale))}},this.destroy=()=>{t.removeMouseListener(this.mouseListener),app_InternalEvent.A.removeListener(document,"mouseup",this.mouseUpListener)}}}const app_other_PanningManager=app_PanningManager;class app_PanningHandler extends app_EventSource.A{constructor(t){super(),this.getPanningManager=()=>this.panningManager,this.useLeftButtonForPanning=!1,this.usePopupTrigger=!0,this.ignoreCell=!1,this.previewEnabled=!0,this.useGrid=!1,this.panningEnabled=!1,this.pinchEnabled=!0,this.initialScale=0,this.maxScale=8,this.minScale=.01,this.dx=0,this.dy=0,this.startX=0,this.startY=0,this.dx0=0,this.dy0=0,this.panningTrigger=!1,this.active=!1,this.mouseDownEvent=null,this.graph=t,this.graph.addMouseListener(this),this.forcePanningHandler=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");i===app_InternalEvent.A.MOUSE_DOWN&&this.isForcePanningEvent(s)&&(this.start(s),this.active=!0,this.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN_START,{event:s})),s.consume())},this.graph.addListener(app_InternalEvent.A.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(t,e)=>{if(this.isPinchEnabled()){const t=e.getProperty("event");(0,app_EventUtils.fm)(t)||"gesturestart"!==t.type?"gestureend"===t.type&&0!==this.initialScale&&(this.initialScale=0):(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),0!==this.initialScale&&this.zoomGraph(t)}},this.graph.addListener(app_InternalEvent.A.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},app_InternalEvent.A.addListener(document,"mouseup",this.mouseUpListener),this.panningManager=new app_other_PanningManager(t)}isActive(){return this.active||null!==this.initialScale}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(t){this.panningEnabled=t}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(t){this.pinchEnabled=t}isPanningTrigger(t){const e=t.getEvent();return this.useLeftButtonForPanning&&!t.getState()&&(0,app_EventUtils.Lg)(e)||(0,app_EventUtils.qt)(e)&&(0,app_EventUtils.RT)(e)||this.usePopupTrigger&&(0,app_EventUtils.$Y)(e)}isForcePanningEvent(t){return this.ignoreCell||(0,app_EventUtils.DO)(t.getEvent())}mouseDown(t,e){this.mouseDownEvent=e,!e.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(e)&&(this.start(e),this.consumePanningTrigger(e))}start(t){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=t.getX(),this.startY=t.getY(),this.dx=0,this.dy=0,this.panningTrigger=!0}consumePanningTrigger(t){t.consume()}mouseMove(t,e){if(this.dx=e.getX()-this.startX,this.dy=e.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN,{event:e}));else if(this.panningTrigger){const t=this.active;this.active=Math.abs(this.dx)>this.graph.getSnapTolerance()||Math.abs(this.dy)>this.graph.getSnapTolerance(),!t&&this.active&&this.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN_START,{event:e}))}(this.active||this.panningTrigger)&&e.consume()}mouseUp(t,e){if(this.active){if(0!==this.dx&&0!==this.dy){if(!this.graph.isUseScrollbarsForPanning()||!(0,app_styleUtils.uM)(this.graph.container)){const{scale:t}=this.graph.getView(),e=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(e.x+this.dx/t,e.y+this.dy/t)}e.consume()}this.fireEvent(new app_EventObject.A(app_InternalEvent.A.PAN_END,{event:e}))}this.reset()}zoomGraph(t){let e=Math.round(this.initialScale*t.scale*100)/100;e=Math.max(this.minScale,e),e=Math.min(this.maxScale,e),this.graph.view.scale!==e&&(this.graph.zoomTo(e),app_InternalEvent.A.consume(t))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=0,this.dy=0}panGraph(t,e){this.graph.getView().setTranslate(t,e)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),app_InternalEvent.A.removeListener(document,"mouseup",this.mouseUpListener)}}app_PanningHandler.pluginId="PanningHandler";const app_handler_PanningHandler=app_PanningHandler,app_getDefaultPlugins=()=>[app_handler_CellEditorHandler,app_handler_TooltipHandler,app_handler_SelectionCellsHandler,app_handler_PopupMenuHandler,app_handler_ConnectionHandler,app_handler_SelectionHandler,app_handler_PanningHandler];class app_Graph extends app_EventSource.A{createCellRenderer(){return new app_cell_CellRenderer}createEdgeHandlerInstance(t){return new app_handler_EdgeHandler(t)}createEdgeSegmentHandler(t){return new app_handler_EdgeSegmentHandler(t)}createElbowEdgeHandler(t){return new app_handler_ElbowEdgeHandler(t)}createGraphDataModel(){return new app_view_GraphDataModel}createGraphView(){return new app_GraphView.A(this)}createSelectionModel(){return new app_view_GraphSelectionModel(this)}createStylesheet(){return new app_Stylesheet}createVertexHandler(t){return new app_handler_VertexHandler(t)}registerDefaults(){app_registerDefaultShapes(),app_registerDefaultStyleElements(),app_registerDefaultEdgeMarkers()}constructor(t,e,i=app_getDefaultPlugins(),s=null){super(),this.destroyed=!1,this.graphModelChangeListener=null,this.paintBackground=null,this.isConstrainedMoving=!1,this.cells=[],this.imageBundles=[],this.mouseListeners=[],this.multiplicities=[],this.plugins={},this.renderHint=null,this.dialect="svg",this.defaultOverlap=.5,this.defaultParent=null,this.backgroundImage=null,this.pageVisible=!1,this.pageBreaksVisible=!1,this.pageBreakColor="gray",this.pageBreakDashed=!0,this.minPageBreakDist=20,this.preferPageSize=!1,this.pageFormat=new app_Rectangle.A(...app_Constants.s4),this.pageScale=1.5,this.enabled=!0,this.exportEnabled=!0,this.importEnabled=!0,this.ignoreScrollbars=!1,this.translateToScrollPosition=!1,this.maximumGraphBounds=null,this.minimumGraphSize=null,this.minimumContainerSize=null,this.maximumContainerSize=null,this.resizeContainer=!1,this.border=0,this.keepEdgesInForeground=!1,this.keepEdgesInBackground=!1,this.recursiveResize=!1,this.resetViewOnRootChange=!0,this.allowLoops=!1,this.defaultLoopStyle=app_style_EdgeStyle.Loop,this.multigraph=!0,this.minFitScale=.1,this.maxFitScale=8,this.warningImage=new app_image_ImageBox(`${app_Client.A.imageBasePath}/warning${app_Client.A.IS_MAC?".png":".gif"}`,16,16),this.alreadyConnectedResource=app_config.F.isEnabled()?"alreadyConnected":"",this.containsValidationErrorsResource=app_config.F.isEnabled()?"containsValidationErrors":"",this.getContainer=()=>this.container,this.getPlugin=t=>this.plugins[t],this.getCellRenderer=()=>this.cellRenderer,this.getDialect=()=>this.dialect,this.isPageVisible=()=>this.pageVisible,this.isPageBreaksVisible=()=>this.pageBreaksVisible,this.getPageBreakColor=()=>this.pageBreakColor,this.isPageBreakDashed=()=>this.pageBreakDashed,this.getMinPageBreakDist=()=>this.minPageBreakDist,this.isPreferPageSize=()=>this.preferPageSize,this.getPageFormat=()=>this.pageFormat,this.getPageScale=()=>this.pageScale,this.isExportEnabled=()=>this.exportEnabled,this.isImportEnabled=()=>this.importEnabled,this.isIgnoreScrollbars=()=>this.ignoreScrollbars,this.isTranslateToScrollPosition=()=>this.translateToScrollPosition,this.getMinimumGraphSize=()=>this.minimumGraphSize,this.setMinimumGraphSize=t=>this.minimumGraphSize=t,this.getMinimumContainerSize=()=>this.minimumContainerSize,this.setMinimumContainerSize=t=>this.minimumContainerSize=t,this.getAlreadyConnectedResource=()=>this.alreadyConnectedResource,this.getContainsValidationErrorsResource=()=>this.containsValidationErrorsResource,this.registerDefaults(),this.container=t??document.createElement("div"),this.model=e??this.createGraphDataModel(),this.cellRenderer=this.createCellRenderer(),this.setStylesheet(s??this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=(t,e)=>{this.graphModelChanged(e.getProperty("edit").changes)},this.getDataModel().addListener(app_InternalEvent.A.CHANGE,this.graphModelChangeListener),this.view.init(),this.sizeDidChange(),this.setSelectionModel(this.createSelectionModel()),i.forEach((t=>this.plugins[t.pluginId]=new t(this))),this.view.revalidate()}getWarningImage(){return this.warningImage}batchUpdate(t){this.getDataModel().batchUpdate(t)}getDataModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(t){this.stylesheet=t}graphModelChanged(t){for(const e of t)this.processChange(e);this.updateSelection(),this.view.validate(),this.sizeDidChange()}processChange(t){if(t instanceof app_undoable_changes_RootChange)this.clearSelection(),this.setDefaultParent(null),t.previous&&this.removeStateForCell(t.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.ROOT));else if(t instanceof app_undoable_changes_ChildChange){const e=t.child.getParent();this.view.invalidate(t.child,!0,!0),e&&this.getDataModel().contains(e)&&!e.isCollapsed()||(this.view.invalidate(t.child,!0,!0),this.removeStateForCell(t.child),this.view.currentRoot==t.child&&this.home()),e!=t.previous&&(null!=e&&this.view.invalidate(e,!1,!1),null!=t.previous&&this.view.invalidate(t.previous,!1,!1))}else if(t instanceof app_undoable_changes_TerminalChange||t instanceof app_undoable_changes_GeometryChange)(t instanceof app_undoable_changes_TerminalChange||null==t.previous&&null!=t.geometry||null!=t.previous&&!t.previous.equals(t.geometry))&&this.view.invalidate(t.cell);else if(t instanceof app_undoable_changes_ValueChange)this.view.invalidate(t.cell,!1,!1);else if(t instanceof app_undoable_changes_StyleChange){this.view.invalidate(t.cell,!0,!0);const e=this.view.getState(t.cell);null!=e&&(e.invalidStyle=!0)}else null!=t.cell&&t.cell instanceof app_cell_Cell&&this.removeStateForCell(t.cell)}scrollPointToVisible(t,e,i=!1,s=20){const n=this.getPlugin("PanningHandler");if(this.isTimerAutoScroll()||!this.ignoreScrollbars&&!(0,app_styleUtils.uM)(this.container))this.isAllowAutoPanning()&&n&&!n.isActive()&&n.getPanningManager().panTo(t+this.getPanDx(),e+this.getPanDy());else{const n=this.container;if(t>=n.scrollLeft&&e>=n.scrollTop&&t<=n.scrollLeft+n.clientWidth&&e<=n.scrollTop+n.clientHeight){let l=n.scrollLeft+n.clientWidth-t;if(l<s){const t=n.scrollLeft;if(n.scrollLeft+=s-l,i&&t===n.scrollLeft){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollWidth+s-l;t.style.width=`${e}px`,n.scrollLeft+=s-l}}else l=t-n.scrollLeft,l<s&&(n.scrollLeft-=s-l);let a=n.scrollTop+n.clientHeight-e;if(a<s){const t=n.scrollTop;if(n.scrollTop+=s-a,t==n.scrollTop&&i){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollHeight+s-a;t.style.height=`${e}px`,n.scrollTop+=s-a}}else a=e-n.scrollTop,a<s&&(n.scrollTop-=s-a)}}}getBorderSizes(){const t=(0,app_styleUtils.lY)(this.container);return new app_Rectangle.A((0,app_styleUtils.sc)(t.paddingLeft)+("none"!=t.borderLeftStyle?(0,app_styleUtils.sc)(t.borderLeftWidth):0),(0,app_styleUtils.sc)(t.paddingTop)+("none"!=t.borderTopStyle?(0,app_styleUtils.sc)(t.borderTopWidth):0),(0,app_styleUtils.sc)(t.paddingRight)+("none"!=t.borderRightStyle?(0,app_styleUtils.sc)(t.borderRightWidth):0),(0,app_styleUtils.sc)(t.paddingBottom)+("none"!=t.borderBottomStyle?(0,app_styleUtils.sc)(t.borderBottomWidth):0))}getPreferredPageSize(t,e,i){const s=this.view.translate,n=this.pageFormat,l=this.pageScale,a=new app_Rectangle.A(0,0,Math.ceil(n.width*l),Math.ceil(n.height*l)),r=this.pageBreaksVisible?Math.ceil(e/a.width):1,o=this.pageBreaksVisible?Math.ceil(i/a.height):1;return new app_Rectangle.A(0,0,r*a.width+2+s.x,o*a.height+2+s.y)}fit(t=this.getBorder(),e=!1,i=0,s=!0,n=!1,l=!1,a=null){if(null!=this.container){const r=this.getBorderSizes();let o=this.container.offsetWidth-r.x-r.width-1,h=null!=a?a:this.container.offsetHeight-r.y-r.height-1,p=this.view.getGraphBounds();if(p.width>0&&p.height>0){e&&null!=p.x&&null!=p.y&&(p=p.clone(),p.width+=p.x,p.height+=p.y,p.x=0,p.y=0);const a=this.view.scale;let r=p.width/a,d=p.height/a;null!=this.backgroundImage&&(r=Math.max(r,this.backgroundImage.width-p.x/a),d=Math.max(d,this.backgroundImage.height-p.y/a));const c=(e?t:2*t)+i+1;o-=c,h-=c;let u=n?h/d:l?o/r:Math.min(o/r,h/d);if(null!=this.minFitScale&&(u=Math.max(u,this.minFitScale)),null!=this.maxFitScale&&(u=Math.min(u,this.maxFitScale)),!s)return u;if(e)this.view.scale!=u&&this.view.setScale(u);else if((0,app_styleUtils.uM)(this.container)){this.view.setScale(u);const t=this.getGraphBounds();null!=t.x&&(this.container.scrollLeft=t.x),null!=t.y&&(this.container.scrollTop=t.y)}else{const e=null!=p.x?Math.floor(this.view.translate.x-p.x/a+t/u+i/2):t,s=null!=p.y?Math.floor(this.view.translate.y-p.y/a+t/u+i/2):t;this.view.scaleAndTranslate(u,e,s)}}}return this.view.scale}doResizeContainer(t,e){null!=this.maximumContainerSize&&(t=Math.min(this.maximumContainerSize.width,t),e=Math.min(this.maximumContainerSize.height,e));const i=this.container;i.style.width=`${Math.ceil(t)}px`,i.style.height=`${Math.ceil(e)}px`}createHandler(t){let e=null;if(t.cell.isEdge()){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1),n=t.cell.getGeometry(),l=this.getView().getEdgeStyle(t,n&&n.points||void 0,i,s);e=this.createEdgeHandler(t,l)}else e=this.createVertexHandler(t);return e}createEdgeHandler(t,e){let i=null;return i=e==app_style_EdgeStyle.Loop||e==app_style_EdgeStyle.ElbowConnector||e==app_style_EdgeStyle.SideToSide||e==app_style_EdgeStyle.TopToBottom?this.createElbowEdgeHandler(t):e==app_style_EdgeStyle.SegmentConnector||e==app_style_EdgeStyle.OrthConnector?this.createEdgeSegmentHandler(t):this.createEdgeHandlerInstance(t),i}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(t){return null}getChildOffsetForCell(t){return null}home(){const t=this.getCurrentRoot();null!=t&&(this.view.setCurrentRoot(null),null!=this.view.getState(t)&&this.setSelectionCell(t))}isValidRoot(t){return!!t}getGraphBounds(){return this.view.getGraphBounds()}getMaximumGraphBounds(){return this.maximumGraphBounds}refresh(t=null){t?this.view.clear(t,!1):this.view.clear(void 0,!0),this.view.validate(),this.sizeDidChange(),this.fireEvent(new app_EventObject.A(app_InternalEvent.A.REFRESH))}center(t=!0,e=!0,i=.5,s=.5){const n=this.container,l=(0,app_styleUtils.uM)(this.container),a=2*this.getBorder(),r=n.clientWidth-a,o=n.clientHeight-a,h=this.getGraphBounds(),p=this.view.translate,d=this.view.scale;let c=t?r-h.width:0,u=e?o-h.height:0;if(l){h.x-=p.x,h.y-=p.y;const t=n.scrollWidth,e=n.scrollHeight;t>r&&(c=0),e>o&&(u=0),this.view.setTranslate(Math.floor(c/2-h.x),Math.floor(u/2-h.y)),n.scrollLeft=(t-r)/2,n.scrollTop=(e-o)/2}else this.view.setTranslate(t?Math.floor(p.x-h.x/d+c*i/d):p.x,e?Math.floor(p.y-h.y/d+u*s/d):p.y)}isOrthogonal(t){const e=t.style.orthogonal;if(null!=e)return e;const i=this.view.getEdgeStyle(t);return i===app_style_EdgeStyle.SegmentConnector||i===app_style_EdgeStyle.ElbowConnector||i===app_style_EdgeStyle.SideToSide||i===app_style_EdgeStyle.TopToBottom||i===app_style_EdgeStyle.EntityRelation||i===app_style_EdgeStyle.OrthConnector}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(t){this.backgroundImage=t}convertValueToString(t){const e=t.getValue();if(null!=e){if((0,app_domUtils.Ll)(e))return e.nodeName;if("function"==typeof e.toString)return e.toString()}return""}getLinkForCell(t){return null}getBorder(){return this.border}setBorder(t){this.border=t}isResizeContainer(){return this.resizeContainer}setResizeContainer(t){this.resizeContainer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isMultigraph(){return this.multigraph}setMultigraph(t){this.multigraph=t}isAllowLoops(){return this.allowLoops}setAllowLoops(t){this.allowLoops=t}isRecursiveResize(t=null){return this.recursiveResize}setRecursiveResize(t){this.recursiveResize=t}getOverlap(t){return this.isAllowOverlapParent(t)?this.defaultOverlap:0}isAllowOverlapParent(t){return!1}getDefaultParent(){let t=this.getCurrentRoot();return t||(t=this.defaultParent,t)||(t=this.getDataModel().getRoot().getChildAt(0)),t}setDefaultParent(t){this.defaultParent=t}destroy(){this.destroyed||(this.destroyed=!0,Object.values(this.plugins).forEach((t=>t.onDestroy())),this.view.destroy(),this.model&&this.graphModelChangeListener&&(this.getDataModel().removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null))}}var app_CellType,CellType,app_AggregateFunctions,AggregateFunctions,app_LineConditionOperators,LineConditionOperators;app_applyGraphMixins(app_Graph),CellType=app_CellType||(app_CellType={}),CellType.constant="constant",CellType.system="system",CellType.select="select",CellType.join="join",CellType.union="union",CellType.where="where",CellType.group_by="group_by",AggregateFunctions=app_AggregateFunctions||(app_AggregateFunctions={}),AggregateFunctions.SUM="СУММА",AggregateFunctions.MIN="МИН",AggregateFunctions.MAX="МАКС",AggregateFunctions.AVG="СРЕДНЕЕ",AggregateFunctions.COUNT="КОЛ",AggregateFunctions.RCOUNT="РКОЛ",LineConditionOperators=app_LineConditionOperators||(app_LineConditionOperators={}),LineConditionOperators.AND="И",LineConditionOperators.OR="ИЛИ";const app_SELECTABLE_CELL_TYPES=[app_CellType.join,app_CellType.union],app_EDITABLE_CELL_TYPES=[app_CellType.join,app_CellType.union];class app_VisualizerCellType{}app_VisualizerCellType.System={name:app_CellType.system,defaultStyle:{shape:"rectangle",fontColor:"black",fillColor:"orange",strokeColor:"gold",strokeWidth:1,rounded:!0},highlightedStyle:{shape:"rectangle",fontColor:"white",fillColor:"blue",strokeColor:"indigo",strokeWidth:1,rounded:!0}},app_VisualizerCellType.Select={name:app_CellType.select,defaultStyle:{shape:"rectangle",fontColor:"black",fillColor:"lightblue",strokeColor:"black",strokeWidth:2,rounded:!0,arcSize:5},highlightedStyle:{shape:"rectangle",fontColor:"white",fillColor:"blue",strokeColor:"indigo",strokeWidth:1,rounded:!0}},app_VisualizerCellType.Join={name:app_CellType.join,defaultStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"black",strokeWidth:2,rounded:!0},selectedStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"blue",strokeWidth:2,rounded:!0}},app_VisualizerCellType.Union={name:app_CellType.union,defaultStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"black",strokeWidth:2,rounded:!0},selectedStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"blue",strokeWidth:2,rounded:!0}},app_VisualizerCellType.GroupBy={name:app_CellType.group_by,defaultStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"black",strokeWidth:2,rounded:!0}},app_VisualizerCellType.Where={name:app_CellType.where,defaultStyle:{shape:"ellipse",fontColor:"black",fillColor:"white",strokeColor:"black",strokeWidth:2,rounded:!0}};class app_VisualizerTooltip{constructor(t,e){this.container=t,this.graph=e,this.tooltip=document.createElement("div"),this.setStyle(),this.container.appendChild(this.tooltip)}setStyle(){Object.assign(this.tooltip.style,{position:"absolute",backgroundColor:"#ffd700ee",color:"#555",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",pointerEvents:"none",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",whiteSpace:"nowrap"})}showTooltipText(t,e){const i=this.graph.getCellBounds(t);null!==i&&(this.tooltip.innerHTML=e,this.tooltip.style.left=`${i.x}px`,this.tooltip.style.top=`${i.y+i.height+50}px`,this.tooltip.style.visibility="visible")}showTooltipTexts(t,e){const i=this.graph.getCellBounds(t);null!==i&&(this.tooltip.innerHTML=e.join("<br>"),this.tooltip.style.left=`${i.x}px`,this.tooltip.style.top=`${i.y+i.height+50}px`,this.tooltip.style.visibility="visible")}hideTooltip(){this.tooltip.style.visibility="hidden"}isVisible(){return"visible"===this.tooltip.style.visibility}}class app_GraphLayout{constructor(t){this.useBoundingBox=!0,this.parent=null,this.graph=t}moveCell(t,e,i){}resizeCell(t,e,i){}execute(t){}getGraph(){return this.graph}getConstraint(t,e,i,s){return this.graph.getCurrentCellStyle(e)[t]}traverse({vertex:t,directed:e,func:i,edge:s,visited:n}){if(null!=i&&null!=t&&(e=null==e||e,!(n=n||new app_util_Dictionary.A).get(t))){n.put(t,!0);const l=i(t,s);if(null==l||l){const s=t.getEdgeCount();if(s>0)for(let l=0;l<s;l+=1){const s=t.getEdgeAt(l),a=s.getTerminal(!0)===t;if(!e||a){const t=this.graph.view.getVisibleTerminal(s,!a);this.traverse({vertex:t,directed:e,func:i,edge:s,visited:n})}}}}}isAncestor(t,e,i){if(!i)return e.getParent()===t;if(e===t)return!1;for(;null!=e&&e!==t;)e=e.getParent();return e===t}isVertexMovable(t){return this.graph.isCellMovable(t)}isVertexIgnored(t){return!t.isVertex()||!t.isVisible()}isEdgeIgnored(t){return!t.isEdge()||!t.isVisible()||null==t.getTerminal(!0)||null==t.getTerminal(!1)}setEdgeStyleEnabled(t,e){this.graph.setCellStyles("noEdgeStyle",e?"0":"1",[t])}setOrthogonalEdge(t,e){this.graph.setCellStyles("orthogonal",e?"1":"0",[t])}getParentOffset(t){const e=new app_Point.A;if(null!=t&&t!==this.parent&&(this.graph.getDataModel(),this.parent&&this.parent.isAncestor(t))){let i=t.getGeometry();for(;t!==this.parent;)e.x+=i.x,e.y+=i.y,i=(t=t.getParent()).getGeometry()}return e}setEdgePoints(t,e){if(null!=t){const{model:i}=this.graph;let s=t.getGeometry();if(null==s?(s=new app_geometry_Geometry,s.setRelative(!0)):s=s.clone(),null!=this.parent&&null!=e){const i=t.getParent(),s=this.getParentOffset(i);for(let t=0;t<e.length;t+=1)e[t].x=e[t].x-s.x,e[t].y=e[t].y-s.y}s.points=e,i.setGeometry(t,s)}}setVertexLocation(t,e,i){const s=this.graph.getDataModel();let n=t.getGeometry(),l=null;if(null!=n){if(l=new app_Rectangle.A(e,i,n.width,n.height),this.useBoundingBox){const s=this.graph.getView().getState(t);if(null!=s&&null!=s.text&&null!=s.text.boundingBox){const{scale:t}=this.graph.getView(),n=s.text.boundingBox;s.text.boundingBox.x<s.x&&(e+=(s.x-n.x)/t,l.width=n.width),s.text.boundingBox.y<s.y&&(i+=(s.y-n.y)/t,l.height=n.height)}}if(null!=this.parent){const s=t.getParent();if(null!=s&&s!==this.parent){const t=this.getParentOffset(s);e-=t.x,i-=t.y}}n.x===e&&n.y===i||(n=n.clone(),n.x=e,n.y=i,s.setGeometry(t,n))}return l}getVertexBounds(t){let e=t.getGeometry();if(this.useBoundingBox){const i=this.graph.getView().getState(t);if(null!=i&&null!=i.text&&null!=i.text.boundingBox){const{scale:t}=this.graph.getView(),s=i.text.boundingBox,n=Math.max(i.x-s.x,0)/t,l=Math.max(i.y-s.y,0)/t,a=Math.max(s.x+s.width-(i.x+i.width),0)/t,r=Math.max(s.y+s.height-(i.y+i.height),0)/t;e=new app_Rectangle.A(e.x-n,e.y-l,e.width+n+a,e.height+l+r)}}if(null!=this.parent){const i=t.getParent();if(e=e.clone(),null!=i&&i!==this.parent){const t=this.getParentOffset(i);e.x+=t.x,e.y+=t.y}}return new app_Rectangle.A(e.x,e.y,e.width,e.height)}arrangeGroups(t,e,i,s,n,l){return this.graph.updateGroupBounds(t,e,!0,i,s,n,l)}}const app_layout_GraphLayout=app_GraphLayout;class app_WeightedCellSorter{constructor(t,e=0){this.weightedValue=0,this.nudge=!1,this.visited=!1,this.rankIndex=null,this.cell=t,this.weightedValue=e}static compare(t,e){return null!=t&&null!=e?e.weightedValue>t.weightedValue?-1:e.weightedValue<t.weightedValue?1:e.nudge?-1:1:0}}const app_util_WeightedCellSorter=app_WeightedCellSorter;function app_findTreeRoots(t,e,i=!1,s=!1){const n=[];if(null!=e){let l=null,a=0;for(const r of e.getChildren())if(r.isVertex()&&r.isVisible()){const o=t.getConnections(r,i?e:null);let h=0,p=0;for(let e=0;e<o.length;e++)t.view.getVisibleTerminal(o[e],!0)==r?h++:p++;(s&&0==h&&p>0||!s&&0==p&&h>0)&&n.push(r);const d=s?p-h:h-p;d>a&&(a=d,l=r)}0==n.length&&null!=l&&n.push(l)}return n}function app_traverse(t=null,e=!0,i=null,s=null,n=null,l=!1){if(null!=i&&null!=t&&(e=null==e||e,l=null!=l&&l,!(n=n||new Dictionary).get(t))){n.put(t,!0);const a=i(t,s);if(null==a||a){const s=t.getEdgeCount();if(s>0)for(let a=0;a<s;a+=1){const s=t.getEdgeAt(a),r=s.getTerminal(!0)==t;e&&!l!=r||app_traverse(s.getTerminal(!r),e,i,s,n,l)}}}}class app_CompactTreeLayout extends app_layout_GraphLayout{constructor(t,e=!0,i=!1){super(t),this.parentX=null,this.parentY=null,this.visited={},this.horizontal=!0,this.invert=!1,this.resizeParent=!0,this.maintainParentLocation=!1,this.groupPadding=10,this.groupPaddingTop=0,this.groupPaddingRight=0,this.groupPaddingBottom=0,this.groupPaddingLeft=0,this.parentsChanged=null,this.moveTree=!1,this.levelDistance=10,this.nodeDistance=20,this.resetEdges=!0,this.prefHozEdgeSep=5,this.prefVertEdgeOff=4,this.minEdgeJetty=8,this.channelBuffer=4,this.edgeRouting=!0,this.sortEdges=!1,this.alignRanks=!1,this.maxRankHeight=[],this.root=null,this.node=null,this.horizontal=e,this.invert=i}isVertexIgnored(t){return super.isVertexIgnored(t)||0===t.getConnections().length}isHorizontal(){return this.horizontal}execute(t,e){this.parent=t;const i=this.graph.getDataModel();if(null==e)if(this.graph.getEdges(t,t.getParent(),this.invert,!this.invert,!1).length>0)this.root=t;else{const e=app_findTreeRoots(this.graph,t,!0,this.invert);if(e.length>0)for(let t=0;t<e.length;t+=1)if(!this.isVertexIgnored(e[t])&&this.graph.getEdges(e[t],null,this.invert,!this.invert,!1).length>0){this.root=e[t];break}}else this.root=e;if(null!=this.root){if(this.resizeParent?this.parentsChanged={}:this.parentsChanged=null,this.parentX=null,this.parentY=null,t!==this.root&&null!=t.isVertex()&&this.maintainParentLocation){const e=t.getGeometry();null!=e&&(this.parentX=e.x,this.parentY=e.y)}i.beginUpdate();try{if(this.visited={},this.node=this.dfs(this.root,t),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);let e=this.graph.gridSize,s=e;if(!this.moveTree){const t=this.getVertexBounds(this.root);null!=t&&(e=t.x,s=t.y)}let n=null;if(n=this.isHorizontal()?this.horizontalLayout(this.node,e,s):this.verticalLayout(this.node,null,e,s),null!=n){let t=0,i=0;n.x<0&&(t=Math.abs(e-n.x)),n.y<0&&(i=Math.abs(s-n.y)),0===t&&0===i||this.moveNode(this.node,t,i),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY){let e=t.getGeometry();null!=e&&(e=e.clone(),e.x=this.parentX,e.y=this.parentY,i.setGeometry(t,e))}}}finally{i.endUpdate()}}}moveNode(t,e,i){t.x+=e,t.y+=i,this.apply(t);let{child:s}=t;for(;null!=s;)this.moveNode(s,e,i),s=s.next}sortOutgoingEdges(t,e){const i=new app_util_Dictionary.A;e.sort(((e,s)=>{const n=e.getTerminal(e.getTerminal(!1)==t);let l=i.get(n);null==l&&(l=app_CellPath.A.create(n).split(app_CellPath.A.PATH_SEPARATOR),i.put(n,l));const a=s.getTerminal(s.getTerminal(!1)===t);let r=i.get(a);return null==r&&(r=app_CellPath.A.create(a).split(app_CellPath.A.PATH_SEPARATOR),i.put(a,r)),app_CellPath.A.compare(l,r)}))}findRankHeights(t,e){const i=this.maxRankHeight;(null==i[e]||i[e]<t.height)&&(i[e]=t.height);let{child:s}=t;for(;null!=s;)this.findRankHeights(s,e+1),s=s.next}setCellHeights(t,e){const i=this.maxRankHeight;null!=i[e]&&i[e]>t.height&&(t.height=i[e]);let{child:s}=t;for(;null!=s;)this.setCellHeights(s,e+1),s=s.next}dfs(t,e){const i=app_CellPath.A.create(t);let s=null;if(null!=t&&null==this.visited[i]&&!this.isVertexIgnored(t)){this.visited[i]=t,s=this.createNode(t),this.graph.getDataModel();let n=null;const l=this.graph.getEdges(t,e,this.invert,!this.invert,!1,!0),a=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(t,l);for(let t=0;t<l.length;t+=1){const i=l[t];if(!this.isEdgeIgnored(i)){this.resetEdges&&this.setEdgePoints(i,null),this.edgeRouting&&(this.setEdgeStyleEnabled(i,!1),this.setEdgePoints(i,null));const t=a.getState(i),l=null!=t?t.getVisibleTerminal(this.invert):a.getVisibleTerminal(i,this.invert),r=this.dfs(l,e);null!=r&&null!=l.getGeometry()&&(null==n?s.child=r:n.next=r,n=r)}}}return s}layout(t){let{child:e}=t;for(;null!=e;)this.layout(e),e=e.next;null!=t.child?this.attachParent(t,this.join(t)):this.layoutLeaf(t)}horizontalLayout(t,e,i,s=null){t.x+=e+t.offsetX,t.y+=i+t.offsetY,s=this.apply(t,s);const{child:n}=t;if(null!=n){s=this.horizontalLayout(n,t.x,t.y,s);let e=t.y+n.offsetY,i=n.next;for(;null!=i;)s=this.horizontalLayout(i,t.x+n.offsetX,e,s),e+=i.offsetY,i=i.next}return s}verticalLayout(t,e,i,s,n=null){t.x=t.x+i+t.offsetY,t.y=t.y+s+t.offsetX,n=this.apply(t,n);const{child:l}=t;if(null!=l){n=this.verticalLayout(l,t,t.x,t.y,n);let e=t.x+l.offsetY,i=l.next;for(;null!=i;)n=this.verticalLayout(i,t,e,t.y+l.offsetX,n),e+=i.offsetY,i=i.next}return n}attachParent(t,e){const i=this.nodeDistance+this.levelDistance,s=(e-t.width)/2-this.nodeDistance,n=s+t.width+2*this.nodeDistance-e;t.child.offsetX=i+t.height,t.child.offsetY=n,t.contour.upperHead=this.createLine(t.height,0,this.createLine(i,n,t.contour.upperHead)),t.contour.lowerHead=this.createLine(t.height,0,this.createLine(i,s,t.contour.lowerHead))}layoutLeaf(t){const e=2*this.nodeDistance;t.contour.upperTail=this.createLine(t.height+e,0),t.contour.upperHead=t.contour.upperTail,t.contour.lowerTail=this.createLine(0,-t.width-e),t.contour.lowerHead=this.createLine(t.height+e,0,t.contour.lowerTail)}join(t){const e=2*this.nodeDistance;let{child:i}=t;t.contour=i.contour;let s=i.width+e,n=s;for(i=i.next;null!=i;){const l=this.merge(t.contour,i.contour);i.offsetY=l+s,i.offsetX=0,s=i.width+e,n+=l+s,i=i.next}return n}merge(t,e){let i=0,s=0,n=0,l=t.lowerHead,a=e.upperHead;for(;null!=a&&null!=l;){const t=this.offset(i,s,a.dx,a.dy,l.dx,l.dy);s+=t,n+=t,i+a.dx<=l.dx?(i+=a.dx,s+=a.dy,a=a.next):(i-=l.dx,s-=l.dy,l=l.next)}if(null!=a){const n=this.bridge(t.upperTail,0,0,a,i,s);t.upperTail=null!=n.next?e.upperTail:n,t.lowerTail=e.lowerTail}else{const n=this.bridge(e.lowerTail,i,s,l,0,0);null==n.next&&(t.lowerTail=n)}return t.lowerHead=e.lowerHead,n}offset(t,e,i,s,n,l){let a=0;return n<=t||t+i<=0?0:(a=n*s-i*l>0?t<0?t*s/i-e:t>0?t*l/n-e:-e:n<t+i?l-(e+(n-t)*s/i):n>t+i?(i+t)*l/n-(e+s):l-(e+s),a>0?a:0)}bridge(t,e,i,s,n,l){const a=n+s.dx-e;let r=0,o=0;0===s.dx?r=s.dy:(o=a*s.dy,r=o/s.dx);const h=this.createLine(a,r,s.next);return t.next=this.createLine(0,l+s.dy-r-i,h),h}createNode(t){const e={};e.cell=t,e.x=0,e.y=0,e.width=0,e.height=0;const i=this.getVertexBounds(t);return null!=i&&(this.isHorizontal()?(e.width=i.height,e.height=i.width):(e.width=i.width,e.height=i.height)),e.offsetX=0,e.offsetY=0,e.contour={},e}apply(t,e=null){this.graph.getDataModel();const i=t.cell;let s=i.getGeometry();if(null!=i&&null!=s){if(this.isVertexMovable(i)&&(s=this.setVertexLocation(i,t.x,t.y),this.resizeParent)){const t=i.getParent(),e=app_CellPath.A.create(t),s=this.parentsChanged;null==s[e]&&(s[e]=t)}e=null==e?new app_Rectangle.A(s.x,s.y,s.width,s.height):new app_Rectangle.A(Math.min(e.x,s.x),Math.min(e.y,s.y),Math.max(e.x+e.width,s.x+s.width),Math.max(e.y+e.height,s.y+s.height))}return e}createLine(t,e,i=null){return{dx:t,dy:e,next:i}}adjustParents(){const t=[];for(const e in this.parentsChanged)t.push(this.parentsChanged[e]);this.arrangeGroups((0,app_styleUtils.gU)(t,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)}localEdgeProcessing(t){this.processNodeOutgoing(t);let{child:e}=t;for(;null!=e;)this.localEdgeProcessing(e),e=e.next}processNodeOutgoing(t){let{child:e}=t;const i=t.cell;let s=0;const n=[];for(;null!=e;){let t;s++,t=this.horizontal?e.y:e.x,n.push(new app_util_WeightedCellSorter(e,t)),e=e.next}n.sort(app_util_WeightedCellSorter.compare);let l=t.width;const a=(s+1)*this.prefHozEdgeSep;l>a+2*this.prefHozEdgeSep&&(l-=2*this.prefHozEdgeSep);const r=l/s;let o=r/2;l>a+2*this.prefHozEdgeSep&&(o+=this.prefHozEdgeSep);let h=this.minEdgeJetty-this.prefVertEdgeOff,p=0;const d=this.getVertexBounds(i);e=t.child;for(let t=0;t<n.length;t++){const e=n[t].cell.cell,l=this.getVertexBounds(e),a=this.graph.getEdgesBetween(i,e,!1),c=[];let u=0,g=0;for(let t=0;t<a.length;t+=1)this.horizontal?(u=d.x+d.width,g=d.y+o,c.push(new app_Point.A(u,g)),u=d.x+d.width+h,c.push(new app_Point.A(u,g)),g=l.y+l.height/2,c.push(new app_Point.A(u,g)),this.setEdgePoints(a[t],c)):(u=d.x+o,g=d.y+d.height,c.push(new app_Point.A(u,g)),g=d.y+d.height+h,c.push(new app_Point.A(u,g)),u=l.x+l.width/2,c.push(new app_Point.A(u,g)),this.setEdgePoints(a[t],c));t<s/2?h+=this.prefVertEdgeOff:t>s/2&&(h-=this.prefVertEdgeOff),o+=r,p=Math.max(p,h)}}}const app_layout_CompactTreeLayout=app_CompactTreeLayout;class app_VisualizerLayout{constructor(t){this.graph=t,this.layout=new app_layout_CompactTreeLayout(this.graph),this.layout.nodeDistance=30,this.layout.levelDistance=20,this.layout.horizontal=!1,this.layout.invert=!1,this.layout.edgeRouting=!1,this.layout.moveTree=!0}layoutGraph(){this.graph.getDataModel().beginUpdate(),this.graph.setCellsMovable(!0);const t=this.getArrowStyle(this.layout.horizontal);this.setArrowStyle(t),this.layout.execute(this.graph.getDefaultParent()),this.graph.setCellsMovable(!1),this.graph.getDataModel().endUpdate()}getArrowStyle(t){return Object.assign(Object.assign({edgeStyle:"orthogonalEdgeStyle",rounded:!0,verticalAlign:"top",verticalLabelPosition:"top"},t?{exitX:1,exitY:.5,entryX:0,entryY:.5}:{exitX:.5,exitY:1,entryX:.5,entryY:0}),{exitPerimeter:!0,entryPerimeter:!0})}setArrowStyle(t){const e=this.graph.getChildEdges(this.graph.getDefaultParent());this.graph.batchUpdate((()=>{for(const i of e)this.graph.getDataModel().setStyle(i,t)}))}getLayout(){return this.layout}setHorizontalLayout(t){this.layout.horizontal=t}}class app_VisualizerToolbarBuilder{constructor(t){this.toolbar=document.createElement("div"),this.setToolbarStyle(),this.visualizerGraph=t}addZoomInButton(){const t=document.createElement("button");return t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 5.5C7.51472 5.5 5.5 7.51472 5.5 10C5.5 12.4853 7.51472 14.5 10 14.5C10.7763 14.5 11.5046 14.3041 12.1403 13.9596C12.5244 13.7514 12.8751 13.4888 13.182 13.182C13.4888 12.8751 13.7514 12.5244 13.9596 12.1403C14.3041 11.5046 14.5 10.7763 14.5 10C14.5 7.51472 12.4853 5.5 10 5.5ZM4 10C4 6.68629 6.68629 4 10 4C13.3137 4 16 6.68629 16 10C16 11.032 15.7388 12.0052 15.2784 12.855C15.1212 13.145 14.9409 13.4206 14.7399 13.6792L20.003 18.9423L18.9423 20.003L13.6792 14.7399C13.4206 14.9408 13.1451 15.1212 12.855 15.2784C12.0052 15.7388 11.032 16 10 16C6.68629 16 4 13.3137 4 10Z" fill="#1F2328"/><path fill-rule="evenodd" clip-rule="evenodd" d="M9.24995 9.24993V7H10.7499V9.24993H13V10.7499H10.7499V13H9.24995V10.7499H7V9.24993H9.24995Z" fill="#1F2328"/></svg>',t.title="Увеличить масштаб",t.addEventListener("click",(()=>{this.visualizerGraph.zoomIn()})),this.setButtonStyle(t),this.toolbar.append(t),this}addZoomOutButton(){const t=document.createElement("button");return t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 5.5C7.51472 5.5 5.5 7.51472 5.5 10C5.5 12.4853 7.51472 14.5 10 14.5C10.7763 14.5 11.5046 14.3041 12.1403 13.9596C12.5244 13.7514 12.8751 13.4888 13.182 13.182C13.4888 12.8751 13.7514 12.5244 13.9596 12.1403C14.3041 11.5046 14.5 10.7763 14.5 10C14.5 7.51472 12.4853 5.5 10 5.5ZM4 10C4 6.68629 6.68629 4 10 4C13.3137 4 16 6.68629 16 10C16 11.032 15.7388 12.0052 15.2784 12.855C15.1212 13.145 14.9409 13.4206 14.7399 13.6792L20.003 18.9423L18.9423 20.003L13.6792 14.7399C13.4206 14.9408 13.1451 15.1212 12.855 15.2784C12.0052 15.7388 11.032 16 10 16C6.68629 16 4 13.3137 4 10Z" fill="#1F2328"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7 9.24993H13V10.7499H7V9.24993Z" fill="#1F2328"/></svg>',t.title="Уменьшить масштаб",t.addEventListener("click",(()=>{this.visualizerGraph.zoomOut()})),this.setButtonStyle(t),this.toolbar.append(t),this}addZoomToFitButton(){const t=document.createElement("button");return t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 16H2v6h6v-1H3zM16 3h5v5h1V2h-6zm5 18h-5v1h6v-6h-1zM8 2H2v6h1V3h5z"/><path fill="none" d="M0 0h24v24H0z"/></svg>',t.title="Подогнать масштаб",t.addEventListener("click",(()=>{this.visualizerGraph.zoomToFit(50)})),this.setButtonStyle(t),this.toolbar.append(t),this}addCurrentScaleTile(){const t=document.createElement("div"),e=this.visualizerGraph.getGraph().getView(),i=e.getScale();return t.innerText=`${(100*i).toFixed(0)}%`,t.title="Текущий масштаб",e.addListener(app_InternalEvent.A.SCALE_AND_TRANSLATE,((i,s)=>{const n=e.getScale();t.innerText=`${(100*n).toFixed(0)}%`})),e.addListener(app_InternalEvent.A.SCALE,((i,s)=>{const n=e.getScale();t.innerText=`${(100*n).toFixed(0)}%`})),this.setTileStyle(t),this.toolbar.append(t),this}addLayoutHorizontallyButton(){const t=document.createElement("button");return t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.0609 11.75L13.5285 16.2804L12.4681 15.2196L15.1888 12.5H6.00001V11H15.1888L12.4681 8.28045L13.5285 7.21955L18.0609 11.75Z" fill="#1F2328"/></svg>',t.title="Расположить горизонтально",t.addEventListener("click",(()=>{this.visualizerGraph.setHorizontalLayout(!0),this.visualizerGraph.layoutGraph()})),this.setButtonStyle(t),this.toolbar.append(t),this}addLayoutVerticallyButton(){const t=document.createElement("button");return t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 18.0609L7.46955 13.5285L8.53044 12.468L11.25 15.1888L11.25 5.99998H12.75L12.75 15.1888L15.4695 12.468L16.5304 13.5285L12 18.0609Z" fill="#1F2328"/></svg>',t.title="Расположить вертикально",t.addEventListener("click",(()=>{this.visualizerGraph.setHorizontalLayout(!1),this.visualizerGraph.layoutGraph()})),this.setButtonStyle(t),this.toolbar.append(t),this}addShowExtra(){const t=document.createElement("button");t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 10C4 10 5.6 15 12 15M12 15C18.4 15 20 10 20 10M12 15V18M18 17L16 14.5M6 17L8 14.5" stroke="#464455" stroke-linecap="round" stroke-linejoin="round"/></svg>',t.title="Раскрыть доп. содержание";let e=!1;return t.addEventListener("click",(()=>{e=!e,e?(this.visualizerGraph.showExtraContent(),t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 12C4 12 5.6 7 12 7M12 7C18.4 7 20 12 20 12M12 7V4M18 5L16 7.5M6 5L8 7.5M15 13C15 14.6569 13.6569 16 12 16C10.3431 16 9 14.6569 9 13C9 11.3431 10.3431 10 12 10C13.6569 10 15 11.3431 15 13Z" stroke="#464455" stroke-linecap="round" stroke-linejoin="round"/></svg>',t.title="Скрыть доп. содержание"):(this.visualizerGraph.hideExtraContent(),t.innerHTML='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 10C4 10 5.6 15 12 15M12 15C18.4 15 20 10 20 10M12 15V18M18 17L16 14.5M6 17L8 14.5" stroke="#464455" stroke-linecap="round" stroke-linejoin="round"/></svg>',t.title="Раскрыть доп. содержание")})),this.setButtonStyle(t),this.toolbar.append(t),this}addTileGap(t){const e=document.createElement("div");return e.style.width=`${t}px`,this.toolbar.append(e),this}getToolbar(){return this.toolbar}setToolbarStyle(){this.toolbar.style.margin="5px 10px",this.toolbar.style.padding="5px",this.toolbar.style.display="flex",this.toolbar.style.flexDirection="row",this.toolbar.style.alignItems="center",this.toolbar.style.backgroundColor="#f0f0f0",this.toolbar.style.borderRadius="10px",this.toolbar.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"}setButtonStyle(t){t.style.backgroundColor="gold",t.style.margin="0px 2px",t.style.padding="1px 10px",t.style.borderRadius="3px",t.style.cursor="pointer",t.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)",t.style.transition="all 0.2s ease-in-out"}setTileStyle(t){t.style.backgroundColor="gainsboro",t.style.margin="0px 2px",t.style.padding="1px 10px",t.style.borderRadius="3px",t.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"}}class app_TooltipMouseHandler{constructor(t){this.visualizerGraph=t}mouseMove(t,e){const i=e.getCell();this.visualizerGraph.hoverOnCell(i)}mouseDown(t,e){}mouseUp(t,e){}}class app_VisualizerGraphHandlers{constructor(t){this.isPanning=!1,this.startX=0,this.startY=0,this.dx=0,this.dy=0,this.visualizerGraph=t}getMouseDownHandler(){return t=>{this.isPanning=!0,this.startX=t.clientX,this.startY=t.clientY;const e=this.visualizerGraph.getGraph().getView().getTranslate();this.dx=e.x,this.dy=e.y}}getMouseMoveHandler(){return t=>{if(this.isPanning){const e=this.visualizerGraph.getGraph().getView(),i=e.getScale(),s=(t.clientX-this.startX)/i,n=(t.clientY-this.startY)/i;e.setTranslate(this.dx+s,this.dy+n)}}}getMouseUpHandler(){return t=>{this.isPanning=!1}}getWheelHandler(){return t=>{this.visualizerGraph.getTooltip().hideTooltip(),t.deltaY>0?this.visualizerGraph.zoomOut():this.visualizerGraph.zoomIn()}}getClickHandler(){return(t,e)=>{const i=e.properties.cell;this.visualizerGraph.clickCell(i)}}getDoubleClickHandler(){return(t,e)=>{const i=e.properties.cell;this.visualizerGraph.doubleClickCell(i)}}}class app_GraphAnimation{constructor(t,e){this.duration=500,this.graph=t,this.easingFunction=e}setDuration(t){this.duration=t}translateGraph(t){const e=this.graph.getView().getTranslate(),i=new app_Point.A(e.x,e.y),s=performance.now();requestAnimationFrame((()=>{this.animateTranslate(s,i,t)}))}scaleAndTranslate(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),n=new app_Point.A(s.x,s.y),l=performance.now();requestAnimationFrame((()=>{this.animateScaleAndTranslate(l,i,t,n,e)}))}animateTranslate(t,e,i){const s=performance.now()-t,n=Math.min(s/this.duration,1),l=this.easingFunction(n),a=i.x-e.x,r=i.y-e.y,o=e.x+a*l,h=e.y+r*l;this.graph.getView().setTranslate(o,h),n<1&&requestAnimationFrame((()=>this.animateTranslate(t,e,i)))}animateScaleAndTranslate(t,e,i,s,n){const l=performance.now()-t,a=Math.min(l/this.duration,1),r=this.easingFunction(a),o=i-e,h=n.x-s.x,p=n.y-s.y,d=e+o*r,c=s.x+h*r,u=s.y+p*r;this.graph.getView().scaleAndTranslate(d,c,u),a<1&&requestAnimationFrame((()=>this.animateScaleAndTranslate(t,e,i,s,n)))}}class app_EasingFunctions{static linear(t){return t}static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return t<.5?2*t*t:(4-2*t)*t-1}static easeInOutQubic(t){return t<.5?4*Math.pow(t,3):1-Math.pow(-2*t+2,3)/2}static easeInOutExpo(t){return 0===t||1===t?t:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}}const app_COMPOSITE_FIELD_ABSENT_VALUE=null;var app_Sort,Sort,app_JoinType,JoinType,app_DSQueryType,DSQueryType;Sort=app_Sort||(app_Sort={}),Sort.DESC="desc",Sort.ASC="asc",Sort.NONE="none",JoinType=app_JoinType||(app_JoinType={}),JoinType.inner="inner",JoinType.left="left",JoinType.right="right",JoinType.full="full",DSQueryType=app_DSQueryType||(app_DSQueryType={}),DSQueryType.select="select",DSQueryType.join="join",DSQueryType.union="union",DSQueryType.system="system",DSQueryType.constant="constant";const{constant:app_QT_CONSTANT,join:app_QT_JOIN,select:app_QT_SELECT,system:app_QT_SYSTEM,union:app_QT_UNION}=app_DSQueryType,app_EDITABLE_QUERY_TYPES=[app_QT_CONSTANT,app_QT_JOIN,app_QT_SELECT,app_QT_UNION],app_READ_ONLY_QUERY_TYPES=[app_QT_SYSTEM];var app_browser_symbol=__webpack_require__(897),app_browser_symbol_default=__webpack_require__.n(app_browser_symbol),app_browser_sprite_build=__webpack_require__(42),app_browser_sprite_build_default=__webpack_require__.n(app_browser_sprite_build),app_symbol=new(app_browser_symbol_default())({id:"icon-left-join",use:"icon-left-join-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-left-join">\n  <g fill="currentColor" class="icon-color__main"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.8119 17.0839C13.7355 17.6643 14.8286 18 16 18C19.3137 18 22 15.3137 22 12C22 8.68629 19.3137 6 16 6C14.8286 6 13.7355 6.3357 12.8119 6.91614C13.0589 7.14999 13.2888 7.40165 13.4997 7.66906C14.2352 7.24354 15.0891 7 16 7C18.7614 7 21 9.23858 21 12C21 14.7614 18.7614 17 16 17C15.0891 17 14.2352 16.7565 13.4997 16.3309C13.2888 16.5983 13.0589 16.85 12.8119 17.0839Z" /><path d="M8 6C4.68629 6 2 8.68629 2 12C2 15.3137 4.68629 18 8 18C9.53671 18 10.9385 17.4223 12 16.4722C10.7725 15.3736 10 13.777 10 12C10 10.223 10.7725 8.62643 12 7.52779C10.9385 6.57771 9.53671 6 8 6Z" /><path d="M12.6876 8.2545C11.6526 9.17057 11 10.5091 11 12C11 13.4909 11.6526 14.8294 12.6876 15.7455C13.5089 14.719 14 13.4168 14 12C14 10.5832 13.5089 9.28101 12.6876 8.2545Z" /></g>\n</symbol>'}),app_result=app_browser_sprite_build_default().add(app_symbol);const app_left_join=app_symbol;var app_right_join_symbol=new(app_browser_symbol_default())({id:"icon-right-join",use:"icon-right-join-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-right-join">\n  <g fill="currentColor" class="icon-color__main"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.1881 17.0839C10.2645 17.6643 9.17144 18 8.00002 18C4.6863 18 2 15.3137 2 12C2 8.68629 4.6863 6 8.00002 6C9.17144 6 10.2645 6.3357 11.1881 6.91614C10.9411 7.14999 10.7112 7.40165 10.5003 7.66906C9.7648 7.24354 8.91085 7 8.00002 7C5.23859 7 3 9.23858 3 12C3 14.7614 5.23859 17 8.00002 17C8.91085 17 9.7648 16.7565 10.5003 16.3309C10.7112 16.5983 10.9411 16.85 11.1881 17.0839Z" /><path d="M16 6C19.3137 6 22 8.68629 22 12C22 15.3137 19.3137 18 16 18C14.4633 18 13.0615 17.4223 12 16.4722C13.2275 15.3736 14 13.777 14 12C14 10.223 13.2275 8.62643 12 7.52779C13.0615 6.57771 14.4633 6 16 6Z" /><path d="M11.3124 8.2545C12.3474 9.17057 13 10.5091 13 12C13 13.4909 12.3474 14.8294 11.3124 15.7455C10.4911 14.719 10 13.4168 10 12C10 10.5832 10.4911 9.28101 11.3124 8.2545Z" /></g>\n</symbol>'}),app_right_join_result=app_browser_sprite_build_default().add(app_right_join_symbol);const app_right_join=app_right_join_symbol;var app_inner_join_symbol=new(app_browser_symbol_default())({id:"icon-inner-join",use:"icon-inner-join-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-inner-join">\n  <g fill="currentColor" class="icon-color__main"><path d="M12 16.4722C13.2275 15.3735 14 13.777 14 12C14 10.223 13.2275 8.62646 12 7.52783C10.7725 8.62646 10 10.223 10 12C10 13.777 10.7725 15.3735 12 16.4722Z" /><path d="M10.5004 16.3309C9.76486 16.7564 8.91087 17 8 17C5.23858 17 3 14.7614 3 12C3 9.23858 5.23858 7 8 7C8.91086 7 9.76484 7.24356 10.5003 7.66911C10.7112 7.4016 10.9412 7.14993 11.1881 6.91615C10.2644 6.3357 9.17142 6 8 6C4.68629 6 2 8.68629 2 12C2 15.3137 4.68629 18 8 18C9.17144 18 10.2645 17.6643 11.1881 17.0838C10.9412 16.8501 10.7113 16.5984 10.5004 16.3309Z" /><path d="M16 17C18.7614 17 21 14.7614 21 12C21 9.23858 18.7614 7 16 7C15.0892 7 14.2352 7.24356 13.4997 7.66911C13.2888 7.4016 13.0588 7.14992 12.8119 6.91615C13.7356 6.3357 14.8286 6 16 6C19.3137 6 22 8.68629 22 12C22 15.3137 19.3137 18 16 18C14.8286 18 13.7356 17.6643 12.8119 17.0838C13.0588 16.8501 13.2887 16.5984 13.4996 16.3309C14.2352 16.7564 15.0891 17 16 17Z" /></g>\n</symbol>'}),app_inner_join_result=app_browser_sprite_build_default().add(app_inner_join_symbol);const app_inner_join=app_inner_join_symbol;var app_full_join_symbol=new(app_browser_symbol_default())({id:"icon-full-join",use:"icon-full-join-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-full-join">\n  <g fill="currentColor" class="icon-color__main"><path d="M12 16.4723C13.2275 15.3736 14 13.777 14 12C14 10.223 13.2275 8.62647 12 7.52783C10.7725 8.62647 10 10.223 10 12C10 13.777 10.7725 15.3736 12 16.4723Z" /><path d="M22 12.0029C22 15.3166 19.3137 18.0029 16 18.0029C14.8286 18.0029 13.7356 17.6672 12.8119 17.0868C14.1581 15.8121 15 14.0052 15 12.0029C15 10.0006 14.1581 8.1937 12.8119 6.91905C13.7355 6.3386 14.8286 6.00289 16 6.00289C19.3137 6.00289 22 8.68918 22 12.0029Z" /><path d="M11.1881 6.91616C9.84189 8.19081 9 9.99772 9 12C9 14.0023 9.84187 15.8092 11.1881 17.0839C10.2644 17.6643 9.17141 18 8 18C4.68629 18 2 15.3137 2 12C2 8.68629 4.68629 6 8 6C9.17143 6 10.2645 6.33571 11.1881 6.91616Z" /></g>\n</symbol>'}),app_full_join_result=app_browser_sprite_build_default().add(app_full_join_symbol);const app_full_join=app_full_join_symbol;var app_union_symbol=new(app_browser_symbol_default())({id:"icon-union",use:"icon-union-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-union">\n  <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" class="icon-color__main" d="M5 6.5C5 5.67157 5.67157 5 6.5 5C7.32843 5 8 5.67157 8 6.5V12C8 14.2091 9.79086 16 12 16C14.2091 16 16 14.2091 16 12V6.5C16 5.67157 16.6716 5 17.5 5C18.3284 5 19 5.67157 19 6.5V12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12V6.5Z" />\n</symbol>'}),app_union_result=app_browser_sprite_build_default().add(app_union_symbol);const app_union=app_union_symbol;var app_group_by_symbol=new(app_browser_symbol_default())({id:"icon-group-by",use:"icon-group-by-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-group-by">\n  <g transform="scale(0.9) translate(1,1)"><path fill="currentColor" d="M5,6H1C0.4,6,0,5.6,0,5V1c0-0.6,0.4-1,1-1h4c0.6,0,1,0.4,1,1v4C6,5.6,5.6,6,5,6z M2,4h2V2H2V4z" /><path d="M23,6h-4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1h4c0.6,0,1,0.4,1,1v4C24,5.6,23.6,6,23,6z M20,4h2V2h-2V4z" /><path d="M5,24H1c-0.6,0-1-0.4-1-1v-4c0-0.6,0.4-1,1-1h4c0.6,0,1,0.4,1,1v4C6,23.6,5.6,24,5,24z M2,22h2v-2H2V22z" /><path d="M23,24h-4c-0.6,0-1-0.4-1-1v-4c0-0.6,0.4-1,1-1h4c0.6,0,1,0.4,1,1v4C24,23.6,23.6,24,23,24z M20,22h2v-2h-2V22z" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M20,5" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M20,19" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M2,5" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M3,18" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M5,4" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M19,4" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6,21" /><path stroke="#2D2D2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M19,20" /><path d="M3,20c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1s1,0.4,1,1v14C4,19.6,3.6,20,3,20z" /><path d="M19,22H5c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S19.6,22,19,22z" /><path d="M21,20c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1s1,0.4,1,1v14C22,19.6,21.6,20,21,20z" /><path d="M19,4H5C4.4,4,4,3.6,4,3s0.4-1,1-1h14c0.6,0,1,0.4,1,1S19.6,4,19,4z" /></g>\n</symbol>'}),app_group_by_result=app_browser_sprite_build_default().add(app_group_by_symbol);const app_group_by=app_group_by_symbol;var app_where_symbol=new(app_browser_symbol_default())({id:"icon-where",use:"icon-where-usage",viewBox:"0 0 24 24",content:'<symbol viewBox="0 0 24 24" id="icon-where">\n  <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3 4C3 3.44772 3.44772 3 4 3H20C20.5523 3 21 3.44772 21 4V7.25736C21 8.31823 20.5786 9.33564 19.8284 10.0858L15 14.9142V18C15 19.6569 13.6569 21 12 21C10.3431 21 9 19.6569 9 18V14.9142L4.17157 10.0858C3.42143 9.33564 3 8.31823 3 7.25736V4ZM5 5V7.25736C5 7.78779 5.21071 8.2965 5.58579 8.67157L11 14.0858V18C11 18.5523 11.4477 19 12 19C12.5523 19 13 18.5523 13 18V14.0858L18.4142 8.67157C18.7893 8.2965 19 7.78779 19 7.25736V5H5Z" />\n</symbol>'}),app_where_result=app_browser_sprite_build_default().add(app_where_symbol);const app_where=app_where_symbol;class app_GraphIcons{static getIcon(t,e=void 0){switch(t){case app_CellType.constant:case app_CellType.system:case app_CellType.select:return"";case app_CellType.join:return void 0!==e?this.getJoinIcon(e):"";case app_CellType.union:return this.getUnionIcon();case app_CellType.group_by:return this.getGroupByIcon();case app_CellType.where:return this.getWhereIcon()}}static getJoinIcon(t){switch(t.toLowerCase()){case app_JoinType.left:return this.getLeftJoinIcon();case app_JoinType.right:return this.getRightJoinIcon();case app_JoinType.inner:return this.getInnerJoinIcon();case app_JoinType.full:return this.getFullJoinIcon();default:return""}}static getLeftJoinIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_left_join.id}"/></svg>`}static getRightJoinIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_right_join.id}"/></svg>`}static getInnerJoinIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_inner_join.id}"/></svg>`}static getFullJoinIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_full_join.id}"/></svg>`}static getUnionIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_union.id}"/></svg>`}static getGroupByIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_group_by.id}"/></svg>`}static getWhereIcon(){return`<svg width="${this.iconSize}" height="${this.iconSize}"><use href="#${app_where.id}"/></svg>`}static setIconSize(t){this.iconSize=t}}app_GraphIcons.iconSize=24;class app_VisualizerCellManager{constructor(t){this.cellExists=t=>{for(const e of this.visualizerGraph.getSchemeCells())if(e.info.id===t)return!0;return!1},this.addArrow=(t,e)=>{const i=this.visualizerGraph.getGraph(),s=i.getDefaultParent();i.insertEdge({parent:s,source:t,target:e})},this.getVisualizerCellByCell=t=>{for(const e of this.visualizerGraph.getSchemeCells())if(e.cell===t)return e},this.getVisualizerCellById=t=>{for(const e of this.visualizerGraph.getSchemeCells())if(e.info.id===t)return e},this.visualizerGraph=t}createSystemCell(t,e){this.createCell({id:t,name:e,type:app_VisualizerCellType.System})}createSelectCell(t,e,i){this.createCell({id:t,name:void 0!==i?i:"SELECT",type:app_VisualizerCellType.Select,extra:e})}createJoinCell(t,e,i){this.createCell({id:t,name:e.toUpperCase()+" JOIN",type:app_VisualizerCellType.Join,hint:i})}createUnionCell(t){this.createCell({id:t,name:"UNION",type:app_VisualizerCellType.Union})}createWhereCell(t,e){this.createCell({id:t,name:"WHERE",type:app_VisualizerCellType.Where,hint:e})}createGroupByCell(t,e){this.createCell({id:t,name:"GROUP BY",type:app_VisualizerCellType.GroupBy,hint:e})}updateCellStyle(t,e){const i=this.visualizerGraph.getGraph(),s=Object.assign({},i.getCellStyle(t));for(const t in e){const i=e[t];void 0!==i&&(s[t]=i)}i.getDataModel().setStyle(t,s)}isSelected(t){return t===this.visualizerGraph.getSelectedCell()}getOutgoingCells(t){const e=[];for(const i of t.getOutgoingEdges()){const t=i.getTerminal(!1);null!==t&&e.push(t)}return e}selectCell(t){const e=this.visualizerGraph.getSelectedCell();void 0!==e&&this.unselectCell(e);const i=this.getVisualizerCellByCell(t);void 0!==i&&void 0!==i.info.type.selectedStyle&&this.updateCellStyle(t,i.info.type.selectedStyle),this.visualizerGraph.setSelectedCell(t)}unselectCell(t){const e=this.getVisualizerCellByCell(t);void 0!==e&&this.updateCellStyle(t,e.info.type.defaultStyle),this.visualizerGraph.setSelectedCell(void 0)}centerCell(t){const e=this.visualizerGraph.getGraph().getView(),i=e.getState(t);if(null===i)return;const s=e.getScale(),n=e.getTranslate(),l=this.visualizerGraph.getContainer(),a=(i.x+i.width/2)/s-n.x,r=(i.y+i.height/2)/s-n.y,o=l.clientWidth/2/s,h=l.clientHeight/2/s,p=new app_Point.A(o-a,h-r);if(n.x===p.x&&n.y===p.y)return;const d=this.visualizerGraph.getTooltip();d.isVisible()&&d.hideTooltip(),this.visualizerGraph.getGraphAnimation().translateGraph(p)}toggleExtraContent(t){const e=this.visualizerGraph.getGraph();void 0!==t.info.expanded&&t.info.expanded?e.getDataModel().setValue(t.cell,t.info.name):e.getDataModel().setValue(t.cell,`<div style="padding:5px;">${t.info.name}<hr><p style="text-align:left">${t.info.extra}</p></div>`),t.info.expanded=!t.info.expanded,e.updateCellSize(t.cell),this.visualizerGraph.layoutGraph()}highlightCells(t){void 0!==this.highlightCells&&this.unhighlightCells();for(const e of t){const t=this.getVisualizerCellByCell(e);void 0!==t&&void 0!==t.info.type.highlightedStyle&&this.updateCellStyle(e,t.info.type.highlightedStyle)}this.visualizerGraph.setHighlightedCells(t)}unhighlightCells(){for(const t of this.visualizerGraph.getHighlightedCells()){const e=this.getVisualizerCellByCell(t);void 0!==e&&this.updateCellStyle(t,e.info.type.defaultStyle)}this.visualizerGraph.setHighlightedCells([])}createCell(t){const e=this.visualizerGraph.getGraph(),i=e.getDefaultParent();let s,n;s=t.type.name===app_CellType.join?app_GraphIcons.getIcon(t.type.name,t.name.split(" ")[0]):app_GraphIcons.getIcon(t.type.name),n=""!==s?`<div>${s}</div>`:void 0!==t.extra&&void 0!==t.expanded&&t.expanded?`<div>${t.name}<hr><p style="text-align:left">${t.extra}</p></div>`:t.name;const l=e.insertVertex({parent:i,position:[50,50],size:[8*t.name.length,25],value:n});this.updateCellStyle(l,t.type.defaultStyle),e.updateCellSize(l),e.scrollCellToVisible(l);const a={cell:l,info:t};return this.addVisualizerCell(a),a}addVisualizerCell(t){this.visualizerGraph.getSchemeCells().push(t)}makeSelect(t,e){const i=this.getVisualizerCellById(t),s=this.getVisualizerCellById(e);void 0!==i&&void 0!==s&&this.addArrow(s.cell,i.cell)}makeWhere(t,e){const i=this.getVisualizerCellById(t),s=this.getVisualizerCellById(e);void 0!==i&&void 0!==s&&this.addArrow(s.cell,i.cell)}makeGroupBy(t,e){const i=this.getVisualizerCellById(t),s=this.getVisualizerCellById(e);void 0!==i&&void 0!==s&&this.addArrow(s.cell,i.cell)}makeJoin(t,e,i){const s=this.getVisualizerCellById(t),n=this.getVisualizerCellById(e),l=this.getVisualizerCellById(i);void 0!==s&&void 0!==n&&void 0!==l&&(this.addArrow(l.cell,s.cell),this.addArrow(l.cell,n.cell))}makeUnion(t,e){const i=[];for(const e of t){const t=this.getVisualizerCellById(e);void 0!==t&&i.push(t)}const s=this.getVisualizerCellById(e);if(void 0!==s&&0!==i.length)for(const t of i)this.addArrow(s.cell,t.cell)}}class app_GraphTooltipFormatter{static makeHintForField(t){return this.makeHintForExpression(t.expression,t.type)}static makeHintForExpression(t,e=void 0){return Object.entries(app_AggregateFunctions).forEach((e=>{for(const i of e){const e=new RegExp(`${i}\\(`,"g");t=t.replace(e,`<font color="orangered">${i}</font>(`)}})),void 0!==e?`${t}: <font color="green">${e}</font>`:t}static makeHintForCondition(t){return Object.entries(app_LineConditionOperators).forEach((e=>{for(const i of e){const e=new RegExp(` ${i} `,"g");t=t.replace(e,`\n${i} `)}})),t}}class app_VisualizerQueryManager{constructor(t){this.queries={},this.cellManager=t}makeScheme(t){this.queries=t.queries;const e=t.rootId,i=this.queries[e];switch(i.type){case app_DSQueryType.constant:this.processConstantQuery(i,e);break;case app_DSQueryType.select:this.processSelectQuery(i,e);break;case app_DSQueryType.join:this.processJoinQuery(i,e);break;case app_DSQueryType.union:this.processUnionQuery(i,e)}}processConstantQuery(t,e,i=void 0){if(!this.cellManager.cellExists(e)){const s=[];for(const e of t.select)s.push(app_GraphTooltipFormatter.makeHintForField(e));this.cellManager.createSelectCell(e,s.join("\n"),i)}return e}processSelectQuery(t,e,i=void 0){let s=t.from;if(s=this.processSubquery(this.queries[s],s,t.fromAs),void 0!==t.groupBy){const i=e+"-g",n=[];for(const e of t.groupBy)n.push(app_GraphTooltipFormatter.makeHintForField(t.select[e]));this.cellManager.createGroupByCell(i,n.join("\n")),this.cellManager.makeGroupBy(s,i),s=i}if(void 0!==t.where){const i=e+"-w",n=[];for(const e of t.where)n.push(e.expression);this.cellManager.createWhereCell(i,n.join("\n")),this.cellManager.makeWhere(s,i),s=i}if(!this.cellManager.cellExists(e)){const s=[];for(const e of t.select)s.push(app_GraphTooltipFormatter.makeHintForField(e));this.cellManager.createSelectCell(e,s.join("\n"),i)}return this.cellManager.makeSelect(s,e),e}processJoinQuery(t,e,i=void 0){const s=t.joinSources;let n=s.root.source.from;n=this.processSubquery(this.queries[n],n,s.root.source.fromAs);for(const t of s.root.relations){const i=s.relationIndex[t];let l=this.processSubquery(this.queries[i.source.from],i.source.from,i.source.fromAs);if(!this.cellManager.cellExists(t)){const s=app_GraphTooltipFormatter.makeHintForCondition(i.condition);this.cellManager.createJoinCell(`${e}-${t}`,i.type,s)}this.cellManager.makeJoin(n,l,`${e}-${t}`),n=this.processJoinRelation(s,t,e)}let l=n;if(void 0!==t.groupBy){const i=e+"-g",s=[];for(const e of t.groupBy)s.push(app_GraphTooltipFormatter.makeHintForField(t.select[e]));this.cellManager.createGroupByCell(i,s.join("\n")),this.cellManager.makeGroupBy(n,i),l=i}if(void 0!==t.where){const i=e+"-w",s=[];for(const e of t.where)s.push(e.expression);this.cellManager.createWhereCell(i,s.join(app_LineConditionOperators.AND+"\n")),this.cellManager.makeWhere(l,i),l=i}if(!this.cellManager.cellExists(e)){const s=[];for(const e of t.select)s.push(app_GraphTooltipFormatter.makeHintForField(e));this.cellManager.createSelectCell(e,s.join("\n"),i)}return this.cellManager.makeSelect(l,e),e}processUnionQuery(t,e,i=void 0){const s=[];for(const e of t.unions){let t=e.from;t=this.processSubquery(this.queries[t],t,e.fromAs),s.push(e.from)}const n=e+"-u";if(this.cellManager.cellExists(n)||this.cellManager.createUnionCell(n),this.cellManager.makeUnion(s,n),!this.cellManager.cellExists(e)){const s=[];for(let e=0;e<t.select.length;e++){const i=[];for(let s=0;s<t.unions.length;s++)null!==t.select[e].expressionUnion[s]?i.push(t.unions[s].fromAs+"."+t.select[e].expressionUnion[s]):i.push("null");s.push(app_GraphTooltipFormatter.makeHintForExpression(i.join(" | "),t.select[e].type))}this.cellManager.createSelectCell(e,s.join("\n"),i),this.cellManager.makeSelect(n,e)}return e}processSubquery(t,e,i){switch(t.type){case app_DSQueryType.system:return this.processSystemTable(e,i);case app_DSQueryType.constant:return this.processConstantQuery(t,e,i);case app_DSQueryType.select:return this.processSelectQuery(t,e,i);case app_DSQueryType.join:return this.processJoinQuery(t,e,i);case app_DSQueryType.union:return this.processUnionQuery(t,e,i)}}processSystemTable(t,e){return this.cellManager.cellExists(t)||this.cellManager.createSystemCell(t,e),t}getSelectSources(t){const e=[];return this.getSelectSourcesRecursively(t,e),e}getSelectSourcesRecursively(t,e){const i=this.cellManager.getOutgoingCells(t);if(0!==i.length)for(const t of i){const i=this.cellManager.getVisualizerCellByCell(t);void 0===i||i.info.type.name!==app_CellType.system&&i.info.type.name!==app_CellType.select?this.getSelectSourcesRecursively(t,e):e.push(t)}}processJoinRelation(t,e,i){const s=t.relationIndex[e];let n=`${i}-${e}`;for(const e of s.relations){const s=t.relationIndex[e];let l=this.processSubquery(this.queries[s.source.from],s.source.from,s.source.fromAs);if(!this.cellManager.cellExists(e)){const t=app_GraphTooltipFormatter.makeHintForCondition(s.condition);this.cellManager.createJoinCell(`${i}-${e}`,s.type,t)}this.cellManager.makeJoin(n,l,`${i}-${e}`),n=this.processJoinRelation(t,e,i)}return n}}class app_VisualizerGraph{constructor(t,e=void 0){this.graph=new app_Graph(t),this.graphHandlers=new app_VisualizerGraphHandlers(this),this.initGraph(),this.cellManager=new app_VisualizerCellManager(this),this.queryManager=new app_VisualizerQueryManager(this.cellManager),this.container=t,this.initContainer(),this.editorHandler=e,this.graphAnimation=new app_GraphAnimation(this.graph,app_EasingFunctions.easeInOutQuad),this.graphAnimation.setDuration(500),this.tooltip=new app_VisualizerTooltip(t,this.graph),this.layout=new app_VisualizerLayout(this.graph),this.visualizerCells=[],this.highlightedCells=[],this.selectedCell=void 0}initGraph(){this.graph.setCellsMovable(!1),this.graph.setCellsResizable(!1),this.graph.setCellsSelectable(!1),this.graph.setPanning(!1),this.graph.setHtmlLabels(!0),this.graph.isCellEditable=()=>!1;const t=new app_TooltipMouseHandler(this);this.graph.addMouseListener(t),this.graph.addListener(app_InternalEvent.A.CLICK,this.graphHandlers.getClickHandler()),this.graph.addListener(app_InternalEvent.A.DOUBLE_CLICK,this.graphHandlers.getDoubleClickHandler())}initContainer(){const t=new app_VisualizerToolbarBuilder(this).addZoomToFitButton().addCurrentScaleTile().addZoomInButton().addZoomOutButton().addTileGap(30).addLayoutHorizontallyButton().addLayoutVerticallyButton().addTileGap(30).addShowExtra().addTileGap(30).getToolbar();this.container.prepend(t),this.container.addEventListener("mousedown",this.graphHandlers.getMouseDownHandler()),this.container.addEventListener("mousemove",this.graphHandlers.getMouseMoveHandler()),this.container.addEventListener("mouseup",this.graphHandlers.getMouseUpHandler()),this.container.addEventListener("wheel",this.graphHandlers.getWheelHandler())}drawGraph(t){this.graph.getDataModel().clear(),this.visualizerCells=[],this.graph.batchUpdate((()=>{try{this.queryManager.makeScheme(t)}catch(t){return void console.error("Произошла ошибка при попытке визуализировать модель запроса: передан некорректный объект")}this.layoutGraph(),this.graph.cellsOrdered(this.graph.getChildVertices(this.graph.getDefaultParent()),!1)}))}getGraph(){return this.graph}getTooltip(){return this.tooltip}getContainer(){return this.container}getLayout(){return this.layout}layoutGraph(){this.layout.layoutGraph()}setHorizontalLayout(t){this.layout.setHorizontalLayout(t)}showExtraContent(){for(const t of this.visualizerCells)void 0===t.info.extra||t.info.expanded||this.cellManager.toggleExtraContent(t)}hideExtraContent(){for(const t of this.visualizerCells)void 0!==t.info.extra&&t.info.expanded&&this.cellManager.toggleExtraContent(t)}clickCell(t){const e=this.cellManager.getVisualizerCellByCell(t);if(void 0!==e){if(this.graph.getDataModel().beginUpdate(),app_SELECTABLE_CELL_TYPES.includes(e.info.type.name))if(this.cellManager.isSelected(t))this.cellManager.unselectCell(t),this.cellManager.unhighlightCells();else{this.cellManager.centerCell(t),this.cellManager.selectCell(t);const e=this.queryManager.getSelectSources(t);this.cellManager.highlightCells(e)}else void 0!==e.info.extra&&this.cellManager.toggleExtraContent(e);this.graph.getDataModel().endUpdate()}}doubleClickCell(t){const e=this.cellManager.getVisualizerCellByCell(t);if(void 0!==e&&void 0!==this.editorHandler&&app_EDITABLE_CELL_TYPES.includes(e.info.type.name)){const t=this.editorHandler(`${e.info.name} (${e.info.id})`);void 0!==t&&this.drawGraph(t)}}hoverOnCell(t){if(null!==t&&t.vertex){const e=this.cellManager.getVisualizerCellByCell(t);if(void 0===e)return void(this.container.style.cursor="default");if(void 0!==e.info.hint){const i=e.info.hint.split("\n");i.length>1?this.tooltip.showTooltipTexts(t,i):this.tooltip.showTooltipText(t,e.info.hint)}app_SELECTABLE_CELL_TYPES.includes(e.info.type.name)||app_EDITABLE_CELL_TYPES.includes(e.info.type.name)||void 0!==e.info.extra?this.container.style.cursor="pointer":this.container.style.cursor="default"}else"default"!=this.container.style.cursor&&(this.container.style.cursor="default"),this.tooltip.isVisible()&&this.tooltip.hideTooltip()}zoomIn(){this.graph.getView().getScale()>=10||(this.graph.zoomIn(),this.graph.getView().getScale()>10&&this.graph.getView().setScale(10))}zoomOut(){this.graph.getView().getScale()<=.1||(this.graph.zoomOut(),this.graph.getView().getScale()<.1&&this.graph.getView().setScale(.1))}zoomToFit(t){if(this.graph.getChildVertices().length<=1)return;const e=this.graph.getGraphBounds(),i=this.graph.getView().getScale(),s=this.container.clientWidth-2*t,n=this.container.clientHeight-2*t,l=s/(e.width/i),a=n/(e.height/i),r=Math.min(l,a),o=new app_Point.A(0,0);this.graphAnimation.scaleAndTranslate(r,o)}getSchemeCells(){return this.visualizerCells}getSelectedCell(){return this.selectedCell}getGraphAnimation(){return this.graphAnimation}setGraphAnimation(t){this.graphAnimation=t}setSelectedCell(t){this.selectedCell=t}getHighlightedCells(){return this.highlightedCells}setHighlightedCells(t){this.highlightedCells=t}}class app_AppModelVisualizer{constructor(t,e){const i=document.getElementById(t);i?this.schemeGraph=new app_VisualizerGraph(i,e):(console.error("Приложение не может работать, т.к. не был найден контейнер с id "+t),this.schemeGraph=void 0)}visualizeQuery(t){void 0!==this.schemeGraph&&this.schemeGraph.drawGraph(t)}}const app_app=app_AppModelVisualizer;var __webpack_exports__AppModelVisualizer=__webpack_exports__.h,__webpack_exports__default=__webpack_exports__.A;export{__webpack_exports__AppModelVisualizer as AppModelVisualizer,__webpack_exports__default as default};